<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta name="google-site-verification" content="5_8DTmIiEq4gFvNAfxAD6TsGOgrMAjp8lQFQvfA6zZc" />
    <title>/var/</title>
    <meta name="author" content="Serafeim Papastefanos">


    
<style type="text/css">
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: var(--jp-cell-editor-active-background) }
.highlight { background: var(--jp-cell-editor-background); color: var(--jp-mirror-editor-variable-color) }
.highlight .c { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment */
.highlight .err { color: var(--jp-mirror-editor-error-color) } /* Error */
.highlight .k { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword */
.highlight .o { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator */
.highlight .p { color: var(--jp-mirror-editor-punctuation-color) } /* Punctuation */
.highlight .ch { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Multiline */
.highlight .cp { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Preproc */
.highlight .cpf { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Single */
.highlight .cs { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Special */
.highlight .kc { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Type */
.highlight .m { color: var(--jp-mirror-editor-number-color) } /* Literal.Number */
.highlight .s { color: var(--jp-mirror-editor-string-color) } /* Literal.String */
.highlight .ow { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator.Word */
.highlight .pm { color: var(--jp-mirror-editor-punctuation-color) } /* Punctuation.Marker */
.highlight .w { color: var(--jp-mirror-editor-variable-color) } /* Text.Whitespace */
.highlight .mb { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Bin */
.highlight .mf { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Float */
.highlight .mh { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Hex */
.highlight .mi { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer */
.highlight .mo { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Oct */
.highlight .sa { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Affix */
.highlight .sb { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Backtick */
.highlight .sc { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Char */
.highlight .dl { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Delimiter */
.highlight .sd { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Doc */
.highlight .s2 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Double */
.highlight .se { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Escape */
.highlight .sh { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Heredoc */
.highlight .si { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Interpol */
.highlight .sx { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Other */
.highlight .sr { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Regex */
.highlight .s1 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Single */
.highlight .ss { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Symbol */
.highlight .il { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer.Long */
</style>

<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
div.entry-content {
  overflow: visible;
  padding: 8px;
}
.input_area {
  padding: 0.2em;
}

a.heading-anchor {
 white-space: normal;
}

.rendered_html
code {
 font-size: .8em;
}

pre.ipynb {
  color: black;
  background: #f7f7f7;
  border: none;
  box-shadow: none;
  margin-bottom: 0;
  padding: 0;
  margin: 0px;
  font-size: 13px;
}

/* remove the prompt div from text cells */
div.text_cell .prompt {
    display: none;
}

/* remove horizontal padding from text cells, */
/* so it aligns with outer body text */
div.text_cell_render {
    padding: 0.5em 0em;
}

img.anim_icon{padding:0; border:0; vertical-align:middle; -webkit-box-shadow:none; -box-shadow:none}

div.collapseheader {
    width=100%;
    background-color:#d3d3d3;
    padding: 2px;
    cursor: pointer;
    font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
}
</style>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true,
        displayMath: [['$$','$$'], ["\\[","\\]"]]
    }
});
</script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<script type="text/javascript">
jQuery(document).ready(function($) {
    $("div.collapseheader").click(function () {
    $header = $(this).children("span").first();
    $codearea = $(this).children(".input_area");
    console.log($(this).children());
    $codearea.slideToggle(500, function () {
        $header.text(function () {
            return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
        });
    });
});
});
</script>




    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="https://www.spapas.net/favicon.png" rel="icon">

    <link href="https://www.spapas.net/theme/css/main.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://www.spapas.net/theme/css/extra_style.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://fonts.googleapis.com/css?family=Fira+Mono|Fira+Sans:400,700&amp;subset=greek" rel="stylesheet">

<style>
#gHPzseYvFrhZ123 {
  padding: 5px !important;
  display: block;
  margin-bottom: 10px !important;
  background: #900;
  color: #fff;
  border-radius: 5px;
  font-size: 1.0rem !important;
}
</style>


  <script>
    
      
  </script>

    <script data-ad-client="ca-pub-7673322832689008" async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
      onerror="adBlockFunction();"></script>
  </head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="https://www.spapas.net/">/var/</a></h1>
    <h2>Various programming stuff</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li >
        <a href="https://www.spapas.net/category/ai.html">Ai</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/android.html">Android</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/clojure.html">Clojure</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/css.html">Css</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/django.html">Django</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/elixir.html">Elixir</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/flask.html">Flask</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/gaming.html">Gaming</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/git.html">Git</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/html.html">Html</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/javascript.html">Javascript</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/networking.html">Networking</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/pelican.html">Pelican</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/postgresql.html">Postgresql</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/python.html">Python</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/spring.html">Spring</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/unix.html">Unix</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/wagtail.html">Wagtail</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
    <div id="gHPzseYvFrhZ123">
      Hello! If you are using an ad blocker but find something useful here 
      and want to support me please consider disabling your ad blocker for this site. 
      <br />
      <br />
      Thank you,<br />
      Serafeim
      
    </div>
<div class="blog-index">
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2015/05/27/using-browserify-watchify/">Using browserify and watchify to improve your client-side-javascript workflow</a>
      </h1>
    <p class="meta">
<time datetime="2015-05-27T14:20:00+03:00" pubdate>Wed 27 May 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title"><a class="reference internal" href="#top">Contents</a></p>
<ul class="simple">
<li><a class="reference internal" href="#the-problem" id="toc-entry-1">The&nbsp;problem</a></li>
<li><a class="reference internal" href="#the-solution" id="toc-entry-2">The&nbsp;solution</a></li>
<li><a class="reference internal" href="#installing-required-tools" id="toc-entry-3">Installing required&nbsp;tools</a></li>
<li><a class="reference internal" href="#starting-your-node-js-project" id="toc-entry-4">Starting your (node.js)&nbsp;project</a></li>
<li><a class="reference internal" href="#running-browserify-for-the-first-time" id="toc-entry-5">Running browserify for the first&nbsp;time</a></li>
<li><a class="reference internal" href="#using-external-libraries" id="toc-entry-6">Using external&nbsp;libraries</a></li>
<li><a class="reference internal" href="#introducing-watchify" id="toc-entry-7">Introducing&nbsp;watchify</a></li>
<li><a class="reference internal" href="#creating-your-own-modules" id="toc-entry-8">Creating your own&nbsp;modules</a></li>
<li><a class="reference internal" href="#uglifying-your-bundle" id="toc-entry-9">Uglifying your&nbsp;bundle</a></li>
<li><a class="reference internal" href="#the-client-side-javascript-workflow" id="toc-entry-10">The client-side javascript&nbsp;workflow</a></li>
<li><a class="reference internal" href="#conlusion" id="toc-entry-11">Conlusion</a></li>
</ul>
</div>
<div class="section" id="the-problem">
<h2><a class="toc-backref" href="#toc-entry-1">The&nbsp;problem</a></h2>
<p>Once upon a time, when people started using client-side code to their projects they (mainly
due to the lack of decent client-side libraries but also because of the <a class="reference external" href="http://en.wikipedia.org/wiki/Not_invented_here"><span class="caps">NIH</span> syndrome</a>)
were just adding their own code in script nodes or .js files using <tt class="docutils literal">document.getElementById</tt> to manipulate
the <span class="caps">DOM</span> (good luck checking for all possible browser-edge cases)
and <tt class="docutils literal">window.XMLHttpRequest</tt> to try doing <span class="caps">AJAX</span>.</p>
<p>After these dark-times, the
age of javascript-framework came: prototype, jquery, dojo. These were (and still are)
some great libraries (even <span class="caps">NIH</span>-sick people used them to handle browser incompatibilities):
You just downloaded the .js file with the framework, put it inside your project
static files and added it to your page with a script tag and then filled your client-side
code with funny $(&#8216;#id&#8217;)&nbsp;symbols!</p>
<p>Coming to the modern age in client-side development, the number of decent libraries has greatly increased
and instead of monolithic frameworks there are different libraries for different needs. So instead of
just downloading a single file and adding the script node for that file to your <span class="caps">HTML</span>, you need to
download the required javascript files, put them all in your static files directory and then micro-manage
the script nodes for each of your pages depending on which libraries each page needs! So if you want
to use (for example) moment.js to your client-side code you need to go to <em>all</em> <span class="caps">HTML</span> pages that use that
specific client-side code and add a moment.js-script&nbsp;element!</p>
<p>As can be understood this leads to really ugly situations like people avoiding refactoring their code to use
external libraries, using a single-global module  with all their client side code, using <span class="caps">CDN</span> to avoid
downloading the javascript libraries and of course never upgrade their javascript&nbsp;libraries!</p>
</div>
<div class="section" id="the-solution">
<h2><a class="toc-backref" href="#toc-entry-2">The&nbsp;solution</a></h2>
<p><a class="reference external" href="http://browserify.org/">browserify</a> and <a class="reference external" href="https://github.com/substack/watchify">watchify</a> are two sister tools from the server-side-javascript (node.js and friends)
world that greatly improve your javascript workflow: Using them, you no longer need to micro-manage
your script tags but instead you just declare the libraries each of your client-side modules is
using - or you can even create your own reusable modules! Also, installing (or updating) javascript
libraries is as easy as running a single&nbsp;command!</p>
<p>How are they working? With browserify you create a single <tt class="docutils literal">main.js</tt> for each of your <span class="caps">HTML</span>
pages and in it you declare its requirements using <a class="reference external" href="https://github.com/substack/browserify-handbook#require">require</a>. You&#8217;ll then pass your <tt class="docutils literal">main.js</tt>
through browserify and it will create a single file (e.g <tt class="docutils literal">bundle.js</tt>) that contains all the requirements
(of course each requirement could have other requirements - they&#8217;ll be automatically also
included in the resulting .js file). That&#8217;s the <em>only</em> file you need to put to the script tag of
your <span class="caps">HTML</span>! Using watchify, you can <em>watch</em> your <tt class="docutils literal">main.js</tt> for changes (the changes may also
be in the files included from main.js) and automatically generate the resulting <tt class="docutils literal">bundle.js</tt> so that
you&#8217;ll just need to hit F5 to refresh and get the new&nbsp;version!</p>
<p>browserify not only concatenates your javascript libraries to a single bundle but can also transform
your coffesscript, typescript, jsx etc files to javascrpt and <em>then</em> also add them to the bundle. This
is possible through a concept called transforms &#8212; there are <a class="reference external" href="https://github.com/substack/node-browserify/wiki/list-of-transforms">a lot of transforms</a> that you can&nbsp;use.</p>
<p>Below, I will propose a really simple and generic workflow that should cover most of your javascript needs.
I should mention that I mainly develop django apps and my development machine is running windows, however you
can easily use exactly the  same workflow from any kind of server-side technology (ruby, python, javascript,
java, php or even static <span class="caps">HTML</span> pages!) or development machine (windows, linux, osx) - it&#8217;s exactly the&nbsp;same!</p>
</div>
<div class="section" id="installing-required-tools">
<h2><a class="toc-backref" href="#toc-entry-3">Installing required&nbsp;tools</a></h2>
<p>As already mentioned, you need two node.js tools. Just install them globally using npm (installing
node.js and npm is really easy - there&#8217;s even <a class="reference external" href="https://nodejs.org/download/">a package for windows</a>):</p>
<pre class="code literal-block">
npm install -g browserify watchify
</pre>
<p>The <tt class="docutils literal"><span class="pre">-g</span></tt> switch installs the packages globally so you can use the browserify and watchify commands from
your command prompt - after that entering <tt class="docutils literal">browserify</tt> or <tt class="docutils literal">watchify</tt> from your command prompt should be&nbsp;working.</p>
</div>
<div class="section" id="starting-your-node-js-project">
<h2><a class="toc-backref" href="#toc-entry-4">Starting your (node.js)&nbsp;project</a></h2>
<p>Although you may already have a project structure, in order to use browserify you&#8217;ll need to
create a node.js project (project from now on) that needs just two&nbsp;things:</p>
<ul class="simple">
<li>a <tt class="docutils literal">package.json</tt> that lists various options for your&nbsp;project</li>
<li>a <tt class="docutils literal">node_modules</tt> directory that contains the packages that your project&nbsp;uses</li>
</ul>
<p>To create the <tt class="docutils literal">package.json</tt> you can either copy paste a simple one or run <tt class="docutils literal">npm init</tt> inside
a folder of your project. After <tt class="docutils literal">npm init</tt> you&#8217;ll need to answer a bunch of questions and then
a <tt class="docutils literal">package.json</tt> will be created to the same folder. If you don&#8217;t want to answer these questions
(most probably you only want to use node.js for browserify - instead you wouldn&#8217;t be reading
this) then just put an empty json string <tt class="docutils literal">{}</tt> in <tt class="docutils literal">package.json</tt>.</p>
<p>I recommend adding <tt class="docutils literal">package.json</tt> to the top-level folder of your version-controlled souce-code tree -
please put this file in your version control - the <tt class="docutils literal">node_modules</tt> directory will be be created
to the same directory with <tt class="docutils literal">package.json</tt> and should be ignored by your version&nbsp;control.</p>
</div>
<div class="section" id="running-browserify-for-the-first-time">
<h2><a class="toc-backref" href="#toc-entry-5">Running browserify for the first&nbsp;time</a></h2>
<p>Not the time has come to create a <tt class="docutils literal">main.js</tt> file. This could be put anywhere you like (based on your project structure) -
I&#8221; suppose that <tt class="docutils literal">main.js</tt> is inside the <tt class="docutils literal">src/</tt>  folder of your project.
Just put a <tt class="docutils literal"><span class="pre">console.log(&quot;Hello,</span> world&quot;)</tt> to the <tt class="docutils literal">main.js</tt> for now. To test that everything is working,&nbsp;run:</p>
<pre class="code literal-block">
browserify src/main.js
</pre>
<p>You should see some minified-js gibberish to your console (something like <tt class="docutils literal">(function <span class="pre">e(t,n,r){function</span> <span class="pre">s(o,u){if(!n[o]){if(!t[o]){var</span> a=typeof <span class="pre">...)</span></tt>
) which means that everything works fine. Now, create a <tt class="docutils literal">dist</tt> directory which would contain your bundle files and&nbsp;run</p>
<pre class="code literal-block">
browserify src/main.js -o dist/bundle.js
</pre>
<p>the -o switch will put the the same minified-js gibberish output to the  <tt class="docutils literal">dist/bundle.js</tt> file instead of stdout.
Finally, include a script element with that file to your <span class="caps">HTML</span> and you
should see &#8220;Hello, world&#8221; to your javascript console when opening the <span class="caps">HTML</span>&nbsp;file!</p>
</div>
<div class="section" id="using-external-libraries">
<h2><a class="toc-backref" href="#toc-entry-6">Using external&nbsp;libraries</a></h2>
<p>To use a library from your main.js you need to install it and get a reference to it through require. Let&#8217;s try to use <a class="reference external" href="http://momentjs.com/">moment.js</a>:
To install the library&nbsp;run</p>
<pre class="code literal-block">
npm install moment --save
</pre>
<p>This will create a moment directory inside node_modules that will contain the moment.js library. It will also add a
dependency to your <tt class="docutils literal">package.json</tt> (that&#8217;s what the <tt class="docutils literal"><span class="pre">--save</span></tt> switch does), something like&nbsp;this:</p>
<pre class="code literal-block">
&quot;dependencies&quot;: {
  &quot;moment&quot;: &quot;^2.10.3&quot;
}
</pre>
<p>Whenever you install more client-side libraries they&#8217;ll be saved there. When you want to re-install everything (for instance
when you clone your project) you can just do&nbsp;a</p>
<pre class="code literal-block">
npm install
</pre>
<p>and all dependencies of <tt class="docutils literal">package.json</tt> will be installed in <tt class="docutils literal">node_modules</tt> (that&#8217;s why <tt class="docutils literal">node_modules</tt> should not be&nbsp;tracked).</p>
<p>After you&#8217;ve installed moment.js to your project change <tt class="docutils literal">src/main.js</tt> to:</p>
<pre class="code literal-block">
moment = require('moment')
console.log(moment() );
</pre>
<p>and rerun <tt class="docutils literal">browserify src/main.js <span class="pre">-o</span> dist/bundle.js</tt>. When you reload your <span class="caps">HTML</span> you&#8217;ll see the that you are able to use
moment - all this without changing your <span class="caps">HTML</span>!!!</p>
<p>As you can understand, in order to use a library with browserify, this library must support it by having an npm package. The nice thing is that
most libraries already support it &#8212; let&#8217;s try for another example to use <a class="reference external" href="http://underscorejs.org/">underscore.js</a> and (for some reason) we need version underscore 1.7&nbsp;:</p>
<pre class="code literal-block">
npm install underscore&#64;1.7--save
</pre>
<p>you&#8217;ll se that your package.json dependencies will also contain underscore.js&nbsp;1.7:</p>
<pre class="code literal-block">
{
  &quot;dependencies&quot;: {
    &quot;moment&quot;: &quot;^2.10.3&quot;,
    &quot;underscore&quot;: &quot;^1.7.0&quot;
  }
}
</pre>
<p>If you want to upgrade underscore to the latest version run&nbsp;a:</p>
<pre class="code literal-block">
npm install underscore --upgrade --save
</pre>
<p>and you&#8217;ll see that your <tt class="docutils literal">package.json</tt> will contan the latest version of&nbsp;underscore.js.</p>
<p>Finally, let&#8217;s change our <tt class="docutils literal">src/man.js</tt> to use&nbsp;underscore:</p>
<pre class="code literal-block">
moment = require('moment')
_ = require('underscore')

_([1,2,3]).map(function(x) {
  console.log(x+1);
});
</pre>
<p>After you create your bundle you should se 2 3 4 in your&nbsp;console!</p>
</div>
<div class="section" id="introducing-watchify">
<h2><a class="toc-backref" href="#toc-entry-7">Introducing&nbsp;watchify</a></h2>
<p>Running browserify <em>every</em> time you change your js files to create the <tt class="docutils literal">bundle.js</tt> feels
like doing repetitive work - this is where wachify comes to the rescue; watchify is a
tool that watches your source code and dependencies and when a change is detected it will
recreate the bundle&nbsp;automagically!</p>
<p>To run it, you can&nbsp;use:</p>
<pre class="code literal-block">
watchify src/main.js -o dist/bundle.js -v
</pre>
<p>and you&#8217;ll see something like: <tt class="docutils literal">155544 bytes written to dist/bundle.js (0.57 seconds)</tt> &#8212; try
changing main.js and you&#8217;ll see that bundle.js will also be&nbsp;re-written!</p>
<p>Some things to keep in mind with watchify&nbsp;usage:</p>
<ul class="simple">
<li>The -v flag outputs the verbose text (or else you won&#8217;t se any postive messages) - I like using it to be sure that everything is&nbsp;ok.</li>
<li>You need to use the -o flag with watchify &#8212; you can&#8217;t output to stdout(we&#8217;ll see that this will change our workflow for production a bit&nbsp;later)</li>
<li>watchify takes the same parameters with browserify &#8212; so if you do any transformations with browserify you can also do them with&nbsp;watchify</li>
</ul>
<p>In the following, I&#8217;ll assume that you are running the <tt class="docutils literal">watchify src/main.js <span class="pre">-o</span> dist/bundle.js <span class="pre">-d</span></tt> so your bundles will
always be re-created when changes are&nbsp;found.</p>
</div>
<div class="section" id="creating-your-own-modules">
<h2><a class="toc-backref" href="#toc-entry-8">Creating your own&nbsp;modules</a></h2>
<p>Using browserify we can create our own modules and <em>require</em> them in other modules using the <tt class="docutils literal">module.exports</tt> mechanism!</p>
<p>Creating a module is really simple: In a normal javascript file either assign directly to module.exports or
include all local objects you want to be visible as an attribute to <tt class="docutils literal">module.exports</tt> &#8212; everything
else will be private to the&nbsp;module.</p>
<p>As an example, let&#8217;s create an <tt class="docutils literal">src/modules</tt> folder and put a file module1.js inside it, containing the&nbsp;following:</p>
<pre class="code literal-block">
var variable = 'variable'
var variable2 = 'variable2'
var funct = function(x) {
  return x+1;
}
var funct2 = function(x) {
  return x+1;
}

module.exports['variable'] = variable
module.exports['funct'] = funct
</pre>
<p>As you see, although we&#8217;ve defined a number of things in that module, only the variable and funct attributes
of module.exports will be visible when the module is used. To use the module, change main.js like&nbsp;this:</p>
<pre class="code literal-block">
module1 = require('./modules/module1')
console.log(module1.funct(9))
</pre>
<p>When you refresh your <span class="caps">HTML</span> you&#8217;ll see 10 in the console. So, require will return the <tt class="docutils literal">module.exports</tt> objects
of each module. It will either search in your project&#8217;s <tt class="docutils literal">node_modules</tt> (when you use just the modfule name,
for example <tt class="docutils literal">moment</tt>, or locally (when you start a path with either <tt class="docutils literal">./</tt> or <tt class="docutils literal">../</tt> &#8212; in our case we required
the module <tt class="docutils literal">module1.js</tt> from the folder <tt class="docutils literal">modules</tt>).</p>
<p>As a final example, we&#8217;ll create another module that is used by module1: Create a file named <tt class="docutils literal">module2.js</tt> inside the
<tt class="docutils literal">modules</tt> folder and the following&nbsp;contents:</p>
<pre class="code literal-block">
var funct = function(x) {
    return x+1;
}

module.exports = funct
</pre>
<p>After that, change <tt class="docutils literal">module1.js</tt> to&nbsp;this:</p>
<pre class="code literal-block">
module2 = require('./module2')

var variable = 'variable'
var funct = function(x) {
    return module2(x)+1;
}

module.exports['variable'] = variable
module.exports['funct'] = funct
</pre>
<p>So <tt class="docutils literal">module1</tt> will import the <tt class="docutils literal">module2</tt> module (from the same directory) and call it (since a function is assignedd to module.exports).
When you refresh your <span class="caps">HTML</span> you should see&nbsp;11!</p>
</div>
<div class="section" id="uglifying-your-bundle">
<h2><a class="toc-backref" href="#toc-entry-9">Uglifying your&nbsp;bundle</a></h2>
<p>If had taken a look at the file size of your <tt class="docutils literal">bundle.js</tt> when you&#8217;d included moment.js or underscore.js you&#8217;d see
that the file size has been greatly increased. Take a peek at <tt class="docutils literal">bundle.js</tt> and you&#8217;ll see why: The contents of the module files
will be concatenated as they are, without any changes! This may be nice for development / debugging, however for production
we&#8217;d like our bundle.js to be minified &#8212; or uglyfied as it&#8217;s being said in the javascript&nbsp;world.</p>
<p>To help us with this, uglifying we&#8217;ll use <a class="reference external" href="https://www.npmjs.com/package/uglify-js">uglify-js</a>. First of all, please install it&nbsp;globally</p>
<pre class="code literal-block">
npm install uglify-js -g
</pre>
<p>and you&#8217;ll be able to use the <tt class="docutils literal">uglifyjs</tt> command to uglify your bundles! To use the <tt class="docutils literal">uglifyjs</tt> command for your <tt class="docutils literal">bundle.js</tt>
try&nbsp;this</p>
<pre class="code literal-block">
uglifyjs dist\bundle.js  &gt; dist\bundle.min.js
</pre>
<p>and you&#8217;ll see the size of the bundle.min.js greatly reduced! To achieve even better minification (and code mangling as an added
bonus) you could pass the -mc options to&nbsp;uglify:</p>
<pre class="code literal-block">
uglifyjs dist\bundle.js -mc &gt; dist\bundle.min.js
</pre>
<p>and you&#8217;ll see an even smaller&nbsp;bundle.min.js!</p>
<p>As a final step, we can combine the output of browserify and uglify to a single command using a&nbsp;pipe:</p>
<pre class="code literal-block">
browserify src/main.js | uglifyjs -mc &gt; dist/bundle.js
</pre>
<p>this will create the uglified bundle.js! Using the pipe to output to uglifyjs is not possible
with watchify since watchify cannot output to stdout &#8212; however, as we&#8217;ll see in the next section
this is not a real&nbsp;problem.</p>
</div>
<div class="section" id="the-client-side-javascript-workflow">
<h2><a class="toc-backref" href="#toc-entry-10">The client-side javascript&nbsp;workflow</a></h2>
<p>The proposed client-side javascript workflow uses two commands, one for the development and one
for creating the production&nbsp;bundle.</p>
<p>For the development, we&#8217;ll use watchify since we need to immediately re-create the bundle when a
javascript source file is changed and we don&#8217;t want any&nbsp;uglification:</p>
<pre class="code literal-block">
watchify src/main.js -o dist/bundle.js -v
</pre>
<p>For creating our production bundle, we&#8217;ll use browserify and&nbsp;uglify:</p>
<pre class="code literal-block">
browserify src/main.js  | uglifyjs -mc warnings=false &gt; dist/bundle.js
</pre>
<p>(i&#8217;ve added warnings=false to uglfiyjs to suppress&nbsp;warnings).</p>
<p>The above two commands can either be put to batch files or added to your existing workflow (for example
as <a class="reference external" href="http://www.fabfile.org/">fabric</a> commands if you use fabric). However, since we already have a javascrpt project (i.e a <tt class="docutils literal">package.json</tt>)
we can use that to run these commands. Just add a <tt class="docutils literal">scripts</tt> section to your package.json like&nbsp;this:</p>
<pre class="code literal-block">
{
  &quot;dependencies&quot;: {
    &quot;moment&quot;: &quot;^2.10.3&quot;,
    &quot;underscore&quot;: &quot;^1.8.3&quot;
  },
  &quot;scripts&quot;: {
    &quot;watch&quot;: &quot;watchify src/main.js -o dist/bundle.js -v&quot;,
    &quot;build&quot;: &quot;browserify src/main.js  | uglifyjs -mc warnings=false &gt; dist/bundle.js&quot;
  }
}
</pre>
<p>and you&#8217;ll be able to run <tt class="docutils literal">npm run watch</tt> to start watchifying for changes and <tt class="docutils literal">npm run build</tt> to
create your production&nbsp;bundle!</p>
</div>
<div class="section" id="conlusion">
<h2><a class="toc-backref" href="#toc-entry-11">Conlusion</a></h2>
<p>In the above we saw two (three if we include uglifyjs) javascript tools that will greatly improve our
javascript workflow. Using these we can easily <em>require</em> (import) external javascript libraries to
our project without any micromanagement of script tags in html files. We also can seperate our own
client-side code to self-contained modules that will only export interfaces and not pollute the global
namespace. The resulting production client-side javascript file will be output minimized and ready to
be used by the users&#8217;&nbsp;browsers.</p>
<p>All the above are possible with minimal changes to our code and development&nbsp;workflow:</p>
<ul class="simple">
<li>create a package.json and install your&nbsp;dependencies</li>
<li>require the external libraries (instead of using them off the global&nbsp;namespace)</li>
<li>define your module&#8217;s interace through module.exports (instead of polluting the global&nbsp;namespace)</li>
<li>change your client javascript files to <tt class="docutils literal">bundle.js</tt></li>
<li>run <tt class="docutils literal">npm run watch</tt> when developing and <tt class="docutils literal">npm run build</tt> before&nbsp;deploying</li>
</ul>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2015/04/29/django-show-404-page/">Show 404 page on django when DEBUG=True</a>
      </h1>
    <p class="meta">
<time datetime="2015-04-29T10:20:00+03:00" pubdate>Wed 29 April 2015</time>    </p>
</header>

<div class="entry-content"><p>The default 404 error page on django can be <a class="reference external" href="https://docs.djangoproject.com/en/1.8/topics/http/views/#the-http404-exception">easily overriden</a> by adding
a template named <tt class="docutils literal">404.html</tt> to the top level directory of your templates.
However, on your development environment you&#8217;ll never be able to see this
template because when <tt class="docutils literal"><span class="caps">DEBUG</span>=True</tt> django will render the debug not found
page to help you debug your url&nbsp;configuration.</p>
<p>If you want to display that page in your development environment you can always
change the <span class="caps">DEBUG</span> setting to False, however there&#8217;s a better way: Add a url
pattern for django&#8217;s default 404 view - just  add the following to your <tt class="docutils literal">urls.py</tt>:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">django.views.defaults</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="c1"># Other url patterns ...</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^404/$&#39;</span><span class="p">,</span> <span class="n">django</span><span class="o">.</span><span class="n">views</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">page_not_found</span><span class="p">,</span> <span class="p">),</span>
<span class="p">)</span>
</pre></div>
<p>You&#8217;ll then be able to see your 404 page by visiting the defined <span class="caps">URL</span>!</p>
<p><strong>Upgrade for newer Django&nbsp;versions</strong></p>
<p>I&#8217;ve recently found out that for newer Django versions the <tt class="docutils literal">page_not_found</tt> view needs a second
parameter (beyond <tt class="docutils literal">request</tt>) named <tt class="docutils literal">exception</tt> (<a class="reference external" href="https://docs.djangoproject.com/el/2.1/ref/views/#django.views.defaults.page_not_found">see here</a>). Thus
if you just add the view to your urls as I propose you&#8217;ll get an exception. To fix it, you can do something&nbsp;like:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">django</span>

<span class="k">def</span><span class="w"> </span><span class="nf">custom_page_not_found</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">django</span><span class="o">.</span><span class="n">views</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">page_not_found</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;404/&quot;</span><span class="p">,</span> <span class="n">custom_page_not_found</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
<p>This creates a simple view that calls the builtin <tt class="docutils literal">page_not_found</tt> passing it <tt class="docutils literal">None</tt> as the <tt class="docutils literal">exception</tt> parameter.</p>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2015/02/06/python-pusher-rest/">Calling the REST API of Pusher from python</a>
      </h1>
    <p class="meta">
<time datetime="2015-02-06T12:20:00+02:00" pubdate>Fri 06 February 2015</time>    </p>
</header>

<div class="entry-content"><div class="section" id="introduction">
<h2>Introduction</h2>
<p><a class="reference external" href="https://pusher.com/">Pusher</a> is one of the best real time frameworks right now. Using it you can add real time
events in your projects without the need to configure and use <span class="caps">HTTP</span> servers that support
real-time events in your environment. I used it recently in a project and it worked really
good, having a very simple <span class="caps">API</span> and a nice interface for debugging your&nbsp;requests.</p>
<p>The only problem I&#8217;ve found was that the <a class="reference external" href="https://github.com/pusher/pusher_client_python">Pusher python <span class="caps">API</span></a> misses some features that
the APIs for other languages have, specifically finding out the users on a presence&nbsp;channel.</p>
<p>Pusher supports real-time events through the use of &#8220;channels&#8221;. Each pusher client will
subscribe to a channel and receive messages that are sent to that channel. A special kind
of channel are presence channels which keep a list of their subscribers. You can query the
<a class="reference external" href="https://pusher.com/docs/rest_api">Pusher <span class="caps">REST</span> <span class="caps">API</span></a> (or f.e the Pusher Javascript <span class="caps">API</span>) to find out the names of the users
in a presence channel - however this is <em>not</em> currently possible with the python <span class="caps">API</span>.</p>
<p>Unfortuanately, calling the Pusher <span class="caps">REST</span> <span class="caps">API</span> is <em>not</em> so easy, since it needs a complicated
singining of each request, so I&#8217;ve written this post to help developers that need to call
this <span class="caps">API</span> from python (to get the users of a presence channel or for any other method the
<span class="caps">REST</span> <span class="caps">API</span>&nbsp;supports).</p>
</div>
<div class="section" id="signing-the-request">
<h2>Signing the&nbsp;request</h2>
<p>Quoting from the <a class="reference external" href="https://pusher.com/docs/rest_api">Pusher <span class="caps">REST</span> <span class="caps">API</span></a>, to sign a request we need a signature,&nbsp;which:</p>
<blockquote>
<p>The signature is a <span class="caps">HMAC</span> <span class="caps">SHA256</span> hex digest. This is generated by signing a string made up of the following components concatenated with newline characters&nbsp;\n:</p>
<ul class="simple">
<li>The uppercase request method (e.g. <span class="caps">POST</span>)</li>
<li>The request path (e.g.&nbsp;/some/resource)</li>
<li>The query parameters sorted by key, with keys converted to lowercase, then joined as in the query string. Note that the string must not be url escaped (e.g. given the keys auth_key: foo, Name: Something else, you get auth_key=foo&amp;name=Something&nbsp;else)</li>
</ul>
</blockquote>
<p>So, we need to create a string and then sign it using our Pusher api_key and secret. To help with this, we create a <tt class="docutils literal">Token</tt>
class which will be initialzed with out pusher key/secret and correctly sign a&nbsp;string:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Token</span><span class="p">(</span><span class="nb">object</span><span class="p">,):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">secret</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secret</span> <span class="o">=</span> <span class="n">secret</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secret</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</pre></div>
<p>It uses the <tt class="docutils literal">hmac</tt> and <tt class="docutils literal">hashlib</tt> python&nbsp;modules.</p>
</div>
<div class="section" id="generating-the-complete-query-string">
<h2>Generating the complete query&nbsp;string</h2>
<p>We can now create a function that will sign a request using an instance of the above&nbsp;token:</p>
<div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">create_signed_query_string</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">partial_path</span><span class="p">,</span> <span class="n">request_params</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;auth_key&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
        <span class="s1">&#39;auth_timestamp&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
        <span class="s1">&#39;auth_version&#39;</span><span class="p">:</span> <span class="s1">&#39;1.0&#39;</span>
    <span class="p">}</span>
    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">request_params</span><span class="p">)</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span>
    <span class="n">params_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">params_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">=</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="p">)</span>

    <span class="n">query_string</span> <span class="o">=</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params_list</span><span class="p">)</span>

    <span class="n">sign_data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">partial_path</span><span class="p">,</span> <span class="n">query_string</span><span class="p">])</span>
    <span class="n">query_string</span> <span class="o">+=</span> <span class="s1">&#39;&amp;auth_signature=&#39;</span> <span class="o">+</span> <span class="n">token</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">sign_data</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">query_string</span>
</pre></div>
<p><tt class="docutils literal">create_signed_query_string</tt> receives an instance of a <tt class="docutils literal">Token</tt>, the path that we want to request
without the server part (for example <tt class="docutils literal"><span class="pre">/apps/33/users/my-channel</span></tt>)  and a dictionary of
request parameters. It then adds three extra fields to the request parameters (<tt class="docutils literal">auth_key, auth_timestamp, auth_version</tt>)
and creates a list of these parameters in the <tt class="docutils literal">key=value</tt> form, where the keys are alphabetically sorted.
After that it joins the above <tt class="docutils literal">key=value</tt> parameters using <tt class="docutils literal">&amp;</tt> to create the <tt class="docutils literal">query_string</tt> and then it creates the string to be signed (<tt class="docutils literal">sign_data</tt>)
by concatenating the <span class="caps">HTTP</span> methdo (<span class="caps">GET</span>) with the path and the <tt class="docutils literal">query_string</tt>. Finally, it appends the signing result as an extra
query parameter named (<tt class="docutils literal">auth_signature</tt>).</p>
</div>
<div class="section" id="requesting-the-users-of-the-presence-channel">
<h2>Requesting the users of the presence&nbsp;channel</h2>
<p>The <tt class="docutils literal">create_signed_query_string</tt> can now be used to get the users of a presence channel like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_users</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">secret</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
    <span class="n">partial_path</span> <span class="o">=</span>  <span class="s1">&#39;/apps/</span><span class="si">{0}</span><span class="s1">/channels/</span><span class="si">{1}</span><span class="s1">/users&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span>
    <span class="n">qs</span> <span class="o">=</span> <span class="n">create_signed_query_string</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">partial_path</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">full_path</span> <span class="o">=</span> <span class="s1">&#39;http://api.pusherapp.com/</span><span class="si">{0}</span><span class="s1">?</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">partial_path</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
</pre></div>
<p>The <tt class="docutils literal">get_users</tt> function will generate the path of the pusher <span class="caps">REST</span> <span class="caps">API</span> (using
our pusher app_id and channel name) and initialize a signing <tt class="docutils literal">Token</tt> using
the pusher key and secret. It will then pass the previous to <tt class="docutils literal">create_signed_query_string</tt>
to generate the complete <tt class="docutils literal">query_string</tt> and generate the <tt class="docutils literal">full_path</tt> to which
a simple <span class="caps">HTTP</span> <span class="caps">GET</span> request is issued. The result will be a <span class="caps">JSON</span> list of the users in the
presence&nbsp;channel.</p>
</div>
<div class="section" id="complete-example">
<h2>Complete&nbsp;example</h2>
<p>A complete example of getting the presence users of a channel is the&nbsp;following:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hmac</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="n">app_id</span> <span class="o">=</span> <span class="s1">&#39;pusher_app_id&#39;</span>
<span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;pusher_key&#39;</span>
<span class="n">secret</span> <span class="o">=</span> <span class="s1">&#39;pusher_secret&#39;</span>
<span class="n">channel</span> <span class="o">=</span> <span class="s1">&#39;pusher_presence_channel&#39;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Token</span><span class="p">(</span><span class="nb">object</span><span class="p">,):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">secret</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secret</span> <span class="o">=</span> <span class="n">secret</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secret</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">create_signed_query_string</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">partial_path</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">request_params</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;auth_key&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
        <span class="s1">&#39;auth_timestamp&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
        <span class="s1">&#39;auth_version&#39;</span><span class="p">:</span> <span class="s1">&#39;1.0&#39;</span>
    <span class="p">}</span>
    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">request_params</span><span class="p">)</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span>
    <span class="n">params_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">params_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">=</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="p">)</span>

    <span class="n">query_string</span> <span class="o">=</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params_list</span><span class="p">)</span>

    <span class="n">sign_data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">partial_path</span><span class="p">,</span> <span class="n">query_string</span><span class="p">])</span>
    <span class="n">query_string</span> <span class="o">+=</span> <span class="s1">&#39;&amp;auth_signature=&#39;</span> <span class="o">+</span> <span class="n">token</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">sign_data</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">query_string</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_users</span><span class="p">(</span><span class="n">channel</span><span class="p">):</span>
    <span class="n">partial_path</span> <span class="o">=</span>  <span class="s1">&#39;/apps/</span><span class="si">{0}</span><span class="s1">/channels/</span><span class="si">{1}</span><span class="s1">/users&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span>
    <span class="n">qs</span> <span class="o">=</span>  <span class="n">create_signed_query_string</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">partial_path</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span> <span class="p">{})</span>
    <span class="n">full_path</span> <span class="o">=</span> <span class="s1">&#39;http://api.pusherapp.com/</span><span class="si">{0}</span><span class="s1">?</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">partial_path</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>

<span class="nb">print</span> <span class="n">get_users</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>With the above we are able to not only easily get the users of a Pusher presence
channel in python but to also call any method we want from the Pusher <span class="caps">REST</span> <span class="caps">API</span> by implementing a function
similar to  <tt class="docutils literal">get_users</tt>.</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2015/01/27/async-tasks-with-django-rq/">Asynchronous tasks in django with django-rq</a>
      </h1>
    <p class="meta">
<time datetime="2015-01-27T14:20:00+02:00" pubdate>Tue 27 January 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title"><a class="reference internal" href="#top">Contents</a></p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="toc-entry-1">Introduction</a></li>
<li><a class="reference internal" href="#job-queues-in-python" id="toc-entry-2">Job queues in&nbsp;python</a></li>
<li><a class="reference internal" href="#django-test-rq" id="toc-entry-3">django-test-rq</a><ul>
<li><a class="reference internal" href="#models-py" id="toc-entry-4">models.py</a></li>
<li><a class="reference internal" href="#forms-py" id="toc-entry-5">forms.py</a></li>
<li><a class="reference internal" href="#views-py" id="toc-entry-6">views.py</a></li>
<li><a class="reference internal" href="#tasks-py" id="toc-entry-7">tasks.py</a></li>
<li><a class="reference internal" href="#settings-py" id="toc-entry-8">settings.py</a></li>
<li><a class="reference internal" href="#running-the-project" id="toc-entry-9">Running the&nbsp;project</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rqworker-and-rqscheduler" id="toc-entry-10">rqworker and rqscheduler</a><ul>
<li><a class="reference internal" href="#for-development" id="toc-entry-11">For&nbsp;development</a></li>
<li><a class="reference internal" href="#for-production" id="toc-entry-12">For&nbsp;production</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion" id="toc-entry-13">Conclusion</a></li>
</ul>
</div>
<p><strong>Update 03/05/2022</strong>: The github project has been updated to work with latest version of Django (4.0.4) and Python (3.10): <a class="reference external" href="https://github.com/spapas/django-test-rq">https://github.com/spapas/django-test-rq</a></p>
<p><strong>Update 01/09/15</strong>: I&#8217;ve written a new post about rq and django with some
<a class="reference external" href="https://www.spapas.net/2015/09/01/django-rq-redux/">more advanced techniques</a>&nbsp;!</p>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#toc-entry-1">Introduction</a></h2>
<p>Job queuing (asynchronous tasks) is a common requirement for non-trivial django projects. Whenever an operation
can take more than half a second it should be put to a job queue in order to be run asynchronously by a
seperate worker. This is really important since the response to a user request needs to be immediate
or else the users will experience laggy behavior and start complaining!
Even for fairly quick tasks (like sending email through an <span class="caps">SMTP</span> server) you need to use an asynchronous task
if you care about your users since
the time required for such a task is not really&nbsp;limited.</p>
<p>Using job queues is involved not only for the developers of the application (who need to create the
asynchronous tasks and give feedback to the users when the&#8217;ve finished since they can&#8217;t use the normal
<span class="caps">HTTP</span> response) and but also for the administrators, since, in order to support job queues at least two
more componets will be&nbsp;needed:</p>
<ul class="simple">
<li>One job queue that will store the jobs to be executed next in a first in first queue. This could be the normal database of the project however it&#8217;s not recommended for performance reasons and most of thetimes it is a specific component called &#8220;Message&nbsp;Broker&#8221;</li>
<li>One (or more) workers that will monitor the job queue and when there is work to do they will dequeue and execute&nbsp;it</li>
</ul>
<p>These can all run in the same server but if it gets saturated they can easily be seperated (even more work for&nbsp;administrators).</p>
<p>Beyond job queuing, another relative requirement for many projects is to schedule a task to be run in the future
(similar to the <tt class="docutils literal">at</tt> unix command) or at specific time intervals (similar to the <tt class="docutils literal">cron</tt> unix command). For
instance, if a user is registered today we may need to check after one or two days if he&#8217;s logged in and used our application -
if he hasn&#8217;t then probably he&#8217;s having problems and we can call him to help him. Also, we could check every night
to see if any users that have registered to our application don&#8217;t have activated their account through email activation
and delete these accounts. Scheduled tasks should be also run by the workers mentioned&nbsp;above.</p>
</div>
<div class="section" id="job-queues-in-python">
<h2><a class="toc-backref" href="#toc-entry-2">Job queues in&nbsp;python</a></h2>
<p>The most known application for using job queues in python is <a class="reference external" href="http://www.celeryproject.org/">celery</a> which is a really great project that supports
many brokers,  integrates nicely
with python/django (but can be used even with other languages) and has
many more features (most of them are only useful on really big, enterprise projects). I&#8217;ve already used
it in a previous application, however, because celery is really complex I found it rather difficult to
configure it successfully and I never was perfectly sure that my asynchronous task would actually work or
that I&#8217;d used the correct configuration for my&nbsp;needs!</p>
<p>Celery also has <a class="reference external" href="http://celery.readthedocs.org/en/latest/faq.html#does-celery-have-many-dependencies">many dependencies</a> in order to be able to talk with the different broker backends it supports,
improve multithreading support etc. They may be required in enterprise apps but not for most Django web based&nbsp;projects.</p>
<p>So, for small-to-average projects I recommend using a different asynchronous task solution instead of celery, particularly
(as you&#8217;ve already guessed from the title of this post) <a class="reference external" href="http://python-rq.org/"><span class="caps">RQ</span></a>. <span class="caps">RQ</span> is simpler than celery, it integrates great with django
using the excellent <a class="reference external" href="https://github.com/ui/django-rq">django-rq</a> package and doesn&#8217;t actually have any more dependencies beyond redis support which is
used as a broker (however most modern django projects already use redis for their caching needs as an  alternative
to&nbsp;memcached).</p>
<p>It even supports supports job scheduling through the <a class="reference external" href="https://github.com/ui/rq-scheduler">rq-scheduler</a> package (celery also supports
job scheduling through celery beat): Run a different process (scheduler) that polls the job
scheduling queue for any jobs that need to be run because of scheduling and if yes put them to
the normal job&nbsp;queue.</p>
<p>Although <span class="caps">RQ</span> and frieds are really easy to use (and have nice documentation) I wasn&#8217;t able to find
a <em>complete</em> example of using it with django, so I&#8217;ve implemented one
(found at <a class="reference external" href="https://github.com/spapas/django-test-rq">https://github.com/spapas/django-test-rq</a> &#8212; since I&#8217;ve updated this project a bit
with new stuff,
please checkout tag django-test-rq-simple <tt class="docutils literal">git checkout <span class="pre">django-test-rq-simple</span></tt>) mainly for my own testing
purposes. To help others that want to also use <span class="caps">RQ</span> in their project but don&#8217;t know from where
to start, I&#8217;ll present it in the following paragraphs, along with some comments on
how to actually use <span class="caps">RQ</span> in your production&nbsp;environment.</p>
</div>
<div class="section" id="django-test-rq">
<h2><a class="toc-backref" href="#toc-entry-3">django-test-rq</a></h2>
<p>This is a simple django project that can be used to asynchronously
run and schedule jobs and examine their behavior. The job to be scheduled just downloads a provided
<span class="caps">URL</span> and counts its length. There is only one django application (tasks) that contains two views, one
to display existing tasks and create new ones and one to display some info for the&nbsp;jobs.</p>
<div class="section" id="models-py">
<h3><a class="toc-backref" href="#toc-entry-4">models.py</a></h3>
<p>Two models (<tt class="docutils literal">Task</tt> and <tt class="docutils literal">ScheduledTask</tt>) for saving individual tasks and
scheduled tasks and one model (<tt class="docutils literal">ScheduledTaskInstance</tt>) to save scheduled
instances of each scheduled&nbsp;task.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rq</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_current_job</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Task</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># A model to save information about an asynchronous task</span>
    <span class="n">created_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">job_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ScheduledTask</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># A model to save information about a scheduled task</span>
    <span class="n">created_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
    <span class="c1"># A scheduled task has a common job id for all its occurences</span>
    <span class="n">job_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ScheduledTaskInstance</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># A model to save information about instances of a scheduled task</span>
    <span class="n">scheduled_task</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;ScheduledTask&#39;</span><span class="p">)</span>
    <span class="n">created_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="forms-py">
<h3><a class="toc-backref" href="#toc-entry-5">forms.py</a></h3>
<p>A very simple form to create a new&nbsp;task.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django</span><span class="w"> </span><span class="kn">import</span> <span class="n">forms</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; A simple form to read a url from the user in order to find out its length</span>
<span class="sd">    and either run it asynchronously or schedule it schedule_times times,</span>
<span class="sd">    every schedule_interval seconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;URL&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Enter a url (starting with http/https) to start a job that will download it and count its words&#39;</span> <span class="p">)</span>
    <span class="n">schedule_times</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;How many times to run this job. Leave empty or 0 to run it only once.&#39;</span><span class="p">)</span>
    <span class="n">schedule_interval</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;How much time (in seconds) between runs of the job. Leave empty to run it only once.&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TaskForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="n">schedule_times</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;schedule_times&#39;</span><span class="p">)</span>
        <span class="n">schedule_interval</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;schedule_interval&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">schedule_times</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">schedule_interval</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">schedule_times</span> <span class="ow">and</span> <span class="n">schedule_interval</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Please fill both schedule_times and schedule_interval to schedule a job or leave them both empty&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="s1">&#39;schedule_times&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="s1">&#39;schedule_interval&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="views-py">
<h3><a class="toc-backref" href="#toc-entry-6">views.py</a></h3>
<p>This is actually very simple if you&#8217;re familiar with Class Based Views. Two CBVs
are defined, one for the Task form + Task display and another for the Job&nbsp;display.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.views.generic.edit</span><span class="w"> </span><span class="kn">import</span> <span class="n">FormView</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.views.generic</span><span class="w"> </span><span class="kn">import</span> <span class="n">TemplateView</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaskForm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_url_words</span><span class="p">,</span> <span class="n">scheduled_get_url_words</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Task</span><span class="p">,</span><span class="n">ScheduledTask</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rq.job</span><span class="w"> </span><span class="kn">import</span> <span class="n">Job</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">django_rq</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TasksHomeFormView</span><span class="p">(</span><span class="n">FormView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class that displays a form to read a url to read its contents and if the job</span>
<span class="sd">    is to be scheduled or not and information about all the tasks and scheduled tasks.</span>

<span class="sd">    When the form is submitted, the task will be either scheduled based on the</span>
<span class="sd">    parameters of the form or will be just executed asynchronously immediately.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">TaskForm</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;tasks_home.html&#39;</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
        <span class="n">schedule_times</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;schedule_times&#39;</span><span class="p">)</span>
        <span class="n">schedule_interval</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;schedule_interval&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">schedule_times</span> <span class="ow">and</span> <span class="n">schedule_interval</span><span class="p">:</span>
            <span class="c1"># Schedule the job with the form parameters</span>
            <span class="n">scheduler</span> <span class="o">=</span> <span class="n">django_rq</span><span class="o">.</span><span class="n">get_scheduler</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">scheduler</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span>
                <span class="n">scheduled_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                <span class="n">func</span><span class="o">=</span><span class="n">scheduled_get_url_words</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">url</span><span class="p">],</span>
                <span class="n">interval</span><span class="o">=</span><span class="n">schedule_interval</span><span class="p">,</span>
                <span class="n">repeat</span><span class="o">=</span><span class="n">schedule_times</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Just execute the job asynchronously</span>
            <span class="n">get_url_words</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">TasksHomeFormView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TasksHomeFormView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s1">&#39;tasks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created_on&#39;</span><span class="p">)</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s1">&#39;scheduled_tasks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ScheduledTask</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created_on&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ctx</span>


<span class="k">class</span><span class="w"> </span><span class="nc">JobTemplateView</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple template view that gets a job id as a kwarg parameter</span>
<span class="sd">    and tries to fetch that job from RQ. It will then print all attributes</span>
<span class="sd">    of that object using __dict__.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;job.html&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">JobTemplateView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">redis_conn</span> <span class="o">=</span> <span class="n">django_rq</span><span class="o">.</span><span class="n">get_connection</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">Job</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;job&#39;</span><span class="p">],</span> <span class="n">connection</span><span class="o">=</span><span class="n">redis_conn</span><span class="p">)</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="vm">__dict__</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">ctx</span><span class="p">[</span><span class="s1">&#39;job&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">job</span>
        <span class="k">return</span> <span class="n">ctx</span>
</pre></div>
</div>
<div class="section" id="tasks-py">
<h3><a class="toc-backref" href="#toc-entry-7">tasks.py</a></h3>
<p>Here two jobs are defined: One to be used for simple asynchronous tasks and the
other to be used for scheduled asynchronous tasks (since for asynchronous tasks
we wanted to group their runs per job&nbsp;id).</p>
<p>The <tt class="docutils literal">&#64;job</tt> decorator will add the <tt class="docutils literal">delay()</tt> method (used in <tt class="docutils literal">views.py</tt>) to
the function. It&#8217;s not really required for <tt class="docutils literal">scheduled_get_url_words</tt> since
it&#8217;s called through the <tt class="docutils literal">scheduled.schedule</tt>.</p>
<p>When a task is finished, it can return a value (like we do in <tt class="docutils literal">return task.result</tt>)
which will be saved for a limited amount of time (500 seconds by default - could be
even saved for ever) to redis.
This may be useful in some cases, however, I think that for normal web applications it&#8217;s
not that useful, and since here we use normal django models
for each task, we can save it to that model&#8217;s instance&nbsp;instead.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Task</span><span class="p">,</span> <span class="n">ScheduledTask</span><span class="p">,</span> <span class="n">ScheduledTaskInstance</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rq</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_current_job</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_rq</span><span class="w"> </span><span class="kn">import</span> <span class="n">job</span>


<span class="nd">@job</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_url_words</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="c1"># This creates a Task instance to save the job instance and job result</span>
    <span class="n">job</span> <span class="o">=</span> <span class="n">get_current_job</span><span class="p">()</span>

    <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">job_id</span><span class="o">=</span><span class="n">job</span><span class="o">.</span><span class="n">get_id</span><span class="p">(),</span>
        <span class="n">name</span><span class="o">=</span><span class="n">url</span>
    <span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">result</span>


<span class="nd">@job</span>
<span class="k">def</span><span class="w"> </span><span class="nf">scheduled_get_url_words</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This creates a ScheduledTask instance for each group of</span>
<span class="sd">    scheduled task - each time this scheduled task is run</span>
<span class="sd">    a new instance of ScheduledTaskInstance will be created</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">job</span> <span class="o">=</span> <span class="n">get_current_job</span><span class="p">()</span>

    <span class="n">task</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">ScheduledTask</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span>
        <span class="n">job_id</span><span class="o">=</span><span class="n">job</span><span class="o">.</span><span class="n">get_id</span><span class="p">(),</span>
        <span class="n">name</span><span class="o">=</span><span class="n">url</span>
    <span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">response_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">ScheduledTaskInstance</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">scheduled_task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">response_len</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response_len</span>
</pre></div>
</div>
<div class="section" id="settings-py">
<h3><a class="toc-backref" href="#toc-entry-8">settings.py</a></h3>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">&#39;123&#39;</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">TEMPLATE_DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>

    <span class="s1">&#39;django_extensions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django_rq&#39;</span><span class="p">,</span>

    <span class="s1">&#39;tasks&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">MIDDLEWARE_CLASSES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth.middleware.SessionAuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s1">&#39;django_test_rq.urls&#39;</span>
<span class="n">WSGI_APPLICATION</span> <span class="o">=</span> <span class="s1">&#39;django_test_rq.wsgi.application&#39;</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;db.sqlite3&#39;</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s1">&#39;en-us&#39;</span>
<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s1">&#39;UTC&#39;</span>
<span class="n">USE_I18N</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">USE_L10N</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">USE_TZ</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">&#39;/static/&#39;</span>

<span class="c1"># Use redis for caches</span>
<span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s2">&quot;django_redis.cache.RedisCache&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOCATION&quot;</span><span class="p">:</span> <span class="s2">&quot;redis://127.0.0.1:6379/0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;CLIENT_CLASS&quot;</span><span class="p">:</span> <span class="s2">&quot;django_redis.client.DefaultClient&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Use the same redis as with caches for RQ</span>
<span class="n">RQ_QUEUES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;USE_REDIS_CACHE&#39;</span><span class="p">:</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">SESSION_ENGINE</span> <span class="o">=</span> <span class="s2">&quot;django.contrib.sessions.backends.cache&quot;</span>
<span class="n">SESSION_CACHE_ALIAS</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
<span class="n">RQ_SHOW_ADMIN_LINK</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Add a logger for rq_scheduler in order to display when jobs are queueud</span>
<span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;formatters&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;simple&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1"> </span><span class="si">%(message)s</span><span class="s1">&#39;</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;console&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;logging.StreamHandler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;formatter&#39;</span><span class="p">:</span> <span class="s1">&#39;simple&#39;</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;django.request&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;console&#39;</span><span class="p">],</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span>
            <span class="s1">&#39;propagate&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;rq_scheduler&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;console&#39;</span><span class="p">],</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span>
            <span class="s1">&#39;propagate&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
<p>By default, rq_scheduler won&#8217;t log anything so we won&#8217;t be able to see
any output when new instances of each scheduled task are queued for execution.
That&#8217;s why we&#8217;ve overriden the <span class="caps">LOGGING</span> setting in order to actually log
rq_scheduler output to the&nbsp;console.</p>
</div>
<div class="section" id="running-the-project">
<h3><a class="toc-backref" href="#toc-entry-9">Running the&nbsp;project</a></h3>
<p>I recommend using <a class="reference external" href="https://www.vagrantup.com/">Vagrant</a> to start a stock ubuntu/trusty32 box. After that, install redis, virtualenv and virtualenvwrapper
and create/activate a virtualenv named <tt class="docutils literal">rq</tt>. You can go to the home directory of <tt class="docutils literal"><span class="pre">django-test-rq</span></tt>
and install requirements through <tt class="docutils literal">pip install requirements.txt</tt> and create the database tables with
<tt class="docutils literal">python manage.py migrate</tt>. Finally you may run the project with <tt class="docutils literal">python manage.py runserver_plus</tt>.</p>
</div>
</div>
<div class="section" id="rqworker-and-rqscheduler">
<h2><a class="toc-backref" href="#toc-entry-10">rqworker and&nbsp;rqscheduler</a></h2>
<p>Before scheduling any tasks we need to run two more&nbsp;processes:</p>
<ul class="simple">
<li>rqworker: This is a worker that dequeues jobs from the queue and executes them. We could run more than one onstance of this job if we need&nbsp;it.</li>
<li>rqscheduler: This is a process that runs every one minute and checks if there are scheduled jobs that have to be executed. If yes, it will add them to the queue in order to be executed by a&nbsp;worker.</li>
</ul>
<div class="section" id="for-development">
<h3><a class="toc-backref" href="#toc-entry-11">For&nbsp;development</a></h3>
<p>If you want to run rqworker and rqscheduler for your development environment you can just do it with
running <tt class="docutils literal">python manage.py rqworker</tt> and <tt class="docutils literal">python mange.py rqscheduler</tt> through screen/tmux. If everything
is allright you should see tasks being added to the queue and scheduled (you may need to refresh the
homepage before seeing everything since a task may be executed after the response is&nbsp;created).</p>
<p>Also, keep in mind that rqscheduler runs once every minute by default so you may need to wait up to
minute to see a <tt class="docutils literal">ScheduledTask</tt> instance. Also, this means that you can&#8217;t run more than one scheduled
task instance per&nbsp;minute.</p>
</div>
<div class="section" id="for-production">
<h3><a class="toc-backref" href="#toc-entry-12">For&nbsp;production</a></h3>
<p>Trying to create daemons through screen is not
sufficient for a production envornment since we&#8217;d like to actually have logging, monitoring and of course
automatically start rqworker and rqscheduler when the server&nbsp;boots.</p>
<p>For this, I recommend using the <a class="reference external" href="http://supervisord.org/">supervisord</a> tool which
can be used to monitor and control a number of processes. There are other similar tools, however I&#8217;ve
found supervisord the easier to&nbsp;use.</p>
<p>In order to monitor/control a process through supervisord you need to add a <tt class="docutils literal">[program:progrname]</tt> section in
supervisord&#8217;s configuration and pass a number of parameters. The <tt class="docutils literal">progname</tt> is the name of the monitoring
process. Here&#8217;s how rqworker can be configured using&nbsp;supervisord:</p>
<pre class="code literal-block">
[program:rqworker]
command=python manage.py rqworker
directory=/vagrant/progr/py/rq/django-test-rq
environment=PATH=&quot;/home/vagrant/.virtualenvs/rq/bin&quot;
user=vagrant
</pre>
<p>The options used will chdir to <tt class="docutils literal">directory</tt> and execute <tt class="docutils literal">command</tt> as <tt class="docutils literal">user</tt>. The <tt class="docutils literal">environment</tt>
option can be used to set envirotnment variables - here we set <tt class="docutils literal"><span class="caps">PATH</span></tt> in order to use a specific
virtual environment. This will allow you to monitor rqworker through supervisord and log its
output to a file in <tt class="docutils literal">/var/log/supervisor</tt> (by default). A similar entry needs to be added for
rqscheduler of course. If everything has been configured correctly, when you reload the supervisord
settings you can run <tt class="docutils literal">sudo /usr/bin/supervisorctl</tt> and should see something&nbsp;like</p>
<pre class="code literal-block">
rqscheduler                      RUNNING    pid 1561, uptime 0:00:03
rqworker                         RUNNING    pid 1562, uptime 0:00:03
</pre>
<p>Also, tho log files should contain some debug&nbsp;info.</p>
</div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#toc-entry-13">Conclusion</a></h2>
<p>Although using job queues makes it more difficult for the developer and adds at least one
(and probably more) points of failure to a project (the workers, the broker etc) their
usage, even for very simple projects is&nbsp;unavoidable.</p>
<p>Unless a complex, enterprise solution like celery is really required for a project
I recommend using the much simpler and easier to configure <span class="caps">RQ</span> for all your
asynchronous and scheduled task needs. Using <span class="caps">RQ</span> (and the relative projects django-rq
and rq-scheduler) we can easily add production ready queueued and scheduled jobs to
any django&nbsp;project.</p>
<p>In this article we presented a small introduction to <span class="caps">RQ</span> and its friends and saw how
to configure django to use it in a production ready environment using a small
django project (<a class="reference external" href="https://github.com/spapas/django-test-rq">https://github.com/spapas/django-test-rq</a>) which was implemented as a companion
to help readers quickly test the concepts presented&nbsp;here.</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2015/01/21/django-model-auditing/">Django model auditing</a>
      </h1>
    <p class="meta">
<time datetime="2015-01-21T14:20:00+02:00" pubdate>Wed 21 January 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title"><a class="reference internal" href="#top">Contents</a></p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="toc-entry-1">Introduction</a></li>
<li><a class="reference internal" href="#adding-simple-auditing-functionality-ourselves" id="toc-entry-2">Adding simple auditing functionality&nbsp;ourselves</a></li>
<li><a class="reference internal" href="#example" id="toc-entry-3">Example</a><ul>
<li><a class="reference internal" href="#models-py" id="toc-entry-4">models.py</a></li>
<li><a class="reference internal" href="#forms-py" id="toc-entry-5">forms.py</a></li>
<li><a class="reference internal" href="#views-py" id="toc-entry-6">views.py</a></li>
<li><a class="reference internal" href="#urls-py" id="toc-entry-7">urls.py</a></li>
<li><a class="reference internal" href="#templates" id="toc-entry-8">templates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-django-simple-history" id="toc-entry-9">Using django-simple-history</a><ul>
<li><a class="reference internal" href="#installation" id="toc-entry-10">Installation</a></li>
<li><a class="reference internal" href="#example-1" id="toc-entry-11">Example</a></li>
<li><a class="reference internal" href="#usage" id="toc-entry-12">Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-django-reversion" id="toc-entry-13">Using django-reversion</a><ul>
<li><a class="reference internal" href="#installation-1" id="toc-entry-14">Installation</a></li>
<li><a class="reference internal" href="#example-2" id="toc-entry-15">Example</a></li>
<li><a class="reference internal" href="#usage-1" id="toc-entry-16">Usage</a></li>
<li><a class="reference internal" href="#comparing-versions-with-django-reversion-compare" id="toc-entry-17">Comparing versions with&nbsp;django-reversion-compare</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion" id="toc-entry-18">Conclusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#toc-entry-1">Introduction</a></h2>
<p>An auditing trail is a common requirement in most non-trivial applications. Organizations
need to know <em>who</em> did the change, <em>when</em> it was done and <em>what</em> was actually changed.
In this post we will see three
different solution in order to add this functionality in Django: doing it ourselves,
using django-simple-history and using&nbsp;django-reversion.</p>
<p><em>Update 24/09/2015:</em> Added a paragraph describing the django-reversion-compare which is
a great addon for django-reversion that makes finding differences between versions a&nbsp;breeze!</p>
</div>
<div class="section" id="adding-simple-auditing-functionality-ourselves">
<h2><a class="toc-backref" href="#toc-entry-2">Adding simple auditing functionality&nbsp;ourselves</a></h2>
<p>A simple way to actually do auditing is to keep four extra fields in our models:
<tt class="docutils literal">created_by</tt>, <tt class="docutils literal">created_on</tt>, <tt class="docutils literal">modified_by</tt> and <tt class="docutils literal">modified_on</tt>. The first two
will be filled when the model instance is created while the latter two will be
changed whenever the model instance is saved. So we only have <em>who</em> and <em>whe</em>.
Sometimes, these are enough so let&#8217;s see how easy it is to implement it in&nbsp;django.</p>
<p>We&#8217;ll need an abstract model that could be used as a base class for models that need&nbsp;auditing:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.conf</span><span class="w"> </span><span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Auditable</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">created_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">created_by</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;created_by&#39;</span><span class="p">)</span>

    <span class="n">modified_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">modified_by</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;modified_by&#39;</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
<p>Models inheriting from <tt class="docutils literal">Auditable</tt> will contain their datetime of creation and modification
which will be automatically filled using the very usefull <tt class="docutils literal">auto_now_add_</tt> (which will
set the current datetime when the model instance is created) and <tt class="docutils literal">auto_now_</tt> (which will
set the current datetime when the model instance is&nbsp;modified).</p>
<p>Such models will also have two foreign keys to <tt class="docutils literal">User</tt>, one for the user
that created the and one of the user that modified them. The problem with these two fields
is that they cannot be filled automatically (like the datetimes) because the user that
actually did create/change the objects must be&nbsp;provided!</p>
<p>Since I am really fond of CBVs I will present a simple mixin that can be used with CreateView
and UpdateView and does exactly&nbsp;that:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AuditableMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">created_by</span><span class="p">:</span>
            <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">created_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">modified_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">AuditableMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
</pre></div>
<p>The above mixin overrides the <tt class="docutils literal">form_valid</tt> method of <tt class="docutils literal">CreateView</tt> and <tt class="docutils literal">UpdateView</tt>:
First it checks if the object is created (if it is created it won&#8217;t be saved in the
database yet thus it won&#8217;t have an id) in order to set the <tt class="docutils literal">created_by</tt> attribute to
the current user. After that it will set the <tt class="docutils literal">modified_by</tt> attribute of the object to
the current user. Finally, it will call the next <tt class="docutils literal">form_valid</tt> method to do whatever
is required (save the model instance and redirect to <tt class="docutils literal">success_url</tt> by&nbsp;default).</p>
<p>The views using <tt class="docutils literal">AuditableMixin</tt> should allow only logged in users (or else an
exception will be thrown). Also, don&#8217;t forget to exclude the <tt class="docutils literal">created_by</tt> and <tt class="docutils literal">modified_by</tt>
fields from your model form (<tt class="docutils literal">created_on</tt> and <tt class="docutils literal">modified_on</tt> will automatically be&nbsp;excluded).</p>
</div>
<div class="section" id="example">
<h2><a class="toc-backref" href="#toc-entry-3">Example</a></h2>
<p>Let&#8217;s see a simple example of creating a small django application using the previously defined abstract model and&nbsp;mixin:</p>
<div class="section" id="models-py">
<h3><a class="toc-backref" href="#toc-entry-4">models.py</a></h3>
<div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.conf</span><span class="w"> </span><span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.core.urlresolvers</span><span class="w"> </span><span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">auditable.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Auditable</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Book</span><span class="p">(</span><span class="n">Auditable</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;book_list&quot;</span><span class="p">)</span>
</pre></div>
<p>In the above we suppose that the <tt class="docutils literal">Auditable</tt> abstract model is imported from the
<tt class="docutils literal">auditable.models</tt> module and that a view named <tt class="docutils literal">book_list</tt> that shows all books&nbsp;exists.</p>
</div>
<div class="section" id="forms-py">
<h3><a class="toc-backref" href="#toc-entry-5">forms.py</a></h3>
<div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelForm</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BookForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">]</span>
</pre></div>
<p>Show only <tt class="docutils literal">name</tt> and <tt class="docutils literal">author</tt> fields (and not the auditable fields) in the <tt class="docutils literal">Book ModelForm</tt>.</p>
</div>
<div class="section" id="views-py">
<h3><a class="toc-backref" href="#toc-entry-6">views.py</a></h3>
<div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.views.generic.edit</span><span class="w"> </span><span class="kn">import</span> <span class="n">CreateView</span><span class="p">,</span> <span class="n">UpdateView</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.views.generic</span><span class="w"> </span><span class="kn">import</span> <span class="n">ListView</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">auditable.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">AuditableMixin</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Book</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">BookForm</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BookCreateView</span><span class="p">(</span><span class="n">AuditableMixin</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">BookForm</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BookUpdateView</span><span class="p">(</span><span class="n">AuditableMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">BookForm</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BookListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
</pre></div>
<p>We import the <tt class="docutils literal">AuditableMixin</tt> from <tt class="docutils literal">auditable.views</tt> and make our Create and Update views
inherit from this mixin also in addition to <tt class="docutils literal">CreateView</tt> and <tt class="docutils literal">UpdateView</tt>. Pay attention that our
mixin is placed <em>before</em> CreateView in order to call <tt class="docutils literal">form_valid</tt> in the proper order: When multiple
inheritance is used like this python will check each class from left to right to find the proper method
and call it. For example, in our <tt class="docutils literal">BookCreateView</tt>, when the <tt class="docutils literal">form_valid</tt> method is called, python
will first check if <tt class="docutils literal">BookCreateView</tt> has a <tt class="docutils literal">form_valid</tt> method. Since it does not, it will check
if <tt class="docutils literal">AuditableMixin</tt> has a <tt class="docutils literal">form_valid</tt> method and call it. Now, we are calling the <tt class="docutils literal"><span class="pre">super(...).form_valid()</span></tt> in the
<tt class="docutils literal">AuditableMixin</tt> <tt class="docutils literal">form_valid</tt>, so the <tt class="docutils literal">form_valid</tt> of <tt class="docutils literal">CreateView</tt> will <em>also</em> be&nbsp;called.</p>
<p>A simple <tt class="docutils literal">ListView</tt> is also added to just show the info on all&nbsp;books.</p>
</div>
<div class="section" id="urls-py">
<h3><a class="toc-backref" href="#toc-entry-7">urls.py</a></h3>
<div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.conf.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">views</span><span class="w"> </span><span class="kn">import</span> <span class="n">BookCreateView</span><span class="p">,</span> <span class="n">BookUpdateView</span><span class="p">,</span> <span class="n">BookListView</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^accounts/login/$&#39;</span><span class="p">,</span> <span class="s1">&#39;django.contrib.auth.views.login&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^accounts/logout/$&#39;</span><span class="p">,</span> <span class="s1">&#39;django.contrib.auth.views.logout&#39;</span><span class="p">,</span> <span class="p">),</span>

    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^create/$&#39;</span><span class="p">,</span> <span class="n">BookCreateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;create_book&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^update/(?P&lt;pk&gt;\d+)/$&#39;</span><span class="p">,</span> <span class="n">BookUpdateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;update_book&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="n">BookListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;book_list&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
<p>Just add the previously defined Create/Update/List views along with a login/logout&nbsp;views.</p>
</div>
<div class="section" id="templates">
<h3><a class="toc-backref" href="#toc-entry-8">templates</a></h3>
<p>You&#8217;ll need four&nbsp;templates:</p>
<ul class="simple">
<li>books/book_list.html: Show the list of&nbsp;books</li>
<li>books/book_form.html: Show the book editing&nbsp;form</li>
<li>registration/login.html: Login&nbsp;form</li>
<li>registration/logout.html: Logout&nbsp;message</li>
</ul>
</div>
</div>
<div class="section" id="using-django-simple-history">
<h2><a class="toc-backref" href="#toc-entry-9">Using&nbsp;django-simple-history</a></h2>
<p><a class="reference external" href="https://github.com/treyhunner/django-simple-history">django-simple-history</a>  can be used to not only store the user and date of each modification
but a different version for each modification. To do that, for every model that is registered
to be used with django-simple-history, it wil create a second table in
the database hosting all versions (historical records) of that model. As we can understand this is really powerfull
since we can see exactly what was changed and also do normal <span class="caps">SQL</span> queries on&nbsp;that!</p>
<div class="section" id="installation">
<h3><a class="toc-backref" href="#toc-entry-10">Installation</a></h3>
<p>To use django-simple-history in a project, after we do a <tt class="docutils literal">pip install <span class="pre">django-simple-history</span></tt>,
we just need to add it to <tt class="docutils literal">INSTALLED_APPS</tt> and
add the <tt class="docutils literal">simple_history.middleware.HistoryRequestMiddleware</tt> to the <tt class="docutils literal">MIDDLEWARE_CLASSES</tt> list.</p>
<p>Finally, to keep the historical records for a model, just add an instace of <tt class="docutils literal">HistoricalRecords</tt> to this&nbsp;model.</p>
</div>
<div class="section" id="example-1">
<h3><a class="toc-backref" href="#toc-entry-11">Example</a></h3>
<p>For example, our previously defined <tt class="docutils literal">Book</tt> model will be modified like&nbsp;this:</p>
<div class="highlight"><pre><span></span>class SHBook(models.Model):
    name = models.CharField(max_length=128)
    author = models.CharField(max_length=128)

    def get_absolute_url(self):
        return reverse(&quot;shbook_list&quot;)

    history = HistoricalRecords()
</pre></div>
<p>When we run <tt class="docutils literal">python manage.py makemigrations</tt> and <tt class="docutils literal">migrate</tt> this, we&#8217;ll see that beyond the table for SHBook, a table for HistoricalSHBook will be&nbsp;created:</p>
<pre class="code literal-block">
Migrations for 'sample':
  0002_historicalshbook_shbook.py:
    - Create model HistoricalSHBook
    - Create model SHBook
</pre>
<p>Let&#8217;s see the schema of&nbsp;historicalshbook:</p>
<pre class="code literal-block">
CREATE TABLE &quot;sample_historicalshbook&quot; (
    &quot;id&quot; integer NOT NULL,
    &quot;name&quot; varchar(128) NOT NULL,
    &quot;author&quot; varchar(128) NOT NULL,
    &quot;history_id&quot; integer NOT NULL PRIMARY KEY AUTOINCREMENT,
    &quot;history_date&quot; datetime NOT NULL,
    &quot;history_type&quot; varchar(1) NOT NULL,
    &quot;history_user_id&quot; integer NULL REFERENCES &quot;auth_user&quot; (&quot;id&quot;)
);
</pre>
<p>So we see that it has the <em>same</em> fields as with <tt class="docutils literal">SHBook</tt> (<tt class="docutils literal">id, name, author</tt>) with the addition of
the primary key (<tt class="docutils literal">history_id</tt>) of this historical record, the date and user that did the change
(<tt class="docutils literal">history_date</tt>, <tt class="docutils literal">history_user_id</tt>) and the type of the record (created / update /&nbsp;delete).</p>
<p>So, just by adding a <tt class="docutils literal">HistoricalRecords()</tt> attribute to our model definition we&#8217;ll get complete auditing
for the instance of that&nbsp;model</p>
</div>
<div class="section" id="usage">
<h3><a class="toc-backref" href="#toc-entry-12">Usage</a></h3>
<p>To find out information about the historical records we&#8217;ll just use the <tt class="docutils literal">HistoricalRecords()</tt> attribute
of that&nbsp;model:</p>
<p>For example, running <tt class="docutils literal">SHBook.history.filter(id=1)</tt> will return all historical records of the book with
<tt class="docutils literal">id = 1</tt>. For each one of them we have can use the&nbsp;following:</p>
<ul class="simple">
<li>get the user that made the change through the <tt class="docutils literal">history_user</tt> attribute</li>
<li>get the date of the change through the <tt class="docutils literal">history_date</tt> attribute</li>
<li>get the type of the change through the <tt class="docutils literal">history_type</tt> attribute (and the corresponding <tt class="docutils literal">get_history_type_dispaly</tt>)</li>
<li>get a model instance as it was then through the <tt class="docutils literal">history_object</tt> attribute (in order to <tt class="docutils literal">save()</tt> it and revert to this&nbsp;version)</li>
</ul>
</div>
</div>
<div class="section" id="using-django-reversion">
<h2><a class="toc-backref" href="#toc-entry-13">Using&nbsp;django-reversion</a></h2>
<p><a class="reference external" href="https://github.com/etianen/django-reversion">django-reversion</a>  offers more or less the same functionality of django-simple-history by following a different philosophy:
Instead of creating an extra table holding the history records for each model, it insteads converts all the fields of each model
to json and stores that <span class="caps">JSON</span> in the database in a text&nbsp;field.</p>
<p>This has the advantage that no extra tables are created to the database but the disadvantage that you can&#8217;t easily query
your historical records. So you may choose one or the other depending on your actual&nbsp;requirements.</p>
<div class="section" id="installation-1">
<h3><a class="toc-backref" href="#toc-entry-14">Installation</a></h3>
<p>To use django-reversion in a project, after we do a <tt class="docutils literal">pip install <span class="pre">django-reversion</span></tt>,
we just need to add it to <tt class="docutils literal">INSTALLED_APPS</tt> and
add the <tt class="docutils literal">reversion.middleware.RevisionMiddleware</tt> to the <tt class="docutils literal">MIDDLEWARE_CLASSES</tt> list.</p>
<p>In order to save the revisions of a model, you need to register this model to django-reversion. This can be
done either through the django-admin, by inheriting the admin class of that model from <tt class="docutils literal">reversion.VersionAdmin</tt>
or, if you don&#8217;t want to use the admin by <tt class="docutils literal">reversion.register</tt> decorator.</p>
</div>
<div class="section" id="example-2">
<h3><a class="toc-backref" href="#toc-entry-15">Example</a></h3>
<p>To use django-reversion to keep track of changes to <tt class="docutils literal">Book</tt> we can modify it like&nbsp;this:</p>
<div class="highlight"><pre><span></span>@reversion.register
class RBook(models.Model):
    name = models.CharField(max_length=128)
    author = models.CharField(max_length=128)

    def get_absolute_url(self):
        return reverse(&quot;rbook_list&quot;)
</pre></div>
<p>django-reversion uses two tables in the database to keep track of revisions: <tt class="docutils literal">revision</tt> and <tt class="docutils literal">version</tt>. Let&#8217;s
take a look at their&nbsp;schemata:</p>
<pre class="code literal-block">
.schema reversion_revision
CREATE TABLE &quot;reversion_revision&quot; (
    &quot;id&quot; integer NOT NULL PRIMARY KEY AUTOINCREMENT,
    &quot;manager_slug&quot; varchar(200) NOT NULL,
    &quot;date_created&quot; datetime NOT NULL,
    &quot;comment&quot; text NOT NULL,
    &quot;user_id&quot; integer NULL REFERENCES &quot;auth_user&quot; (&quot;id&quot;)
);

.schema reversion_version
CREATE TABLE &quot;reversion_version&quot; (
    &quot;id&quot; integer NOT NULL PRIMARY KEY AUTOINCREMENT,
    &quot;object_id&quot; text NOT NULL,
    &quot;object_id_int&quot; integer NULL,
    &quot;format&quot; varchar(255) NOT NULL,
    &quot;serialized_data&quot; text NOT NULL,
    &quot;object_repr&quot; text NOT NULL,
    &quot;content_type_id&quot; integer NOT NULL REFERENCES &quot;django_content_type&quot; (&quot;id&quot;),
    &quot;revision_id&quot; integer NOT NULL REFERENCES &quot;reversion_revision&quot; (&quot;id&quot;)
);
</pre>
<p>As we can understand, the <tt class="docutils literal">revision</tt> table holds information like who created this
revison (<tt class="docutils literal">user_id</tt>) and when (<tt class="docutils literal">date_created</tt>) while the <tt class="docutils literal">version</tt> stores
a reference to the object that was modified (through a GenericForeignKey) and
the actual data (in the <tt class="docutils literal">serialized_data</tt> field). By default it uses <span class="caps">JSON</span>
to serialize the data (the serialization format is in the <tt class="docutils literal">format</tt> field). There&#8217;s
an one-to-one relation between <tt class="docutils literal">revision</tt> and <tt class="docutils literal">version</tt>.</p>
<p>If we create an instance of <tt class="docutils literal">RBook</tt> we&#8217;ll see the following in the&nbsp;database:</p>
<pre class="code literal-block">
sqlite&gt; select * from reversion_revision;
1|default|2015-01-21 10:31:25.233000||1

sqlite&gt; select * from reversion_version;
1|1|1|json|[{&quot;fields&quot;: {&quot;name&quot;: &quot;asdasdasd&quot;, &quot;author&quot;: &quot;asdasd&quot;}, &quot;model&quot;: &quot;sample.rbook&quot;, &quot;pk&quot;: 1}]|RBook object|12|1
</pre>
<p><tt class="docutils literal">date_created</tt> and <tt class="docutils literal">user_id</tt> are stored on <tt class="docutils literal">revision</tt> while <tt class="docutils literal">format</tt>, <tt class="docutils literal">serialized_data</tt>, <tt class="docutils literal">content_type_id</tt> and
<tt class="docutils literal">object_id_int</tt> (the <tt class="docutils literal">GenericForeignKey</tt>) are stored in <tt class="docutils literal">version</tt>.</p>
</div>
<div class="section" id="usage-1">
<h3><a class="toc-backref" href="#toc-entry-16">Usage</a></h3>
<p>To find out information about an object you have to use the <tt class="docutils literal">reversion.get_for_object(object)</tt> method. In order to be
easily used in templates I recommend creating the following <tt class="docutils literal">get_versions()</tt> method in each model that is registered with&nbsp;django-reversion</p>
<pre class="code literal-block">
def get_versions(self):
    return reversion.get_for_object(self)
</pre>
<p>Now, each version has a <tt class="docutils literal">revision</tt> attribute for the corresponding revision and can be used to do the&nbsp;following:</p>
<ul class="simple">
<li>get the user that made the change through the <tt class="docutils literal">revision.user</tt> attribute</li>
<li>get the date of the change through the <tt class="docutils literal">revision.date_created</tt> attribute</li>
<li>get the values of the object fields as they were in this revision using the <tt class="docutils literal">field_dict</tt> attribute</li>
<li>get a model instance as it was on that revision using the <tt class="docutils literal">object_version.object</tt> attribute</li>
<li>revert to that previous version of that object using the <tt class="docutils literal">revert()</tt> method</li>
</ul>
</div>
<div class="section" id="comparing-versions-with-django-reversion-compare">
<h3><a class="toc-backref" href="#toc-entry-17">Comparing versions with&nbsp;django-reversion-compare</a></h3>
<p>A great addon for django-version is <a class="reference external" href="github.com/jedie/django-reversion-compare">django-reversion-compare</a> which helps you find out differences
between versions of your objects. When you use django-reversion-compare, you&#8217;ll be able to select
two (different) versions of your object and you&#8217;ll be presented with a list of all the differences
found in the fields of that object between the two versions. The diff algorithm is smart, so you&#8217;ll
be able to easily recognise the&nbsp;changes.</p>
<p>To use django-reversion-compare, after installing it you should just inherit your admin views from
<tt class="docutils literal">reversion_compare.admin.CompareVersionAdmin</tt> (instead of <tt class="docutils literal">reversion.VersionAdmin</tt>) and you&#8217;ll
get the reversion-compare views instead of reversion views in the admin for the history of the&nbsp;object.</p>
<p>Also, in case you need to give access to normal, non-admin users to the history of an object (this is
useful for auditing reasons), you can use the <tt class="docutils literal">reversion_compare.views.HistoryCompareDetailView</tt>
as a normal <tt class="docutils literal">DetailView</tt> to create a non-admin history and compare diff&nbsp;view.</p>
</div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#toc-entry-18">Conclusion</a></h2>
<p>In the above we say that it is really easy to add basic (<em>who</em> and <em>when</em>) auditing capabilities to your models: You just need to
inherit your models from the <tt class="docutils literal">Auditable</tt> abstract class and inherit your Create and Update CBVs from <tt class="docutils literal">AuditableMixin</tt>.
If you want to know exactly <em>what</em> was changed then you have two solutions: django-simple-history to create an extra table for
each of your models so you&#8217;ll be able to query your historical records (and easily extra aggregates, statistics etc) and
django-reversion to save each version as a json object, so no extra tables will be&nbsp;created.</p>
<p>All three solutions for auditing have been implemented in a sample project at <a class="reference external" href="https://github.com/spapas/auditing-sample">https://github.com/spapas/auditing-sample</a>.</p>
<p>You can clone the project and, preferrably in a virtual environment, install requirements (<tt class="docutils literal">pip install <span class="pre">-r</span> requirements.txt</tt>),
do a migrate (<tt class="docutils literal">python manage.py migrate</tt> &#8212; uses sqlite3 by default) and run the local development
server (<tt class="docutils literal">python manage.py ruinserver</tt>).</p>
</div>
</div>
  		</article>
<div class="pagination">
    <a class="prev" href="https://www.spapas.net/index13.html">&larr; Older</a>

    <a class="next" href="https://www.spapas.net/index11.html">Newer &rarr;</a>
  <br />
</div></div>
<aside class="sidebar">
  
  <section>
    <br />
    <a href='/feeds/all.atom.xml'>Atom</a>
    |
    <a href='/feeds/all.rss.xml'>RSS</a>
  </section>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- Sidebar unit -->
  <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7673322832689008" data-ad-slot="2720624730"
    data-ad-format="auto" data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>


  <script async src="https://cse.google.com/cse.js?cx=612920e5ca9da850c"></script>
  <div class="gcse-search"></div>

  
  <section>
    <h1>Support me</h1>

    You can show your appreciation for anything useful you've found here by 
    buying me a coffee 
    <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="spapas" data-color="#FFDD00" data-emoji=""  data-font="Lato" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script>

    or donating me some bitcoin to this address:
    <small><pre>bc1qx42vp8napheaewhnx0rk0mttdrdrtvw6czvxhl</pre></small>
    <svg shape-rendering="crispEdges" height="200" width="200" viewBox="0 0 29 29" class="qrcode">
      <path fill="#FFFFFF" d="M0,0 h29v29H0z"></path><path fill="#000000" d="M0 0h7v1H0zM9 0h2v1H9zM12 0h1v1H12zM14 0h2v1H14zM18 0h2v1H18zM22,0 h7v1H22zM0 1h1v1H0zM6 1h1v1H6zM8 1h1v1H8zM11 1h1v1H11zM14 1h5v1H14zM22 1h1v1H22zM28,1 h1v1H28zM0 2h1v1H0zM2 2h3v1H2zM6 2h1v1H6zM8 2h4v1H8zM17 2h1v1H17zM22 2h1v1H22zM24 2h3v1H24zM28,2 h1v1H28zM0 3h1v1H0zM2 3h3v1H2zM6 3h1v1H6zM9 3h2v1H9zM14 3h3v1H14zM18 3h1v1H18zM22 3h1v1H22zM24 3h3v1H24zM28,3 h1v1H28zM0 4h1v1H0zM2 4h3v1H2zM6 4h1v1H6zM8 4h1v1H8zM11 4h1v1H11zM13 4h1v1H13zM15 4h2v1H15zM18 4h1v1H18zM22 4h1v1H22zM24 4h3v1H24zM28,4 h1v1H28zM0 5h1v1H0zM6 5h1v1H6zM8 5h2v1H8zM14 5h2v1H14zM19 5h2v1H19zM22 5h1v1H22zM28,5 h1v1H28zM0 6h7v1H0zM8 6h1v1H8zM10 6h1v1H10zM12 6h1v1H12zM14 6h1v1H14zM16 6h1v1H16zM18 6h1v1H18zM20 6h1v1H20zM22,6 h7v1H22zM8 7h2v1H8zM11 7h1v1H11zM15 7h1v1H15zM17 7h2v1H17zM0 8h2v1H0zM3 8h1v1H3zM6 8h2v1H6zM10 8h1v1H10zM12 8h3v1H12zM20 8h1v1H20zM22 8h3v1H22zM26 8h2v1H26zM1 9h1v1H1zM3 9h3v1H3zM8 9h1v1H8zM10 9h1v1H10zM12 9h2v1H12zM16 9h2v1H16zM20 9h1v1H20zM22 9h1v1H22zM25 9h1v1H25zM27,9 h2v1H27zM0 10h1v1H0zM3 10h2v1H3zM6 10h1v1H6zM8 10h3v1H8zM12 10h2v1H12zM16 10h1v1H16zM19 10h1v1H19zM22 10h3v1H22zM27 10h1v1H27zM0 11h1v1H0zM2 11h1v1H2zM4 11h2v1H4zM7 11h1v1H7zM13 11h4v1H13zM18 11h4v1H18zM26 11h2v1H26zM0 12h1v1H0zM2 12h3v1H2zM6 12h1v1H6zM11 12h1v1H11zM13 12h1v1H13zM15 12h3v1H15zM20 12h1v1H20zM22 12h2v1H22zM27,12 h2v1H27zM4 13h1v1H4zM8 13h3v1H8zM12 13h1v1H12zM14 13h1v1H14zM17 13h4v1H17zM25 13h2v1H25zM0 14h1v1H0zM4 14h3v1H4zM8 14h2v1H8zM11 14h3v1H11zM16 14h1v1H16zM21 14h2v1H21zM24,14 h5v1H24zM3 15h3v1H3zM7 15h2v1H7zM10 15h1v1H10zM12 15h2v1H12zM15 15h1v1H15zM17 15h2v1H17zM20 15h2v1H20zM23 15h1v1H23zM1 16h1v1H1zM4 16h1v1H4zM6 16h4v1H6zM16 16h2v1H16zM20 16h1v1H20zM23 16h1v1H23zM25 16h1v1H25zM28,16 h1v1H28zM2 17h1v1H2zM5 17h1v1H5zM7 17h2v1H7zM11 17h3v1H11zM17 17h1v1H17zM22 17h1v1H22zM25 17h1v1H25zM27,17 h2v1H27zM0 18h1v1H0zM3 18h1v1H3zM5 18h4v1H5zM10 18h1v1H10zM12 18h1v1H12zM18 18h1v1H18zM20 18h1v1H20zM22 18h2v1H22zM25,18 h4v1H25zM2 19h3v1H2zM8 19h1v1H8zM16 19h2v1H16zM21 19h1v1H21zM23 19h1v1H23zM25 19h1v1H25zM27 19h1v1H27zM0 20h1v1H0zM2 20h5v1H2zM8 20h2v1H8zM13 20h4v1H13zM19 20h6v1H19zM26 20h1v1H26zM28,20 h1v1H28zM8 21h2v1H8zM12 21h3v1H12zM16 21h1v1H16zM20 21h1v1H20zM24 21h1v1H24zM26,21 h3v1H26zM0 22h7v1H0zM8 22h3v1H8zM17 22h1v1H17zM20 22h1v1H20zM22 22h1v1H22zM24 22h2v1H24zM27 22h1v1H27zM0 23h1v1H0zM6 23h1v1H6zM10 23h2v1H10zM13 23h2v1H13zM19 23h2v1H19zM24,23 h5v1H24zM0 24h1v1H0zM2 24h3v1H2zM6 24h1v1H6zM9 24h2v1H9zM12 24h2v1H12zM17 24h1v1H17zM20 24h6v1H20zM28,24 h1v1H28zM0 25h1v1H0zM2 25h3v1H2zM6 25h1v1H6zM8 25h3v1H8zM12 25h1v1H12zM14 25h1v1H14zM18 25h1v1H18zM22 25h3v1H22zM26 25h1v1H26zM0 26h1v1H0zM2 26h3v1H2zM6 26h1v1H6zM10 26h5v1H10zM16 26h3v1H16zM21 26h1v1H21zM24 26h1v1H24zM26 26h1v1H26zM28,26 h1v1H28zM0 27h1v1H0zM6 27h1v1H6zM8 27h3v1H8zM12 27h4v1H12zM17 27h1v1H17zM20 27h1v1H20zM23 27h2v1H23zM27 27h1v1H27zM0 28h7v1H0zM8 28h3v1H8zM14 28h1v1H14zM16 28h3v1H16zM20 28h1v1H20zM22 28h1v1H22zM24 28h2v1H24zM27 28h1v1H27z"></path>
    </svg>
  </section>
  

  <section>
    <h1>Subscribe</h1>
    Do you want to get notified via email when I post new content?
    <style>
      .subscribe-button {
        /* margin: 10px !important; */
        padding: 10px !important;
        background-color: black;
        display: inline-block;
        color: white !important;
        text-decoration: none;

        line-height: 36px !important;
        height: 37px !important;
        text-decoration: none !important;
        display: inline-block !important;
        color: #ffffff !important;
        background-color: #000000 !important;
        border-radius: 3px !important;
        border: 1px solid transparent !important;
        padding: 1px 9px !important;
        font-size: 23px !important;
        letter-spacing: 0.6px !important;
        box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
        -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
        margin: 0 auto !important;
        font-family: 'Cookie', cursive !important;
        -webkit-box-sizing: border-box !important;
        box-sizing: border-box !important;
        -o-transition: 0.3s all linear !important;
        -webkit-transition: 0.3s all linear !important;
        -moz-transition: 0.3s all linear !important;
        -ms-transition: 0.3s all linear !important;
        transition: 0.3s all linear !important;

      }
    </style>
    <a class='subscribe-button' target="_blank" href="http://eepurl.com/dxI3PP">Click here to subscribe!</a>
  </section>


  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
        <a href="https://www.spapas.net/2024/08/22/multiple-erl-elixir-windows/">Multiple Erlang/Elixir versions in Windows</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/11/29/openid-connect-tutorial/">A simple OpenID connect tutorial</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/05/23/simple-django-datatables-integration/">Simple Django - DataTables integration</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/05/22/ai-auto-subtitling/">AI auto-subtitling</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/05/12/disable-your-forms/">HTML form disable after submit</a>
      </li>
    </ul>
  </section>
  <section>

    <h1>Categories</h1>
    <ul id="recent_posts">
      <li><a href="https://www.spapas.net/category/ai.html">ai</a></li>
      <li><a href="https://www.spapas.net/category/android.html">android</a></li>
      <li><a href="https://www.spapas.net/category/clojure.html">clojure</a></li>
      <li><a href="https://www.spapas.net/category/css.html">css</a></li>
      <li><a href="https://www.spapas.net/category/django.html">django</a></li>
      <li><a href="https://www.spapas.net/category/elixir.html">elixir</a></li>
      <li><a href="https://www.spapas.net/category/flask.html">flask</a></li>
      <li><a href="https://www.spapas.net/category/gaming.html">gaming</a></li>
      <li><a href="https://www.spapas.net/category/git.html">git</a></li>
      <li><a href="https://www.spapas.net/category/html.html">html</a></li>
      <li><a href="https://www.spapas.net/category/javascript.html">javascript</a></li>
      <li><a href="https://www.spapas.net/category/networking.html">networking</a></li>
      <li><a href="https://www.spapas.net/category/pelican.html">pelican</a></li>
      <li><a href="https://www.spapas.net/category/postgresql.html">postgresql</a></li>
      <li><a href="https://www.spapas.net/category/python.html">python</a></li>
      <li><a href="https://www.spapas.net/category/spring.html">spring</a></li>
      <li><a href="https://www.spapas.net/category/unix.html">unix</a></li>
      <li><a href="https://www.spapas.net/category/wagtail.html">wagtail</a></li>
    </ul>
  </section>

  <section>
    <h1>Tags</h1>
    <a href="https://www.spapas.net/tag/erlang.html">erlang</a>,    <a href="https://www.spapas.net/tag/elixir.html">elixir</a>,    <a href="https://www.spapas.net/tag/windows.html">windows</a>,    <a href="https://www.spapas.net/tag/openid.html">openid</a>,    <a href="https://www.spapas.net/tag/openid-connect.html">openid-connect</a>,    <a href="https://www.spapas.net/tag/oidc.html">oidc</a>,    <a href="https://www.spapas.net/tag/http.html">http</a>,    <a href="https://www.spapas.net/tag/keycloak.html">keycloak</a>,    <a href="https://www.spapas.net/tag/python.html">python</a>,    <a href="https://www.spapas.net/tag/django.html">django</a>,    <a href="https://www.spapas.net/tag/jquery.html">jquery</a>,    <a href="https://www.spapas.net/tag/datatables.html">datatables</a>,    <a href="https://www.spapas.net/tag/ai.html">ai</a>,    <a href="https://www.spapas.net/tag/whisper.html">whisper</a>,    <a href="https://www.spapas.net/tag/whispercpp.html">whisper.cpp</a>,    <a href="https://www.spapas.net/tag/subtitles.html">subtitles</a>,    <a href="https://www.spapas.net/tag/video.html">video</a>,    <a href="https://www.spapas.net/tag/auto-subtitling.html">auto-subtitling</a>,    <a href="https://www.spapas.net/tag/subtitiling.html">subtitiling</a>,    <a href="https://www.spapas.net/tag/transcribe.html">transcribe</a>,    <a href="https://www.spapas.net/tag/html.html">html</a>,    <a href="https://www.spapas.net/tag/javascript.html">javascript</a>,    <a href="https://www.spapas.net/tag/media.html">media</a>,    <a href="https://www.spapas.net/tag/storage.html">storage</a>,    <a href="https://www.spapas.net/tag/unpoly.html">unpoly</a>,    <a href="https://www.spapas.net/tag/access.html">access</a>,    <a href="https://www.spapas.net/tag/database.html">database</a>,    <a href="https://www.spapas.net/tag/accdb.html">accdb</a>,    <a href="https://www.spapas.net/tag/mdb.html">mdb</a>,    <a href="https://www.spapas.net/tag/postgresql.html">postgresql</a>,    <a href="https://www.spapas.net/tag/development.html">development</a>,    <a href="https://www.spapas.net/tag/inlines.html">inlines</a>,    <a href="https://www.spapas.net/tag/clojure.html">clojure</a>,    <a href="https://www.spapas.net/tag/cmd.html">cmd</a>,    <a href="https://www.spapas.net/tag/pdf.html">pdf</a>,    <a href="https://www.spapas.net/tag/wkhtmltopdf.html">wkhtmltopdf</a>,    <a href="https://www.spapas.net/tag/forward-proxy.html">forward-proxy</a>,    <a href="https://www.spapas.net/tag/reverse-proxy.html">reverse-proxy</a>,    <a href="https://www.spapas.net/tag/proxy.html">proxy</a>,    <a href="https://www.spapas.net/tag/networking.html">networking</a>,    <a href="https://www.spapas.net/tag/dj-rest-auth.html">dj-rest-auth</a>,    <a href="https://www.spapas.net/tag/rest.html">rest</a>,    <a href="https://www.spapas.net/tag/django-rest-framework.html">django-rest-framework</a>,    <a href="https://www.spapas.net/tag/authentication.html">authentication</a>,    <a href="https://www.spapas.net/tag/tokens.html">tokens</a>,    <a href="https://www.spapas.net/tag/migrations.html">migrations</a>,    <a href="https://www.spapas.net/tag/foreignkey.html">foreignkey</a>,    <a href="https://www.spapas.net/tag/dark-souls.html">dark-souls</a>,    <a href="https://www.spapas.net/tag/dark-souls-2.html">dark-souls-2</a>,    <a href="https://www.spapas.net/tag/dark-souls-3.html">dark-souls-3</a>,    <a href="https://www.spapas.net/tag/autohotkey.html">autohotkey</a>,    <a href="https://www.spapas.net/tag/matplotlib.html">matplotlib</a>,    <a href="https://www.spapas.net/tag/hashids.html">hashids</a>,    <a href="https://www.spapas.net/tag/wagtail.html">wagtail</a>,    <a href="https://www.spapas.net/tag/osmon.html">osmon</a>,    <a href="https://www.spapas.net/tag/phoenix.html">phoenix</a>,    <a href="https://www.spapas.net/tag/os-monitoring.html">os-monitoring</a>,    <a href="https://www.spapas.net/tag/forms.html">forms</a>,    <a href="https://www.spapas.net/tag/django-crispy-forms.html">django-crispy-forms</a>,    <a href="https://www.spapas.net/tag/django-widget-tweaks.html">django-widget-tweaks</a>,    <a href="https://www.spapas.net/tag/ecto.html">ecto</a>,    <a href="https://www.spapas.net/tag/queries.html">queries</a>,    <a href="https://www.spapas.net/tag/declarative.html">declarative</a>,    <a href="https://www.spapas.net/tag/form.html">form</a>,    <a href="https://www.spapas.net/tag/php.html">php</a>,    <a href="https://www.spapas.net/tag/select2.html">select2</a>,    <a href="https://www.spapas.net/tag/autocompelte.html">autocompelte</a>,    <a href="https://www.spapas.net/tag/ajax.html">ajax</a>,    <a href="https://www.spapas.net/tag/android.html">android</a>,    <a href="https://www.spapas.net/tag/kotlin.html">kotlin</a>,    <a href="https://www.spapas.net/tag/adapter.html">adapter</a>,    <a href="https://www.spapas.net/tag/filter.html">filter</a>,    <a href="https://www.spapas.net/tag/async.html">async</a>,    <a href="https://www.spapas.net/tag/tasks.html">tasks</a>,    <a href="https://www.spapas.net/tag/django-rq.html">django-rq</a>,    <a href="https://www.spapas.net/tag/rq.html">rq</a>,    <a href="https://www.spapas.net/tag/du.html">du</a>,    <a href="https://www.spapas.net/tag/unix.html">unix</a>,    <a href="https://www.spapas.net/tag/linux.html">linux</a>,    <a href="https://www.spapas.net/tag/disk-usage.html">disk-usage</a>,    <a href="https://www.spapas.net/tag/cbv.html">cbv</a>,    <a href="https://www.spapas.net/tag/middleware.html">middleware</a>,    <a href="https://www.spapas.net/tag/class-based-views.html">class-based-views</a>,    <a href="https://www.spapas.net/tag/react.html">react</a>,    <a href="https://www.spapas.net/tag/redux.html">redux</a>,    <a href="https://www.spapas.net/tag/hyperapp.html">hyperapp</a>,    <a href="https://www.spapas.net/tag/immutable.html">immutable</a>,    <a href="https://www.spapas.net/tag/es6.html">es6</a>,    <a href="https://www.spapas.net/tag/youtube.html">youtube</a>,    <a href="https://www.spapas.net/tag/youtube-dl.html">youtube-dl</a>,    <a href="https://www.spapas.net/tag/ffmpeg.html">ffmpeg</a>,    <a href="https://www.spapas.net/tag/django-rest-auth.html">django-rest-auth</a>,    <a href="https://www.spapas.net/tag/python-2.html">python-2</a>,    <a href="https://www.spapas.net/tag/python-3.html">python-3</a>,    <a href="https://www.spapas.net/tag/plpgsql.html">plpgsql</a>,    <a href="https://www.spapas.net/tag/component.html">component</a>,    <a href="https://www.spapas.net/tag/ag-grid.html">ag-grid</a>,    <a href="https://www.spapas.net/tag/grid.html">grid</a>,    <a href="https://www.spapas.net/tag/bash.html">bash</a>,    <a href="https://www.spapas.net/tag/cron.html">cron</a>,    <a href="https://www.spapas.net/tag/pandas.html">pandas</a>,    <a href="https://www.spapas.net/tag/scipy.html">scipy</a>,    <a href="https://www.spapas.net/tag/numpy.html">numpy</a>,    <a href="https://www.spapas.net/tag/pivot.html">pivot</a>,    <a href="https://www.spapas.net/tag/pivot_table.html">pivot_table</a>,    <a href="https://www.spapas.net/tag/ipython.html">ipython</a>,    <a href="https://www.spapas.net/tag/jupyter.html">jupyter</a>,    <a href="https://www.spapas.net/tag/notebook.html">notebook</a>,    <a href="https://www.spapas.net/tag/query.html">query</a>,    <a href="https://www.spapas.net/tag/q.html">q</a>,    <a href="https://www.spapas.net/tag/imgur.html">imgur</a>,    <a href="https://www.spapas.net/tag/console.html">console</a>,    <a href="https://www.spapas.net/tag/research.html">research</a>,    <a href="https://www.spapas.net/tag/debug.html">debug</a>,    <a href="https://www.spapas.net/tag/werkzeug.html">werkzeug</a>,    <a href="https://www.spapas.net/tag/django-extensions.html">django-extensions</a>,    <a href="https://www.spapas.net/tag/404.html">404</a>,    <a href="https://www.spapas.net/tag/error.html">error</a>,    <a href="https://www.spapas.net/tag/spring.html">spring</a>,    <a href="https://www.spapas.net/tag/spring-boot.html">spring-boot</a>,    <a href="https://www.spapas.net/tag/java.html">java</a>,    <a href="https://www.spapas.net/tag/ldap.html">ldap</a>,    <a href="https://www.spapas.net/tag/profiles.html">profiles</a>,    <a href="https://www.spapas.net/tag/settings.html">settings</a>,    <a href="https://www.spapas.net/tag/properties.html">properties</a>,    <a href="https://www.spapas.net/tag/yaml.html">yaml</a>,    <a href="https://www.spapas.net/tag/configuration.html">configuration</a>,    <a href="https://www.spapas.net/tag/deploy.html">deploy</a>,    <a href="https://www.spapas.net/tag/initd.html">init.d</a>,    <a href="https://www.spapas.net/tag/react-redux.html">react-redux</a>,    <a href="https://www.spapas.net/tag/redux-thunk.html">redux-thunk</a>,    <a href="https://www.spapas.net/tag/redux-form.html">redux-form</a>,    <a href="https://www.spapas.net/tag/react-router.html">react-router</a>,    <a href="https://www.spapas.net/tag/react-router-redux.html">react-router-redux</a>,    <a href="https://www.spapas.net/tag/react-notification.html">react-notification</a>,    <a href="https://www.spapas.net/tag/history.html">history</a>,    <a href="https://www.spapas.net/tag/babel.html">babel</a>,    <a href="https://www.spapas.net/tag/babelify.html">babelify</a>,    <a href="https://www.spapas.net/tag/browserify.html">browserify</a>,    <a href="https://www.spapas.net/tag/watchify.html">watchify</a>,    <a href="https://www.spapas.net/tag/uglify.html">uglify</a>,    <a href="https://www.spapas.net/tag/boilerplate.html">boilerplate</a>,    <a href="https://www.spapas.net/tag/tutorial.html">tutorial</a>,    <a href="https://www.spapas.net/tag/introduction.html">introduction</a>,    <a href="https://www.spapas.net/tag/fixed-data-tables.html">fixed-data-tables</a>,    <a href="https://www.spapas.net/tag/fixeddatatable.html">FixedDataTable</a>,    <a href="https://www.spapas.net/tag/reportlab.html">reportlab</a>,    <a href="https://www.spapas.net/tag/xhtml2pdf.html">xhtml2pdf</a>,    <a href="https://www.spapas.net/tag/node.html">node</a>,    <a href="https://www.spapas.net/tag/npm.html">npm</a>,    <a href="https://www.spapas.net/tag/generic.html">generic</a>,    <a href="https://www.spapas.net/tag/tables.html">tables</a>,    <a href="https://www.spapas.net/tag/flux.html">flux</a>,    <a href="https://www.spapas.net/tag/jobs.html">jobs</a>,    <a href="https://www.spapas.net/tag/asynchronous.html">asynchronous</a>,    <a href="https://www.spapas.net/tag/scheduling.html">scheduling</a>,    <a href="https://www.spapas.net/tag/redis.html">redis</a>,    <a href="https://www.spapas.net/tag/pusher.html">pusher</a>,    <a href="https://www.spapas.net/tag/auditing.html">auditing</a>,    <a href="https://www.spapas.net/tag/css.html">css</a>,    <a href="https://www.spapas.net/tag/design.html">design</a>,    <a href="https://www.spapas.net/tag/boostrap-material-design.html">boostrap-material-design</a>,    <a href="https://www.spapas.net/tag/less.html">less</a>,    <a href="https://www.spapas.net/tag/nodejs.html">node.js</a>,    <a href="https://www.spapas.net/tag/gmail.html">gmail</a>,    <a href="https://www.spapas.net/tag/security.html">security</a>,    <a href="https://www.spapas.net/tag/google.html">google</a>,    <a href="https://www.spapas.net/tag/flask.html">flask</a>,    <a href="https://www.spapas.net/tag/mongodb.html">mongodb</a>,    <a href="https://www.spapas.net/tag/heroku.html">heroku</a>,    <a href="https://www.spapas.net/tag/spring-security.html">spring-security</a>,    <a href="https://www.spapas.net/tag/git.html">git</a>,    <a href="https://www.spapas.net/tag/github.html">github</a>,    <a href="https://www.spapas.net/tag/branching.html">branching</a>,    <a href="https://www.spapas.net/tag/static-html.html">static-html</a>,    <a href="https://www.spapas.net/tag/githubio.html">github.io</a>,    <a href="https://www.spapas.net/tag/pelican.html">pelican</a>,    <a href="https://www.spapas.net/tag/github-pages.html">github-pages</a>,    <a href="https://www.spapas.net/tag/rst.html">rst</a>  </section>

  <section>
    <h1>Yearly archives</h1>
    <a href="https://www.spapas.net/posts/2013/">2013</a>,    <a href="https://www.spapas.net/posts/2014/">2014</a>,    <a href="https://www.spapas.net/posts/2015/">2015</a>,    <a href="https://www.spapas.net/posts/2016/">2016</a>,    <a href="https://www.spapas.net/posts/2017/">2017</a>,    <a href="https://www.spapas.net/posts/2018/">2018</a>,    <a href="https://www.spapas.net/posts/2019/">2019</a>,    <a href="https://www.spapas.net/posts/2020/">2020</a>,    <a href="https://www.spapas.net/posts/2021/">2021</a>,    <a href="https://www.spapas.net/posts/2022/">2022</a>,    <a href="https://www.spapas.net/posts/2023/">2023</a>,    <a href="https://www.spapas.net/posts/2024/">2024</a>  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/spapas">@spapas</a> on GitHub
    <script  src="//code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script type="text/javascript">
      $(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = 'https://www.spapas.net/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'spapas',
              count: 5,
              skip_forks: true,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="https://www.spapas.net/theme/js/github.js" type="text/javascript"> </script>
  </section>


  <section>
    <a href="https://twitter.com/_serafeim_?ref_src=twsrc%5Etfw" class="twitter-follow-button"
      data-show-count="false">Follow @_serafeim_</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2013&ndash;2024  Serafeim Papastefanos &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="https://www.spapas.net/theme/js/modernizr-2.0.js"></script>
  <script src="https://www.spapas.net/theme/js/ender.js"></script>
  <script src="https://www.spapas.net/theme/js/octopress.js" type="text/javascript"></script>
  <script src="https://www.spapas.net/theme/js/ads.js"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44750952-1', 'auto');

    ga('send', 'pageview');
    </script>

<script defer data-domain="spapas.net" src="https://plausible.hcg.gr/js/script.js"></script>  <script type="text/javascript">
    var disqus_shortname = 'spapas-github-io';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>

</body>

</html>
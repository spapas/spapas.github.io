<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="5_8DTmIiEq4gFvNAfxAD6TsGOgrMAjp8lQFQvfA6zZc" />
  <title>Django dynamic tables and filters for similar models &mdash; /var/</title>
  <meta name="author" content="Serafeim Papastefanos">






  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="http://spapas.github.io/favicon.png" rel="icon">

  <link href="http://spapas.github.io/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="http://spapas.github.io/">/var/</a></h1>
    <h2>Various programming stuff</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li >
        <a href="http://spapas.github.io/category/css.html">Css</a>
      </li>
      <li class="active">
        <a href="http://spapas.github.io/category/django.html">Django</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/flask.html">Flask</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/git.html">Git</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/javascript.html">Javascript</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/pelican.html">Pelican</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/python.html">Python</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/spring.html">Spring</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/wagtail.html">Wagtail</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Django dynamic tables and filters for similar models</h1>
    <p class="meta">
<time datetime="2015-10-05T14:20:00+03:00" pubdate>Δευ 05 Οκτώβριος 2015</time>    </p>
</header>

  <div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#the-problem-we-ll-solve" id="id2">The problem we&#8217;ll&nbsp;solve</a></li>
<li><a class="reference internal" href="#adding-the-dynamic-table" id="id3">Adding the dynamic&nbsp;table</a></li>
<li><a class="reference internal" href="#creating-a-dynamic-form-for-filtering" id="id4">Creating a dynamic form for&nbsp;filtering</a></li>
<li><a class="reference internal" href="#creating-the-dynamic-cbv" id="id5">Creating the dynamic <span class="caps">CBV</span></a></li>
<li><a class="reference internal" href="#conclusion" id="id6">Conclusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a></h2>
<p>One of my favorite django apps is <a class="reference external" href="https://github.com/bradleyayers/django-tables2">django-tables2</a>: It allows you to
easily create pagination and sorting enabled <span class="caps">HTML</span> tables to represent
your model data using the usual djangonic technique (similar to how
you <a class="reference external" href="https://docs.djangoproject.com/en/1.8/topics/forms/modelforms/#modelform">create ModelForms</a>). I use it to almost all my projects to
represent the data, along with <a class="reference external" href="https://github.com/alex/django-filter">django-filter</a> to create forms
to filter my model data. I&#8217;ve written <a class="reference external" href="http://stackoverflow.com/questions/13611741/django-tables-column-filtering/15129259#15129259">a nice <span class="caps">SO</span> answer</a> with
instructions on how to use django-filter along with django-tables2.
This article will describe a technique that allows you to generate
tables and filters for your models in the most <span class="caps">DRY</span>&nbsp;way!</p>
</div>
<div class="section" id="the-problem-we-ll-solve">
<h2><a class="toc-backref" href="#id2">The problem we&#8217;ll&nbsp;solve</a></h2>
<p>The main tool django-tables2 offers is a template tag called <tt class="docutils literal">render_table</tt>
that gets an instance of a subclass of <tt class="docutils literal">django_tables2.Table</tt>
which contains a description of the table (columns, style etc) along
with a queryset with the table&#8217;s data and outputs it to the page. A nice
extra feature of render_table is that you could pass it just a simple
django queryset and it will output it without the need to create the
custom Table class. So you can do something like {% render_table User.objects.all() %}
and get a quick output of your Users&nbsp;table.</p>
<p>In one of my projects I had three models that
were used for keeping a different type of business log in the database (for auditing reasons)
and was using the above feature to display these logs to the administrators, just by
creating a very simple <tt class="docutils literal">ListView</tt> (a different one for each Log type) and using the
<tt class="docutils literal">render_table</tt> to display the data. So I&#8217;d created three views limilar to&nbsp;this:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">AuditLogListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">AuditLog</span>
  <span class="n">context_object_name</span> <span class="o">=</span> <span class="s">&#39;logs&#39;</span>
</pre></div>
<p>which all used a single template that contained a line <tt class="docutils literal">{% render_table logs %}</tt> to display
the table (the <tt class="docutils literal">logs</tt> context variable contains the list/queryset of <tt class="docutils literal">AuditLog</tt> s)
so <tt class="docutils literal">render_table</tt> will just output that list in a page. Each view of course had a different
<tt class="docutils literal">model</tt> attribute.</p>
<p>This was a nice <span class="caps">DRY</span> (but quick and dirty solution) that soon was not enough to fulfill the
needs of the administrators since they neeeded to have default sorting, filtering, hide
the primary key-id column etc. The obvious solution for that would be to just create three different
<tt class="docutils literal">Table</tt> subclasses that
would more or less have the same options with only their <tt class="docutils literal">model</tt> attributte different. I didn&#8217;t
like this solution that much since it seemed non-<span class="caps">DRY</span> to me and I would instead prefer to
create a generic <tt class="docutils literal">Table</tt> (that wouldn&#8217;t have a <tt class="docutils literal">model</tt> attributte) and would just output
its data with the correct options &#8212; so instead of three <tt class="docutils literal">Table</tt> classes I&#8217;d like to create
just a single one with common options that would display its data (what <tt class="docutils literal">render_table</tt> does).</p>
<p>Unfortunately, I couldn&#8217;t find a solution to this, since when I ommited the <tt class="docutils literal">model</tt> attribute
from the <tt class="docutils literal">Table</tt> subclass nothing was outputed (there is no way to define fields to
display in a <tt class="docutils literal">Table</tt> without also defining the model). An obvious (and <span class="caps">DRY</span>) resolution would be to create
a base <tt class="docutils literal">Table</tt> subclass that would define the needed options and create three subclasses
that would inherit from this class and override only the <tt class="docutils literal">model</tt> attribute. This unfortunately was not
possible becase <a class="reference external" href="http://stackoverflow.com/questions/16696066/django-tables2-dynamically-adding-columns-to-table-not-adding-attrs-to-table/16741665#16741665">inheritance does not work well with django-tables2</a>!</p>
<p>Furthermore, there&#8217;s the extra hurdle of adding filtering to the above tables so that
the admin&#8217;s would be able to quickly find a log message - if we wanted to use django-filter
we&#8217;d need again to create three different subclasses (one for each log model type)
of <tt class="docutils literal">django_filter.FilterSet</tt> since
django-filter requires you to define the model for which the filter will be&nbsp;created!</p>
<p>One cool way to resolve such problems is to create your classes dynamically when
you need &#8216;em. I&#8217;ve already described a way to <a class="reference external" href="http://spapas.github.io/2013/12/24/django-dynamic-forms/">dynamically create forms in django
in a previous post</a>. Below, I&#8217;ll describe
a similar technique which can be used to create both dynamic tables and filters. Using
this methodology, you&#8217;ll be able to add a new <span class="caps">CBV</span> that displays a table with
pagination, order and filtering for your model by just inheriting from a base&nbsp;class!</p>
</div>
<div class="section" id="adding-the-dynamic-table">
<h2><a class="toc-backref" href="#id3">Adding the dynamic&nbsp;table</a></h2>
<p>To create the <span class="caps">DRY</span> <span class="caps">CBV</span> we&#8217;ll use the <a class="reference external" href="http://django-tables2.readthedocs.org/en/latest/pages/generic-mixins.html?highlight=singletableview">SingleTableView</a> (<tt class="docutils literal">django_tables2.SingleTableView</tt>)
as a base and override its <tt class="docutils literal">get_table_class</tt> method to dynamically create our table class
using <tt class="docutils literal">type</tt>.
Here&#8217;s how it could be done using a mixin (notice that this mixin should be used in a
<tt class="docutils literal">SingleTableView</tt> to override its <tt class="docutils literal">get_table_class</tt> method):</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">AddTableMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">):</span>
  <span class="n">table_pagination</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;per_page&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">}</span>

  <span class="k">def</span> <span class="nf">get_table_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">def</span> <span class="nf">get_table_column</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
          <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">django</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">):</span>
              <span class="k">return</span> <span class="n">tables</span><span class="o">.</span><span class="n">DateColumn</span><span class="p">(</span><span class="s">&quot;d/m/Y H:i&quot;</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="k">return</span> <span class="n">tables</span><span class="o">.</span><span class="n">Column</span><span class="p">()</span>

      <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
          <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">get_table_column</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">for</span>
          <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;id&#39;</span>
      <span class="p">)</span>
      <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;Meta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s">&#39;Meta&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s">&#39;attrs&#39;</span><span class="p">:{</span><span class="s">&quot;class&quot;</span><span class="p">:</span><span class="s">&quot;table&quot;</span><span class="p">},</span> <span class="s">&quot;order_by&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;-created_on&quot;</span><span class="p">,</span> <span class="p">)</span> <span class="p">}</span> <span class="p">)</span>
      <span class="n">klass</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s">&#39;DTable&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">Table</span><span class="p">,</span> <span class="p">),</span> <span class="n">attrs</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">klass</span>
</pre></div>
<p>Let&#8217;s try to explain the <tt class="docutils literal">get_table_class</tt> method: First of all, we&#8217;ve defined a local <tt class="docutils literal">get_table_column</tt>
function that will return a django-tables2 column depending on the field of the model. For example, in
our case I wanted to use a <tt class="docutils literal">django_tables2.DateColumn</tt> with a specific format when a <tt class="docutils literal">DateTimeField</tt> is
encountered and for all other model fields just use the stock <tt class="docutils literal">Column</tt>. You may add other overrides here,
for example add a <tt class="docutils literal">TemplateColumn</tt> to properly render some&nbsp;data.</p>
<p>After that, we create a dictionary with all the attributes of the dynamic table model.
The <tt class="docutils literal">self.model</tt> field will contain
the model Class of this <tt class="docutils literal">SingleTableView</tt>, so using its <tt class="docutils literal">_meta.fields</tt> will return
the defined fields of that model. As we can see, I just use
a generator expression to create a tuple with the name of the field and its column type (using <tt class="docutils literal">get_table_column</tt>)
excluding the &#8216;id&#8217; column. So, attrs will be a dictionary of field names and column types. Here you may
also exclude other columns you don&#8217;t want to&nbsp;display.</p>
<p>The <tt class="docutils literal">Meta</tt> class of this table is crated using <tt class="docutils literal">type</tt> which creates a parentless class by
defining all its attributes in a dictionary
and set it as the <tt class="docutils literal">Meta</tt> key in the previously defined <tt class="docutils literal">attrs</tt> dict.
Finally, we create the actual <tt class="docutils literal">django_tables2.Table</tt> subclass by
inheriting from it and passing the <tt class="docutils literal">attrs</tt> dict. We&#8217;ll see an example of what <tt class="docutils literal">get_table_class</tt> returns&nbsp;later.</p>
</div>
<div class="section" id="creating-a-dynamic-form-for-filtering">
<h2><a class="toc-backref" href="#id4">Creating a dynamic form for&nbsp;filtering</a></h2>
<p>Let&#8217;s create another mixin that could be used to create a dynamic <tt class="docutils literal">django.Form</tt> subclass to the <span class="caps">CBV</span>:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">AddFormMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">):</span>
  <span class="k">def</span> <span class="nf">define_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">def</span> <span class="nf">get_form_field_type</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
          <span class="k">return</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

      <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
          <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">get_form_field_type</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">for</span>
          <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_fields</span><span class="p">()</span> <span class="p">)</span>

      <span class="n">klass</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s">&#39;DForm&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">,</span> <span class="p">),</span> <span class="n">attrs</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">klass</span>

  <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="n">form_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_form</span><span class="p">()</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">form</span> <span class="o">=</span> <span class="n">form_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">form</span> <span class="o">=</span> <span class="n">form_class</span><span class="p">()</span>

      <span class="n">qs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AddFormMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
          <span class="n">q_objects</span> <span class="o">=</span> <span class="n">Q</span><span class="p">()</span>
          <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_fields</span><span class="p">():</span>
              <span class="n">q_objects</span> <span class="o">&amp;=</span> <span class="n">Q</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">f</span><span class="o">+</span><span class="s">&#39;__icontains&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)})</span>

          <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">q_objects</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">qs</span>

  <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
      <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AddFormMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="n">ctx</span><span class="p">[</span><span class="s">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span>
      <span class="k">return</span> <span class="n">ctx</span>
</pre></div>
<p>The first method that will be called is the <tt class="docutils literal">get_queryset</tt> method that will generate the dynamic form
using <tt class="docutils literal">define_form</tt>. This method has a <tt class="docutils literal">get_form_field_type</tt> local function (similar to get_table_fields)
that can be used to override the types of the fields (or just fallback to a normal <tt class="docutils literal">CharField</tt>) and
then create the <tt class="docutils literal">attrs</tt> dictionary and <tt class="docutils literal">forms.Form</tt> subclass in a similar way as the <tt class="docutils literal">Table</tt> subclass. Here,
we don&#8217;t want to create a filter form from all fields of the model as we did on table, so instead
we&#8217;ll use a <tt class="docutils literal">get_form_fields</tt> (don&#8217;t confuse it with the local <tt class="docutils literal">get_form_field_type</tt>)
method that returns the name of the fields that we want to
use in the filtering form and needs to be defined in each <span class="caps">CBV</span> &#8212; the <tt class="docutils literal">get_form_fields</tt> must
be defined in classes that use this&nbsp;mixin.</p>
<p>After defining the form, we need to check if there&#8217;s anything to the <tt class="docutils literal"><span class="caps">GET</span></tt> dict &#8212; since we are just filtering the
queryset we&#8217;d need to submit the form with a <tt class="docutils literal"><span class="caps">GET</span></tt> (and not a <tt class="docutils literal"><span class="caps">POST</span></tt>). We see that if we have
data to our <tt class="docutils literal">request.<span class="caps">GET</span></tt> dictionary we&#8217;ll instantiate the form using this data (or else we&#8217;ll just
create an empty form). To do the actual filtering, we check if the form is valid and create a <tt class="docutils literal">django.models.db.Q</tt> object
that is used to combine (by <span class="caps">AND</span>) the conditions. Each of the individual Q objects that will be combined
(<tt class="docutils literal">&amp;=</tt>)
to create the complete one will be created using the line <tt class="docutils literal"><span class="pre">Q(**{f+'__icontains':self.form.cleaned_data.get(f,</span> <span class="pre">'')})</span></tt>
(where f will be the name of the field) which is a nice trick: It will create a
dictionary of the form <tt class="docutils literal">{'action__icontains': 'test text'}</tt> and then pass this as a keyword
argument to the Q (using the <tt class="docutils literal">**</tt> mechanism), so <tt class="docutils literal">Q</tt> will be called like
<tt class="docutils literal"><span class="pre">Q(action__icontains='test</span> text')</tt> - this (using the <tt class="docutils literal"><span class="pre">**{key:val}</span></tt> trick) is
the only way to pass dynamic kwargs to a&nbsp;function!</p>
<p>Finally, the queryset will be filtered using the combined <tt class="docutils literal">Q</tt> object we just&nbsp;described.</p>
</div>
<div class="section" id="creating-the-dynamic-cbv">
<h2><a class="toc-backref" href="#id5">Creating the dynamic <span class="caps">CBV</span></a></h2>
<p>Using the above mixins, we can easily create a dynamic <span class="caps">CBV</span> with a table and a filter form only by inheriting
from the mixins
and <tt class="docutils literal">SingleTableView</tt> and defining the <tt class="docutils literal">get_form_fields</tt> method:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">AuditLogListView</span><span class="p">(</span><span class="n">AddTableMixin</span><span class="p">,</span> <span class="n">AddFormMixin</span><span class="p">,</span> <span class="n">SingleTableView</span><span class="p">):</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">AuditLog</span>
  <span class="n">context_object_name</span> <span class="o">=</span> <span class="s">&#39;logs&#39;</span>

  <span class="k">def</span> <span class="nf">get_form_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span><span class="s">&#39;user__username&#39;</span><span class="p">,</span> <span class="p">)</span>
</pre></div>
<p>Let&#8217;s suppose that the <tt class="docutils literal">AuditLog</tt> is defined as&nbsp;following:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">AuditLog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
  <span class="n">created_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span> <span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="bp">False</span><span class="p">,)</span>
  <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="bp">False</span><span class="p">,)</span>
  <span class="n">action</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="bp">False</span><span class="p">,)</span>
</pre></div>
<p>Using the above <tt class="docutils literal">AuditLogListView</tt>, a dynamic table and a dynamic form will be automaticall created whenever the view is visited.
The <tt class="docutils literal">Table</tt> class will be like&nbsp;this:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">DTable</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
  <span class="n">created_on</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">DateColumn</span><span class="p">(</span><span class="s">&quot;d/m/Y H:i&quot;</span><span class="p">)</span>
  <span class="n">user</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">Column</span><span class="p">()</span>
  <span class="n">action</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">Column</span><span class="p">()</span>

  <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
      <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;class&quot;</span><span class="p">:</span><span class="s">&quot;table&quot;</span><span class="p">}</span>
      <span class="n">order_by</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;-created_on&quot;</span><span class="p">,</span> <span class="p">)</span>
</pre></div>
<p>and the <tt class="docutils literal">Form</tt> class like&nbsp;this:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">DForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
  <span class="n">user__username</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
  <span class="n">action</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
</pre></div>
<p>An interesting thing to notice is that we can drill down to foreign keys (f.e. <tt class="docutils literal">user__username</tt>) to create more interesting filters.
Also we could add some more
methods to be overriden by the implementing class beyond
the <tt class="docutils literal">get_form_fields</tt>. For example, instead of using <tt class="docutils literal">self.model._meta.fields</tt>
to generate the fields of the table, we
could instead use a <tt class="docutils literal">get_table_fields</tt> (similar to the <tt class="docutils literal">get_form_fields</tt>)
method that would be overriden in the implementing
classes (and even drill down on foreign keys to display more data on the table using <a class="reference external" href="http://django-tables2.readthedocs.org/en/latest/pages/accessors.html">accessors</a>).</p>
<p>Or, we could also define the form field types and lookups (instead of always using <tt class="docutils literal">CharField</tt> and
<tt class="docutils literal">icontains</tt> ) in the <tt class="docutils literal">get_form_fields</tt> &#8212; similar to&nbsp;django-filter.</p>
<p>Please notice that instead of creating a django form instance for filtering, we could instead create a django-filter instance with
a similar methodology. However, I preferred to just use a normal django form because it makes the whole process more clear and removes
a level of abstraction (we just create a <tt class="docutils literal">django.Form</tt> subclass while, if we used django-filter we&#8217;d need to create
a django-filter subclass which would create a <tt class="docutils literal">django.Form</tt> subclass)!</p>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id6">Conclusion</a></h2>
<p>Using the above technique we can quickly create a table and filter for a number of Models that all share
the same properties in the most <span class="caps">DRY</span>. This technique of course is useful only for quick CBVs that
are more or less the same and require little customization. Another interesting thing is that instead of
creating different <tt class="docutils literal">SingleTableView</tt> s we could instead create a single <span class="caps">CBV</span> that will get the content type
of the Model to be viewed as a parameter and retrieve the model (and queryset) from the content type - so
we could have a single <span class="caps">CBV</span> for all our table/filtering views&nbsp;!</p>
</div>
</div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        Serafeim Papastefanos
    </span>
  </span>
<time datetime="2015-10-05T14:20:00+03:00" pubdate>Δευ 05 Οκτώβριος 2015</time>  <span class="categories">
    <a class='category' href='http://spapas.github.io/category/django.html'>django</a>
  </span>
  <span class="categories">
    <a class="category" href="http://spapas.github.io/tag/django.html">django</a>,    <a class="category" href="http://spapas.github.io/tag/python.html">python</a>,    <a class="category" href="http://spapas.github.io/tag/forms.html">forms</a>,    <a class="category" href="http://spapas.github.io/tag/tables.html">tables</a>  </span>
</p><div class="sharing">
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://spapas.github.io/2015/10/05/django-dynamic-tables-similar-models/" data-via="" data-counturl="http://spapas.github.io/2015/10/05/django-dynamic-tables-similar-models/" >Tweet</a>
</div>    </footer>
  </article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
  </section>
</div>
<aside class="sidebar">
  <section>
  <br />
  <a href='/feeds/all.atom.xml'>Atom</a> 
  |
  <a href='/feeds/all.rss.xml'>RSS</a> 
  </section>
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="http://spapas.github.io/2016/03/31/spring-boot-settings/">Configuring Spring Boot</a>
      </li>
      <li class="post">
          <a href="http://spapas.github.io/2016/03/02/react-redux-tutorial/">A comprehensive react-redux tutorial</a>
      </li>
      <li class="post">
          <a href="http://spapas.github.io/2015/12/22/ajax-with-react-fixed-data-table/">Ajax data with Fixed Data Table for React</a>
      </li>
      <li class="post">
          <a href="http://spapas.github.io/2015/11/27/pdf-in-django/">PDFs in Django: The essential guide</a>
      </li>
      <li class="post">
          <a href="http://spapas.github.io/2015/11/16/using-browserify-es6/">Improve your client-side-javascript workflow more by using ES6</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="http://spapas.github.io/category/css.html">css</a></li>
        <li><a href="http://spapas.github.io/category/django.html">django</a></li>
        <li><a href="http://spapas.github.io/category/flask.html">flask</a></li>
        <li><a href="http://spapas.github.io/category/git.html">git</a></li>
        <li><a href="http://spapas.github.io/category/javascript.html">javascript</a></li>
        <li><a href="http://spapas.github.io/category/pelican.html">pelican</a></li>
        <li><a href="http://spapas.github.io/category/python.html">python</a></li>
        <li><a href="http://spapas.github.io/category/spring.html">spring</a></li>
        <li><a href="http://spapas.github.io/category/wagtail.html">wagtail</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="http://spapas.github.io/tag/pelican.html">pelican</a>,    <a href="http://spapas.github.io/tag/tasks.html">tasks</a>,    <a href="http://spapas.github.io/tag/django-rest-framework.html">django-rest-framework</a>,    <a href="http://spapas.github.io/tag/less.html">less</a>,    <a href="http://spapas.github.io/tag/spring.html">spring</a>,    <a href="http://spapas.github.io/tag/react-redux.html">react-redux</a>,    <a href="http://spapas.github.io/tag/rest.html">rest</a>,    <a href="http://spapas.github.io/tag/babelify.html">babelify</a>,    <a href="http://spapas.github.io/tag/google.html">google</a>,    <a href="http://spapas.github.io/tag/design.html">design</a>,    <a href="http://spapas.github.io/tag/scheduling.html">scheduling</a>,    <a href="http://spapas.github.io/tag/ldap.html">ldap</a>,    <a href="http://spapas.github.io/tag/auditing.html">auditing</a>,    <a href="http://spapas.github.io/tag/npm.html">npm</a>,    <a href="http://spapas.github.io/tag/tutorial.html">tutorial</a>,    <a href="http://spapas.github.io/tag/static-html.html">static-html</a>,    <a href="http://spapas.github.io/tag/generic.html">generic</a>,    <a href="http://spapas.github.io/tag/tables.html">tables</a>,    <a href="http://spapas.github.io/tag/reportlab.html">reportlab</a>,    <a href="http://spapas.github.io/tag/git.html">git</a>,    <a href="http://spapas.github.io/tag/uglify.html">uglify</a>,    <a href="http://spapas.github.io/tag/rq.html">rq</a>,    <a href="http://spapas.github.io/tag/react-router.html">react-router</a>,    <a href="http://spapas.github.io/tag/django-rq.html">django-rq</a>,    <a href="http://spapas.github.io/tag/babel.html">babel</a>,    <a href="http://spapas.github.io/tag/nodejs.html">node.js</a>,    <a href="http://spapas.github.io/tag/redis.html">redis</a>,    <a href="http://spapas.github.io/tag/heroku.html">heroku</a>,    <a href="http://spapas.github.io/tag/fixed-data-tables.html">fixed-data-tables</a>,    <a href="http://spapas.github.io/tag/properties.html">properties</a>,    <a href="http://spapas.github.io/tag/forms.html">forms</a>,    <a href="http://spapas.github.io/tag/yaml.html">yaml</a>,    <a href="http://spapas.github.io/tag/github-pages.html">github-pages</a>,    <a href="http://spapas.github.io/tag/404.html">404</a>,    <a href="http://spapas.github.io/tag/xhtml2pdf.html">xhtml2pdf</a>,    <a href="http://spapas.github.io/tag/watchify.html">watchify</a>,    <a href="http://spapas.github.io/tag/deploy.html">deploy</a>,    <a href="http://spapas.github.io/tag/gmail.html">gmail</a>,    <a href="http://spapas.github.io/tag/spring-security.html">spring-security</a>,    <a href="http://spapas.github.io/tag/css.html">css</a>,    <a href="http://spapas.github.io/tag/authentication.html">authentication</a>,    <a href="http://spapas.github.io/tag/node.html">node</a>,    <a href="http://spapas.github.io/tag/initd.html">init.d</a>,    <a href="http://spapas.github.io/tag/jobs.html">jobs</a>,    <a href="http://spapas.github.io/tag/redux-form.html">redux-form</a>,    <a href="http://spapas.github.io/tag/redux-thunk.html">redux-thunk</a>,    <a href="http://spapas.github.io/tag/es6.html">es6</a>,    <a href="http://spapas.github.io/tag/python.html">python</a>,    <a href="http://spapas.github.io/tag/mongodb.html">mongodb</a>,    <a href="http://spapas.github.io/tag/javascript.html">javascript</a>,    <a href="http://spapas.github.io/tag/wagtail.html">wagtail</a>,    <a href="http://spapas.github.io/tag/introduction.html">introduction</a>,    <a href="http://spapas.github.io/tag/react.html">react</a>,    <a href="http://spapas.github.io/tag/class-based-views.html">class-based-views</a>,    <a href="http://spapas.github.io/tag/spring-boot.html">spring-boot</a>,    <a href="http://spapas.github.io/tag/boilerplate.html">boilerplate</a>,    <a href="http://spapas.github.io/tag/pdf.html">pdf</a>,    <a href="http://spapas.github.io/tag/rst.html">rst</a>,    <a href="http://spapas.github.io/tag/java.html">java</a>,    <a href="http://spapas.github.io/tag/cbv.html">cbv</a>,    <a href="http://spapas.github.io/tag/configuration.html">configuration</a>,    <a href="http://spapas.github.io/tag/browserify.html">browserify</a>,    <a href="http://spapas.github.io/tag/react-router-redux.html">react-router-redux</a>,    <a href="http://spapas.github.io/tag/branching.html">branching</a>,    <a href="http://spapas.github.io/tag/github.html">github</a>,    <a href="http://spapas.github.io/tag/pusher.html">pusher</a>,    <a href="http://spapas.github.io/tag/settings.html">settings</a>,    <a href="http://spapas.github.io/tag/windows.html">windows</a>,    <a href="http://spapas.github.io/tag/ajax.html">ajax</a>,    <a href="http://spapas.github.io/tag/profiles.html">profiles</a>,    <a href="http://spapas.github.io/tag/django.html">django</a>,    <a href="http://spapas.github.io/tag/flux.html">flux</a>,    <a href="http://spapas.github.io/tag/history.html">history</a>,    <a href="http://spapas.github.io/tag/fixeddatatable.html">FixedDataTable</a>,    <a href="http://spapas.github.io/tag/githubio.html">github.io</a>,    <a href="http://spapas.github.io/tag/error.html">error</a>,    <a href="http://spapas.github.io/tag/debug.html">debug</a>,    <a href="http://spapas.github.io/tag/asynchronous.html">asynchronous</a>,    <a href="http://spapas.github.io/tag/security.html">security</a>,    <a href="http://spapas.github.io/tag/redux.html">redux</a>,    <a href="http://spapas.github.io/tag/react-notification.html">react-notification</a>,    <a href="http://spapas.github.io/tag/flask.html">flask</a>,    <a href="http://spapas.github.io/tag/boostrap-material-design.html">boostrap-material-design</a>  </section>



</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2013&ndash;2016  Serafeim Papastefanos &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="http://spapas.github.io/theme/js/modernizr-2.0.js"></script>
  <script src="http://spapas.github.io/theme/js/ender.js"></script>
  <script src="http://spapas.github.io/theme/js/octopress.js" type="text/javascript"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44750952-1', 'auto');

    ga('send', 'pageview');
    </script>
  <script type="text/javascript">
    var disqus_shortname = 'spapas-github-io';
    var disqus_identifier = '/2015/10/05/django-dynamic-tables-similar-models/';
    var disqus_url = 'http://spapas.github.io/2015/10/05/django-dynamic-tables-similar-models/';
    var disqus_title = 'Django dynamic tables and filters for similar&nbsp;models';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
</body>
</html>
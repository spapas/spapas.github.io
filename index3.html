<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta name="google-site-verification" content="5_8DTmIiEq4gFvNAfxAD6TsGOgrMAjp8lQFQvfA6zZc" />
    <title>/var/</title>
    <meta name="author" content="Serafeim Papastefanos">


    
<style type="text/css">
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: var(--jp-cell-editor-active-background) }
.highlight { background: var(--jp-cell-editor-background); color: var(--jp-mirror-editor-variable-color) }
.highlight .c { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment */
.highlight .err { color: var(--jp-mirror-editor-error-color) } /* Error */
.highlight .k { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword */
.highlight .o { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator */
.highlight .p { color: var(--jp-mirror-editor-punctuation-color) } /* Punctuation */
.highlight .ch { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Multiline */
.highlight .cp { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Preproc */
.highlight .cpf { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Single */
.highlight .cs { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Special */
.highlight .kc { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Type */
.highlight .m { color: var(--jp-mirror-editor-number-color) } /* Literal.Number */
.highlight .s { color: var(--jp-mirror-editor-string-color) } /* Literal.String */
.highlight .ow { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator.Word */
.highlight .pm { color: var(--jp-mirror-editor-punctuation-color) } /* Punctuation.Marker */
.highlight .w { color: var(--jp-mirror-editor-variable-color) } /* Text.Whitespace */
.highlight .mb { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Bin */
.highlight .mf { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Float */
.highlight .mh { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Hex */
.highlight .mi { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer */
.highlight .mo { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Oct */
.highlight .sa { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Affix */
.highlight .sb { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Backtick */
.highlight .sc { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Char */
.highlight .dl { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Delimiter */
.highlight .sd { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Doc */
.highlight .s2 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Double */
.highlight .se { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Escape */
.highlight .sh { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Heredoc */
.highlight .si { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Interpol */
.highlight .sx { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Other */
.highlight .sr { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Regex */
.highlight .s1 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Single */
.highlight .ss { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Symbol */
.highlight .il { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer.Long */
</style>

<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
div.entry-content {
  overflow: visible;
  padding: 8px;
}
.input_area {
  padding: 0.2em;
}

a.heading-anchor {
 white-space: normal;
}

.rendered_html
code {
 font-size: .8em;
}

pre.ipynb {
  color: black;
  background: #f7f7f7;
  border: none;
  box-shadow: none;
  margin-bottom: 0;
  padding: 0;
  margin: 0px;
  font-size: 13px;
}

/* remove the prompt div from text cells */
div.text_cell .prompt {
    display: none;
}

/* remove horizontal padding from text cells, */
/* so it aligns with outer body text */
div.text_cell_render {
    padding: 0.5em 0em;
}

img.anim_icon{padding:0; border:0; vertical-align:middle; -webkit-box-shadow:none; -box-shadow:none}

div.collapseheader {
    width=100%;
    background-color:#d3d3d3;
    padding: 2px;
    cursor: pointer;
    font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
}
</style>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true,
        displayMath: [['$$','$$'], ["\\[","\\]"]]
    }
});
</script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<script type="text/javascript">
jQuery(document).ready(function($) {
    $("div.collapseheader").click(function () {
    $header = $(this).children("span").first();
    $codearea = $(this).children(".input_area");
    console.log($(this).children());
    $codearea.slideToggle(500, function () {
        $header.text(function () {
            return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
        });
    });
});
});
</script>




    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="https://www.spapas.net/favicon.png" rel="icon">

    <link href="https://www.spapas.net/theme/css/main.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://www.spapas.net/theme/css/extra_style.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://fonts.googleapis.com/css?family=Fira+Mono|Fira+Sans:400,700&amp;subset=greek" rel="stylesheet">

<style>
#gHPzseYvFrhZ123 {
  padding: 5px !important;
  display: block;
  margin-bottom: 10px !important;
  background: #900;
  color: #fff;
  border-radius: 5px;
  font-size: 1.0rem !important;
}
</style>


  <script>
    
      
  </script>

    <script data-ad-client="ca-pub-7673322832689008" async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
      onerror="adBlockFunction();"></script>
  </head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="https://www.spapas.net/">/var/</a></h1>
    <h2>Various programming stuff</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li >
        <a href="https://www.spapas.net/category/ai.html">Ai</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/android.html">Android</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/clojure.html">Clojure</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/css.html">Css</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/django.html">Django</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/elixir.html">Elixir</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/flask.html">Flask</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/gaming.html">Gaming</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/git.html">Git</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/html.html">Html</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/javascript.html">Javascript</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/networking.html">Networking</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/pelican.html">Pelican</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/postgresql.html">Postgresql</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/python.html">Python</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/spring.html">Spring</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/unix.html">Unix</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/wagtail.html">Wagtail</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
    <div id="gHPzseYvFrhZ123">
      Hello! If you are using an ad blocker but find something useful here 
      and want to support me please consider disabling your ad blocker for this site. 
      <br />
      <br />
      Thank you,<br />
      Serafeim
      
    </div>
<div class="blog-index">
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2022/06/28/better-django-inlines/">Better Django inlines</a>
      </h1>
    <p class="meta">
<time datetime="2022-06-28T12:20:00+03:00" pubdate>Tue 28 June 2022</time>    </p>
</header>

<div class="entry-content"><p>Django has a feature called <em>inlines</em> which can be used to edit multiple related
objects at once. You&#8217;ll get a single view that will contain a single html form that
includes a different Django form for each object, edit any of them and submit them
all to be&nbsp;saved.</p>
<p>This feature is heavily used when you have objects that have a parent-child relation
between them. For example, a book and a testimonial for each book. Each testimonial
will belong to a single book and from a <span class="caps">UX</span> point of view it seems better to be able
to edit all testimonials for each book at the same&nbsp;time.</p>
<p>The biggest disadvantage of inlines is that, because of how Django works, their
interface is very primitive: For adding new objects, you need to define the number
of empty forms that will be included for each inline. The user can fill them up
and press save. Then the objects will be created and the user will get new empty forms to fill.
To understand this better, let&#8217;s suppose that you have defined 3 empty forms (which is the
default) and the user wants to create 10 inline objects. The flow will&nbsp;be:</p>
<ul class="simple">
<li>The user sees the 3 empty forms and fills them with&nbsp;data.</li>
<li>The user presses save to <span class="caps">POST</span> the&nbsp;data.</li>
<li>The user sees the 3 new objects and another 3 empty&nbsp;forms.</li>
<li>The user fills the 3 empty forms with&nbsp;data.</li>
<li>The user presses save to <span class="caps">POST</span> the&nbsp;data.</li>
<li>The user sees the 6 new objects and another 3 empty&nbsp;forms.</li>
<li>The user fills the 3 empty forms with&nbsp;data.</li>
<li>The user presses save to <span class="caps">POST</span> the&nbsp;data.</li>
<li>The user sees the 9 new objects and another 3 empty&nbsp;forms.</li>
<li>The user fills 1 empty form with&nbsp;data.</li>
<li>The user presses save to <span class="caps">POST</span> the&nbsp;data.</li>
<li>The user sees the 10 new objects and another 3 empty&nbsp;forms.</li>
</ul>
<p>As you can see the user is filling up the available forms and presses save all the time to get the
new forms to display the objects. This makes the
experience very problematic and confuses users that are not familiar with it. Also, when deleting
objects, the user will see a delete checkbox for each object which needs to select and press save to
actually <em>delete</em> the object. This is also counter-intuitive because it&#8217;s not easy for the user
to understand that the object will be deleted when he saves the&nbsp;form.</p>
<p>In this article I&#8217;ll present a way to improve the experience of inlines: We&#8217;ll have a way to add
new inlines without the need to save the form all the time. Also we&#8217;ll be able to improve the
behavior of the delete button so it has a better <span class="caps">UX</span>.</p>
<p>The work in this article is published in this github repository: <a class="reference external" href="https://github.com/spapas/inlinesample">https://github.com/spapas/inlinesample</a>.</p>
<p>The project implements a Book model containing multiple testimonials and editions. For each book
you use inlines to add/edit the Book, its testimonials and editions in the same form. Also, I have included
two ways to add/edit a book: Using the traditional django inlines way and using the javascript way I propose&nbsp;here.</p>
<div class="section" id="models">
<h2>Models</h2>
<p>The models used in this project are the&nbsp;following:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Edition</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">book</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">publisher</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">pages</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Testimonial</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">book</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
    <span class="n">testimonial</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</pre></div>
<p>As you can see they are very simple; each edition and testimonial has a foreign key to a&nbsp;book.</p>
</div>
<div class="section" id="views">
<h2>Views</h2>
<p>For the views I&#8217;m going to use the <a class="reference external" href="https://github.com/AndrewIngram/django-extra-views">django-extra-views</a> package that provides a bunch of
useful inline-related Class Based&nbsp;Views:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.views.generic</span><span class="w"> </span><span class="kn">import</span> <span class="n">ListView</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">extra_views</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">CreateWithInlinesView</span><span class="p">,</span>
    <span class="n">UpdateWithInlinesView</span><span class="p">,</span>
    <span class="n">InlineFormSetFactory</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BookListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Book</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="s2">&quot;edition_set&quot;</span><span class="p">,</span> <span class="s2">&quot;testimonial_set&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">EditionInline</span><span class="p">(</span><span class="n">InlineFormSetFactory</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Edition</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;publisher&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;pages&quot;</span><span class="p">]</span>
    <span class="n">factory_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;extra&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TestimonialInline</span><span class="p">(</span><span class="n">InlineFormSetFactory</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Testimonial</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;testimonial&quot;</span><span class="p">]</span>
    <span class="n">factory_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;extra&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BetterMixin</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_template_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;better&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;books/book_better_form.html&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_template_names</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;/&quot;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BookCreateView</span><span class="p">(</span><span class="n">BetterMixin</span><span class="p">,</span> <span class="n">CreateWithInlinesView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Book</span>
    <span class="n">inlines</span> <span class="o">=</span> <span class="p">[</span><span class="n">EditionInline</span><span class="p">,</span> <span class="n">TestimonialInline</span><span class="p">]</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;author&quot;</span><span class="p">]</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BookUpdateView</span><span class="p">(</span><span class="n">BetterMixin</span><span class="p">,</span> <span class="n">UpdateWithInlinesView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Book</span>
    <span class="n">inlines</span> <span class="o">=</span> <span class="p">[</span><span class="n">EditionInline</span><span class="p">,</span> <span class="n">TestimonialInline</span><span class="p">]</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;author&quot;</span><span class="p">]</span>
</pre></div>
<p>As you can see for starts we add a BookListView that will be mapped to the / <span class="caps">URL</span>. This displays a table with all the books
along with links to add a new or edit an existing book using both the traditional and better&nbsp;approach.</p>
<p>Then we define two classes inheriting from <tt class="docutils literal">InlineFormSetFactory</tt>: <tt class="docutils literal">EditionInline</tt> and <tt class="docutils literal">TestimonialInline</tt>.
These classes define our inlines: We set a model for them, the fields that will be displayed and pass extra parameters
if needed. In this case we pass <tt class="docutils literal">factory_kwargs = {&quot;extra&quot;: 1}</tt> to have a single extra form for each inline. If we didn&#8217;t
pass this Django would create 3 extra forms for each inline. Notice that if we were only using the better inlines we&#8217;d pass
0 to the extra parameter since it&#8217;s not really needed here. However because we use the same inlines for both the traditional
and the better inlines I&#8217;m using 1 here (or else we wouldn&#8217;t be able to add new objects on the traditional&nbsp;approach).</p>
<p>Then we define a <cite>BetterMixin</cite>; the only thing it does it to return a different html template if the user visits the <em>better</em>
views and override the get_sucess_url method to return to &#8220;/&#8221;. As you can understand from this, the only difference between the traditional and better approach is the&nbsp;template.</p>
<p>Finally, we&#8217;ve got two views for adding/editing a new book. We inherit from <tt class="docutils literal">CreateWithInlinesView</tt> and <tt class="docutils literal">UpdateWithInlinesView</tt>
and set their model, inlines and fields attributes to the correct&nbsp;values.</p>
</div>
<div class="section" id="traditional-templates">
<h2>Traditional&nbsp;templates</h2>
<p>The traditional book_form.html template is like&nbsp;this:</p>
<div class="highlight"><pre><span></span>{% extends &quot;base.html&quot; %}
{% load crispy_forms_tags %}
{% block html_title %}Book form{% endblock%}
{% block page_title %}Book form{% endblock%}

{% block content %}
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&#39;POST&#39;</span><span class="p">&gt;</span>
        {% csrf_token %}
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card w-full bg-base-100 shadow-xl card-bordered card-compact border border-gray-900&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-body&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-title&quot;</span><span class="p">&gt;</span>Book<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
                {{ form|crispy }}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        {% include &quot;partials/_inline_set_simple.html&quot; with formset=inlines.0 title=&quot;Editions&quot; %}
        {% include &quot;partials/_inline_set_simple.html&quot; with formset=inlines.1 title=&quot;Testimonials&quot; %}

        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#39;submit&#39;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;btn bg-blue-600&#39;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#39;Save&#39;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;/&#39;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;btn bg-gray-600&#39;</span><span class="p">&gt;</span>Back<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
<p>I&#8217;m using tailwind css for the templates. As you can see we get a two important context variables: <tt class="docutils literal">form</tt> and <tt class="docutils literal">inlines</tt>. The
<tt class="docutils literal">form</tt> is the main object form (book) and the <tt class="docutils literal">inlines</tt> is the list of inlines (editions and testimonials). Notice that I&#8217;m
using a partial template for each of the inlines to improve re-usability. The <cite>_inline_set_simple.html</cite> is like&nbsp;this:</p>
<div class="highlight"><pre><span></span>{% load crispy_forms_tags %}

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card w-full bg-base-100 shadow-xl card-bordered card-compact border border-gray-900&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-body&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-title&quot;</span><span class="p">&gt;</span>{{ title }}<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    {{ formset.management_form }}
    {% for form in formset %}
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;flex border rounded p-1 m-1&#39;</span><span class="p">&gt;</span>
        {% for field in form %}
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;flex-col mx-2 my-2&#39;</span><span class="p">&gt;</span>
            {{ field|as_crispy_field }}
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        {% endfor %}
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    {% endfor %}
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>This uses the django-crispy-forms package to improve form handling. See
<a class="reference external" href="https://www.spapas.net/2020/03/18/django-crispy-form-quick-easy-layout/">this article</a> for a tutorial on using&nbsp;django-crispy-forms.</p>
<p>Notice that i&#8217;m doing <tt class="docutils literal">formset=inlines[n]</tt>, so each inline will have a <tt class="docutils literal">management_form</tt> that is
used internally by django and
a bunch of forms (1 for each object). Each form will have the fields we defined for that inline with
the addition of the delete&nbsp;checkbox.</p>
<p>This is enough to get the basic function. The user will get the following form when adding a new&nbsp;book:</p>
<img alt="The traditional book form" src="/images/book-form.png" style="width: 640px;" />
<p>As we already discussed, the user fills the info and presses save if he wants to add more testimonials or&nbsp;editions.</p>
</div>
<div class="section" id="better-templates">
<h2>Better&nbsp;templates</h2>
<p>Let&#8217;s now take a peek at the <tt class="docutils literal">book_better_form.html</tt> template:</p>
<div class="highlight"><pre><span></span>{% extends &quot;base.html&quot; %}
{% load crispy_forms_tags static %}
{% block html_title %}Book better form{% endblock%}
{% block page_title %}Book better form{% endblock%}

{% block content %}
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&#39;POST&#39;</span><span class="p">&gt;</span>
        {% csrf_token %}
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card w-full bg-base-100 shadow-xl card-bordered card-compact border border-gray-900&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-body&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-title&quot;</span><span class="p">&gt;</span>Book<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
                {{ form|crispy }}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        {% include &quot;partials/_inline_set.html&quot; with inline_name=&#39;edition_set&#39; inline_title=&quot;Editions&quot; formset=inlines.0 %}
        {% include &quot;partials/_inline_set.html&quot; with inline_name=&#39;testimonial_set&#39; inline_title=&quot;Testimonials&quot; formset=inlines.1 %}

        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#39;submit&#39;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;btn bg-blue-600&#39;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#39;Save&#39;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;/&#39;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;btn bg-gray-600&#39;</span><span class="p">&gt;</span>Back<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{% static &#39;inline-editor.js&#39; %}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
<p>This is similar to the <tt class="docutils literal">book_form.html</tt> with the following&nbsp;differences:</p>
<ul class="simple">
<li>We include the <tt class="docutils literal">partials/_inline_set.html</tt> partial template passing it the inline_name which is used to identify the inline. We also pass it the actual inline formset object and a&nbsp;title.</li>
<li>We include some custom javascript called <tt class="docutils literal"><span class="pre">inline-editor.js</span></tt> that is used to handle the inline&nbsp;formset.</li>
</ul>
<p>Notice here that we need to use the <em>correct</em> inline_name and not whatever we want! Usually it will be <tt class="docutils literal">child_name_set</tt> but to be sure
we can easily find it by taking a
peek at the management form django will generate for us (we&#8217;ll see something like <tt class="docutils literal"><span class="pre">testimonial_set-TOTAL_FORMS</span></tt>, so we know that
the name is <tt class="docutils literal">testimonial_set</tt>).</p>
<p>The partial <tt class="docutils literal">_inline_set.html</tt> is a little more&nbsp;complex:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;better_inline_{{ inline_name }}&#39;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card w-full bg-base-100 shadow-xl card-bordered card-compact border border-gray-900&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-body&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-title&quot;</span><span class="p">&gt;</span>
            {{ inline_title }}
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;btn btn-primary&#39;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button bg-blue-500&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;add-form-{{ inline_name }}&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
        {% if formset.non_form_errors %}
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-danger&quot;</span><span class="p">&gt;</span>{{ formset.non_form_errors }}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        {% endif %}

        <span class="p">&lt;</span><span class="nt">template</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;empty-form-{{ inline_name }}&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;flex border border-primary rounded p-1 m-1 inline-form&#39;</span><span class="p">&gt;</span>
                {% for field in formset.empty_form %}
                    {% include &quot;partials/_inline_field.html&quot; %}
                {% endfor %}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

        {{ formset.management_form }}

        {% for form in formset %}
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;flex border rounded p-1 m-1 inline-form&#39;</span><span class="p">&gt;</span>
                {% for field in form %}
                    {% include &quot;partials/_inline_field.html&quot; %}
                {% endfor %}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        {% empty %}
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;flex p-1 m-1 inline-form&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        {% endfor %}
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span> <span class="cm">&lt;!-- card body --&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span><span class="cm">&lt;!-- card --&gt;</span>
</pre></div>
<p>We use the <tt class="docutils literal">inline_name</tt> we passed to generate a unique id for this inline to reference it in the javascript. Then
we have an add new form button. We also add an empty form template that we&#8217;ll use to copy over when adding a new form.
The <tt class="docutils literal">formset.empty_form</tt> is generated by django. After we include the <tt class="docutils literal">management_form</tt> we enumerate the forms using
a for loop. Notice the empty div <tt class="docutils literal">&lt;div <span class="pre">class='flex</span> <span class="pre">p-1</span> <span class="pre">m-1</span> <span class="pre">inline-form'&gt;&lt;/div&gt;</span></tt> when there are no forms, we need that
to help us position the place of the forms to be added as will be explained later. The same <tt class="docutils literal"><span class="pre">inline-form</span></tt> class is used
on the empty template and on the existing&nbsp;forms.</p>
<p>This uses the _inline_field.html partial template which is like&nbsp;this:</p>
<div class="highlight"><pre><span></span>{% load widget_tweaks %}
{% load crispy_forms_tags %}

{% if field.field.widget.input_type == &#39;hidden&#39; %}
    {{ field }}
{% else %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;flex-col my-1 mx-2&#39;</span><span class="p">&gt;</span>
        {% if &quot;DELETE&quot; in field.name  %}
            {{ field|add_class:&quot;&quot;|attr:&quot;onclick:delClick(this)&quot;|as_crispy_field }}
        {% elif field.name == &quot;testimonial&quot; %}
            {{ field|attr:&quot;rows:2&quot;|as_crispy_field }}
        {% else %}
            {{ field|as_crispy_field }}
        {% endif %}
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endif %}
</pre></div>
<p>In this template we add an onclick function called <tt class="docutils literal">delClick</tt> when the user clicks the delete checkbox. We could also do
various other stuff like hide the delete checkbox and add a delete button instead but i&#8217;m leaving it as an exercise to the&nbsp;reader.</p>
</div>
<div class="section" id="better-templates-js">
<h2>Better templates&nbsp;js</h2>
<p>Let&#8217;s now take a peek at the actual javascript. First of all we define a function named&nbsp;inlinEditor:</p>
<div class="highlight"><pre><span></span><span class="kd">function</span><span class="w"> </span><span class="nx">inlineEditor</span><span class="p">(</span><span class="nx">inlineSetName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">tmpl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#empty-form-&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">inlineSetName</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;[name=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">inlineSetName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;-TOTAL_FORMS]&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#add-form-&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">inlineSetName</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">ev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">ev</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">newForm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tmpl</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="nx">newForm</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;[id*=__prefix__]&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">el</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">el</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">el</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;__prefix__&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">counter</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="nx">el</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">el</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;__prefix__&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">counter</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">newForm</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;[for*=__prefix__]&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">el</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">el</span><span class="p">.</span><span class="nx">htmlFor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">el</span><span class="p">.</span><span class="nx">htmlFor</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;__prefix__&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">counter</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">        </span><span class="p">})</span>

<span class="w">        </span><span class="nx">counter</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">counter</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">last_element_selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;form #better_inline_&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">inlineSetName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; .inline-form:last-of-type&#39;</span>
<span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">last_element_selector</span><span class="p">).</span><span class="nx">insertAdjacentElement</span><span class="p">(</span><span class="s1">&#39;afterend&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">newForm</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</pre></div>
<p>This initially function saves the empty form template and the number of forms in the inline. The number of the forms initially is provided
by the django management form. Then we add a click event to the add button for that particular inline. When the user clicks the add
button we&#8217;ll add a new empty form to the end of the existing forms. This works like&nbsp;this:</p>
<p>Each of the inline forms has an id that has the following form <tt class="docutils literal"><span class="pre">inline_name-<span class="caps">NUMBER</span>-field_name</span></tt>, so for example for the first form of editions publisher we&#8217;ll get something like <tt class="docutils literal"><span class="pre">edition_set-0-publisher</span></tt>. The empty form has the string <tt class="docutils literal">__prefix__</tt> instead of the number
so it will be <tt class="docutils literal"><span class="pre">edition_set-__prefix__-publisher</span></tt>. To create the new form we clone the empty form template and replace the <tt class="docutils literal">__prefix__</tt>
on  the elements with the correct number (based on the total number of forms). Then we increase the number of forms and insert the new form
next to the element with the <tt class="docutils literal">last_element_selector</tt> we define there. As you can see this selector will find the last element that
is inside our inline and has a class of <tt class="docutils literal"><span class="pre">inline-form</span></tt>.
That&#8217;s why we need the <tt class="docutils literal"><span class="pre">inline-form</span></tt> class to all three cases as we discussed&nbsp;above</p>
<p>Beyond this, we also have the implementation of <tt class="docutils literal">delClick</tt> that adds a red-border class to form of the element that was clicked
(notice the parentElement.parentElement&nbsp;thingie):</p>
<div class="highlight"><pre><span></span><span class="kd">function</span><span class="w"> </span><span class="nx">delClick</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">checked</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">el</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;border-red-500&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">el</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">&#39;border-red-500&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>Finally, we generate the  inlineEditors when the dom is&nbsp;loaded:</p>
<div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">inlineEditor</span><span class="p">(</span><span class="s1">&#39;edition_set&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">inlineEditor</span><span class="p">(</span><span class="s1">&#39;testimonial_set&#39;</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>
<p>Please notice that here we also need to use the <em>correct</em> name of the inlines (both here and in the&nbsp;template).</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>Using the better approach our book form will be like&nbsp;this:</p>
<img alt="The better book form" src="/images/better-book-form.png" style="width: 640px;" />
<p>Now the user can click the add button and a new form will be added in the end of the current list of forms. Also
when he clicks the delete button he&#8217;ll get a red border around the form to be&nbsp;deleted.</p>
<p>Before finishing this tutorial I&#8217;d like to point out some things that you need to be extra careful about, especially
since you are probably going to use your own html&nbsp;structure:</p>
<ul class="simple">
<li>Don&#8217;t forget to use the correct name for the inlines in the partial template and when initializing it with&nbsp;inlineEditor</li>
<li>Make sure to add the inline-form class to an empty div if there are no forms in the inline, to the existing forms of the inline and to the empty&nbsp;template</li>
<li>Be careful on where you&#8217;ll add  classes to the delClick handler; it depends on the structure of your&nbsp;html</li>
</ul>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2022/04/14/clojure-windows/">Using clojure from Windows</a>
      </h1>
    <p class="meta">
<time datetime="2022-04-14T11:20:00+03:00" pubdate>Thu 14 April 2022</time>    </p>
</header>

<div class="entry-content"><p>In this small article I&#8217;m going to post a guide on how to install and use clojure from Windows using good old&#8217;&nbsp;cmd.exe.</p>
<p>Unfortunately, most guides on the official clojure site have instructions on using Clojure from Windows through Powershell or <span class="caps">WSL</span>.
For my own reasons I hate both these approaches and only use the cmd.exe to interact with the Windows command&nbsp;line.</p>
<p>There are more or less two approaches to using clojure. Using <a class="reference external" href="https://leiningen.org/">leiningen</a> or using the clj tools.
The clojure official guide seems to be <cite>biased towards clj tools</cite>. However I think that leiningen may be easier for new users.
I&#8217;ll cover both approaches&nbsp;here.</p>
<p><em>Warning</em> Before doing anything else please make sure to install Java. You need a version of java that is at least 1.8. Try running
<tt class="docutils literal">java <span class="pre">-version</span></tt> in cmd.exe to make sure you have java and it is the correct&nbsp;version.</p>
<div class="section" id="leiningen">
<h2>Leiningen</h2>
<p>To install leiningen you just download the lein.bat file from their page and put it in a folder in your <span class="caps">PATH</span>. You&#8217;ll then run
lein and it will download all dependencies and install&nbsp;itself!</p>
<p>To start a clojure repl to be able to play with clojure you write <tt class="docutils literal">lein repl</tt>. If everything went smooth you should see a prompt
and if you write <tt class="docutils literal">(+ 1 2)</tt> you should get <tt class="docutils literal">3</tt>. To exit press <tt class="docutils literal">ctrl+d</tt> or write <tt class="docutils literal">exit</tt>.</p>
<p>To start a new project you&#8217;ll use <tt class="docutils literal">lein new [template name] [project name]</tt>. For example, to create a new app you&#8217;ll write:
<tt class="docutils literal">lein new app leinapp</tt>. You&#8217;ll get a new directory called <tt class="docutils literal">leinapp</tt>. The important stuff in this directory&nbsp;are:</p>
<ul class="simple">
<li><tt class="docutils literal">project.clj</tt>: The basic descriptor of your project; here you can set various attrs of your project and also add&nbsp;dependencies</li>
<li>src\leinapp: The source directory of your project. This is where you&#8217;ll put your&nbsp;code.</li>
<li>test\leinapp: Add tests&nbsp;here</li>
</ul>
<p>There should be a <tt class="docutils literal">core.clj</tt> file inside your src\leinapp folder. The <tt class="docutils literal">main</tt> function is the entry point of the app. Try running
<tt class="docutils literal">lein run</tt> from the project folder and you should get the output of the <tt class="docutils literal">main</tt> function.</p>
<p>Add this to the end of the <tt class="docutils literal">core.clj</tt> to define a <tt class="docutils literal">foo</tt> function:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">defn </span><span class="nv">foo</span><span class="w"> </span><span class="p">[]</span>
<span class="w">  </span><span class="s">&quot;bar&quot;</span><span class="p">)</span>
</pre></div>
<p>And run <tt class="docutils literal">lein repl</tt>. You should get a repl command prompt for your application
in the <tt class="docutils literal">leinapp.core</tt> namespace (if you named your app <tt class="docutils literal">leinapp</tt>). Type
<tt class="docutils literal">(foo)</tt> and you should see <tt class="docutils literal">&quot;bar&quot;</tt>.</p>
<p>To create a stand alone jar with your code (called <em>uberjar</em>) you can use <tt class="docutils literal">lein uberjar</tt>. This will create a file
named <tt class="docutils literal"><span class="pre">target\uberjar\leinapp-0.1.0-<span class="caps">SNAPSHOT</span>-standalone.jar</span></tt>. Then try <tt class="docutils literal">java <span class="pre">-jar</span> <span class="pre">target\uberjar\leinapp-0.1.0-<span class="caps">SNAPSHOT</span>-standalone.jar</span></tt>
(notice I&#8217;m still on the leinapp project folder) and you&#8217;ll see the output of&nbsp;main!</p>
</div>
<div class="section" id="clj">
<h2>clj</h2>
<p>Using the clj is a more <em>modern</em> approach to clojure development. As I said before the official clojure page seems to be biased towards
using this approach. The problem is that it seems to require Powershell to run as you can see on the  <cite>clj on Windows</cite> page.</p>
<p>Thankfully, the good people at the <a class="reference external" href="https://clojurians.slack.com/">clojurians</a> slack pointed me to <a class="reference external" href="https://github.com/borkdude/deps.clj">deps.clj</a> project. This is an implementation of clj in clojure and
can be installed natively on Windows by downloading the .zip <a class="reference external" href="https://github.com/borkdude/deps.clj/releases">from the releases page</a>. This zip should contain a deps.exe file. Put
that executable it in your path. You can also rename it to clj.exe if you want. Also if you have the powershell installed you can run this command from cmd.exe
<tt class="docutils literal">PowerShell <span class="pre">-Command</span> &quot;iwr <span class="pre">-useb</span> <span class="pre">https://raw.githubusercontent.com/borkdude/deps.clj/master/install.ps1</span> | iex&quot;</tt> to install it&nbsp;automatically.</p>
<p>You can now run <tt class="docutils literal">deps</tt> and you should get a clojure repl similar to <tt class="docutils literal">lein repl</tt>.</p>
<p>To create a new project skeleton you can use the
use the <a class="reference external" href="https://github.com/seancorfield/deps-new">deps-new</a> project. To install it run the following command from cmd.exe:
<tt class="docutils literal">deps <span class="pre">-Ttools</span> install <span class="pre">io.github.seancorfield/deps-new</span> <span class="pre">&quot;{:git/tag</span> <span class="pre">&quot;&quot;&quot;v0.4.9&quot;&quot;&quot;}&quot;</span> :as new</tt> (please notice that there are various
<a class="reference external" href="https://clojure.org/reference/deps_and_cli#quoting">problems with the quoting on windows</a> but this command should work&nbsp;fine).</p>
<p>To create a new app run: <tt class="docutils literal">deps <span class="pre">-Tnew</span> app :name organization/depsapp</tt> and you&#8217;ll get your app in the <tt class="docutils literal">depsapp</tt> folder. If you want
a similar form as with lein, try <tt class="docutils literal">deps <span class="pre">-Tnew</span> app :name depsapp/core <span class="pre">:target-dir</span> depsapp</tt>. Now the <tt class="docutils literal">depsapp</tt> folder will&nbsp;contain:</p>
<ul class="simple">
<li><tt class="docutils literal">deps.edn</tt>: The basic descriptor of your project; here you can set various attrs of your project and also add dependencies. This more or less changes the project.clj we got from&nbsp;leiningen.</li>
<li>src\depsapp: The source directory of your project. This is where you&#8217;ll put your&nbsp;code.</li>
<li>test\depsapp: Add tests&nbsp;here</li>
</ul>
<p>To run the project, try: <tt class="docutils literal">deps <span class="pre">-M</span> <span class="pre">-m</span> depsapp.core</tt> or
<tt class="docutils literal">deps&nbsp; <span class="pre">-M:run-m</span></tt> or
<tt class="docutils literal">deps&nbsp; <span class="pre">-X:run-x</span></tt> to directly run the greet function (<tt class="docutils literal"><span class="pre">run-m</span></tt> and <tt class="docutils literal"><span class="pre">run-x</span></tt> are aliases defined in <tt class="docutils literal">deps.edn</tt> take a&nbsp;peek).</p>
<p>To start a <span class="caps">REPL</span>, run <tt class="docutils literal">deps</tt>. Notice this will start on the <tt class="docutils literal">user</tt> namespace, so you&#8217;ll need to do something&nbsp;like:</p>
<div class="highlight"><pre><span></span><span class="nv">user=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="ss">&#39;depsapp.core</span><span class="p">)</span>
<span class="nv">nil</span>
<span class="nv">user=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">depsapp.core/foo</span><span class="p">)</span>
<span class="s">&quot;bar&quot;</span>
</pre></div>
<p>to run a <tt class="docutils literal">(foo)</tt> function that you&#8217;ve added in the <tt class="docutils literal">core.clj</tt> file.</p>
<p>To run the tests use: <tt class="docutils literal">deps <span class="pre">-T:build</span> test</tt>.</p>
<p>To create the uberjar you&#8217;ll run:
<tt class="docutils literal">deps <span class="pre">-T:build</span> ci</tt> (tests must pass). Then execute it directly using
<tt class="docutils literal">java <span class="pre">-jar</span> <span class="pre">target\core-0.1.0-<span class="caps">SNAPSHOT</span>.jar</span></tt>.</p>
<p>Also, notice that it&#8217;s really simple to create a new project with deps without the deps-new. For example,
create a folder named <tt class="docutils literal">manualapp</tt> and in this folder
create a <tt class="docutils literal">deps.edn</tt> file containing just the string <tt class="docutils literal">{}</tt>. Then add another folder named <tt class="docutils literal">src</tt> with a  <tt class="docutils literal">hello.clj</tt> file
containing something&nbsp;like:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">ns </span><span class="nv">hello</span><span class="p">)</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">foo</span><span class="w"> </span><span class="p">[]</span>
<span class="w">  </span><span class="s">&quot;bar&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">run</span><span class="w"> </span><span class="p">[</span><span class="nv">opts</span><span class="p">]</span>
<span class="w">  </span><span class="p">(</span><span class="nb">println </span><span class="s">&quot;Hello world&quot;</span><span class="p">))</span>
</pre></div>
<p>You can then open a <span class="caps">REPL</span> on the project using <tt class="docutils literal">deps</tt> or run the run function using <tt class="docutils literal">deps <span class="pre">-X</span> hello/run</tt>.</p>
</div>
<div class="section" id="vscode-integration">
<h2>VSCode&nbsp;integration</h2>
<p>Both leining and clj projects can easily be used with VSCode. First of all, install the calva package in your VSCode. Then, open your
clojure project in VScode and press <tt class="docutils literal">ctrl+shift+p</tt> to bring up the command pallete. Here write &#8220;Jack&#8221; (from jack-in) and select it
(also this has the shortctut <tt class="docutils literal">ctrl+alt+c ctrl+alt+j</tt>). Select the correct project type (<tt class="docutils literal">leiningen</tt> or <tt class="docutils literal">deps.edn</tt>). A repl
will be opened to the side; you can then go to your core.clj file and run <tt class="docutils literal">ctrl+alt+c enter</tt> to load the current&nbsp;file.</p>
<p>Then you can move to the repl on the side and run the function with <tt class="docutils literal">(foo)</tt> or run <tt class="docutils literal"><span class="pre">(-main)</span></tt>. Also you can write <tt class="docutils literal">(foo)</tt>
in your source file and press <tt class="docutils literal">ctrl+enter</tt> to execute it and see the result; the <tt class="docutils literal">ctrl+enter</tt> will execute the form where your
cursor is. See <a class="reference external" href="https://calva.io/try-first/">this</a> for&nbsp;more.</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2022/02/14/django-pdfs-2022/">PDFs in Django like it’s 2022!</a>
      </h1>
    <p class="meta">
<time datetime="2022-02-14T12:20:00+02:00" pubdate>Mon 14 February 2022</time>    </p>
</header>

<div class="entry-content"><p>In a <a class="reference external" href="https://www.spapas.net/2015/11/27/pdf-in-django/">previous article</a> I had written a very comprehensive
guide on how to render PDFs in Django using tools like reportlab and xhtml2pdf. Although these tools
are still valid and work fine I have decided that usually it&#8217;s way too much pain to set them up to work&nbsp;properly.</p>
<p>Another common way to generate PDFs in the Python world is using the <a class="reference external" href="https://weasyprint.org/">weasyprint</a> library.
Unfortunately this library has way too many requirements and installing it on Windows
is worse than <a class="reference external" href="https://doc.courtbouillon.org/weasyprint/stable/first_steps.html#windows">putting needles in your eyes</a>. I don&#8217;t like needles in my eyes, thank you very&nbsp;much.</p>
<p>There are various other ways to generate PDFs like using a report server like Japser or
<span class="caps">SQL</span> Server Reporting Services but these are too &#8220;enterpris-y&#8221; for most people and require
another server, a learning curve,&nbsp;etc.</p>
<p>I was actually so disappointed by the status of <span class="caps">PDF</span> generation today that in some recent projects
instead of the <span class="caps">PDF</span> file I generated an <span class="caps">HTML</span> page with a nice pdf-printing stylesheet and
instructed the users to print it as <span class="caps">PDF</span> (from the browser) so as to generate the <span class="caps">PDF</span>&nbsp;themselves!</p>
<p>However, recently I found another way to generate PDFs in my Django projects which I&#8217;d like to share
with you: Using the <a class="reference external" href="https://wkhtmltopdf.org/">wkhtmltopdf</a> tool. The wkhtmltopdf is a command line program that has binaries
for more or less every operating system. It&#8217;s a single binary that you can download and put it in
a directory, you don&#8217;t need to run another server or any fancy installation. Only an executable. To
use it? You call it like <cite>wkhtmltopdf http://google.com google.pdf</cite> and it will download the url
and generate the pdf! It&#8217;s as simple as that! This tool is old and heavily used but only recently I
researched its integration with&nbsp;Django.</p>
<p>Please notice that there&#8217;s actually a <a class="reference external" href="https://github.com/incuna/django-wkhtmltopdf">django-wkhtmltopdf</a> library for integrating wkhtmltopdf with
django. However I din&#8217;t have good results while trying to use it (maybe because of my Windows dev
environment). Also, implementing the integration myself allowed my to more easily understand what&#8217;s
happening and better debug the wkhtmltopdf. However <span class="caps">YMMV</span>, after you read this small post to understand
how the integration works you can try django-wkhtmltopdf to see if it works in your&nbsp;case.</p>
<p>In any way, the first thing you need to do is download and install wkhtmltopdf for your platform and save its
full path in your settings.py like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="c1"># For linux</span>
<span class="n">WKHTMLTOPDF_CMD</span> <span class="o">=</span> <span class="s1">&#39;/usr/local/bin/wkhtmltopdf&#39;</span>

<span class="c1"># or for windows</span>
<span class="n">WKHTMLTOPDF_CMD</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;c:\util\wkhtmltopdf.exe&#39;</span>
</pre></div>
<p>Notice that I&#8217;m using the full path. I have observed that even if you put the binary to a directory
in the system <span class="caps">PATH</span> it won&#8217;t be picked (at least in my case) thus I recommend using the full&nbsp;path.</p>
<p>Now, let&#8217;s suppose we&#8217;ve got a <tt class="docutils literal">DetailView</tt> (let&#8217;s call it <tt class="docutils literal">SampleDetailView</tt>) that we&#8217;d like to render as <span class="caps">PDF</span>. We can use the following
<span class="caps">CBV</span> for&nbsp;that:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">subprocess</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_output</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.template</span><span class="w"> </span><span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">Template</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.template.loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_template</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tempfile</span><span class="w"> </span><span class="kn">import</span> <span class="n">NamedTemporaryFile</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SamplePdfDetailView</span><span class="p">(</span><span class="n">SampleDetailView</span><span class="p">):</span>
  <span class="k">def</span><span class="w"> </span><span class="nf">get_resp_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
      <span class="n">template</span> <span class="o">=</span> <span class="n">get_template</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
      <span class="n">resp</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">resp</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">get_resp_from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_str</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
      <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template_str</span><span class="p">)</span>
      <span class="n">resp</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>
      <span class="k">return</span> <span class="n">resp</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
      <span class="n">context</span><span class="p">[</span><span class="s1">&#39;pdf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="c1"># We can use either</span>
      <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resp_from_string</span><span class="p">(</span><span class="s2">&quot;&lt;h1&gt;Hello, world! {{ object }}&lt;/h1&gt;&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
      <span class="c1"># or</span>
      <span class="c1"># resp = self.get_resp_from_file(&#39;test_pdf.html&#39;, context)</span>

      <span class="n">tempfile</span> <span class="o">=</span> <span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+b&#39;</span><span class="p">,</span> <span class="n">buffering</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.html&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">,</span>
                                    <span class="nb">dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

      <span class="n">tempfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
      <span class="n">tempfile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
      <span class="n">tempfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
      <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
          <span class="n">settings</span><span class="o">.</span><span class="n">WKHTMLTOPDF_CMD</span><span class="p">,</span>
          <span class="s1">&#39;--page-size&#39;</span><span class="p">,</span> <span class="s1">&#39;A4&#39;</span><span class="p">,</span> <span class="s1">&#39;--encoding&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
          <span class="s1">&#39;--footer-center&#39;</span><span class="p">,</span> <span class="s1">&#39;[page] / [topage]&#39;</span><span class="p">,</span>
          <span class="s1">&#39;--enable-local-file-access&#39;</span><span class="p">,</span>  <span class="n">tempfile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">]</span>
      <span class="c1"># print(&quot; &quot;.join(cmd))</span>
      <span class="n">out</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

      <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
</pre></div>
<p>We can put the pdf view on our url patterns right next to our <tt class="docutils literal">DetailView</tt> i.e:</p>
<div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="o">...</span>
  <span class="n">path</span><span class="p">(</span>
      <span class="s2">&quot;detail/&lt;int:pk&gt;/&quot;</span><span class="p">,</span>
      <span class="n">permission_required</span><span class="p">(</span><span class="s2">&quot;core.user&quot;</span><span class="p">)(</span>
          <span class="n">views</span><span class="o">.</span><span class="n">SampleDetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()</span>
      <span class="p">),</span>
      <span class="n">name</span><span class="o">=</span><span class="s2">&quot;detail&quot;</span><span class="p">,</span>
  <span class="p">),</span>
  <span class="n">path</span><span class="p">(</span>
      <span class="s2">&quot;detail/&lt;int:pk&gt;/pdf/&quot;</span><span class="p">,</span>
      <span class="n">permission_required</span><span class="p">(</span><span class="s2">&quot;core.user&quot;</span><span class="p">)(</span>
          <span class="n">views</span><span class="o">.</span><span class="n">SamplePdfDetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()</span>
      <span class="p">),</span>
      <span class="n">name</span><span class="o">=</span><span class="s2">&quot;detail_pdf&quot;</span><span class="p">,</span>
  <span class="p">),</span>
  <span class="o">...</span>
<span class="p">]</span>
</pre></div>
<p>Let&#8217;s try to understand how this works: First of all notice that we have two options, either
create a <span class="caps">PDF</span> from an html string or from a normal template file. For the first option we pass
the full html string to the <tt class="docutils literal">get_resp_from_string</tt> and the context and we&#8217;ll get the rendered html
(i.e the context will be applied to the template).
For the second option we pass the filename of a django template and the context. Notice that
there&#8217;s a small difference on how the <tt class="docutils literal">template.render()</tt> method is called in the two&nbsp;methods.</p>
<p>After that we&#8217;ve got an html file saved in the <tt class="docutils literal">resp</tt> string. We want to give this to wkhtmltopdf so
as to be converted to <span class="caps">PDF</span>. To do that we first create a temporary file using the <tt class="docutils literal">NamedTemporaryFile</tt>
class and write the <tt class="docutils literal">resp</tt> to it. Then we call wkhtmltopdf passing it this temporary file. Notice we
use the <tt class="docutils literal">subprocess.check_output</tt> function that will capture the output of the command and return&nbsp;it.</p>
<p>Finally we delete the temporary file and return the pdf as an <tt class="docutils literal">HttpResponse</tt>.</p>
<p>We call the wkhtmltopdf like&nbsp;this:</p>
<pre class="code literal-block">
c:\util\wkhtmltopdf.exe --page-size A4 --encoding utf-8 --footer-center [page] / [topage] --enable-local-file-access C:\Users\serafeim\AppData\Local\Temp\tmp_lh5r6f9.html -
</pre>
<p>The page-size can be changed to letter if you are in the <span class="caps">US</span>. The encoding should be utf-8. The &#8212;footer-center option adds a
footer to the <span class="caps">PDF</span> page with the current page and the total number of pages. The &#8212;enable-local-file-access is very important
since it allows <tt class="docutils literal">wkhtmltopdf</tt> to access local files (in the filesystem) and not only remote ones. After that we&#8217;ve got the
full path of our temporary file and following is the <tt class="docutils literal">-</tt> which means that the pdf output will be on the stdout (so we&#8217;ll capture it
with <tt class="docutils literal">check_output</tt>).</p>
<p>Notice that there&#8217;s a commented out print command before the <tt class="docutils literal">check_output</tt> call. If you have problems you can call this
command from your command line to debug the wkhtmltopdf command (don&#8217;t forget to comment out the <tt class="docutils literal">os.remove</tt> line to keep
the temporary file). Also, wkhtmltopdf will output some stuff while rendering the command, for example something&nbsp;like:</p>
<pre class="code literal-block">
Loading pages (1/6)
Counting pages (2/6)
Resolving links (4/6)
Loading headers and footers (5/6)
Printing pages (6/6)
Done
</pre>
<p>You can pass the <tt class="docutils literal"><span class="pre">--quiet</span></tt> option to hide this output. However the output is useful to see what wkhtmltopdf is doing in
case there are problems so I recommend leaving it on while developing. Let&#8217;s take a look at a problematic&nbsp;output:</p>
<pre class="code literal-block">
Loading pages (1/6)
Error: Failed to load file:///static/bootstrap/css/bootstrap.min.css, with network status code 203 and http status code 0 - Error opening /static_edla/bootstrap/css/govgr_bootstrap.min.css: The system cannot find the path specified.
[...]
Counting pages (2/6)
Resolving links (4/6)
Loading headers and footers (5/6)
Printing pages (6/6)
Done
</pre>
<p>The above output means that our template tries to load a css file that wkhtmltopdf can&#8217;t find and errors out! To understand this error, I had a line like this in my&nbsp;template:</p>
<pre class="code literal-block">
&lt;link href=&quot;{% static 'bootstrap/css/bootstrap.min.css' %}&quot; rel=&quot;stylesheet&quot;&gt;
</pre>
<p>which will be converted to a link like <tt class="docutils literal">`/static/bootstrap/css/bootstrap.min.css</tt>.
However notice that I tell wkhtmltopdf to render a file from my temporary directory, it doesn&#8217;t
know where that link points to!
Following this thing you need to be extra careful to <em>include everything</em> in your <span class="caps">HTML</span>-pdf template and not
use any external links. So all styles must be inlined in the template using <tt class="docutils literal">&lt;style&gt;</tt> tags and all images must be
converted to data images with base64, something&nbsp;like:</p>
<pre class="code literal-block">
&lt;img src='data:image/png;base64,...&gt;
</pre>
<p>To do that in python for a dynamic image you can use something&nbsp;like:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

<span class="k">def</span><span class="w"> </span><span class="nf">convert_to_data</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
  <span class="k">return</span> <span class="s1">&#39;data:image/xyz;base64,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</pre></div>
<p>and then use that as your image src (notice I&#8217;m using <tt class="docutils literal">image/xyz</tt> here for an
arbitrary image, please use the correct image type if you know it i.e <tt class="docutils literal">image/png</tt> or <tt class="docutils literal">image/jpg</tt>).</p>
<p>If you&#8217;ve got a static image you want to include you can convert it to base64 using an online service <a class="reference external" href="https://www.base64-image.de/">like this</a>,
or read it with python and convert&nbsp;it:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;static/images/image.png&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">image</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</pre></div>
<p>Instead of a <tt class="docutils literal">DetailView</tt> we could use the same approach for any kind of <span class="caps">CBV</span>. If you are to use the <span class="caps">PDF</span>
response to multiple CBVs I recommend exporting the functionality to a mixin and inheriting from that also
(see my <a class="reference external" href="https://www.spapas.net/2018/03/19/comprehensive-django-cbv-guide/"><span class="caps">CBV</span> guide</a> for&nbsp;more).</p>
<p>Finally, the big question in the room is why should I convert my template to a file and pass that to
wkhtmltopdf, can&#8217;t I use the <span class="caps">URL</span> of my template, i.e pass wkhtmltopdf something like <a class="reference external" href="http://example.com/app/detail/321/">http://example.com/app/detail/321/</a>?</p>
<p>By all means you can! This will also enable you to avoid using inline styles and media!!
However keep in mind that the usual case is that this view will not be public but will need an authenticated user to
access it; wkhtmltopdf is publicly trying to access it, it doesn&#8217;t have any rights to it so you&#8217;ll get a 404 or 403 error!
Of course you can
start an adventure on authenticating it somehow (and maybe doing something stupid) or you can just follow my lead
and render it to a file&nbsp;:)</p>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2021/09/21/layman-proxy-primer/">A forward and reverse proxy primer for the layman</a>
      </h1>
    <p class="meta">
<time datetime="2021-09-21T14:20:00+03:00" pubdate>Tue 21 September 2021</time>    </p>
</header>

<div class="entry-content"><p>Before some days I&#8217;d <a class="reference external" href="https://news.ycombinator.com/item?id=28381220">written an answer on <span class="caps">HN</span></a> where I explained as simply as possible
how a forward and a reverse proxy is working and what is the difference between them. In this article
I&#8217;m going to extend this answer a bit to make it a full post and clarify some things even&nbsp;more.</p>
<p>Forward and reverse proxies is an important concept that a lot of technical people aren&#8217;t familiar with.
<span class="caps">HTTP</span> Proxying is a process of forwarding (<span class="caps">HTTP</span>) requests from one server to the other. So when an <span class="caps">HTTP</span>
client issues a request to the server, the request will pass through the proxy server and be forwarded to the
destination server (called the origin server). This explanation is true both for forward and reverse&nbsp;proxying.</p>
<div class="section" id="forward-proxy">
<h2>Forward&nbsp;Proxy</h2>
<p>A forward proxy is used when an <span class="caps">HTTP</span> Client (i.e a browser) wants to access resources in the internet
but isn&#8217;t allowed to connect directly to the public internet so instead uses the&nbsp;proxy.</p>
<p>Usually companies don&#8217;t allow unrestricted access to the internet from their internal network.
Thus the internal users would need to use a proxy to access the internet. This is the concept of the forward proxy.
What happens is that when an internal user want to access an internet resource (i.e www.google.com) her client (i.e browser)
will ask a specific server (the proxy server) for that resource. The client needs to be configured properly with the address
of the proxy&nbsp;server.</p>
<p>So instead of <a class="reference external" href="http://www.google.com">http://www.google.com</a> the browser will access <a class="reference external" href="http://proxy.company.com/?url=www.google.com">http://proxy.company.com/?url=www.google.com</a> and the
proxy will fetch the results and return them to you. If the browser wants to access <a class="reference external" href="https://www.google.com">https://www.google.com</a> <em>without</em>
a configured proxy server it will get a network&nbsp;error.</p>
<p>Here&#8217;s an image that explains&nbsp;this:</p>
<img alt="Forward proxy" src="/images/fw_proxy.png" style="width: 800px;" />
<p>The internal client can access the internal web server directly without problems. However he cannot access
the internet server directly so he needs to use the proxy to access&nbsp;it.</p>
<p>One thing that needs to be made crystal is that the fact that your browser works with the proxy does not mean
that any other <span class="caps">HTTP</span> clients you use will also work. For example, you may want to run <tt class="docutils literal">curl</tt> or <tt class="docutils literal">wget</tt> to download
some files from an external server; these programs will not work without setting a proxy (usually by setting the http_proxy
and https_proxy environment variables or by passing a parameter). Also, the proxy only works for <span class="caps">HTTP</span> requests. If you are
in a private network without external access you will <em>not</em> be able to access non-<span class="caps">HTTP</span> resources. For example you will not be able
to access your non-company mail server (which uses either <span class="caps">IMAP</span> or <span class="caps">POP3</span>) from behind your company&#8217;s network. Typically, you&#8217;ll use
a web client for accessing your&nbsp;mails.</p>
<p>So it seems that using a proxy heavily restricts the internal users usage of internet. What are the advantages of using a forward&nbsp;proxy?</p>
<ul class="simple">
<li>Security: Since the internal computers of a company will not have internet access there&#8217;s no easy way for attackers to access these&nbsp;computers.</li>
<li>Content moderation: The company through the proxy can block access to various internet sites (i.e social network, gaming etc) that the users shouldn&#8217;t access during&nbsp;work.</li>
<li>Caching: The proxy server can have a cache so when multiple users access the same internet resource it will downloaded only once saving the company&#8217;s&nbsp;bandwidth.</li>
</ul>
<p>Especially the security thing is so important that almost all corporate (or university etc) networks will use a proxy server and never
allow direct access to the&nbsp;internet.</p>
<p>A well known, open source forward proxy server is <a class="reference external" href="http://www.squid-cache.org/">Squid</a>.</p>
</div>
<div class="section" id="reverse-proxy">
<h2>Reverse&nbsp;proxy</h2>
<p>A reverse proxy is an <span class="caps">HTTP</span> server that &#8220;proxies&#8221; (i.e forwards) some (or all) requests it receives to a different <span class="caps">HTTP</span>
server and returns the answer back. For example, a company may have a couple of <span class="caps">HTTP</span> servers in its internal network. These
servers have private addresses and cannot be accessed through the internet. To allow external users to access these servers,
the company will configure a reverse proxy server that will forward the requests to the internal servers as seen in the&nbsp;picture:</p>
<img alt="Reverse proxy" src="/images/reverseproxy.png" style="width: 800px;" />
<p>What happens is that the proxy server will forward requests that fulfill some specific
criteria to other web servers. The criteria may be requests that have
* a specific host (forward the requests that have a hostname of <tt class="docutils literal">www.server1.company.com</tt> to the internal server named <tt class="docutils literal">server1</tt> and <tt class="docutils literal">www.server2.company.com</tt> to the internal server named <tt class="docutils literal">server2</tt>)
* or a specific port (forward requests in the port 81 to <tt class="docutils literal">server1</tt> and requests in the port 82 to <tt class="docutils literal">server2</tt>)
* or even a particular path (forward requests with the path <tt class="docutils literal">www.company.com/server1</tt> to <tt class="docutils literal">server1</tt> and requests with the path <tt class="docutils literal">www.company.com/server2</tt> to <tt class="docutils literal">server2</tt>)</p>
<p>or even other criteria that may be&nbsp;decided.</p>
<p>Let&#8217;s see some example of reverse&nbsp;proxying:</p>
<ul class="simple">
<li>A characteristic example of reverse proxy is the well-known 3-tier architecture  (web server / app server / database server). The web server is used to serve all requests but it &#8220;proxies&#8221;  (forwards) some of the requests to the app server. This is used because the web server cannot serve dynamic  replies but can serve static replies like for example&nbsp;files.</li>
<li>Offloading the <span class="caps">SSL</span> (https) security to a particular web server. This server will store the private key of your certificate and terminate the <span class="caps">SSL</span> connections. It will then forward the requests to the internal web servers using plain <span class="caps">HTTP</span>.</li>
<li>An <span class="caps">HTTP</span> load balancer will proxy the requests to a set of other servers based on some algorithm to share the load (i.e the HAProxy software load balancer or even a hardware load&nbsp;balancer)</li>
<li>A reverse proxy can be used to act as a security and <span class="caps">DOS</span> &#8220;shield&#8221; for your web servers. It will check the requests for common attack patterns and forward them to your servers only if they are&nbsp;safe</li>
<li>A reverse proxy can be used for caching; it will return cached versions of resources if they are available to avoid overloading the application&nbsp;servers</li>
<li>A <span class="caps">CDN</span> (content delivery network) is more or less a set of glorified reverse proxy servers that act as a first step for serving the user&#8217;s requests (based on the geographic location) also offering security protection and caching (this is what akamai or cloudflare&nbsp;do)</li>
</ul>
<p>As can be seen from the previous examples there are a lot of apps that do reverse proxying, for example apache <span class="caps">HTTP</span>, nginx, HAProxy, varnish cache et&nbsp;al.</p>
<p>Notice that while there&#8217;s only one forward proxy, there could be a (large) chain of reverse proxies when accessing a remote server.
Let&#8217;s take a look at a rather complex scenario: A user in a corporate network will access an application in another network. In this case the user&#8217;s request
may pass&nbsp;through:</p>
<p>forward proxy (squid) -&gt;
security server / <span class="caps">CDN</span> (akamai) -&gt;
ssl termination (nginx) -&gt;
caching (varnish) -&gt;
web server (nginx again) -&gt;
app server (tomcat or gunicorn or <span class="caps">IIS</span> etc)
as can be seen on the following&nbsp;image:</p>
<img alt="Reverse proxy" src="/images/reverseproxy2.png" style="width: 800px;" />
<p>Notice that is this case (which is not uncommon) there are six (05) servers between your client and the application&nbsp;server!</p>
<p>One common problem with this is that unless <em>all</em> the intermediate servers are configured properly
(by properly modifying and passing the <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For">X-Forwarded-For</a> header)
you won&#8217;t be able to retrieve the <span class="caps">IP</span> of the user that did the initial&nbsp;request.</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2021/08/25/django-token-rest-auth/">Token Authentication for django-rest-framework</a>
      </h1>
    <p class="meta">
<time datetime="2021-08-25T12:40:00+03:00" pubdate>Wed 25 August 2021</time>    </p>
</header>

<div class="entry-content"><div class="section" id="introduction">
<h2>Introduction</h2>
<p>In a <a class="reference external" href="https://www.spapas.net/2018/03/01/django-rest-auth/">a previous article</a>
I explained how to authenticate for your django-rest-framework <span class="caps">API</span>
using the django-rest-auth package.
Since then I have observed that various things have changed and most importantly that
the library I used there (django-rest-auth) is not updated anymore and has been
superseded by another one. Also, some of my information there is contradictory,
especially the parts that deal with the session authentication and csrf&nbsp;protection.</p>
<p>Thus I&#8217;ve written this new article that betters describes a recommended
authentication workflow using tokens. This workflow does not rely on sessions at all.
Beyond that, is more or less the same as the previous one with some updates
and clarifications where&nbsp;needed.</p>
<p>I have also updated the accompanying project of the previous article which
can be found on <a class="reference external" href="https://github.com/spapas/rest_authenticate">https://github.com/spapas/rest_authenticate</a>.</p>
<p>Before continuing with the tutorial, let&#8217;s take a look at what we&#8217;ll build&nbsp;here:</p>
<img alt="Our project" src="/images/rest-auth.gif" style="width: 640px;" />
<p>This is a single html page (styled with <a class="reference external" href="https://picturepan2.github.io/spectre/">spectre.css</a>) that checks if the user is logged in
and either displays the login or logout button (using javascript). When you click the login you&#8217;ll get a modal in which you
can enter your credentials which will be submitted through <span class="caps">REST</span> to the authentication endpoint and
depending on the response will set a javascript variable (and a corresponding session/local storage key).
Then you can use the &#8220;Test auth&#8221; button that works only on authenticated users and returns their username.
Finally, notice that after you log out the &#8220;test auth&#8221; button returns a 403 access&nbsp;denied.</p>
<p>The javascript client uses token authentication so you can run the client in the same server as the server or
in a completely different server (if you are using the proper <span class="caps">CORS</span> headers of&nbsp;course).</p>
</div>
<div class="section" id="some-theory">
<h2>Some&nbsp;theory</h2>
<p>Here I will try to explain a bunch of important&nbsp;concepts:</p>
<div class="section" id="sessions">
<h3>Sessions</h3>
<p>After you log in with Django normally, your authentication information is saved to the <a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/http/sessions/">session</a>.
The session is a bucket of information
that the Django application saves about your visit &#8212; to distinguish between different visitors a cookie with a unique
value named <tt class="docutils literal">sessionid</tt> will be used. So, your web browser will send this cookie with each page request thus allowing Django
to know which bucket of information is yours (and if you&#8217;ve authenticated know who are you). This is not a Django
related concept but a general one (supported by most if not all <span class="caps">HTTP</span> frameworks) and is used to add state to an otherwise
stateless medium (<span class="caps">HTTP</span>).</p>
<p>Since the <tt class="docutils literal">sessionid</tt> cookie is sent not only with traditional but also with Ajax request it can be used to authenticate
<span class="caps">REST</span> requests after you&#8217;ve logged in. This is what is used by default in django-rest-framework is a very good solution for
most use cases: You login to django and you can go ahead and call the <span class="caps">REST</span>
<span class="caps">API</span> through Ajax; the <tt class="docutils literal">sessionid</tt> cookie will be sent along with the request and you&#8217;ll be authenticated&nbsp;automatically.</p>
<p>Now, although the session authentication is nice for using in browsers, you may need to access your <span class="caps">API</span> through a desktop
or a mobile application where, setting the cookies yourself is not the optimal solution. Also, you may have an <span class="caps">SPA</span> that needs
to access an <span class="caps">API</span> in a different domain; using <a class="reference external" href="https://stackoverflow.com/questions/3342140/cross-domain-cookies">using cookies for this is not easy</a> - if possible at&nbsp;all.</p>
</div>
<div class="section" id="csrf-protection">
<h3><span class="caps">CSRF</span>&nbsp;protection</h3>
<p>One important thing that you should be aware if you are going to use session authentication for your <span class="caps">API</span> is the
<a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/csrf/"><span class="caps">CSRF</span> protection</a>. This is a mechanism that helps prevent cross-site request forgery (<span class="caps">CSRF</span>) attacks.
A <span class="caps">CSRF</span> attack works like this: Let&#8217;s suppose that site A is a bank, and has a form with an email and a money amount.
When the user submits the form via <span class="caps">POST</span> it will send this much money to the entered email using Paypal. Now, site B is
a malicious site. When the user visits site B, it will automatically generate a <span class="caps">POST</span> request containing the malicious
user&#8217;s email and the money he wants and submit it to site A. Now, if the user is authenticated with sessions on site A
then site A will think that this is a valid form submission and will actually process the form as normally and send the
money to the malicious&nbsp;user!</p>
<p>As you can understand this is a very serious and easy to exploit attack. To prevent this attack, the <span class="caps">CSRF</span> protection is
used: In order to submit the form on site A, the request must contain a unique string (the <span class="caps">CSRF</span> token) that is generated
automatically by site A. Thankfully, site B cannot access this token and thus cannot submit the&nbsp;form.</p>
<p>The <span class="caps">CSRF</span> situation is only related to sessions. If you are not using sessions then <span class="caps">CSRF</span> protection is not needed because
there&#8217;s no way for site B to submit the form on site A (for example, with TokenAuthentication, site B cannot access the
token that site A&nbsp;has).</p>
<p>However if you <em>are</em> using sessions then you must be extra careful
to protect your <span class="caps">POST</span> views against <span class="caps">CSRF</span> attacks. Django does this by default so you don&#8217;t need to do anything
fancy. However, when you actually want to submit a form using an <span class="caps">API</span> with sessions you must be careful to also
include the <span class="caps">CSRF</span> token as explained in the Django docs about the topic (<a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/csrf/"><span class="caps">CSRF</span> protection</a>).</p>
</div>
<div class="section" id="tokens">
<h3>Tokens</h3>
<p>For cases where you can&#8217;t use the session to authenticate, django-rest-framework
offers a different authentication method called <tt class="docutils literal">TokenAuthentication_</tt>. Using this method, each user of the Django application
is correlated with a random string (Token) which is passed along with each request at its header thus the Django app can authenticate
the user using this token. The token is retrieved when the user logs using his credentials and is saved in the&nbsp;browser.</p>
<p>One thing that may seem strange is that since both the session cookie and a token are
set through <span class="caps">HTTP</span> Headers why all the fuss about tokens? Why not just use the session cookie and be done with it?
Well, there are
various reasons - here&#8217;s a <a class="reference external" href="https://auth0.com/blog/angularjs-authentication-with-cookies-vs-token/">rather extensive article</a> explaining some of them. Some of the reasons are that a token can be valid forever
while the session is something ephemeral - beyond authorization information, sessions may keep various other data for a web
application and are expired after some time to save space. Also, since tokens are used for exactly this (authentication) they
are much easier to use and reason about. Finally, as I&#8217;ve already explained, sharing cookies by multiple sites is not something
you&#8217;d like to do. Actually, to make things easier for you just follow this rule:
<strong>If your <span class="caps">API</span> will be run on a different domain  than your client (i.e api.example.com and www.example.com)
or your client not run on the web (i.e. is a desktop/mobile app) then you must not use session authentication</strong>. Use token
authentication as proposed here or whatever else you may want that doesn&#8217;t rely on&nbsp;sessions.</p>
</div>
<div class="section" id="cors">
<h3><span class="caps">CORS</span></h3>
<p>Another thing that must concern the people that will want to use an <span class="caps">API</span> is the <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS"><span class="caps">CORS</span></a> situation.
By default cross-origin requests are not allowed, i.e site B cannot issue Ajax requests to site A.
Each server can be configured to allow cross-origin requests from other servers. This means that
if you have a server api.example.com that is used as a backend and a server www.example.com that will
serve your front-end, you can configure api.example.com to allow requests only from&nbsp;www.example.com.</p>
<p>By default Django does not allow any cross origin requests and you need to use the <a class="reference external" href="https://github.com/adamchainz/django-cors-headers">django-cors-headers</a>
package to properly configure&nbsp;it.</p>
<p>Notice that <span class="caps">CORS</span> protection is enforced by the Browser. For example if you have build a mobile app
and are consuming an <span class="caps">API</span> in api.example.com then <span class="caps">CORS</span> protection does not apply to your http&nbsp;client.</p>
</div>
</div>
<div class="section" id="installation-configuration">
<h2>Installation <span class="amp">&amp;</span>&nbsp;configuration</h2>
<p>The project will use <a class="reference external" href="http://www.django-rest-framework.org">django-rest-framework</a>, <a class="reference external" href="https://github.com/iMerica/dj-rest-auth">dj-rest-auth</a> and <a class="reference external" href="https://github.com/adamchainz/django-cors-headers">django-cors-headers</a>.</p>
<p>To install django-rest-framework and dj-rest-auth just follow <a class="reference external" href="https://dj-rest-auth.readthedocs.io/en/latest/installation.html">the instructions here</a> i.e just add
<tt class="docutils literal">'rest_framework', 'rest_framework.authtoken'</tt> and <tt class="docutils literal">'dj_rest_auth'</tt> to your <cite>INSTALLED_APPS</cite> in
<tt class="docutils literal">settings.py</tt> and run&nbsp;migrate.</p>
<p>To install django-cors-headers follow the <a class="reference external" href="https://github.com/adamchainz/django-cors-headers#setup">the setup instructions</a>: Add <tt class="docutils literal">&quot;corsheaders&quot;</tt> to your <tt class="docutils literal">INSTALLED_APPS</tt> and
<tt class="docutils literal">&quot;django.middleware.common.CommonMiddleware&quot;</tt> to your <tt class="docutils literal"><span class="caps">MIDDLEWARE</span></tt> in <tt class="docutils literal">settings.py</tt>. Then you can use the
<tt class="docutils literal">CORS_ALLOWED_ORIGINS</tt> setting to configure which origins are allowed to make requests to your project. Let&#8217;s
suppose that you are running your project at 127.0.0.1:8000 and you want to allow requests from a client
running at 127.0.0.1:8001. You can do this by adding the following to your settings.py:
<tt class="docutils literal">CORS_ALLOWED_ORIGINS = <span class="pre">['http://127.0.0.1:8001',</span> <span class="pre">'http://localhost:8001']</span></tt>. Actually, try running the project
with and without that setting and see how the javascript client&nbsp;behaves.</p>
<p>Since I won&#8217;t be adding any other apps to this project (no models are actually needed), I&#8217;ve added
two directories <tt class="docutils literal">static</tt> and <tt class="docutils literal">templates</tt> to put static files and templates there. This is configured
by adding the <tt class="docutils literal">'<span class="caps">DIRS</span>'</tt> attribte to <tt class="docutils literal"><span class="caps">TEMPLATES</span></tt>, like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="o">//</span> <span class="o">...</span>
</pre></div>
<p>and adding the <cite>STATICFILES_DIRS</cite> setting:</p>
<div class="highlight"><pre><span></span><span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s2">&quot;static&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
<p>The remaining setting are the default as were created by <tt class="docutils literal"><span class="pre">django-admin</span> startproject</tt>.</p>
</div>
<div class="section" id="urls">
<h2>Urls</h2>
<p>I have included the the following urls to <tt class="docutils literal">urls.py</tt>:</p>
<div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;test_auth/&#39;</span><span class="p">,</span> <span class="n">TestAuthView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;test_auth&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;rest-auth/logout/&#39;</span><span class="p">,</span> <span class="n">LogoutViewEx</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;rest_logout&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;rest-auth/login/&#39;</span><span class="p">,</span> <span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;rest_login&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">HomeTemplateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="p">),</span>
<span class="p">]</span> <span class="o">+</span> <span class="n">static</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">STATIC_URL</span><span class="p">,</span> <span class="n">document_root</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">STATIC_ROOT</span><span class="p">)</span>
</pre></div>
<p>These are: The django-admin, a <tt class="docutils literal">test_auth</tt> view (that works only for authenticated users and returns their username),
a view (<tt class="docutils literal">LogoutViewEx</tt>) that overrides the rest-auth <span class="caps">REST</span> logout-view (I&#8217;ll explain why this is needed in a minute),
the rest-auth <span class="caps">REST</span> login-view, the home template view (which is the only view implemented) and finally a mapping
of your static files to the <tt class="docutils literal">STATIC_URL</tt>.</p>
<p>The <tt class="docutils literal">LoginView</tt> is the default provided by the dj-rest-auth project. One thing to consider is that
this view will check if the credentials you pass are valid and return a valid token for your user. However,
it will also optionally login the user using sessions (i.e create a new session and return a sessionid cookie). This
is configured by the <tt class="docutils literal">REST_SESSION_LOGIN</tt> option which by default is <tt class="docutils literal">True</tt>.</p>
<p>To test this functionality, try logging in using this login view with a superuser and then visit the django-admin. You
will see that you are already logged in. Now, logout and add (or change) <tt class="docutils literal">REST_SESSION_LOGIN=False</tt> to your settings.py.
Login again from the rest view and now if you visit the django-admin you should see that you need to login&nbsp;again.</p>
<p>Another way to test this is by checking out the response headers of the <tt class="docutils literal"><span class="caps">POST</span></tt> to <tt class="docutils literal"><span class="pre">rest-auth/login/</span></tt> from your
browser&#8217;s development tools. When you are using <tt class="docutils literal">REST_SESSION_LOGIN=True</tt> (or you haven&#8217;t defined it since by
default it is true) you&#8217;ll see the following <tt class="docutils literal"><span class="pre">Set-Cookie</span></tt> line:</p>
<pre class="code literal-block">
sessionid=pw8rp7l7yy33lk7geuxbczaleh35w9je; expires=Wed, 08 Sep 2021 08:29:40 GMT; HttpOnly; Max-Age=1209600; Path=/; SameSite=Lax
</pre>
<p>This cookie won&#8217;t be set if you login again with <tt class="docutils literal">REST_SESSION_LOGIN=False</tt>.</p>
</div>
<div class="section" id="the-views">
<h2>The&nbsp;views</h2>
<p>I&#8217;ve defined three views in this application - the <tt class="docutils literal">HomeTemplateView</tt>, the <tt class="docutils literal">TestAuthView</tt>
and the <tt class="docutils literal">LogoutViewEx</tt> view that overrides the normal <tt class="docutils literal">LogoutView</tt> of <tt class="docutils literal"><span class="pre">django-rest-auth</span></tt>.</p>
<div class="section" id="hometemplateview">
<h3>HomeTemplateView</h3>
<p>The <tt class="docutils literal">HomeTemplateView</tt> is
a simple <tt class="docutils literal">TemplateView</tt> that just
displays an html page and loads the client side code - we&#8217;ll talk about it later in the front-side section.
This is more or less similar (without the django-stuff) with the standalone client  page that can be found on
<tt class="docutils literal">client/index.html</tt>.</p>
</div>
<div class="section" id="testauthview">
<h3>TestAuthView</h3>
<p>The <tt class="docutils literal">TestAuthView</tt> is implemented like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TestAuthView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">authentication</span><span class="o">.</span><span class="n">TokenAuthentication</span><span class="p">,)</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&quot;Hello </span><span class="si">{0}</span><span class="s2">!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&quot;Hello </span><span class="si">{0}</span><span class="s2">! Posted!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">))</span>
</pre></div>
<p>This is very simple however I&#8217;d like to make a few comments about the above. First of all you see that
I&#8217;ve defined both a <tt class="docutils literal">get</tt> and a <tt class="docutils literal">post</tt> method. When you use the token authentication you&#8217;ll see that the
<tt class="docutils literal">post</tt> method will work without the need to provide a csrf token as already discussed&nbsp;before.</p>
</div>
<div class="section" id="authentication-and-permission">
<h3>Authentication and&nbsp;permission</h3>
<p>Notice that both <tt class="docutils literal">authentication_classes</tt> and <tt class="docutils literal">permission_classes</tt> are included in the <tt class="docutils literal">TestAuthView</tt>. These options&nbsp;define:</p>
<ul class="simple">
<li>which method will be used for authenticating access to the <span class="caps">REST</span> view i.e finding out if the user
requesting access has logged in and if yes what&#8217;s his username (in our case only <tt class="docutils literal">TokenAuthentication</tt> will be&nbsp;used)</li>
<li>if the user is authorized (has permission) to call this <span class="caps">REST</span> view (in our case only authenticated users will be&nbsp;allowed)</li>
</ul>
<p>The authentication and permission classes can be set globally
in your <tt class="docutils literal">settings.py</tt> using <tt class="docutils literal"><span class="pre">REST_FRAMEWORK['DEFAULT_AUTHENTICATION_CLASSES']</span></tt> and
<tt class="docutils literal"><span class="pre">REST_FRAMEWORK['DEFAULT_PERMISSION_CLASSES']</span></tt>
or defined per-class like this. If I wanted to have the same authentication and permission classes defined
in my <tt class="docutils literal">settings.py</tt> so I wouldn&#8217;t need to set these options per-class I&#8217;d add the following to my <tt class="docutils literal">settings.py</tt>:</p>
<div class="highlight"><pre><span></span><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class="p">:</span> <span class="p">(</span>
        <span class="s1">&#39;rest_framework.authentication.TokenAuthentication&#39;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class="p">:</span> <span class="p">(</span>
        <span class="s1">&#39;rest_framework.permissions.IsAuthenticated&#39;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">}</span>
</pre></div>
<p>Please keep in mind that you haven&#8217;t defined these in your views or your settings, they will have the
following <a class="reference external" href="http://www.django-rest-framework.org/api-guide/settings/#default_authentication_classes">default</a> <a class="reference external" href="http://www.django-rest-framework.org/api-guide/settings/#default_permission_classes">values</a>:</p>
<div class="highlight"><pre><span></span><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class="p">:</span> <span class="p">(</span>
        <span class="s1">&#39;rest_framework.authentication.SessionAuthentication&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rest_framework.authentication.BasicAuthentication&#39;</span>
    <span class="p">),</span>
    <span class="s1">&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class="p">:</span> <span class="p">(</span>
        <span class="s1">&#39;rest_framework.permissions.AllowAny&#39;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">}</span>
</pre></div>
<p>The above mean that if you don&#8217;t define authentication and permission classes anywhere then the <span class="caps">REST</span>
views will use either session authentication (i.e the user has logged in normally using
the Django login views as explained before) or <span class="caps">HTTP</span> basic authentication
(the request provides the credentials in the header using traditional <span class="caps">HTTP</span> Basic authentication)
and also that all users (logged in or not) will be allowed to call all APIs (this is
probably not something you&nbsp;want).</p>
</div>
<div class="section" id="tokens-1">
<h3>Tokens</h3>
<p>The <tt class="docutils literal">TokenAuthentication</tt> that we are using for the <tt class="docutils literal">TestAuthView</tt>
means that for every request a valid token must be passed (there&#8217;s no concept of state
in <span class="caps">HTTP</span> so you need to pass it whenever you communicate with the&nbsp;server).</p>
<p>The tokens are normal object instances of <tt class="docutils literal">rest_framework.authtoken.models.Token</tt>
and you can take a look at them (or even add one) through the Django admin (auth token - tokens). You can also
even do whatever you normally would do to an object instance, for&nbsp;example:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Token</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>
<span class="p">[(</span><span class="o">&lt;</span><span class="n">User</span><span class="p">:</span> <span class="n">root</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">&#39;db4dcc1b9d00d1af74fb3cb41e1f9e673208485b&#39;</span><span class="p">)]</span>
</pre></div>
<p>To authenticate with a token (using <a class="reference external" href="http://www.django-rest-framework.org/api-guide/authentication/#tokenauthentication">TokenAuthentication</a>), you must add an extra header to your request with the format
<tt class="docutils literal">Authorization: Token token</tt> for example in the previous case <tt class="docutils literal">root</tt> would add
<tt class="docutils literal">Authorization: Token db4dcc1b9d00d1af74fb3cb41e1f9e673208485b</tt>. To do this you&#8217;ll need something
client-side code which we&#8217;ll see in the next&nbsp;section.</p>
<p>To debug your authentication with <a class="reference external" href="https://curl.haxx.se">curl</a> you can just do something like&nbsp;this:</p>
<div class="highlight"><pre><span></span>curl<span class="w"> </span>http://127.0.0.1:8000/test_auth/<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization:Token db4dcc1b9d00d1af74fb3cb41e1f9e673208485b&quot;</span>
</pre></div>
<p>Try it with a valid and invalid token and without providing a token at all and see the response each&nbsp;time.</p>
</div>
<div class="section" id="dj-rest-auth">
<h3>dj-rest-auth</h3>
<p>So, django-rest-framework provides the model (Token) and the mechanism (add the extra Authentication header) for
authentication with Tokens. What it does not provide is a simple way to create/remove tokens for users: This
is where the dj-rest-auth project comes to the rescue! Its login and logout <span class="caps">REST</span> views will automatically
create (and delete) tokens for the users that are logging&nbsp;in.</p>
<p>As already described above, the login view will also authenticate the user
using the session when the REST_SESSION_LOGIN is set to True (default) - this means that if a user
logs in using the login <span class="caps">REST</span> endpoint he&#8217;ll then
be logged in normally to the site and be able to access non-<span class="caps">REST</span> parts of the site (for example the&nbsp;django-admin).</p>
<p>Also, if the user logs in through the dj-rest-auth <span class="caps">REST</span> end point and if you have are using <tt class="docutils literal">SessionAuthentication</tt>
to one of your views then he&#8217;ll be able to authenticate to these views <em>without</em> the need to pass the token (make sure
you understand&nbsp;why).</p>
</div>
<div class="section" id="logoutviewex">
<h3>LogoutViewEx</h3>
<p>Finally, let&#8217;s take a look at the <tt class="docutils literal">LogoutViewEx</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">LogoutViewEx</span><span class="p">(</span><span class="n">LogoutView</span><span class="p">):</span>
    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">authentication</span><span class="o">.</span><span class="n">TokenAuthentication</span><span class="p">,)</span>
</pre></div>
<p>This class only defines the authentication_classes attribute. Is this really needed? Well, it depends on
you project. If you take a look at the source code of
<tt class="docutils literal">LogoutView</tt> (<a class="reference external" href="https://github.com/iMerica/dj-rest-auth/blob/master/dj_rest_auth/views.py#L131">https://github.com/iMerica/dj-rest-auth/blob/master/dj_rest_auth/views.py#L131</a>)
you&#8217;ll see that it does not define <tt class="docutils literal">authentication_classes</tt>. This, as we&#8217;ve already discussed, means that it will
fall-back to whatever you have defined in the settings (or the defaults of&nbsp;django-rest-framework).</p>
<p>So, if you haven&#8217;t
defined anything in the settings then you&#8217;ll get the by default the
<tt class="docutils literal">SessionAuthentication</tt> and <tt class="docutils literal">BasicAuthentication</tt> methods (hint: <em>not</em> the <tt class="docutils literal">TokenAuthentication</tt>).
This means that you won&#8217;t be able to
logout when you pass the token (but <em>will</em> be able to logout from the web-app after you login - why?). So to make everything
crystal and be able to reason better about the behavior I specifically define the <tt class="docutils literal">LogoutViewEx</tt> to use
the <tt class="docutils literal">TokenAuthentication</tt> to properly log out your user. This of course means that you need to pass
the token to your logout view also or else there won&#8217;t be any way to associate the request with a user to log&nbsp;out.</p>
</div>
</div>
<div class="section" id="the-client-side-scripts">
<h2>The client side&nbsp;scripts</h2>
<p>I&#8217;ve included all client-side code to a <tt class="docutils literal">home.html</tt> template that is loaded
from the <tt class="docutils literal">HomeTemplateView</tt>. Also, the same code has been included in <tt class="docutils literal">client/index.html</tt>. This is
a completely standalone javascript client that you can run in a different http server than your Django server,
for example by running <tt class="docutils literal">py <span class="pre">-3</span> <span class="pre">-m</span>&nbsp; http.server 8001</tt> from the client folder and visiting <a class="reference external" href="http://127.0.0.1:8001">http://127.0.0.1:8001</a>.</p>
<p>The client-side code has been implemented only with jQuery because I think
this is the library that most people are familiar with - and is really easy to be understood even if you
are not familiar with it. It more or less consists of five sections in&nbsp;html:</p>
<ul class="simple">
<li>A user-is-logged-in section that displays the username and the logout&nbsp;button</li>
<li>A user-is-not-logged-in section that displays a message and the login&nbsp;button</li>
<li>A test-auth section that displays a button for calling the <tt class="docutils literal">TestAuthView</tt> with <span class="caps">GET</span> defined previously and outputs its&nbsp;response</li>
<li>A test-auth <span class="caps">POST</span> section that displays a button for calling the <tt class="docutils literal">TestAuthView</tt> with <span class="caps">POST</span> defined previously and outputs its&nbsp;response</li>
<li>The login&nbsp;modal</li>
</ul>
<p>Here&#8217;s the html (using spectre.css for&nbsp;styling):</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container grid-lg&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Test<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;columns&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;non-logged-in&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
        You have to log-in!
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span>  <span class="na">id</span><span class="o">=</span><span class="s">&#39;loginButton&#39;</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;columns&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;logged-in&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
        Welcome <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;span-username&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>!
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span>  <span class="na">id</span><span class="o">=</span><span class="s">&#39;logoutButton&#39;</span><span class="p">&gt;</span>Logout<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;columns&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;test&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span>  <span class="na">id</span><span class="o">=</span><span class="s">&#39;testAuthButton&#39;</span><span class="p">&gt;</span>Test auth<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-9&#39;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;test-auth-response&#39;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;columns&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;test&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span>  <span class="na">id</span><span class="o">=</span><span class="s">&#39;testAuthPostButton&#39;</span><span class="p">&gt;</span>Test auth (POST)<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-9&#39;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;test-auth-post-response&#39;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;login-modal&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#close&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-overlay close-modal&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-container&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-header&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#close&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-clear float-right close-modal&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-title h5&quot;</span><span class="p">&gt;</span>Please login<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-body&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>
                    {% csrf_token %}
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-label&quot;</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;input-username&quot;</span><span class="p">&gt;</span>Username<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-input&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;input-username&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Name&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-label&quot;</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;input-password&quot;</span><span class="p">&gt;</span>Password<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-input&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;input-password&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Password&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-checkbox&quot;</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;input-local-storage&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;input-local-storage&quot;</span> <span class="p">/&gt;</span> <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-icon&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>  Use local storage (remember me)
                        <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;label label-error mt-1 d-invisible&#39;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;modal-error&#39;</span><span class="p">&gt;</span>
                    Unable to login!
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-footer&quot;</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;loginOkButton&#39;</span> <span class="p">&gt;</span>Ok<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#close&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn close-modal&quot;</span> <span class="p">&gt;</span>Close<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>The html is very simple and I don&#8217;t think I need to explain much  - notice that the <tt class="docutils literal"><span class="pre">#logged-in</span></tt> and <tt class="docutils literal"><span class="pre">#non-logged-in</span></tt>
sections are mutually exclusive (I use <tt class="docutils literal">$.show()</tt> and <tt class="docutils literal">$.hide()</tt> to show and hide them) but the <tt class="docutils literal">#test</tt> section is always displayed
so you&#8217;ll be able to call the test <span class="caps">REST</span> <span class="caps">API</span> when you are and are not authenticated. For the modal
to be displayed you need to add an <tt class="docutils literal">active</tt> class to its <tt class="docutils literal">#modal</tt> container.</p>
<p>For the javascript, let&#8217;s take a look at some initialization&nbsp;stuff:</p>
<div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">g_urls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;login&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;{% url &quot;rest_login&quot; %}&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;logout&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;{% url &quot;rest_logout&quot; %}&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;test_auth&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;{% url &quot;test_auth&quot; %}&#39;</span><span class="p">,</span>
<span class="p">};</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">g_auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g_auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">g_auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">g_auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">initLogin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#non-logged-in&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#logged-in&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#span-username&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">.</span><span class="nx">username</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">.</span><span class="nx">remember_me</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#non-logged-in&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#logged-in&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#span-username&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#test-auth-response&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#test-auth-post-response&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
<p>First of all, I define a <tt class="docutils literal">g_urls</tt> window/global object that will keep the required <span class="caps">REST</span> <span class="caps">URLS</span> (login/logout and test auth). These
are retrieved from Django using the <tt class="docutils literal">{% url %}</tt> template tag and are not hard-coded (in the js only client they are hard-coded of course).
After that, I check to see if the user has authenticated before. Notice that because
this is client-side code, I need to do that every time the page loads or else the <span class="caps">JS</span> won&#8217;t be initialized properly! The user login
information is stored to an object named <tt class="docutils literal">g_auth</tt> and contains three attributes: <tt class="docutils literal">username</tt>, <tt class="docutils literal">key</tt> (token) and <tt class="docutils literal">remember_me</tt>.</p>
<p>To keep the login information I use either a key named <tt class="docutils literal">auth</tt> to either the <tt class="docutils literal">localStorage</tt> or the <tt class="docutils literal">sessionStorage</tt>. The <tt class="docutils literal">sessionStorage</tt> is used to save
info for the current browser tab (<em>not</em> window) while the <tt class="docutils literal">localStorage</tt> saves info for ever (until somebody deletes it). Thus,
<tt class="docutils literal">localStorage</tt> can be used for implementing a &#8220;remember me&#8221;&nbsp;functionality.</p>
<p>The final function we define here, <tt class="docutils literal">initLogin</tt> (which is called a little later) checks to see if there is login information
and hides/displays the correct things in html. It will also set the local or session storage (depending on remember me&nbsp;value).</p>
<p>After that, we have some client side code that is inside the <tt class="docutils literal">$()</tt> function which will be called after the page has completely&nbsp;loaded:</p>
<div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">initLogin</span><span class="p">();</span>

<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#loginButton&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#login-modal&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.close-modal&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#login-modal&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#testAuthButton&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
<span class="w">            </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="nx">g_urls</span><span class="p">.</span><span class="nx">test_auth</span><span class="p">,</span>
<span class="w">            </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">beforeSend</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">request</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Token &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">g_auth</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#test-auth-response&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&lt;span class=&#39;label label-success&#39;&gt;Ok! Response: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#test-auth-response&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&lt;span class=&#39;label label-error&#39;&gt;Fail! Response: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">responseText</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; (status: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">status</span><span class="o">+</span><span class="s2">&quot;)&lt;/span&gt;&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#testAuthPostButton&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Same as with the GET</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// continuing below ...</span>
</pre></div>
<p>The first thing happening here is to call the <tt class="docutils literal">initLogin</tt> function to properly initialize the page and then we add a couple of
handlers to the click buttons of the <tt class="docutils literal">#loginButton</tt> (which just displays the modal by adding the <tt class="docutils literal">active</tt> class ),
<tt class="docutils literal"><span class="pre">.close-modal</span></tt> class (there are multiple
ways to close the modal thus I use a class which just removes that <tt class="docutils literal">active</tt> class) and finally to the <tt class="docutils literal">#testAuthButton</tt>
and <tt class="docutils literal">#testAuthPostButton#</tt>.
These
button will do a <tt class="docutils literal"><span class="caps">GET</span></tt> and <tt class="docutils literal"><span class="caps">POST</span></tt> request to the <tt class="docutils literal">g_urls.test_auth</tt> we defined before. The important thing to notice
here is that we add
a <tt class="docutils literal">beforeSend</tt> attribute to the <tt class="docutils literal">$.ajax</tt> request which, if <tt class="docutils literal">g_auth</tt> is defined, adds an <tt class="docutils literal">Authorization</tt> header with the token
in the form that django-rest-framework <tt class="docutils literal">TokenAuthentication</tt> expects and as we&#8217;ve already discussed&nbsp;above:</p>
<div class="highlight"><pre><span></span><span class="nx">beforeSend</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">request</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Token &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">g_auth</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>If this ajax call returns without errors (the <tt class="docutils literal">done</tt> part of the ajax call)
we just add the <tt class="docutils literal">data</tt> to a green label else if there&#8217;s an error (<tt class="docutils literal">fail</tt> part)
we add the response text and status to a red label. You can try clicking the buttons and you see that only if you&#8217;ve logged in
you will succeed in this call. Also, notice that both <span class="caps">GET</span> and <span class="caps">POST</span> requests work normally without the need to also include
a csrf token (I hope you understand why by&nbsp;now).</p>
<p>Let&#8217;s now take a look at the <tt class="docutils literal">#loginOkbutton</tt> click handler (inside the&nbsp;modal):</p>
<div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#loginOkButton&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#input-username&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#input-password&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">remember_me</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#input-local-storage&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">username</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Will try to login with &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">username</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">);</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#modal-error&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;d-invisible&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
<span class="w">            </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="nx">g_urls</span><span class="p">.</span><span class="nx">login</span><span class="p">,</span>
<span class="w">            </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="nx">username</span><span class="p">,</span>
<span class="w">                </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="nx">password</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;DONE: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">username</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
<span class="w">            </span><span class="nx">g_auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="nx">username</span><span class="p">,</span>
<span class="w">                </span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span>
<span class="w">                </span><span class="nx">remember_me</span><span class="o">:</span><span class="w"> </span><span class="nx">remember_me</span>
<span class="w">            </span><span class="p">};</span>
<span class="w">            </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#login-modal&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">initLogin</span><span class="p">();</span>
<span class="w">        </span><span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;FAIL&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="w">            </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#modal-error&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;d-invisible&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#modal-error&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;d-invisible&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
<p>All three user inputs (<tt class="docutils literal">username, password, remember_me</tt>) are read from the form and if both username and
password have been defined an Ajax request will be done to the <tt class="docutils literal">g_urls.login</tt> url. We pass
<tt class="docutils literal">username</tt> and <tt class="docutils literal">password</tt> as the request data. Now, if there&#8217;s an
error (<tt class="docutils literal">fail</tt>) I just display a generic message (by removing it&#8217;s <cite>d-invisible</cite> class) while, if the
request was Ok I retrieve the <tt class="docutils literal">key</tt> (token) from the response, initialize the <tt class="docutils literal">g_auth</tt> object with the
<tt class="docutils literal">username</tt>, <tt class="docutils literal">key</tt> and <tt class="docutils literal">remember_me</tt> values and call <tt class="docutils literal">initLogin</tt> to show the correct divs and save
to the session/local&nbsp;storage.</p>
<p>Finally, here&#8217;s the code for logout (still inside the <tt class="docutils literal">$(function () {</tt>):</p>
<div class="highlight"><pre><span></span><span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#logoutButton&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Trying to logout&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
<span class="w">            </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="nx">g_urls</span><span class="p">.</span><span class="nx">logout</span><span class="p">,</span>
<span class="w">            </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">beforeSend</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">request</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Token &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">g_auth</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;DONE: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="w">            </span><span class="nx">g_auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="nx">initLogin</span><span class="p">();</span>
<span class="w">        </span><span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;FAIL: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>

<span class="p">});</span><span class="w"> </span><span class="c1">// End of $(function () {</span>
</pre></div>
<p>The code here is very simple - just do a <tt class="docutils literal"><span class="caps">POST</span></tt> to the <tt class="docutils literal">g_urls.logout</tt>  and if everything is ok delete the <tt class="docutils literal">g_auth</tt> values
and call <tt class="docutils literal">initLogin()</tt> to show the correct divs and remove the <tt class="docutils literal">auth</tt> key from local/session storage. Notice that when
you <tt class="docutils literal"><span class="caps">POST</span></tt> to the <tt class="docutils literal">logout</tt> <span class="caps">REST</span> end-point, you need to also add the <tt class="docutils literal">Authorization</tt> header with the token or else
(since we&#8217;ve defined only <tt class="docutils literal">TokenAuthentication</tt> for the <tt class="docutils literal">authentication_classes</tt> for the <tt class="docutils literal">LogoutViewEx</tt> class)
there won&#8217;t be any way to correlate the request with the user and log him&nbsp;out!</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>Using the info presented on this article you should be able to properly login and logout to Django using <span class="caps">REST</span> and
also call <span class="caps">REST</span> end-points using the <tt class="docutils literal">TokenAuthentication</tt>.</p>
<p>I recommend using the <tt class="docutils literal">curl</tt> utility to try to call the rest
end point with various parameters to see the response. Also, you change the <tt class="docutils literal">LogoutViewEx</tt> with the
default django-rest-auth <tt class="docutils literal">LogoutView</tt> and then try logging out through the web-app <em>and</em> through curl and see
what happens when you try to access the test-auth&nbsp;end-point.</p>
<p>As a final remark, a couple of thing to&nbsp;note:</p>
<ul class="simple">
<li>You can use the <a class="reference external" href="https://github.com/James1345/django-rest-knox">django-rest-knox</a> package to improve the functionality and security of your <span class="caps">REST</span> tokens (by allowing multiple tokens per user, storing them hashed in the database and configuring expiration times for the&nbsp;tokens)</li>
<li>If you are using Apache and mod_wsgi to run you Django project you need to set the <a class="reference external" href="https://modwsgi.readthedocs.io/en/develop/configuration-directives/WSGIPassAuthorization.html">WSGIPassAuthorization</a> option to <tt class="docutils literal">on</tt> in order to pass the Authorization header to your Django&nbsp;app.</li>
</ul>
</div>
</div>
  		</article>
<div class="pagination">
    <a class="prev" href="https://www.spapas.net/index4.html">&larr; Older</a>

    <a class="next" href="https://www.spapas.net/index2.html">Newer &rarr;</a>
  <br />
</div></div>
<aside class="sidebar">
  
  <section>
    <br />
    <a href='/feeds/all.atom.xml'>Atom</a>
    |
    <a href='/feeds/all.rss.xml'>RSS</a>
  </section>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- Sidebar unit -->
  <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7673322832689008" data-ad-slot="2720624730"
    data-ad-format="auto" data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>


  <script async src="https://cse.google.com/cse.js?cx=612920e5ca9da850c"></script>
  <div class="gcse-search"></div>

  
  <section>
    <h1>Support me</h1>

    You can show your appreciation for anything useful you've found here by 
    buying me a coffee 
    <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="spapas" data-color="#FFDD00" data-emoji=""  data-font="Lato" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script>

    or donating me some bitcoin to this address:
    <small><pre>bc1qx42vp8napheaewhnx0rk0mttdrdrtvw6czvxhl</pre></small>
    <svg shape-rendering="crispEdges" height="200" width="200" viewBox="0 0 29 29" class="qrcode">
      <path fill="#FFFFFF" d="M0,0 h29v29H0z"></path><path fill="#000000" d="M0 0h7v1H0zM9 0h2v1H9zM12 0h1v1H12zM14 0h2v1H14zM18 0h2v1H18zM22,0 h7v1H22zM0 1h1v1H0zM6 1h1v1H6zM8 1h1v1H8zM11 1h1v1H11zM14 1h5v1H14zM22 1h1v1H22zM28,1 h1v1H28zM0 2h1v1H0zM2 2h3v1H2zM6 2h1v1H6zM8 2h4v1H8zM17 2h1v1H17zM22 2h1v1H22zM24 2h3v1H24zM28,2 h1v1H28zM0 3h1v1H0zM2 3h3v1H2zM6 3h1v1H6zM9 3h2v1H9zM14 3h3v1H14zM18 3h1v1H18zM22 3h1v1H22zM24 3h3v1H24zM28,3 h1v1H28zM0 4h1v1H0zM2 4h3v1H2zM6 4h1v1H6zM8 4h1v1H8zM11 4h1v1H11zM13 4h1v1H13zM15 4h2v1H15zM18 4h1v1H18zM22 4h1v1H22zM24 4h3v1H24zM28,4 h1v1H28zM0 5h1v1H0zM6 5h1v1H6zM8 5h2v1H8zM14 5h2v1H14zM19 5h2v1H19zM22 5h1v1H22zM28,5 h1v1H28zM0 6h7v1H0zM8 6h1v1H8zM10 6h1v1H10zM12 6h1v1H12zM14 6h1v1H14zM16 6h1v1H16zM18 6h1v1H18zM20 6h1v1H20zM22,6 h7v1H22zM8 7h2v1H8zM11 7h1v1H11zM15 7h1v1H15zM17 7h2v1H17zM0 8h2v1H0zM3 8h1v1H3zM6 8h2v1H6zM10 8h1v1H10zM12 8h3v1H12zM20 8h1v1H20zM22 8h3v1H22zM26 8h2v1H26zM1 9h1v1H1zM3 9h3v1H3zM8 9h1v1H8zM10 9h1v1H10zM12 9h2v1H12zM16 9h2v1H16zM20 9h1v1H20zM22 9h1v1H22zM25 9h1v1H25zM27,9 h2v1H27zM0 10h1v1H0zM3 10h2v1H3zM6 10h1v1H6zM8 10h3v1H8zM12 10h2v1H12zM16 10h1v1H16zM19 10h1v1H19zM22 10h3v1H22zM27 10h1v1H27zM0 11h1v1H0zM2 11h1v1H2zM4 11h2v1H4zM7 11h1v1H7zM13 11h4v1H13zM18 11h4v1H18zM26 11h2v1H26zM0 12h1v1H0zM2 12h3v1H2zM6 12h1v1H6zM11 12h1v1H11zM13 12h1v1H13zM15 12h3v1H15zM20 12h1v1H20zM22 12h2v1H22zM27,12 h2v1H27zM4 13h1v1H4zM8 13h3v1H8zM12 13h1v1H12zM14 13h1v1H14zM17 13h4v1H17zM25 13h2v1H25zM0 14h1v1H0zM4 14h3v1H4zM8 14h2v1H8zM11 14h3v1H11zM16 14h1v1H16zM21 14h2v1H21zM24,14 h5v1H24zM3 15h3v1H3zM7 15h2v1H7zM10 15h1v1H10zM12 15h2v1H12zM15 15h1v1H15zM17 15h2v1H17zM20 15h2v1H20zM23 15h1v1H23zM1 16h1v1H1zM4 16h1v1H4zM6 16h4v1H6zM16 16h2v1H16zM20 16h1v1H20zM23 16h1v1H23zM25 16h1v1H25zM28,16 h1v1H28zM2 17h1v1H2zM5 17h1v1H5zM7 17h2v1H7zM11 17h3v1H11zM17 17h1v1H17zM22 17h1v1H22zM25 17h1v1H25zM27,17 h2v1H27zM0 18h1v1H0zM3 18h1v1H3zM5 18h4v1H5zM10 18h1v1H10zM12 18h1v1H12zM18 18h1v1H18zM20 18h1v1H20zM22 18h2v1H22zM25,18 h4v1H25zM2 19h3v1H2zM8 19h1v1H8zM16 19h2v1H16zM21 19h1v1H21zM23 19h1v1H23zM25 19h1v1H25zM27 19h1v1H27zM0 20h1v1H0zM2 20h5v1H2zM8 20h2v1H8zM13 20h4v1H13zM19 20h6v1H19zM26 20h1v1H26zM28,20 h1v1H28zM8 21h2v1H8zM12 21h3v1H12zM16 21h1v1H16zM20 21h1v1H20zM24 21h1v1H24zM26,21 h3v1H26zM0 22h7v1H0zM8 22h3v1H8zM17 22h1v1H17zM20 22h1v1H20zM22 22h1v1H22zM24 22h2v1H24zM27 22h1v1H27zM0 23h1v1H0zM6 23h1v1H6zM10 23h2v1H10zM13 23h2v1H13zM19 23h2v1H19zM24,23 h5v1H24zM0 24h1v1H0zM2 24h3v1H2zM6 24h1v1H6zM9 24h2v1H9zM12 24h2v1H12zM17 24h1v1H17zM20 24h6v1H20zM28,24 h1v1H28zM0 25h1v1H0zM2 25h3v1H2zM6 25h1v1H6zM8 25h3v1H8zM12 25h1v1H12zM14 25h1v1H14zM18 25h1v1H18zM22 25h3v1H22zM26 25h1v1H26zM0 26h1v1H0zM2 26h3v1H2zM6 26h1v1H6zM10 26h5v1H10zM16 26h3v1H16zM21 26h1v1H21zM24 26h1v1H24zM26 26h1v1H26zM28,26 h1v1H28zM0 27h1v1H0zM6 27h1v1H6zM8 27h3v1H8zM12 27h4v1H12zM17 27h1v1H17zM20 27h1v1H20zM23 27h2v1H23zM27 27h1v1H27zM0 28h7v1H0zM8 28h3v1H8zM14 28h1v1H14zM16 28h3v1H16zM20 28h1v1H20zM22 28h1v1H22zM24 28h2v1H24zM27 28h1v1H27z"></path>
    </svg>
  </section>
  

  <section>
    <h1>Subscribe</h1>
    Do you want to get notified via email when I post new content?
    <style>
      .subscribe-button {
        /* margin: 10px !important; */
        padding: 10px !important;
        background-color: black;
        display: inline-block;
        color: white !important;
        text-decoration: none;

        line-height: 36px !important;
        height: 37px !important;
        text-decoration: none !important;
        display: inline-block !important;
        color: #ffffff !important;
        background-color: #000000 !important;
        border-radius: 3px !important;
        border: 1px solid transparent !important;
        padding: 1px 9px !important;
        font-size: 23px !important;
        letter-spacing: 0.6px !important;
        box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
        -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
        margin: 0 auto !important;
        font-family: 'Cookie', cursive !important;
        -webkit-box-sizing: border-box !important;
        box-sizing: border-box !important;
        -o-transition: 0.3s all linear !important;
        -webkit-transition: 0.3s all linear !important;
        -moz-transition: 0.3s all linear !important;
        -ms-transition: 0.3s all linear !important;
        transition: 0.3s all linear !important;

      }
    </style>
    <a class='subscribe-button' target="_blank" href="http://eepurl.com/dxI3PP">Click here to subscribe!</a>
  </section>


  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
        <a href="https://www.spapas.net/2024/08/22/multiple-erl-elixir-windows/">Multiple Erlang/Elixir versions in Windows</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/11/29/openid-connect-tutorial/">A simple OpenID connect tutorial</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/05/23/simple-django-datatables-integration/">Simple Django - DataTables integration</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/05/22/ai-auto-subtitling/">AI auto-subtitling</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/05/12/disable-your-forms/">HTML form disable after submit</a>
      </li>
    </ul>
  </section>
  <section>

    <h1>Categories</h1>
    <ul id="recent_posts">
      <li><a href="https://www.spapas.net/category/ai.html">ai</a></li>
      <li><a href="https://www.spapas.net/category/android.html">android</a></li>
      <li><a href="https://www.spapas.net/category/clojure.html">clojure</a></li>
      <li><a href="https://www.spapas.net/category/css.html">css</a></li>
      <li><a href="https://www.spapas.net/category/django.html">django</a></li>
      <li><a href="https://www.spapas.net/category/elixir.html">elixir</a></li>
      <li><a href="https://www.spapas.net/category/flask.html">flask</a></li>
      <li><a href="https://www.spapas.net/category/gaming.html">gaming</a></li>
      <li><a href="https://www.spapas.net/category/git.html">git</a></li>
      <li><a href="https://www.spapas.net/category/html.html">html</a></li>
      <li><a href="https://www.spapas.net/category/javascript.html">javascript</a></li>
      <li><a href="https://www.spapas.net/category/networking.html">networking</a></li>
      <li><a href="https://www.spapas.net/category/pelican.html">pelican</a></li>
      <li><a href="https://www.spapas.net/category/postgresql.html">postgresql</a></li>
      <li><a href="https://www.spapas.net/category/python.html">python</a></li>
      <li><a href="https://www.spapas.net/category/spring.html">spring</a></li>
      <li><a href="https://www.spapas.net/category/unix.html">unix</a></li>
      <li><a href="https://www.spapas.net/category/wagtail.html">wagtail</a></li>
    </ul>
  </section>

  <section>
    <h1>Tags</h1>
    <a href="https://www.spapas.net/tag/erlang.html">erlang</a>,    <a href="https://www.spapas.net/tag/elixir.html">elixir</a>,    <a href="https://www.spapas.net/tag/windows.html">windows</a>,    <a href="https://www.spapas.net/tag/openid.html">openid</a>,    <a href="https://www.spapas.net/tag/openid-connect.html">openid-connect</a>,    <a href="https://www.spapas.net/tag/oidc.html">oidc</a>,    <a href="https://www.spapas.net/tag/http.html">http</a>,    <a href="https://www.spapas.net/tag/keycloak.html">keycloak</a>,    <a href="https://www.spapas.net/tag/python.html">python</a>,    <a href="https://www.spapas.net/tag/django.html">django</a>,    <a href="https://www.spapas.net/tag/jquery.html">jquery</a>,    <a href="https://www.spapas.net/tag/datatables.html">datatables</a>,    <a href="https://www.spapas.net/tag/ai.html">ai</a>,    <a href="https://www.spapas.net/tag/whisper.html">whisper</a>,    <a href="https://www.spapas.net/tag/whispercpp.html">whisper.cpp</a>,    <a href="https://www.spapas.net/tag/subtitles.html">subtitles</a>,    <a href="https://www.spapas.net/tag/video.html">video</a>,    <a href="https://www.spapas.net/tag/auto-subtitling.html">auto-subtitling</a>,    <a href="https://www.spapas.net/tag/subtitiling.html">subtitiling</a>,    <a href="https://www.spapas.net/tag/transcribe.html">transcribe</a>,    <a href="https://www.spapas.net/tag/html.html">html</a>,    <a href="https://www.spapas.net/tag/javascript.html">javascript</a>,    <a href="https://www.spapas.net/tag/media.html">media</a>,    <a href="https://www.spapas.net/tag/storage.html">storage</a>,    <a href="https://www.spapas.net/tag/unpoly.html">unpoly</a>,    <a href="https://www.spapas.net/tag/access.html">access</a>,    <a href="https://www.spapas.net/tag/database.html">database</a>,    <a href="https://www.spapas.net/tag/accdb.html">accdb</a>,    <a href="https://www.spapas.net/tag/mdb.html">mdb</a>,    <a href="https://www.spapas.net/tag/postgresql.html">postgresql</a>,    <a href="https://www.spapas.net/tag/development.html">development</a>,    <a href="https://www.spapas.net/tag/inlines.html">inlines</a>,    <a href="https://www.spapas.net/tag/clojure.html">clojure</a>,    <a href="https://www.spapas.net/tag/cmd.html">cmd</a>,    <a href="https://www.spapas.net/tag/pdf.html">pdf</a>,    <a href="https://www.spapas.net/tag/wkhtmltopdf.html">wkhtmltopdf</a>,    <a href="https://www.spapas.net/tag/forward-proxy.html">forward-proxy</a>,    <a href="https://www.spapas.net/tag/reverse-proxy.html">reverse-proxy</a>,    <a href="https://www.spapas.net/tag/proxy.html">proxy</a>,    <a href="https://www.spapas.net/tag/networking.html">networking</a>,    <a href="https://www.spapas.net/tag/dj-rest-auth.html">dj-rest-auth</a>,    <a href="https://www.spapas.net/tag/rest.html">rest</a>,    <a href="https://www.spapas.net/tag/django-rest-framework.html">django-rest-framework</a>,    <a href="https://www.spapas.net/tag/authentication.html">authentication</a>,    <a href="https://www.spapas.net/tag/tokens.html">tokens</a>,    <a href="https://www.spapas.net/tag/migrations.html">migrations</a>,    <a href="https://www.spapas.net/tag/foreignkey.html">foreignkey</a>,    <a href="https://www.spapas.net/tag/dark-souls.html">dark-souls</a>,    <a href="https://www.spapas.net/tag/dark-souls-2.html">dark-souls-2</a>,    <a href="https://www.spapas.net/tag/dark-souls-3.html">dark-souls-3</a>,    <a href="https://www.spapas.net/tag/autohotkey.html">autohotkey</a>,    <a href="https://www.spapas.net/tag/matplotlib.html">matplotlib</a>,    <a href="https://www.spapas.net/tag/hashids.html">hashids</a>,    <a href="https://www.spapas.net/tag/wagtail.html">wagtail</a>,    <a href="https://www.spapas.net/tag/osmon.html">osmon</a>,    <a href="https://www.spapas.net/tag/phoenix.html">phoenix</a>,    <a href="https://www.spapas.net/tag/os-monitoring.html">os-monitoring</a>,    <a href="https://www.spapas.net/tag/forms.html">forms</a>,    <a href="https://www.spapas.net/tag/django-crispy-forms.html">django-crispy-forms</a>,    <a href="https://www.spapas.net/tag/django-widget-tweaks.html">django-widget-tweaks</a>,    <a href="https://www.spapas.net/tag/ecto.html">ecto</a>,    <a href="https://www.spapas.net/tag/queries.html">queries</a>,    <a href="https://www.spapas.net/tag/declarative.html">declarative</a>,    <a href="https://www.spapas.net/tag/form.html">form</a>,    <a href="https://www.spapas.net/tag/php.html">php</a>,    <a href="https://www.spapas.net/tag/select2.html">select2</a>,    <a href="https://www.spapas.net/tag/autocompelte.html">autocompelte</a>,    <a href="https://www.spapas.net/tag/ajax.html">ajax</a>,    <a href="https://www.spapas.net/tag/android.html">android</a>,    <a href="https://www.spapas.net/tag/kotlin.html">kotlin</a>,    <a href="https://www.spapas.net/tag/adapter.html">adapter</a>,    <a href="https://www.spapas.net/tag/filter.html">filter</a>,    <a href="https://www.spapas.net/tag/async.html">async</a>,    <a href="https://www.spapas.net/tag/tasks.html">tasks</a>,    <a href="https://www.spapas.net/tag/django-rq.html">django-rq</a>,    <a href="https://www.spapas.net/tag/rq.html">rq</a>,    <a href="https://www.spapas.net/tag/du.html">du</a>,    <a href="https://www.spapas.net/tag/unix.html">unix</a>,    <a href="https://www.spapas.net/tag/linux.html">linux</a>,    <a href="https://www.spapas.net/tag/disk-usage.html">disk-usage</a>,    <a href="https://www.spapas.net/tag/cbv.html">cbv</a>,    <a href="https://www.spapas.net/tag/middleware.html">middleware</a>,    <a href="https://www.spapas.net/tag/class-based-views.html">class-based-views</a>,    <a href="https://www.spapas.net/tag/react.html">react</a>,    <a href="https://www.spapas.net/tag/redux.html">redux</a>,    <a href="https://www.spapas.net/tag/hyperapp.html">hyperapp</a>,    <a href="https://www.spapas.net/tag/immutable.html">immutable</a>,    <a href="https://www.spapas.net/tag/es6.html">es6</a>,    <a href="https://www.spapas.net/tag/youtube.html">youtube</a>,    <a href="https://www.spapas.net/tag/youtube-dl.html">youtube-dl</a>,    <a href="https://www.spapas.net/tag/ffmpeg.html">ffmpeg</a>,    <a href="https://www.spapas.net/tag/django-rest-auth.html">django-rest-auth</a>,    <a href="https://www.spapas.net/tag/python-2.html">python-2</a>,    <a href="https://www.spapas.net/tag/python-3.html">python-3</a>,    <a href="https://www.spapas.net/tag/plpgsql.html">plpgsql</a>,    <a href="https://www.spapas.net/tag/component.html">component</a>,    <a href="https://www.spapas.net/tag/ag-grid.html">ag-grid</a>,    <a href="https://www.spapas.net/tag/grid.html">grid</a>,    <a href="https://www.spapas.net/tag/bash.html">bash</a>,    <a href="https://www.spapas.net/tag/cron.html">cron</a>,    <a href="https://www.spapas.net/tag/pandas.html">pandas</a>,    <a href="https://www.spapas.net/tag/scipy.html">scipy</a>,    <a href="https://www.spapas.net/tag/numpy.html">numpy</a>,    <a href="https://www.spapas.net/tag/pivot.html">pivot</a>,    <a href="https://www.spapas.net/tag/pivot_table.html">pivot_table</a>,    <a href="https://www.spapas.net/tag/ipython.html">ipython</a>,    <a href="https://www.spapas.net/tag/jupyter.html">jupyter</a>,    <a href="https://www.spapas.net/tag/notebook.html">notebook</a>,    <a href="https://www.spapas.net/tag/query.html">query</a>,    <a href="https://www.spapas.net/tag/q.html">q</a>,    <a href="https://www.spapas.net/tag/imgur.html">imgur</a>,    <a href="https://www.spapas.net/tag/console.html">console</a>,    <a href="https://www.spapas.net/tag/research.html">research</a>,    <a href="https://www.spapas.net/tag/debug.html">debug</a>,    <a href="https://www.spapas.net/tag/werkzeug.html">werkzeug</a>,    <a href="https://www.spapas.net/tag/django-extensions.html">django-extensions</a>,    <a href="https://www.spapas.net/tag/404.html">404</a>,    <a href="https://www.spapas.net/tag/error.html">error</a>,    <a href="https://www.spapas.net/tag/spring.html">spring</a>,    <a href="https://www.spapas.net/tag/spring-boot.html">spring-boot</a>,    <a href="https://www.spapas.net/tag/java.html">java</a>,    <a href="https://www.spapas.net/tag/ldap.html">ldap</a>,    <a href="https://www.spapas.net/tag/profiles.html">profiles</a>,    <a href="https://www.spapas.net/tag/settings.html">settings</a>,    <a href="https://www.spapas.net/tag/properties.html">properties</a>,    <a href="https://www.spapas.net/tag/yaml.html">yaml</a>,    <a href="https://www.spapas.net/tag/configuration.html">configuration</a>,    <a href="https://www.spapas.net/tag/deploy.html">deploy</a>,    <a href="https://www.spapas.net/tag/initd.html">init.d</a>,    <a href="https://www.spapas.net/tag/react-redux.html">react-redux</a>,    <a href="https://www.spapas.net/tag/redux-thunk.html">redux-thunk</a>,    <a href="https://www.spapas.net/tag/redux-form.html">redux-form</a>,    <a href="https://www.spapas.net/tag/react-router.html">react-router</a>,    <a href="https://www.spapas.net/tag/react-router-redux.html">react-router-redux</a>,    <a href="https://www.spapas.net/tag/react-notification.html">react-notification</a>,    <a href="https://www.spapas.net/tag/history.html">history</a>,    <a href="https://www.spapas.net/tag/babel.html">babel</a>,    <a href="https://www.spapas.net/tag/babelify.html">babelify</a>,    <a href="https://www.spapas.net/tag/browserify.html">browserify</a>,    <a href="https://www.spapas.net/tag/watchify.html">watchify</a>,    <a href="https://www.spapas.net/tag/uglify.html">uglify</a>,    <a href="https://www.spapas.net/tag/boilerplate.html">boilerplate</a>,    <a href="https://www.spapas.net/tag/tutorial.html">tutorial</a>,    <a href="https://www.spapas.net/tag/introduction.html">introduction</a>,    <a href="https://www.spapas.net/tag/fixed-data-tables.html">fixed-data-tables</a>,    <a href="https://www.spapas.net/tag/fixeddatatable.html">FixedDataTable</a>,    <a href="https://www.spapas.net/tag/reportlab.html">reportlab</a>,    <a href="https://www.spapas.net/tag/xhtml2pdf.html">xhtml2pdf</a>,    <a href="https://www.spapas.net/tag/node.html">node</a>,    <a href="https://www.spapas.net/tag/npm.html">npm</a>,    <a href="https://www.spapas.net/tag/generic.html">generic</a>,    <a href="https://www.spapas.net/tag/tables.html">tables</a>,    <a href="https://www.spapas.net/tag/flux.html">flux</a>,    <a href="https://www.spapas.net/tag/jobs.html">jobs</a>,    <a href="https://www.spapas.net/tag/asynchronous.html">asynchronous</a>,    <a href="https://www.spapas.net/tag/scheduling.html">scheduling</a>,    <a href="https://www.spapas.net/tag/redis.html">redis</a>,    <a href="https://www.spapas.net/tag/pusher.html">pusher</a>,    <a href="https://www.spapas.net/tag/auditing.html">auditing</a>,    <a href="https://www.spapas.net/tag/css.html">css</a>,    <a href="https://www.spapas.net/tag/design.html">design</a>,    <a href="https://www.spapas.net/tag/boostrap-material-design.html">boostrap-material-design</a>,    <a href="https://www.spapas.net/tag/less.html">less</a>,    <a href="https://www.spapas.net/tag/nodejs.html">node.js</a>,    <a href="https://www.spapas.net/tag/gmail.html">gmail</a>,    <a href="https://www.spapas.net/tag/security.html">security</a>,    <a href="https://www.spapas.net/tag/google.html">google</a>,    <a href="https://www.spapas.net/tag/flask.html">flask</a>,    <a href="https://www.spapas.net/tag/mongodb.html">mongodb</a>,    <a href="https://www.spapas.net/tag/heroku.html">heroku</a>,    <a href="https://www.spapas.net/tag/spring-security.html">spring-security</a>,    <a href="https://www.spapas.net/tag/git.html">git</a>,    <a href="https://www.spapas.net/tag/github.html">github</a>,    <a href="https://www.spapas.net/tag/branching.html">branching</a>,    <a href="https://www.spapas.net/tag/static-html.html">static-html</a>,    <a href="https://www.spapas.net/tag/githubio.html">github.io</a>,    <a href="https://www.spapas.net/tag/pelican.html">pelican</a>,    <a href="https://www.spapas.net/tag/github-pages.html">github-pages</a>,    <a href="https://www.spapas.net/tag/rst.html">rst</a>  </section>

  <section>
    <h1>Yearly archives</h1>
    <a href="https://www.spapas.net/posts/2013/">2013</a>,    <a href="https://www.spapas.net/posts/2014/">2014</a>,    <a href="https://www.spapas.net/posts/2015/">2015</a>,    <a href="https://www.spapas.net/posts/2016/">2016</a>,    <a href="https://www.spapas.net/posts/2017/">2017</a>,    <a href="https://www.spapas.net/posts/2018/">2018</a>,    <a href="https://www.spapas.net/posts/2019/">2019</a>,    <a href="https://www.spapas.net/posts/2020/">2020</a>,    <a href="https://www.spapas.net/posts/2021/">2021</a>,    <a href="https://www.spapas.net/posts/2022/">2022</a>,    <a href="https://www.spapas.net/posts/2023/">2023</a>,    <a href="https://www.spapas.net/posts/2024/">2024</a>  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/spapas">@spapas</a> on GitHub
    <script  src="//code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script type="text/javascript">
      $(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = 'https://www.spapas.net/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'spapas',
              count: 5,
              skip_forks: true,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="https://www.spapas.net/theme/js/github.js" type="text/javascript"> </script>
  </section>


  <section>
    <a href="https://twitter.com/_serafeim_?ref_src=twsrc%5Etfw" class="twitter-follow-button"
      data-show-count="false">Follow @_serafeim_</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2013&ndash;2024  Serafeim Papastefanos &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="https://www.spapas.net/theme/js/modernizr-2.0.js"></script>
  <script src="https://www.spapas.net/theme/js/ender.js"></script>
  <script src="https://www.spapas.net/theme/js/octopress.js" type="text/javascript"></script>
  <script src="https://www.spapas.net/theme/js/ads.js"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44750952-1', 'auto');

    ga('send', 'pageview');
    </script>

<script defer data-domain="spapas.net" src="https://plausible.hcg.gr/js/script.js"></script>  <script type="text/javascript">
    var disqus_shortname = 'spapas-github-io';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>

</body>

</html>
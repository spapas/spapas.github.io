<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="5_8DTmIiEq4gFvNAfxAD6TsGOgrMAjp8lQFQvfA6zZc" />
  <title>Ajax data with Fixed Data Table for React &mdash; /var/</title>
  <meta name="author" content="Serafeim Papastefanos">






  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="http://spapas.github.io/favicon.png" rel="icon">

  <link href="http://spapas.github.io/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="http://spapas.github.io/">/var/</a></h1>
    <h2>Various programming stuff</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li >
        <a href="http://spapas.github.io/category/css.html">Css</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/django.html">Django</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/flask.html">Flask</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/git.html">Git</a>
      </li>
      <li class="active">
        <a href="http://spapas.github.io/category/javascript.html">Javascript</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/pelican.html">Pelican</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/python.html">Python</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/spring.html">Spring</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/wagtail.html">Wagtail</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Ajax data with Fixed Data Table for React</h1>
    <p class="meta">
<time datetime="2015-12-22T15:20:00+02:00" pubdate>Τρι 22 Δεκέμβριος 2015</time>    </p>
</header>

  <div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#our-project" id="id2">Our&nbsp;project</a></li>
<li><a class="reference internal" href="#how-fixeddatatable-gets-its-data" id="id3">How FixedDataTable gets its&nbsp;data</a></li>
<li><a class="reference internal" href="#ajaxcell-non-working-version-1" id="id4">AjaxCell: Non working version&nbsp;1</a></li>
<li><a class="reference internal" href="#ajaxcell-non-working-version-2" id="id5">AjaxCell: Non working version&nbsp;2</a></li>
<li><a class="reference internal" href="#ajaxcell-non-working-version-3" id="id6">AjaxCell: Non working version&nbsp;3</a></li>
<li><a class="reference internal" href="#ajaxcell-final-version" id="id7">AjaxCell: Final&nbsp;version</a></li>
<li><a class="reference internal" href="#the-table-container-component" id="id8">The Table container&nbsp;component</a></li>
<li><a class="reference internal" href="#some-enchancements" id="id9">Some&nbsp;enchancements</a></li>
<li><a class="reference internal" href="#conslusion" id="id10">Conslusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a></h2>
<p><a class="reference external" href="https://facebook.github.io/fixed-data-table/">FixedDataTable</a> is a nice React component from Facebook that is used to render tabular data.
Its main characteristic is that it can handle many rows without sacrificing performance, however
probably due to this fact I was not able to find any examples for loading data using Ajax - all
examples I was able to find had the data already loaded (or created on the&nbsp;fly).</p>
<p>So, although FixedDataTable is able to handle many rows, I am against transfering all of them to the user
whenever our page loads since at most one page of data will be shown on screen (30 rows or so ?) -
any other actions (filtering, sorting, aggregate calculations etc) should be done on the&nbsp;server.</p>
<p>In the following I will present a simple, react-only example with a FixedDataTable that can be
used with server-side, asynchronous, paginated&nbsp;data.</p>
</div>
<div class="section" id="our-project">
<h2><a class="toc-backref" href="#id2">Our&nbsp;project</a></h2>
<p>Let&#8217;s see an example of what we&#8217;ll&nbsp;build:</p>
<img alt="Our project" src="/images/ajax_fixed_data_tables.gif" style="width: 600px;" />
<p>As a source of the data I&#8217;ve used the <a class="reference external" href="http://swapi.co/">Star Wars <span class="caps">API</span></a> and specifically its <a class="reference external" href="http://swapi.co/documentation#people">People <span class="caps">API</span></a> by issuing
requests to <a class="reference external" href="http://swapi.co/api/people/?format=json">http://swapi.co/api/people/?format=json</a>. This will return an array of people from the
star wars universe in <span class="caps">JSON</span> format - the results are paginated with a page size of 10 (and we can switch
to another page using the extra <tt class="docutils literal">page=</tt> request&nbsp;parameter).</p>
<p>I will use es6 with the object spread operator (as described in <a class="reference external" href="http://spapas.github.io/2015/11/16/using-browserify-es6/">a previous article</a>)
to write the code, using a single main.js as a source which will be transpiled to <tt class="docutils literal">dist/bundle.js</tt>.</p>
<p>The placeholder <span class="caps">HTML</span> for our application&nbsp;is:</p>
<div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Hello Ajax Fixed Data Table!<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&#39;https://cdnjs.cloudflare.com/ajax/libs/fixed-data-table/0.6.0/fixed-data-table.min.css&#39;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&#39;dist/bundle.js&#39;</span> <span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
<p>The versions that are used are react 14.3 and fixed-data-table 0.6.0. You can find this project in github &#64;
<a class="reference external" href="https://github.com/spapas/react-tables">https://github.com/spapas/react-tables</a> &#8212; tag name <tt class="docutils literal"><span class="pre">fixed-data-table-ajax</span></tt>.</p>
</div>
<div class="section" id="how-fixeddatatable-gets-its-data">
<h2><a class="toc-backref" href="#id3">How FixedDataTable gets its&nbsp;data</a></h2>
<p>The data of a <tt class="docutils literal">FixedDataTable</tt> component is defined through a number of <tt class="docutils literal">Column</tt> components
and specifically, the <tt class="docutils literal">cell</tt> attribute of that component which sould either return be a static string
to be displayed in that column or a React component (usually a <tt class="docutils literal">Cell</tt>) that will be displayed in
that column or even a function that returns a string or a react component. The function (or component)
passed to <tt class="docutils literal">cell</tt> will have an object with a <tt class="docutils literal">rowIndex</tt> attribute (among others) as a parameter,
for example the&nbsp;following</p>
<div class="highlight"><pre><span class="nt">&lt;Column</span>
  <span class="na">header=</span><span class="s">{&lt;Cell</span><span class="nt">&gt;</span>Url<span class="nt">&lt;/Cell&gt;</span>}
  cell={props =&gt; props.rowIndex}
  width={200}
/&gt;
</pre></div>
<p>will just display the rowIndex for each&nbsp;cell.</p>
<p>So we can see that for each cell that FixedDataTable wants to display it will use its corresponding
<tt class="docutils literal">cell</tt> attribute.
So, a general though if we wanted to support asynchronous, paginated data
is to check the rowIndex and retrieve the correct page asynchronously.
This would lead to a difficulty: What should the <tt class="docutils literal">cell</tt> function return? We&#8217;ll try to resolve this
using an <tt class="docutils literal">AjaxCell</tt> function that should return a react componet to put in the&nbsp;cell:</p>
</div>
<div class="section" id="ajaxcell-non-working-version-1">
<h2><a class="toc-backref" href="#id4">AjaxCell: Non working version&nbsp;1</a></h2>
<p>A first sketch of an <tt class="docutils literal">`AjaxCell</tt> component could be something like&nbsp;this:</p>
<div class="highlight"><pre><span class="c1">// Careful - not working</span>
<span class="kr">const</span> <span class="nx">AjaxCell1</span> <span class="o">=</span> <span class="p">({</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">col</span><span class="p">,</span> <span class="p">...</span><span class="nx">props</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">rowIndex</span><span class="o">&gt;=</span><span class="nx">pageSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">page</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">rowIndex</span> <span class="o">/</span> <span class="nx">pageSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span> <span class="o">%</span> <span class="nx">pageSize</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://swapi.co/api/people/?format=json&amp;page=&#39;</span><span class="o">+</span><span class="nx">page</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Here we have the result ! But where will it go ?</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="c1">/// what ?</span>
<span class="p">}</span>
</pre></div>
<p>The col attribute will later be used to select the attribute we want to display in this cell.
The <tt class="docutils literal">page</tt> and <tt class="docutils literal">idx</tt> will have the correct page number and idx inside that page (for example,
if <tt class="docutils literal">rowIndex</tt> is 33, <tt class="docutils literal">page</tt> will be 4 and idx will be 3. The problem with the above is that
the fetch function will be called <em>asynchronously</em> so when the AjaxCell returns it will <em>not</em> have
the results (yet)! So we won&#8217;t be able to render anything&nbsp;:(</p>
</div>
<div class="section" id="ajaxcell-non-working-version-2">
<h2><a class="toc-backref" href="#id5">AjaxCell: Non working version&nbsp;2</a></h2>
<p>To be able to render <em>something</em>, we could put the results of fetching a page to a <tt class="docutils literal">cache</tt> dictionary &#8212; and only
fetch that page if it is not inside the <tt class="docutils literal">cache</tt> - if it is inside the cache then we&#8217;ll just return
the correct&nbsp;value:</p>
<div class="highlight"><pre><span class="c1">// Careful - not working correctly</span>
<span class="kr">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{}</span>
<span class="kr">const</span> <span class="nx">AjaxCell2</span> <span class="o">=</span> <span class="p">({</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">col</span><span class="p">,</span> <span class="nx">forceUpdate</span><span class="p">,</span> <span class="p">...</span><span class="nx">props</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">rowIndex</span><span class="o">&gt;=</span><span class="nx">pageSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">page</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">rowIndex</span> <span class="o">/</span> <span class="nx">pageSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span> <span class="o">%</span> <span class="nx">pageSize</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">][</span><span class="nx">idx</span><span class="p">][</span><span class="nx">col</span><span class="p">]}</span><span class="o">&lt;</span><span class="err">/Cell&gt;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Loading page &quot;</span> <span class="o">+</span> <span class="nx">page</span><span class="p">);</span>
        <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://swapi.co/api/people/?format=json&amp;page=&#39;</span><span class="o">+</span><span class="nx">page</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
        <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">]</span> <span class="o">=</span> <span class="nx">j</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">];</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;-&lt;</span><span class="err">/Cell&gt;;</span>
<span class="p">}</span>
</pre></div>
<p>The above will work, since it will return an empty (<tt class="docutils literal"><span class="pre">&lt;Cell&gt;-&lt;/Cell&gt;</span></tt>) initially but when the
<tt class="docutils literal">fetch</tt> returns it will set the <tt class="docutils literal">cache</tt> for that page and return the correct value (<tt class="docutils literal"><span class="pre">&lt;Cell&gt;{cache[page][idx][col]}&lt;/Cell&gt;</span></tt>).</p>
<p>However, as can be understood, when the page first loads it will call <tt class="docutils literal">AjaxCell2</tt> for all visible cells &#8212;
because fetch is asynchronous and takes time until it returns (and sets the cache for that page), so the
<tt class="docutils literal">fetch</tt> will be called for <em>all</em>&nbsp;cells!</p>
</div>
<div class="section" id="ajaxcell-non-working-version-3">
<h2><a class="toc-backref" href="#id6">AjaxCell: Non working version&nbsp;3</a></h2>
<p><tt class="docutils literal">fetch</tt> ing each page multiple times is of course not acceptable, so we&#8217;ll add a <tt class="docutils literal">loading</tt> flag
and <tt class="docutils literal">fetch</tt> will be called only when this flag is <tt class="docutils literal">false</tt>, like&nbsp;this:</p>
<div class="highlight"><pre><span class="c1">// Not ready yet</span>
<span class="kr">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
<span class="kd">let</span> <span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">AjaxCell2</span> <span class="o">=</span> <span class="p">({</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">col</span><span class="p">,</span> <span class="p">...</span><span class="nx">props</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">rowIndex</span><span class="o">&gt;=</span><span class="nx">pageSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">page</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">rowIndex</span> <span class="o">/</span> <span class="nx">pageSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span> <span class="o">%</span> <span class="nx">pageSize</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">][</span><span class="nx">idx</span><span class="p">][</span><span class="nx">col</span><span class="p">]}</span><span class="o">&lt;</span><span class="err">/Cell&gt;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">loading</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Loading page &quot;</span> <span class="o">+</span> <span class="nx">page</span><span class="p">);</span>
        <span class="nx">loading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://swapi.co/api/people/?format=json&amp;page=&#39;</span><span class="o">+</span><span class="nx">page</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
        <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">]</span> <span class="o">=</span> <span class="nx">j</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">];</span>
            <span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;-&lt;</span><span class="err">/Cell&gt;;</span>
<span class="p">}</span>
</pre></div>
<p>This works much better - the cells are rendered correctly and each page is loaded only once. However, if for example
I tried to move to the end of the table quickly, I would see some cells that are always loading (they never get their correct value). This is because
there is no way to know that the fetch function has actually completed in order to update with the latest (correct) value of that
cell and will contain the stale placeholder (<tt class="docutils literal"><span class="pre">&lt;Cell&gt;-&lt;/Cell&gt;</span></tt>)&nbsp;value.</p>
</div>
<div class="section" id="ajaxcell-final-version">
<h2><a class="toc-backref" href="#id7">AjaxCell: Final&nbsp;version</a></h2>
<p>To clear the stale data we need to do an update to the table data
when each fetch is finished &#8212; this should be done by a callback that will be passed to the <tt class="docutils literal">AjaxCell</tt>, like&nbsp;this:</p>
<div class="highlight"><pre><span class="kr">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
<span class="kd">let</span> <span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">AjaxCell</span> <span class="o">=</span> <span class="p">({</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">col</span><span class="p">,</span> <span class="nx">forceUpdate</span><span class="p">,</span> <span class="p">...</span><span class="nx">props</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">rowIndex</span><span class="o">&gt;=</span><span class="nx">pageSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">page</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">rowIndex</span> <span class="o">/</span> <span class="nx">pageSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span> <span class="o">%</span> <span class="nx">pageSize</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">][</span><span class="nx">idx</span><span class="p">][</span><span class="nx">col</span><span class="p">]}</span><span class="o">&lt;</span><span class="err">/Cell&gt;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">loading</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Loading page &quot;</span> <span class="o">+</span> <span class="nx">page</span><span class="p">);</span>
        <span class="nx">loading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://swapi.co/api/people/?format=json&amp;page=&#39;</span><span class="o">+</span><span class="nx">page</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
        <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">]</span> <span class="o">=</span> <span class="nx">j</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">];</span>
            <span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="nx">forceUpdate</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">loadingCell</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>So we pass a forceUpdate callback as a property which is called when a fetch is finished. This may
result to some not needed updates to the table (since we would do a fetch + forceUpdate for non-displayed
data) but we can now be positive that when the data is loaded the table will be updated to dispaly&nbsp;it.</p>
</div>
<div class="section" id="the-table-container-component">
<h2><a class="toc-backref" href="#id8">The Table container&nbsp;component</a></h2>
<p>Finally, the component that contains the table is the&nbsp;following:</p>
<div class="highlight"><pre><span class="kr">class</span> <span class="nx">TableContainer</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Table</span>
            <span class="nx">rowHeight</span><span class="o">=</span><span class="p">{</span><span class="mi">30</span><span class="p">}</span> <span class="nx">rowsCount</span><span class="o">=</span><span class="p">{</span><span class="mi">87</span><span class="p">}</span> <span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="mi">600</span><span class="p">}</span> <span class="nx">height</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">}</span> <span class="nx">headerHeight</span><span class="o">=</span><span class="p">{</span><span class="mi">30</span><span class="p">}</span><span class="o">&gt;</span>

            <span class="o">&lt;</span><span class="nx">Column</span>
              <span class="nx">header</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="nx">Name</span><span class="o">&lt;</span><span class="err">/Cell&gt;}</span>
              <span class="nx">cell</span><span class="o">=</span><span class="p">{</span> <span class="o">&lt;</span><span class="nx">AjaxCell</span> <span class="nx">col</span><span class="o">=</span><span class="s1">&#39;name&#39;</span> <span class="nx">forceUpdate</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">forceUpdate</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span> <span class="o">/&gt;</span> <span class="p">}</span>
              <span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">}</span>
            <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="nx">Column</span>
              <span class="nx">header</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="nx">Birth</span> <span class="nx">Year</span><span class="o">&lt;</span><span class="err">/Cell&gt;}</span>
              <span class="nx">cell</span><span class="o">=</span><span class="p">{</span> <span class="o">&lt;</span><span class="nx">AjaxCell</span> <span class="nx">col</span><span class="o">=</span><span class="s1">&#39;birth_year&#39;</span> <span class="nx">forceUpdate</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">forceUpdate</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span> <span class="o">/&gt;</span> <span class="p">}</span>
              <span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">}</span>
            <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="nx">Column</span>
              <span class="nx">header</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="nx">Url</span><span class="o">&lt;</span><span class="err">/Cell&gt;}</span>
              <span class="nx">cell</span><span class="o">=</span><span class="p">{</span> <span class="o">&lt;</span><span class="nx">AjaxCell</span> <span class="nx">col</span><span class="o">=</span><span class="s1">&#39;url&#39;</span> <span class="nx">forceUpdate</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">forceUpdate</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span> <span class="o">/&gt;</span> <span class="p">}</span>
              <span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">}</span>
            <span class="o">/&gt;</span>

        <span class="o">&lt;</span><span class="err">/Table&gt;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>I&#8217;ve made it a component in order to be able to bind the <tt class="docutils literal">forceUpdate</tt> method of the component to and
<tt class="docutils literal">this</tt> and pass it to the <tt class="docutils literal">forceUpdate</tt> parameter to the <tt class="docutils literal">AjaxCell</tt> component. I&#8217;ve hard-coded
the rowsCount value &#8212; instead we should have done an initial fetch to the first page of the <span class="caps">API</span> to get
the total number of rows and only after that fetch had returned display the <tt class="docutils literal">&lt;Table&gt;</tt> component (left
as an exercise to the&nbsp;reader).</p>
</div>
<div class="section" id="some-enchancements">
<h2><a class="toc-backref" href="#id9">Some&nbsp;enchancements</a></h2>
<p>Instead of displaying <tt class="docutils literal"><span class="pre">&lt;Cell&gt;-&lt;/Cell&gt;</span></tt> (or <tt class="docutils literal">&lt;/Cell&gt;</tt>) when the page loads, I propose to define a
cell with an embedded spinner,&nbsp;like</p>
<div class="highlight"><pre><span class="kr">const</span> <span class="nx">loadingCell</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">width</span><span class="o">=</span><span class="s2">&quot;16&quot;</span> <span class="nx">height</span><span class="o">=</span><span class="s2">&quot;16&quot;</span> <span class="nx">alt</span><span class="o">=</span><span class="s2">&quot;star&quot;</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="err">/Cell&gt;</span>
</pre></div>
<p>and return this&nbsp;instead.</p>
<p>Also, if your <span class="caps">REST</span> <span class="caps">API</span> returns too fast and you&#8217;d like to see what would happen if the server request took too long to return, you could
change fetch like&nbsp;this</p>
<div class="highlight"><pre><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://swapi.co/api/people/?format=json&amp;page=&#39;</span><span class="o">+</span><span class="nx">page</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">]</span> <span class="o">=</span> <span class="nx">j</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">];</span>
        <span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">forceUpdate</span><span class="p">();</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
<p>to add a 1 second&nbsp;delay.</p>
</div>
<div class="section" id="conslusion">
<h2><a class="toc-backref" href="#id10">Conslusion</a></h2>
<p>The above is a just a proof of concept of using FixedDataTable with asynchronously loaded server-side data.
This of course could be used for small projects (I am already using it for an internal project) but I recommend
using the <a class="reference external" href="http://spapas.github.io/2015/07/02/comprehensive-react-flux-tutorial-2/">flux architecture</a> for more complex projects. What this more or
less means is that a store component
should be developed that will actually keep the data for each row, and a <tt class="docutils literal">fetchCompleted</tt> action should be
dispatched when the <tt class="docutils literal">fetch</tt> is finished instead of calling <tt class="docutils literal">forceUpdate</tt> directly.</p>
</div>
</div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        Serafeim Papastefanos
    </span>
  </span>
<time datetime="2015-12-22T15:20:00+02:00" pubdate>Τρι 22 Δεκέμβριος 2015</time>  <span class="categories">
    <a class='category' href='http://spapas.github.io/category/javascript.html'>javascript</a>
  </span>
  <span class="categories">
    <a class="category" href="http://spapas.github.io/tag/javascript.html">javascript</a>,    <a class="category" href="http://spapas.github.io/tag/react.html">react</a>,    <a class="category" href="http://spapas.github.io/tag/fixed-data-tables.html">fixed-data-tables</a>,    <a class="category" href="http://spapas.github.io/tag/fixeddatatable.html">FixedDataTable</a>  </span>
</p><div class="sharing">
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://spapas.github.io/2015/12/22/ajax-with-react-fixed-data-table/" data-via="" data-counturl="http://spapas.github.io/2015/12/22/ajax-with-react-fixed-data-table/" >Tweet</a>
</div>    </footer>
  </article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
  </section>
</div>
<aside class="sidebar">
  <section>
  <br />
  <a href='/feeds/all.atom.xml'>Atom</a> 
  |
  <a href='/feeds/all.rss.xml'>RSS</a> 
  </section>
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="http://spapas.github.io/2016/03/31/spring-boot-settings/">Configuring Spring Boot</a>
      </li>
      <li class="post">
          <a href="http://spapas.github.io/2016/03/02/react-redux-tutorial/">A comprehensive react-redux tutorial</a>
      </li>
      <li class="post">
          <a href="http://spapas.github.io/2015/12/22/ajax-with-react-fixed-data-table/">Ajax data with Fixed Data Table for React</a>
      </li>
      <li class="post">
          <a href="http://spapas.github.io/2015/11/27/pdf-in-django/">PDFs in Django: The essential guide</a>
      </li>
      <li class="post">
          <a href="http://spapas.github.io/2015/11/16/using-browserify-es6/">Improve your client-side-javascript workflow more by using ES6</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="http://spapas.github.io/category/css.html">css</a></li>
        <li><a href="http://spapas.github.io/category/django.html">django</a></li>
        <li><a href="http://spapas.github.io/category/flask.html">flask</a></li>
        <li><a href="http://spapas.github.io/category/git.html">git</a></li>
        <li><a href="http://spapas.github.io/category/javascript.html">javascript</a></li>
        <li><a href="http://spapas.github.io/category/pelican.html">pelican</a></li>
        <li><a href="http://spapas.github.io/category/python.html">python</a></li>
        <li><a href="http://spapas.github.io/category/spring.html">spring</a></li>
        <li><a href="http://spapas.github.io/category/wagtail.html">wagtail</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="http://spapas.github.io/tag/pelican.html">pelican</a>,    <a href="http://spapas.github.io/tag/tasks.html">tasks</a>,    <a href="http://spapas.github.io/tag/django-rest-framework.html">django-rest-framework</a>,    <a href="http://spapas.github.io/tag/less.html">less</a>,    <a href="http://spapas.github.io/tag/spring.html">spring</a>,    <a href="http://spapas.github.io/tag/react-redux.html">react-redux</a>,    <a href="http://spapas.github.io/tag/rest.html">rest</a>,    <a href="http://spapas.github.io/tag/babelify.html">babelify</a>,    <a href="http://spapas.github.io/tag/google.html">google</a>,    <a href="http://spapas.github.io/tag/design.html">design</a>,    <a href="http://spapas.github.io/tag/scheduling.html">scheduling</a>,    <a href="http://spapas.github.io/tag/ldap.html">ldap</a>,    <a href="http://spapas.github.io/tag/auditing.html">auditing</a>,    <a href="http://spapas.github.io/tag/npm.html">npm</a>,    <a href="http://spapas.github.io/tag/tutorial.html">tutorial</a>,    <a href="http://spapas.github.io/tag/static-html.html">static-html</a>,    <a href="http://spapas.github.io/tag/generic.html">generic</a>,    <a href="http://spapas.github.io/tag/tables.html">tables</a>,    <a href="http://spapas.github.io/tag/reportlab.html">reportlab</a>,    <a href="http://spapas.github.io/tag/git.html">git</a>,    <a href="http://spapas.github.io/tag/uglify.html">uglify</a>,    <a href="http://spapas.github.io/tag/rq.html">rq</a>,    <a href="http://spapas.github.io/tag/react-router.html">react-router</a>,    <a href="http://spapas.github.io/tag/django-rq.html">django-rq</a>,    <a href="http://spapas.github.io/tag/babel.html">babel</a>,    <a href="http://spapas.github.io/tag/nodejs.html">node.js</a>,    <a href="http://spapas.github.io/tag/redis.html">redis</a>,    <a href="http://spapas.github.io/tag/heroku.html">heroku</a>,    <a href="http://spapas.github.io/tag/fixed-data-tables.html">fixed-data-tables</a>,    <a href="http://spapas.github.io/tag/properties.html">properties</a>,    <a href="http://spapas.github.io/tag/forms.html">forms</a>,    <a href="http://spapas.github.io/tag/yaml.html">yaml</a>,    <a href="http://spapas.github.io/tag/github-pages.html">github-pages</a>,    <a href="http://spapas.github.io/tag/404.html">404</a>,    <a href="http://spapas.github.io/tag/xhtml2pdf.html">xhtml2pdf</a>,    <a href="http://spapas.github.io/tag/watchify.html">watchify</a>,    <a href="http://spapas.github.io/tag/deploy.html">deploy</a>,    <a href="http://spapas.github.io/tag/gmail.html">gmail</a>,    <a href="http://spapas.github.io/tag/spring-security.html">spring-security</a>,    <a href="http://spapas.github.io/tag/css.html">css</a>,    <a href="http://spapas.github.io/tag/authentication.html">authentication</a>,    <a href="http://spapas.github.io/tag/node.html">node</a>,    <a href="http://spapas.github.io/tag/initd.html">init.d</a>,    <a href="http://spapas.github.io/tag/jobs.html">jobs</a>,    <a href="http://spapas.github.io/tag/redux-form.html">redux-form</a>,    <a href="http://spapas.github.io/tag/redux-thunk.html">redux-thunk</a>,    <a href="http://spapas.github.io/tag/es6.html">es6</a>,    <a href="http://spapas.github.io/tag/python.html">python</a>,    <a href="http://spapas.github.io/tag/mongodb.html">mongodb</a>,    <a href="http://spapas.github.io/tag/javascript.html">javascript</a>,    <a href="http://spapas.github.io/tag/wagtail.html">wagtail</a>,    <a href="http://spapas.github.io/tag/introduction.html">introduction</a>,    <a href="http://spapas.github.io/tag/react.html">react</a>,    <a href="http://spapas.github.io/tag/class-based-views.html">class-based-views</a>,    <a href="http://spapas.github.io/tag/spring-boot.html">spring-boot</a>,    <a href="http://spapas.github.io/tag/boilerplate.html">boilerplate</a>,    <a href="http://spapas.github.io/tag/pdf.html">pdf</a>,    <a href="http://spapas.github.io/tag/rst.html">rst</a>,    <a href="http://spapas.github.io/tag/java.html">java</a>,    <a href="http://spapas.github.io/tag/cbv.html">cbv</a>,    <a href="http://spapas.github.io/tag/configuration.html">configuration</a>,    <a href="http://spapas.github.io/tag/browserify.html">browserify</a>,    <a href="http://spapas.github.io/tag/react-router-redux.html">react-router-redux</a>,    <a href="http://spapas.github.io/tag/branching.html">branching</a>,    <a href="http://spapas.github.io/tag/github.html">github</a>,    <a href="http://spapas.github.io/tag/pusher.html">pusher</a>,    <a href="http://spapas.github.io/tag/settings.html">settings</a>,    <a href="http://spapas.github.io/tag/windows.html">windows</a>,    <a href="http://spapas.github.io/tag/ajax.html">ajax</a>,    <a href="http://spapas.github.io/tag/profiles.html">profiles</a>,    <a href="http://spapas.github.io/tag/django.html">django</a>,    <a href="http://spapas.github.io/tag/flux.html">flux</a>,    <a href="http://spapas.github.io/tag/history.html">history</a>,    <a href="http://spapas.github.io/tag/fixeddatatable.html">FixedDataTable</a>,    <a href="http://spapas.github.io/tag/githubio.html">github.io</a>,    <a href="http://spapas.github.io/tag/error.html">error</a>,    <a href="http://spapas.github.io/tag/debug.html">debug</a>,    <a href="http://spapas.github.io/tag/asynchronous.html">asynchronous</a>,    <a href="http://spapas.github.io/tag/security.html">security</a>,    <a href="http://spapas.github.io/tag/redux.html">redux</a>,    <a href="http://spapas.github.io/tag/react-notification.html">react-notification</a>,    <a href="http://spapas.github.io/tag/flask.html">flask</a>,    <a href="http://spapas.github.io/tag/boostrap-material-design.html">boostrap-material-design</a>  </section>



</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2013&ndash;2016  Serafeim Papastefanos &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="http://spapas.github.io/theme/js/modernizr-2.0.js"></script>
  <script src="http://spapas.github.io/theme/js/ender.js"></script>
  <script src="http://spapas.github.io/theme/js/octopress.js" type="text/javascript"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44750952-1', 'auto');

    ga('send', 'pageview');
    </script>
  <script type="text/javascript">
    var disqus_shortname = 'spapas-github-io';
    var disqus_identifier = '/2015/12/22/ajax-with-react-fixed-data-table/';
    var disqus_url = 'http://spapas.github.io/2015/12/22/ajax-with-react-fixed-data-table/';
    var disqus_title = 'Ajax data with Fixed Data Table for&nbsp;React';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
</body>
</html>
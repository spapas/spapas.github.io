<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta name="google-site-verification" content="5_8DTmIiEq4gFvNAfxAD6TsGOgrMAjp8lQFQvfA6zZc" />
    <title>/var/</title>
    <meta name="author" content="Serafeim Papastefanos">


    
<style type="text/css">
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: var(--jp-cell-editor-active-background) }
.highlight { background: var(--jp-cell-editor-background); color: var(--jp-mirror-editor-variable-color) }
.highlight .c { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment */
.highlight .err { color: var(--jp-mirror-editor-error-color) } /* Error */
.highlight .k { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword */
.highlight .o { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator */
.highlight .p { color: var(--jp-mirror-editor-punctuation-color) } /* Punctuation */
.highlight .ch { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Multiline */
.highlight .cp { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Preproc */
.highlight .cpf { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Single */
.highlight .cs { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Special */
.highlight .kc { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Type */
.highlight .m { color: var(--jp-mirror-editor-number-color) } /* Literal.Number */
.highlight .s { color: var(--jp-mirror-editor-string-color) } /* Literal.String */
.highlight .ow { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator.Word */
.highlight .pm { color: var(--jp-mirror-editor-punctuation-color) } /* Punctuation.Marker */
.highlight .w { color: var(--jp-mirror-editor-variable-color) } /* Text.Whitespace */
.highlight .mb { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Bin */
.highlight .mf { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Float */
.highlight .mh { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Hex */
.highlight .mi { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer */
.highlight .mo { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Oct */
.highlight .sa { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Affix */
.highlight .sb { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Backtick */
.highlight .sc { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Char */
.highlight .dl { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Delimiter */
.highlight .sd { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Doc */
.highlight .s2 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Double */
.highlight .se { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Escape */
.highlight .sh { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Heredoc */
.highlight .si { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Interpol */
.highlight .sx { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Other */
.highlight .sr { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Regex */
.highlight .s1 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Single */
.highlight .ss { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Symbol */
.highlight .il { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer.Long */
</style>

<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
div.entry-content {
  overflow: visible;
  padding: 8px;
}
.input_area {
  padding: 0.2em;
}

a.heading-anchor {
 white-space: normal;
}

.rendered_html
code {
 font-size: .8em;
}

pre.ipynb {
  color: black;
  background: #f7f7f7;
  border: none;
  box-shadow: none;
  margin-bottom: 0;
  padding: 0;
  margin: 0px;
  font-size: 13px;
}

/* remove the prompt div from text cells */
div.text_cell .prompt {
    display: none;
}

/* remove horizontal padding from text cells, */
/* so it aligns with outer body text */
div.text_cell_render {
    padding: 0.5em 0em;
}

img.anim_icon{padding:0; border:0; vertical-align:middle; -webkit-box-shadow:none; -box-shadow:none}

div.collapseheader {
    width=100%;
    background-color:#d3d3d3;
    padding: 2px;
    cursor: pointer;
    font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
}
</style>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true,
        displayMath: [['$$','$$'], ["\\[","\\]"]]
    }
});
</script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<script type="text/javascript">
jQuery(document).ready(function($) {
    $("div.collapseheader").click(function () {
    $header = $(this).children("span").first();
    $codearea = $(this).children(".input_area");
    console.log($(this).children());
    $codearea.slideToggle(500, function () {
        $header.text(function () {
            return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
        });
    });
});
});
</script>




    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="https://www.spapas.net/favicon.png" rel="icon">

    <link href="https://www.spapas.net/theme/css/main.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://www.spapas.net/theme/css/extra_style.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://fonts.googleapis.com/css?family=Fira+Mono|Fira+Sans:400,700&amp;subset=greek" rel="stylesheet">

<style>
#gHPzseYvFrhZ123 {
  padding: 5px !important;
  display: block;
  margin-bottom: 10px !important;
  background: #900;
  color: #fff;
  border-radius: 5px;
  font-size: 1.0rem !important;
}
</style>


  <script>
    
      
  </script>

    <script data-ad-client="ca-pub-7673322832689008" async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
      onerror="adBlockFunction();"></script>
  </head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="https://www.spapas.net/">/var/</a></h1>
    <h2>Various programming stuff</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li >
        <a href="https://www.spapas.net/category/ai.html">Ai</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/android.html">Android</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/clojure.html">Clojure</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/css.html">Css</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/django.html">Django</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/elixir.html">Elixir</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/flask.html">Flask</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/gaming.html">Gaming</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/git.html">Git</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/html.html">Html</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/javascript.html">Javascript</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/networking.html">Networking</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/pelican.html">Pelican</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/postgresql.html">Postgresql</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/python.html">Python</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/spring.html">Spring</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/unix.html">Unix</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/wagtail.html">Wagtail</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
    <div id="gHPzseYvFrhZ123">
      Hello! If you are using an ad blocker but find something useful here 
      and want to support me please consider disabling your ad blocker for this site. 
      <br />
      <br />
      Thank you,<br />
      Serafeim
      
    </div>
<div class="blog-index">
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2015/10/05/django-dynamic-tables-similar-models/">Django dynamic tables and filters for similar models</a>
      </h1>
    <p class="meta">
<time datetime="2015-10-05T14:20:00+03:00" pubdate>Mon 05 October 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title"><a class="reference internal" href="#top">Contents</a></p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="toc-entry-1">Introduction</a></li>
<li><a class="reference internal" href="#the-problem-we-ll-solve" id="toc-entry-2">The problem we&#8217;ll&nbsp;solve</a></li>
<li><a class="reference internal" href="#adding-the-dynamic-table" id="toc-entry-3">Adding the dynamic&nbsp;table</a></li>
<li><a class="reference internal" href="#creating-a-dynamic-form-for-filtering" id="toc-entry-4">Creating a dynamic form for&nbsp;filtering</a></li>
<li><a class="reference internal" href="#creating-the-dynamic-cbv" id="toc-entry-5">Creating the dynamic <span class="caps">CBV</span></a></li>
<li><a class="reference internal" href="#conclusion" id="toc-entry-6">Conclusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#toc-entry-1">Introduction</a></h2>
<p>One of my favorite django apps is <a class="reference external" href="https://github.com/bradleyayers/django-tables2">django-tables2</a>: It allows you to
easily create pagination and sorting enabled <span class="caps">HTML</span> tables to represent
your model data using the usual djangonic technique (similar to how
you <a class="reference external" href="https://docs.djangoproject.com/en/1.8/topics/forms/modelforms/#modelform">create ModelForms</a>). I use it to almost all my projects to
represent the data, along with <a class="reference external" href="https://github.com/alex/django-filter">django-filter</a> to create forms
to filter my model data. I&#8217;ve written <a class="reference external" href="http://stackoverflow.com/questions/13611741/django-tables-column-filtering/15129259#15129259">a nice <span class="caps">SO</span> answer</a> with
instructions on how to use django-filter along with django-tables2.
This article will describe a technique that allows you to generate
tables and filters for your models in the most <span class="caps">DRY</span>&nbsp;way!</p>
</div>
<div class="section" id="the-problem-we-ll-solve">
<h2><a class="toc-backref" href="#toc-entry-2">The problem we&#8217;ll&nbsp;solve</a></h2>
<p>The main tool django-tables2 offers is a template tag called <tt class="docutils literal">render_table</tt>
that gets an instance of a subclass of <tt class="docutils literal">django_tables2.Table</tt>
which contains a description of the table (columns, style etc) along
with a queryset with the table&#8217;s data and outputs it to the page. A nice
extra feature of render_table is that you could pass it just a simple
django queryset and it will output it without the need to create the
custom Table class. So you can do something like {% render_table User.objects.all() %}
and get a quick output of your Users&nbsp;table.</p>
<p>In one of my projects I had three models that
were used for keeping a different type of business log in the database (for auditing reasons)
and was using the above feature to display these logs to the administrators, just by
creating a very simple <tt class="docutils literal">ListView</tt> (a different one for each Log type) and using the
<tt class="docutils literal">render_table</tt> to display the data. So I&#8217;d created three views limilar to&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AuditLogListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">AuditLog</span>
  <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;logs&#39;</span>
</pre></div>
<p>which all used a single template that contained a line <tt class="docutils literal">{% render_table logs %}</tt> to display
the table (the <tt class="docutils literal">logs</tt> context variable contains the list/queryset of <tt class="docutils literal">AuditLog</tt> s)
so <tt class="docutils literal">render_table</tt> will just output that list in a page. Each view of course had a different
<tt class="docutils literal">model</tt> attribute.</p>
<p>This was a nice <span class="caps">DRY</span> (but quick and dirty solution) that soon was not enough to fulfill the
needs of the administrators since they neeeded to have default sorting, filtering, hide
the primary key-id column etc. The obvious solution for that would be to just create three different
<tt class="docutils literal">Table</tt> subclasses that
would more or less have the same options with only their <tt class="docutils literal">model</tt> attributte different. I didn&#8217;t
like this solution that much since it seemed non-<span class="caps">DRY</span> to me and I would instead prefer to
create a generic <tt class="docutils literal">Table</tt> (that wouldn&#8217;t have a <tt class="docutils literal">model</tt> attributte) and would just output
its data with the correct options &#8212; so instead of three <tt class="docutils literal">Table</tt> classes I&#8217;d like to create
just a single one with common options that would display its data (what <tt class="docutils literal">render_table</tt> does).</p>
<p>Unfortunately, I couldn&#8217;t find a solution to this, since when I ommited the <tt class="docutils literal">model</tt> attribute
from the <tt class="docutils literal">Table</tt> subclass nothing was outputed (there is no way to define fields to
display in a <tt class="docutils literal">Table</tt> without also defining the model). An obvious (and <span class="caps">DRY</span>) resolution would be to create
a base <tt class="docutils literal">Table</tt> subclass that would define the needed options and create three subclasses
that would inherit from this class and override only the <tt class="docutils literal">model</tt> attribute. This unfortunately was not
possible becase <a class="reference external" href="http://stackoverflow.com/questions/16696066/django-tables2-dynamically-adding-columns-to-table-not-adding-attrs-to-table/16741665#16741665">inheritance does not work well with django-tables2</a>!</p>
<p>Furthermore, there&#8217;s the extra hurdle of adding filtering to the above tables so that
the admin&#8217;s would be able to quickly find a log message - if we wanted to use django-filter
we&#8217;d need again to create three different subclasses (one for each log model type)
of <tt class="docutils literal">django_filter.FilterSet</tt> since
django-filter requires you to define the model for which the filter will be&nbsp;created!</p>
<p>One cool way to resolve such problems is to create your classes dynamically when
you need &#8216;em. I&#8217;ve already described a way to <a class="reference external" href="https://www.spapas.net/2013/12/24/django-dynamic-forms/">dynamically create forms in django
in a previous post</a>. Below, I&#8217;ll describe
a similar technique which can be used to create both dynamic tables and filters. Using
this methodology, you&#8217;ll be able to add a new <span class="caps">CBV</span> that displays a table with
pagination, order and filtering for your model by just inheriting from a base&nbsp;class!</p>
</div>
<div class="section" id="adding-the-dynamic-table">
<h2><a class="toc-backref" href="#toc-entry-3">Adding the dynamic&nbsp;table</a></h2>
<p>To create the <span class="caps">DRY</span> <span class="caps">CBV</span> we&#8217;ll use the <a class="reference external" href="http://django-tables2.readthedocs.org/en/latest/pages/generic-mixins.html?highlight=singletableview">SingleTableView</a> (<tt class="docutils literal">django_tables2.SingleTableView</tt>)
as a base and override its <tt class="docutils literal">get_table_class</tt> method to dynamically create our table class
using <tt class="docutils literal">type</tt>.
Here&#8217;s how it could be done using a mixin (notice that this mixin should be used in a
<tt class="docutils literal">SingleTableView</tt> to override its <tt class="docutils literal">get_table_class</tt> method):</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AddTableMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">):</span>
  <span class="n">table_pagination</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;per_page&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">}</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">get_table_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">def</span><span class="w"> </span><span class="nf">get_table_column</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
          <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">django</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">):</span>
              <span class="k">return</span> <span class="n">tables</span><span class="o">.</span><span class="n">DateColumn</span><span class="p">(</span><span class="s2">&quot;d/m/Y H:i&quot;</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="k">return</span> <span class="n">tables</span><span class="o">.</span><span class="n">Column</span><span class="p">()</span>

      <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
          <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">get_table_column</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">for</span>
          <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;id&#39;</span>
      <span class="p">)</span>
      <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Meta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Meta&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="s2">&quot;table&quot;</span><span class="p">},</span> <span class="s2">&quot;order_by&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;-created_on&quot;</span><span class="p">,</span> <span class="p">)</span> <span class="p">}</span> <span class="p">)</span>
      <span class="n">klass</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;DTable&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">Table</span><span class="p">,</span> <span class="p">),</span> <span class="n">attrs</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">klass</span>
</pre></div>
<p>Let&#8217;s try to explain the <tt class="docutils literal">get_table_class</tt> method: First of all, we&#8217;ve defined a local <tt class="docutils literal">get_table_column</tt>
function that will return a django-tables2 column depending on the field of the model. For example, in
our case I wanted to use a <tt class="docutils literal">django_tables2.DateColumn</tt> with a specific format when a <tt class="docutils literal">DateTimeField</tt> is
encountered and for all other model fields just use the stock <tt class="docutils literal">Column</tt>. You may add other overrides here,
for example add a <tt class="docutils literal">TemplateColumn</tt> to properly render some&nbsp;data.</p>
<p>After that, we create a dictionary with all the attributes of the dynamic table model.
The <tt class="docutils literal">self.model</tt> field will contain
the model Class of this <tt class="docutils literal">SingleTableView</tt>, so using its <tt class="docutils literal">_meta.fields</tt> will return
the defined fields of that model. As we can see, I just use
a generator expression to create a tuple with the name of the field and its column type (using <tt class="docutils literal">get_table_column</tt>)
excluding the &#8216;id&#8217; column. So, attrs will be a dictionary of field names and column types. Here you may
also exclude other columns you don&#8217;t want to&nbsp;display.</p>
<p>The <tt class="docutils literal">Meta</tt> class of this table is crated using <tt class="docutils literal">type</tt> which creates a parentless class by
defining all its attributes in a dictionary
and set it as the <tt class="docutils literal">Meta</tt> key in the previously defined <tt class="docutils literal">attrs</tt> dict.
Finally, we create the actual <tt class="docutils literal">django_tables2.Table</tt> subclass by
inheriting from it and passing the <tt class="docutils literal">attrs</tt> dict. We&#8217;ll see an example of what <tt class="docutils literal">get_table_class</tt> returns&nbsp;later.</p>
</div>
<div class="section" id="creating-a-dynamic-form-for-filtering">
<h2><a class="toc-backref" href="#toc-entry-4">Creating a dynamic form for&nbsp;filtering</a></h2>
<p>Let&#8217;s create another mixin that could be used to create a dynamic <tt class="docutils literal">django.Form</tt> subclass to the <span class="caps">CBV</span>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AddFormMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">):</span>
  <span class="k">def</span><span class="w"> </span><span class="nf">define_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">def</span><span class="w"> </span><span class="nf">get_form_field_type</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
          <span class="k">return</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

      <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
          <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">get_form_field_type</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">for</span>
          <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_fields</span><span class="p">()</span> <span class="p">)</span>

      <span class="n">klass</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;DForm&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">,</span> <span class="p">),</span> <span class="n">attrs</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">klass</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="n">form_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_form</span><span class="p">()</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">form</span> <span class="o">=</span> <span class="n">form_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">form</span> <span class="o">=</span> <span class="n">form_class</span><span class="p">()</span>

      <span class="n">qs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AddFormMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
          <span class="n">q_objects</span> <span class="o">=</span> <span class="n">Q</span><span class="p">()</span>
          <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_fields</span><span class="p">():</span>
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                  <span class="n">q_objects</span> <span class="o">&amp;=</span> <span class="n">Q</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">f</span><span class="o">+</span><span class="s1">&#39;__icontains&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="n">f</span><span class="p">]})</span>

          <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">q_objects</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">qs</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
      <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AddFormMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="n">ctx</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span>
      <span class="k">return</span> <span class="n">ctx</span>
</pre></div>
<p>The first method that will be called is the <tt class="docutils literal">get_queryset</tt> method that will generate the dynamic form
using <tt class="docutils literal">define_form</tt>. This method has a <tt class="docutils literal">get_form_field_type</tt> local function (similar to get_table_fields)
that can be used to override the types of the fields (or just fallback to a normal <tt class="docutils literal">CharField</tt>) and
then create the <tt class="docutils literal">attrs</tt> dictionary and <tt class="docutils literal">forms.Form</tt> subclass in a similar way as the <tt class="docutils literal">Table</tt> subclass. Here,
we don&#8217;t want to create a filter form from all fields of the model as we did on table, so instead
we&#8217;ll use a <tt class="docutils literal">get_form_fields</tt> (don&#8217;t confuse it with the local <tt class="docutils literal">get_form_field_type</tt>)
method that returns the name of the fields that we want to
use in the filtering form and needs to be defined in each <span class="caps">CBV</span> &#8212; the <tt class="docutils literal">get_form_fields</tt> must
be defined in classes that use this&nbsp;mixin.</p>
<p>After defining the form, we need to check if there&#8217;s anything to the <tt class="docutils literal"><span class="caps">GET</span></tt> dict &#8212; since we are just filtering the
queryset we&#8217;d need to submit the form with a <tt class="docutils literal"><span class="caps">GET</span></tt> (and not a <tt class="docutils literal"><span class="caps">POST</span></tt>). We see that if we have
data to our <tt class="docutils literal">request.<span class="caps">GET</span></tt> dictionary we&#8217;ll instantiate the form using this data (or else we&#8217;ll just
create an empty form). To do the actual filtering, we check if the form is valid and create a <tt class="docutils literal">django.models.db.Q</tt> object
that is used to combine (by <span class="caps">AND</span>) the conditions. Each of the individual Q objects that will be combined
(<tt class="docutils literal">&amp;=</tt>)
to create the complete one will be created using the line <tt class="docutils literal"><span class="pre">Q(**{f+'__icontains':self.form.cleaned_data.get(f,</span> <span class="pre">'')})</span></tt>
(where f will be the name of the field) which is a nice trick: It will create a
dictionary of the form <tt class="docutils literal">{'action__icontains': 'test text'}</tt> and then pass this as a keyword
argument to the Q (using the <tt class="docutils literal">**</tt> mechanism), so <tt class="docutils literal">Q</tt> will be called like
<tt class="docutils literal"><span class="pre">Q(action__icontains='test</span> text')</tt> - this (using the <tt class="docutils literal"><span class="pre">**{key:val}</span></tt> trick) is
the only way to pass dynamic kwargs to a&nbsp;function!</p>
<p>Finally, the queryset will be filtered using the combined <tt class="docutils literal">Q</tt> object we just&nbsp;described.</p>
</div>
<div class="section" id="creating-the-dynamic-cbv">
<h2><a class="toc-backref" href="#toc-entry-5">Creating the dynamic <span class="caps">CBV</span></a></h2>
<p>Using the above mixins, we can easily create a dynamic <span class="caps">CBV</span> with a table and a filter form only by inheriting
from the mixins
and <tt class="docutils literal">SingleTableView</tt> and defining the <tt class="docutils literal">get_form_fields</tt> method:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AuditLogListView</span><span class="p">(</span><span class="n">AddTableMixin</span><span class="p">,</span> <span class="n">AddFormMixin</span><span class="p">,</span> <span class="n">SingleTableView</span><span class="p">):</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">AuditLog</span>
  <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;logs&#39;</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">get_form_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span><span class="s1">&#39;user__username&#39;</span><span class="p">,</span> <span class="p">)</span>
</pre></div>
<p>Let&#8217;s suppose that the <tt class="docutils literal">AuditLog</tt> is defined as&nbsp;following:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AuditLog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
  <span class="n">created_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span> <span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,)</span>
  <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,)</span>
  <span class="n">action</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,)</span>
</pre></div>
<p>Using the above <tt class="docutils literal">AuditLogListView</tt>, a dynamic table and a dynamic form will be automaticall created whenever the view is visited.
The <tt class="docutils literal">Table</tt> class will be like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DTable</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
  <span class="n">created_on</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">DateColumn</span><span class="p">(</span><span class="s2">&quot;d/m/Y H:i&quot;</span><span class="p">)</span>
  <span class="n">user</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">Column</span><span class="p">()</span>
  <span class="n">action</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">Column</span><span class="p">()</span>

  <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
      <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="s2">&quot;table&quot;</span><span class="p">}</span>
      <span class="n">order_by</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;-created_on&quot;</span><span class="p">,</span> <span class="p">)</span>
</pre></div>
<p>and the <tt class="docutils literal">Form</tt> class like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
  <span class="n">user__username</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
  <span class="n">action</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
</pre></div>
<p>An interesting thing to notice is that we can drill down to foreign keys (f.e. <tt class="docutils literal">user__username</tt>) to create more interesting filters.
Also we could add some more
methods to be overriden by the implementing class beyond
the <tt class="docutils literal">get_form_fields</tt>. For example, instead of using <tt class="docutils literal">self.model._meta.fields</tt>
to generate the fields of the table, we
could instead use a <tt class="docutils literal">get_table_fields</tt> (similar to the <tt class="docutils literal">get_form_fields</tt>)
method that would be overriden in the implementing
classes (and even drill down on foreign keys to display more data on the table using <a class="reference external" href="http://django-tables2.readthedocs.org/en/latest/pages/accessors.html">accessors</a>).</p>
<p>Or, we could also define the form field types and lookups (instead of always using <tt class="docutils literal">CharField</tt> and
<tt class="docutils literal">icontains</tt> ) in the <tt class="docutils literal">get_form_fields</tt> &#8212; similar to&nbsp;django-filter.</p>
<p>Please notice that instead of creating a django form instance for filtering, we could instead create a django-filter instance with
a similar methodology. However, I preferred to just use a normal django form because it makes the whole process more clear and removes
a level of abstraction (we just create a <tt class="docutils literal">django.Form</tt> subclass while, if we used django-filter we&#8217;d need to create
a django-filter subclass which would create a <tt class="docutils literal">django.Form</tt> subclass)!</p>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#toc-entry-6">Conclusion</a></h2>
<p>Using the above technique we can quickly create a table and filter for a number of Models that all share
the same properties in the most <span class="caps">DRY</span>. This technique of course is useful only for quick CBVs that
are more or less the same and require little customization. Another interesting thing is that instead of
creating different <tt class="docutils literal">SingleTableView</tt> s we could instead create a single <span class="caps">CBV</span> that will get the content type
of the Model to be viewed as a parameter and retrieve the model (and queryset) from the content type - so
we could have a single <span class="caps">CBV</span> for all our table/filtering views&nbsp;!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2015/09/08/more-complex-react-flux-example/">A (little more) complex react and flux example</a>
      </h1>
    <p class="meta">
<time datetime="2015-09-08T12:55:00+03:00" pubdate>Tue 08 September 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title"><a class="reference internal" href="#top">Contents</a></p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="toc-entry-1">Introduction</a></li>
<li><a class="reference internal" href="#more-about-flux-components" id="toc-entry-2">More about Flux&nbsp;components</a></li>
<li><a class="reference internal" href="#explaining-the-application-components" id="toc-entry-3">Explaining the application&nbsp;components</a></li>
<li><a class="reference internal" href="#reusable-application-components" id="toc-entry-4">Reusable application components</a><ul>
<li><a class="reference internal" href="#dropdown-react-js" id="toc-entry-5">DropDown.react.js</a></li>
<li><a class="reference internal" href="#datepicker-react-js" id="toc-entry-6">DatePicker.react.js</a></li>
<li><a class="reference internal" href="#pagingpanel-react-js" id="toc-entry-7">PagingPanel.react.js</a></li>
<li><a class="reference internal" href="#searchpanel-react-js" id="toc-entry-8">SearchPanel.react.js</a></li>
<li><a class="reference internal" href="#messagepanel" id="toc-entry-9">MessagePanel</a><ul>
<li><a class="reference internal" href="#messagepanel-react-js" id="toc-entry-10">MessagePanel.react.js</a></li>
<li><a class="reference internal" href="#messagestore-js" id="toc-entry-11">MessageStore.js</a></li>
<li><a class="reference internal" href="#messageactions" id="toc-entry-12">MessageActions</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#non-reusable-application-components" id="toc-entry-13">Non-reusable application components</a><ul>
<li><a class="reference internal" href="#booktable-react-js" id="toc-entry-14">BookTable.react.js</a></li>
<li><a class="reference internal" href="#authordialog-react-js" id="toc-entry-15">AuthorDialog.react.js</a></li>
<li><a class="reference internal" href="#authorpanel-react-js" id="toc-entry-16">AuthorPanel.react.js</a></li>
<li><a class="reference internal" href="#statpanel-react-js" id="toc-entry-17">StatPanel.react.js</a></li>
<li><a class="reference internal" href="#bookform-react-js" id="toc-entry-18">BookForm.react.js</a></li>
<li><a class="reference internal" href="#bookpanel-react-js" id="toc-entry-19">BookPanel.react.js</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-actions" id="toc-entry-20">The&nbsp;Actions</a></li>
<li><a class="reference internal" href="#the-stores" id="toc-entry-21">The Stores</a><ul>
<li><a class="reference internal" href="#messagestore-js-1" id="toc-entry-22">MessageStore.js</a></li>
<li><a class="reference internal" href="#authorstore-js" id="toc-entry-23">AuthorStore.js</a></li>
<li><a class="reference internal" href="#categorystore-js" id="toc-entry-24">CategoryStore.js</a></li>
<li><a class="reference internal" href="#bookstore-js" id="toc-entry-25">BookStore.js</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion" id="toc-entry-26">Conclusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#toc-entry-1">Introduction</a></h2>
<p>In <a class="reference external" href="https://www.spapas.net/2015/06/05/comprehensive-react-flux-tutorial/">previous</a>
<a class="reference external" href="https://www.spapas.net/2015/07/02/comprehensive-react-flux-tutorial-2/">two</a> parts of this series, we have seen
how we could implement a
not-so-simple single page application with full <span class="caps">CRUD</span> capabilities
using react only (in the <a class="reference external" href="https://www.spapas.net/2015/06/05/comprehensive-react-flux-tutorial/">first part</a> ) and then how to
change it to use the flux architecture (in the <a class="reference external" href="https://www.spapas.net/2015/07/02/comprehensive-react-flux-tutorial-2/">second part</a>).</p>
<p>In this, third, part, we will
add some more capabilities to the previous app
to prove how easy it is to create complex apps
and continue the discussion on
the Flux architecture. The source code of this project
can
be found at <a class="reference external" href="https://github.com/spapas/react-tutorial">https://github.com/spapas/react-tutorial</a> (tag name&nbsp;react-flux-complex).</p>
<p>Here&#8217;s a demo of the final&nbsp;application:</p>
<img alt="Our project" src="/images/demo2.gif" style="width: 780px;" />
<p>We can see that, when compared to the previous version this one&nbsp;has:</p>
<ul class="simple">
<li>Sorting by table&nbsp;columns</li>
<li>Pagination</li>
<li>Message for&nbsp;loading</li>
<li>Client side url updating (with&nbsp;hashes)</li>
<li>Cascading drop downs (selecting category will filter out&nbsp;subcategories)</li>
<li>Integration with jquery-ui&nbsp;datepicker</li>
<li>Add a child object&nbsp;(author)</li>
<li>Add authors with a modal dialog&nbsp;(popup)</li>
<li>Delete authors (using the &#8220;-&#8221;&nbsp;button)</li>
<li>Colored ajax result messages (green when all is ok, red with&nbsp;error)</li>
<li>A statistics panel (number of books /&nbsp;authors)</li>
</ul>
<p>In the paragraphs below, beyond the whole architecture, we&#8217;ll see
a bunch of techniques such&nbsp;as:</p>
<ul class="simple">
<li>Creating reusable flux&nbsp;components</li>
<li>Integrating react with&nbsp;jquery</li>
<li>Creating cascading&nbsp;dropdowns</li>
<li>Updating URLs with&nbsp;hashes</li>
<li>Adding pagination/sorting/querying to a table of&nbsp;results</li>
<li>Displaying pop&nbsp;ups</li>
</ul>
</div>
<div class="section" id="more-about-flux-components">
<h2><a class="toc-backref" href="#toc-entry-2">More about Flux&nbsp;components</a></h2>
<p>Before delving into the source code of the above application, I&#8217;d like to
make crystal what is the proposed way to call methods in the flux chain
and which types of components can include other types of components. Let&#8217;s
take a look at the following&nbsp;diagram:</p>
<img alt="flux dependencies" src="/images/react_flux_deps1.png" style="width: 480px;" />
<p>The arrows display the dependencies of the Flux architecture - an arrow
from X to Y means that a component of type Y could depend on an Component
of type X (of example, a store could depend on an action or another store
but not on a&nbsp;panel).</p>
<p>In more detail, we can see that in the top of the hierarchy,
having no dependencies are the
Dispatcher and the Constants. The Dispatcher is just a single component
(which actually is a singleton - only one dispatcher exists in each
single page react-flux application)
that inherits from the Facebook&#8217;s dispatcher and is imported by the
action components (since action methods defined in action components
call the <tt class="docutils literal">dispatch</tt> method of the dispatcher passing the correct
parameters) and the stores which do the real actions when an action
is dispatched, depending on the action type. The Constant components
define constant values for the action types and are used by both
the actions (to set the action types to the dispatch calls) and by
the stores to be used on the switch statement when an action is
dispatched. As an example, for BookActions we have the&nbsp;following</p>
<pre class="code literal-block">
var BookConstants = require('../constants/BookConstants')
var AppDispatcher = require('../dispatcher/AppDispatcher').AppDispatcher;

var BookActions = {
    change_book: function(book) {
        AppDispatcher.dispatch({
            actionType: BookConstants.BOOK_CHANGE,
            book: book
        });
    },
// Other book actions [...]
</pre>
<p>and for&nbsp;BookStore</p>
<pre class="code literal-block">
var $ = require('jquery');
var AppDispatcher = require('../dispatcher/AppDispatcher').AppDispatcher;
var BookConstants = require('../constants/BookConstants')

// [...]

BookStore.dispatchToken = AppDispatcher.register(function(action) {
    switch(action.actionType) {
        case BookConstants.BOOK_EDIT:
            _editBook(action.book);
        break;
// [...] other switch branches
</pre>
<p>An interesting thing to see is that the actions depend only on the Dispatcher
and on the Constants, while the stores also depend on actions (not only
from the same action types as the store type, for example AuthorStore depends
on both AuthorActions and MessageActions) and on <em>other</em> stores. This means
that the actions should be a &#8220;clean&#8221; component: Just declare your action methods
whose only purpose is to pass the action type along with the required parameters
to the&nbsp;dispatcher.</p>
<p>On the other hand, the stores are depending on both actions and other stores.
The action dependency is because sometimes when something is done in a store
we need to notify another store to do something as a response to that. For
example, in our case, when a book is updated we need to notify the message
store to show the &#8220;Book updated ok&#8221; message. This preferrably should not be done by
directly calling the corresponding method on the message store but instead
by calling the corresponding action of MessageAction and passing the correct
parameters (actually, the method that updates the message in MessageStore
should be a private method that is called <em>only</em> through the&nbsp;action).</p>
<p>One thing to notice here is that you <em>cannot</em> call (and dispatch) an action in the
same call stack (meaning it is directly called) as of another dispatch or you&#8217;ll get a
<tt class="docutils literal">Invariant Violation: <span class="pre">Dispatch.dispatch(...):</span> Cannot dispatch in the middle of a dispatch.</tt>
error in your javascript console. Let&#8217;s see an example of what this means and how
to avoid it because its a common error. Let&#8217;s say that we have the following
code to a&nbsp;store:</p>
<pre class="code literal-block">
AppDispatcher.register(function(action) {
    switch(action.actionType) {
        case Constants.TEST_ERR:
            TestActions.action1();
        break;
        case Constants.TEST_OK1:
            setTimeout(function() {
                TestActions.action1();
            }, 0);

        break;
        case Constants.TEST_OK2:
            $.get('/get/', function() {
                TestActions.action1();
            });

        break;
    }
    return true;
});
</pre>
<p>Here, the <tt class="docutils literal">TEST_ERR</tt> branch will throw an error because the <tt class="docutils literal">TestAction.action1</tt> is <em>in the same call stack</em>
as this dispatch! On the other hand, both <tt class="docutils literal">TEST_OK1</tt> and <tt class="docutils literal">TEST_OK2</tt> will work: <tt class="docutils literal">TEST_OK2</tt> is the most
usual, since most of the times we want to call an action as a result of an ajax call - however, sometimes we
want to call an action without any ajax &#8212; in this case we use the setTimeout (with a timeout of 0 ms) in
order to move the call to <tt class="docutils literal">TestActions.action1()</tt> to a different call&nbsp;stack.</p>
<p>Now, as I mentioned before, there&#8217;s also a <em>different-store</em> dependency on stores.
This dependency is needed because some stores may offer public methods for other stores to use
(methods that don&#8217;t actually need to be dispatched through the dispatcher) and
for the <tt class="docutils literal">waitFor</tt> method , in case there are two different
stores that respond to a single action and want to have one store executing
its dispatch method before the other.
(the waitFor method takes the dispatchToken, which is the result of <tt class="docutils literal">Dispatcher.register</tt> of
a different store as a parameter in order to wait for that action to&nbsp;finish).</p>
<p>Finally, the Panels depend on both actions (to initiate an action as a response
to user input) and stores (to read the state of the each required store when it
is changed). Of course, not all panels actually depend on stores, since as we
already know the state of a React app should be kept as high in the hierarchy
as possible, so a central component will get the state of a store and pass the
required state attributes to its children through parameters. On the other
hand, every component that responds to user input will have to import
am action object and call the corresponding method &#8212; we should never pass
callbacks from a parent to a child component as a parameter anymore <em>unless</em>
we want to make the component reusable (more on this&nbsp;later).</p>
<p>Finally, as expected, because of their hierarchy the compoents depend on their
child components (a BookTable depends on a BookTableRow&nbsp;etc).</p>
</div>
<div class="section" id="explaining-the-application-components">
<h2><a class="toc-backref" href="#toc-entry-3">Explaining the application&nbsp;components</a></h2>
<p>There are a lot of components that are needed for
the above application. A bird&#8217;s eye view of the components
and their hierarchies can be seen on the following&nbsp;figure:</p>
<img alt="Our components" src="/images/complex_react_components.png" style="width: 780px;" />
<p>We will first explain a bit the components that could be easily reused
by other applications and after that the components that are specifically
implemented for our book/author single page&nbsp;application.</p>
</div>
<div class="section" id="reusable-application-components">
<h2><a class="toc-backref" href="#toc-entry-4">Reusable application&nbsp;components</a></h2>
<p>We can see that beyond the specific components (<tt class="docutils literal">BookPanel</tt>, <tt class="docutils literal">BookTable</tt> etc)
there&#8217;s a bunch of more general components (<tt class="docutils literal">DropDown</tt>, <tt class="docutils literal">DatePicker</tt>, <tt class="docutils literal">PagingPanel</tt>, <tt class="docutils literal">SearchPanel</tt>,
<tt class="docutils literal">MessagePanel</tt>) that have names like they could be used by other applications (for example every application
that wants to implement a DropDown could use our component) and not only by the
Book-Author application. Let&#8217;s take a quick look at these components and if they
are actually&nbsp;reusable:</p>
<div class="section" id="dropdown-react-js">
<h3><a class="toc-backref" href="#toc-entry-5">DropDown.react.js</a></h3>
<pre class="code literal-block">
var React = require('react');

var DropDown = React.createClass({
    render: function() {
        var options = [];
        options.push(&lt;option key='-1' value='' &gt;---&lt;/option&gt;);
        if(this.props.options) {
            this.props.options.forEach(function(option) {
                options.push(&lt;option key={option.id} value={option.id}&gt;{option.name}&lt;/option&gt;);
            });
        }

        return(
            &lt;select ref='dropdown' value={this.props.value?this.props.value:''} onChange={this.onFormChange} &gt;
                {options}
            &lt;/select&gt;
        );
    },
    onFormChange: function() {
        var val = React.findDOMNode(this.refs.dropdown).value
        this.props.dropDownValueChanged(val);
    }
});

module.exports.DropDown = DropDown;
</pre>
<p>What we see here is that this component does not actually have a local state and will need three&nbsp;parameters:</p>
<ul class="simple">
<li>the list of options (<tt class="docutils literal">props.options</tt>)</li>
<li>the curently selected option (<tt class="docutils literal">props.value</tt>)</li>
<li>a callback to be called when the dropdown is changed (<tt class="docutils literal">props.dropDownValueChanged</tt>)</li>
</ul>
<p>By passing the above three parameters this dropdown component can be reused whenever a dropdown is needed!
As we can see here we need to pass a callback function to this dropdown and call the corresponding action
directly. This is important to have a reusable component: The component that includes each dropdown decides
which should be the action on the dropdown value change. Another option if we wanted to avoid callbacks
would be to pass an identifier as a property for each dropdown and the dropdown would call a generic
dropdown action and passing this identifier &#8212; however I think that actually passing the callback is
easier and makes the code much more&nbsp;readable.</p>
</div>
<div class="section" id="datepicker-react-js">
<h3><a class="toc-backref" href="#toc-entry-6">DatePicker.react.js</a></h3>
<p>The datepicker component has more or less the same structure as with the dropdown: It needs one parameter
for its current value (<tt class="docutils literal">props.value</tt>) and another as the callback to the function when the date is
changed (once again this is required to have a reusable&nbsp;component):</p>
<pre class="code literal-block">
var React = require('react');

var DatePicker = React.createClass({
    render: function() {
        return(
            &lt;input type='text' ref='date' value={this.props.value} onChange={this.handleChange} /&gt;
        );
    },
    componentDidMount: function() {
        $(React.findDOMNode(this)).datepicker({ dateFormat: 'yy-mm-dd' });
        $(React.findDOMNode(this)).on('change', this.handleChange);
    },
    componentWillUnmount: function() {

    },
    handleChange: function() {
        var date = React.findDOMNode(this.refs.date).value
        this.props.onChange(date);
    }
});

module.exports.DatePicker = DatePicker ;
</pre>
<p>Another thing we can see here is how can integrate jquery components with react: When
the component is mounted, we get its <span class="caps">DOM</span> component using <tt class="docutils literal">React.findDomNode(this)</tt> and
convert it to a datepicker. We also set its change function to be the passed&nbsp;callback.</p>
</div>
<div class="section" id="pagingpanel-react-js">
<h3><a class="toc-backref" href="#toc-entry-7">PagingPanel.react.js</a></h3>
<p>The paging panel is not actually a reusable component because it requires BookActions
(to handle next and previous page clicks) - so
it can&#8217;t be used by Authors (if authors was a table that is). However, we can easily
change it to be reusable if we passed callbacks for next and previous page so that
the component including PagingPanel would call the correct action on each click. Having
a reusable PagingPangel is not needed for our application since only books have a&nbsp;table.</p>
<pre class="code literal-block">
var React = require('react');
var BookActions = require('../actions/BookActions').BookActions;

var PagingPanel = React.createClass({
    render: function() {
        return(
            &lt;div className=&quot;row&quot;&gt;
                {this.props.page==1?'':&lt;button onClick={this.onPreviousPageClick}&gt;&amp;lt;&lt;/button&gt;}
                &amp;nbsp; Page {this.props.page} of {this.getTotalPages()} &amp;nbsp;
                {this.props.page==this.getTotalPages()?'':&lt;button onClick={this.onNextPageClick} &gt;&amp;gt;&lt;/button&gt;}
            &lt;/div&gt;
        );
    },
    onNextPageClick: function(e) {
        e.preventDefault();
        BookActions.change_page(this.props.page+1)
    },
    onPreviousPageClick: function(e) {
        e.preventDefault();
        BookActions.change_page(this.props.page-1)
    },
    getTotalPages: function() {
        return Math.ceil(this.props.total / this.props.page_size);
    }
})

module.exports.PagingPanel = PagingPanel;
</pre>
<p>The component is very simple, it needs three&nbsp;parameters:</p>
<ul class="simple">
<li>the current page (<tt class="docutils literal">props.page</tt>)</li>
<li>the page size (<tt class="docutils literal">props.page_size</tt>)</li>
<li>the total pages number (<tt class="docutils literal">props.total</tt>)</li>
</ul>
<p>and just displayd the current page along with buttons to go to the next or previous page (if these buttons should be visible of&nbsp;course).</p>
</div>
<div class="section" id="searchpanel-react-js">
<h3><a class="toc-backref" href="#toc-entry-8">SearchPanel.react.js</a></h3>
<p>The SearchPanel is another panel that could be reusable if we&#8217;d passed a callbeck instead of calling the <tt class="docutils literal">BookActions.search</tt>
action directly. The promise behavior has been explained in the previous posts and is needed to buffer the queries to the
server when a user types his search&nbsp;query.</p>
<pre class="code literal-block">
var React = require('react');
var BookActions = require('../actions/BookActions').BookActions;

var SearchPanel = React.createClass({
    getInitialState: function() {
        return {
            search: this.props.query,
        }
    },
    componentWillReceiveProps: function(nextProps) {
      this.setState({
            search: nextProps.query
      });
    },
    render: function() {
        return (
            &lt;div className=&quot;row&quot;&gt;
                &lt;div className=&quot;one-fourth column&quot;&gt;
                    Filter: &amp;nbsp;
                    &lt;input ref='search' name='search' type='text' value={this.state.search} onChange={this.onSearchChange} /&gt;
                    {this.state.search?&lt;button onClick={this.onClearSearch} &gt;x&lt;/button&gt;:''}
                &lt;/div&gt;
            &lt;/div&gt;
        )
    },
    onSearchChange: function() {
        var query = React.findDOMNode(this.refs.search).value;
        if (this.promise) {
            clearInterval(this.promise)
        }
        this.setState({
            search: query
        });
        this.promise = setTimeout(function () {
            BookActions.search(query);
        }.bind(this), 400);
    },
    onClearSearch: function() {
        this.setState({
            search: ''
        });
        BookActions.search('');
    }
});

module.exports.SearchPanel = SearchPanel;
</pre>
<p>As we can see, this panel is a little different than the previous ones because it actually handles its
own local state: When the component should get properties from its parent compoent, its state will
be updated to the <tt class="docutils literal">query</tt> attribute - so the current value of the search query gets updated through
properties. However, when the value of the search input is changed, we see that the local state is
changed immediately but the <tt class="docutils literal">BookActions.search</tt> (or the corresponding callback) gets called <em>only</em>
when the timeout has&nbsp;passed!</p>
<p>The above means that we can type whatever we want on the search input, but it at first it will be used
only locally to immediately update the value of the input and, only after the timeout has fired the
search action will be called. If we hadn&#8217;t used the local state it would be much more difficult to have
this consistent behavior (we&#8217;d need to add two actions, one to handle the search query value change
and another to handle the timeout firing &#8212; making everythimg much more&nbsp;complicated).</p>
</div>
<div class="section" id="messagepanel">
<h3><a class="toc-backref" href="#toc-entry-9">MessagePanel</a></h3>
<p>The MessagePanel is really interesting because it is a reusable component that actually has its own action and store module! This
component can be reused in <em>different</em> applications that need to display message but <em>not</em> on the same application (because a single state
is kept for all messages). If we wanted to use a different MessagePanel for Books or Authors then we&#8217;d need to keep both in the
state <em>and</em> also it to the action to differentiate between messages for author and for book. Instead, by keeping a single Messages
state for both Books and Authors we have a much more simple&nbsp;version.</p>
<div class="section" id="messagepanel-react-js">
<h4><a class="toc-backref" href="#toc-entry-10">MessagePanel.react.js</a></h4>
<p>The MessagePanel component has a local state which responds to changes on MessageStore. When the
state of MessageStore is changed the MessagePanel will be re-rendered with the new&nbsp;message.</p>
<pre class="code literal-block">
var React = require('react');
var MessageStore = require('../stores/MessageStore').MessageStore;

var MessagePanel = React.createClass({
    getInitialState: function() {
        return {

        };
    },
    render: function() {
        return(
            &lt;div className=&quot;row&quot;&gt;
                {this.state.message?&lt;div className={this.state.message.color}&gt;{this.state.message.text}&lt;/div&gt;:&quot;&quot;}
            &lt;/div&gt;
        );
    },
    _onChange: function() {
        this.setState(MessageStore.getState());
    },
    componentWillUnmount: function() {
        MessageStore.removeChangeListener(this._onChange);
    },
    componentDidMount: function() {
        MessageStore.addChangeListener(this._onChange);
    }
})

module.exports.MessagePanel = MessagePanel;
</pre>
</div>
<div class="section" id="messagestore-js">
<h4><a class="toc-backref" href="#toc-entry-11">MessageStore.js</a></h4>
<p>The MessageStore has a (private) state containing a <tt class="docutils literal">message</tt> that gets updated
only when the ccorresponding action is dispached. The store has a single state
for all messages - it doesn&#8217;t care if the messages are for books or&nbsp;authors.</p>
<pre class="code literal-block">
var $ = require('jquery');
var EventEmitter = require('events').EventEmitter;
var AppDispatcher = require('../dispatcher/AppDispatcher').AppDispatcher;
var BookConstants = require('../constants/BookConstants')

var _state = {
    message: {}
};

var MessageStore = $.extend({}, EventEmitter.prototype, {
    getState: function() {
        return _state;
    },
    emitChange: function() {
        this.emit('change');
    },
    addChangeListener: function(callback) {
        this.on('change', callback);
    },
    removeChangeListener: function(callback) {
        this.removeListener('change', callback);
    }
});

MessageStore.dispatchToken = AppDispatcher.register(function(action) {
    switch(action.actionType) {
        case BookConstants.MESSAGE_ADD:
            _state.message = action.message;
            MessageStore.emitChange();
        break;
    }
    return true;
});

module.exports.MessageStore = MessageStore;
</pre>
</div>
<div class="section" id="messageactions">
<h4><a class="toc-backref" href="#toc-entry-12">MessageActions</a></h4>
<p>Finally, there are two actions that are defined for the MessageStore: One for adding
an ok message and one for adding an error message - both of which have the same
message type (but pass a different color&nbsp;parameter).</p>
<pre class="code literal-block">
var AppDispatcher = require('../dispatcher/AppDispatcher').AppDispatcher;
var BookConstants = require('../constants/BookConstants')

var MessageActions = {
    add_message_ok: function(msg) {
        AppDispatcher.dispatch({
            actionType: BookConstants.MESSAGE_ADD,
            message: {
                color: 'green',
                text: msg
            }
        });
    },
    add_message_error: function(msg) {
        AppDispatcher.dispatch({
            actionType: BookConstants.MESSAGE_ADD,
            message: {
                color: 'green',
                text: msg
            }
        });
    }
};

module.exports.MessageActions = MessageActions;
</pre>
</div>
</div>
</div>
<div class="section" id="non-reusable-application-components">
<h2><a class="toc-backref" href="#toc-entry-13">Non-reusable application&nbsp;components</a></h2>
<p>I don&#8217;t want to discuss the source code for all the non-reusable components since some of them
are more or less the same with the previous version and are easy to understand just by
checking the source code (BookTableRow and ButtonPanel). However, I&#8217;ll
discuss the other, more complex components starting from the inside of the&nbsp;react-onion:</p>
<div class="section" id="booktable-react-js">
<h3><a class="toc-backref" href="#toc-entry-14">BookTable.react.js</a></h3>
<p>I want to display this component to discuss how sorting is implemented: Each column has a key which,
when passed to django-rest-framework will sort the results based on that key (the <tt class="docutils literal">__</tt> does a
join so by <tt class="docutils literal">author__last_name</tt> we mean that we want to sort by the last_name field of the author
of each book. Also, you can pass the key as it is to sort ascending or with a minus (-) in front
(for example <tt class="docutils literal"><span class="pre">-author__last_name</span></tt>).</p>
<pre class="code literal-block">
var React = require('react');
var BookTableRow = require('./BookTableRow.react').BookTableRow;
var BookActions = require('../actions/BookActions').BookActions;

var BookTable = React.createClass({
    render: function() {
        var rows = [];
        this.props.books.forEach(function(book) {
            rows.push(&lt;BookTableRow key={book.id} book={book} /&gt;);
        });
        return (
            &lt;table&gt;
                &lt;thead&gt;
                    &lt;tr&gt;
                        &lt;th&gt;&lt;a href='#' onClick={this.onClick.bind(this, 'id')}&gt;{this.showOrdering('id')} Id&lt;/a&gt;&lt;/th&gt;
                        &lt;th&gt;&lt;a href='#' onClick={this.onClick.bind(this, 'title')}&gt;{this.showOrdering('title')} Title&lt;/a&gt;&lt;/th&gt;
                        &lt;th&gt;&lt;a href='#' onClick={this.onClick.bind(this, 'subcategory__name')}&gt;{this.showOrdering('subcategory__name')} Category&lt;/a&gt;&lt;/th&gt;
                        &lt;th&gt;&lt;a href='#' onClick={this.onClick.bind(this, 'publish_date')}&gt;{this.showOrdering('publish_date')} Publish date&lt;/a&gt;&lt;/th&gt;
                        &lt;th&gt;&lt;a href='#' onClick={this.onClick.bind(this, 'author__last_name')}&gt;{this.showOrdering('author__last_name')} Author&lt;/a&gt;&lt;/th&gt;
                        &lt;th&gt;Edit&lt;/th&gt;
                    &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;{rows}&lt;/tbody&gt;
            &lt;/table&gt;
        );
    },
    onClick: function(v, e) {
        e.preventDefault();
        BookActions.sort_books(v);
    },
    showOrdering: function(v) {
        if (v==this.props.ordering) {
            return '+'
        } else if ('-'+v==this.props.ordering) {
            return '-'
        }
    }
});

module.exports.BookTable = BookTable ;
</pre>
<p>The only thing that needs explaining in this module is the line of the&nbsp;form</p>
<pre class="code literal-block">
&lt;th&gt;&lt;a href='#' onClick={this.onClick.bind(this, 'id')}&gt;{this.showOrdering('id')} Id&lt;/a&gt;&lt;/th&gt;
</pre>
<p>that creates the title of each column and triggers ascending or descending sorting on this column by
clicking on it. So, we can see that we&#8217;ve create an onClick function that actually expects a value - the key
to that column. To allow passing that value, we use the bind method of the function object which will
create new a function that has this key as its first parameter. If we didn&#8217;t want to use bind, we&#8217;d need to
creatre 5 different function (onIdClick, onTitleClick etc)! The most common usage of <tt class="docutils literal">bind</tt> is to actually <em>bind</em>
a function to an object (that&#8217;s what the first parameter to this function does)
so that calling this inside that function will refer to that object - here we leave the binding
of the function to the same object and only do the parameter&nbsp;passing.</p>
<p>Also, the showOrdering checks if the current ordering is the same as that column&#8217;s key and displays
either a + (for ascending) or - (for descending) in front of the column&nbsp;title.</p>
</div>
<div class="section" id="authordialog-react-js">
<h3><a class="toc-backref" href="#toc-entry-15">AuthorDialog.react.js</a></h3>
<p>This is a handmade pop-up dialog that gets displayed when a new author is added (the + button is clicked)
using only css to center it on the screen when it is displayed.
We can see that it is either visible on invisible based on the <tt class="docutils literal">showDialog</tt> input property which actually
is the only input this component requires. When it is visible and the ok or cancel button are pressed
the corresponding action will be dispatched (which will actually close this popup by setting the <tt class="docutils literal">showDialog</tt>
to&nbsp;false):</p>
<pre class="code literal-block">
var React = require('react');
var AuthorActions = require('../actions/AuthorActions').AuthorActions;

var AuthorDialog = React.createClass({

    render: function() {
        if (!this.props.showDialog) {
            return (
                &lt;div /&gt;
            )
        } else {
            return(
                &lt;div className='modal-dialog' id=&quot;dialog-form&quot;  &gt;
                    &lt;label htmlFor=&quot;first_name&quot;&gt;First name:&lt;/label&gt; &lt;input type='text' ref='first_name' name='first_name' /&gt; &lt;br /&gt;
                    &lt;label htmlFor=&quot;last_name&quot;&gt;Last name:&lt;/label&gt; &lt;input type='text' ref='last_name' name='last_name' /&gt; &lt;br /&gt;
                    &lt;button onClick={this.onOk}&gt;Ok&lt;/button&gt;
                    &lt;button onClick={this.onCancel} &gt;Cancel&lt;/button&gt;
                &lt;/div&gt;

            );
        }
    },
    onCancel: function(e) {
        e.preventDefault();
        AuthorActions.hide_add_author();
    },
    onOk: function(e) {
        e.preventDefault();
        first_name = React.findDOMNode(this.refs.first_name).value;
        last_name = React.findDOMNode(this.refs.last_name).value;
        AuthorActions.add_author_ok({
            first_name: first_name,
            last_name: last_name
        });
    }
});

module.exports.AuthorDialog = AuthorDialog ;
</pre>
</div>
<div class="section" id="authorpanel-react-js">
<h3><a class="toc-backref" href="#toc-entry-16">AuthorPanel.react.js</a></h3>
<p>The AuthorPanel displays the author select DropDown along with the + (add author) and
- (delete author) buttons. It also contains the AuthorDialog which will be displayed
or not depending on the value of the <tt class="docutils literal">showDialog</tt> property.</p>
<pre class="code literal-block">
var React = require('react');
var DropDown = require('./DropDown.react').DropDown;
var AuthorDialog = require('./AuthorDialog.react').AuthorDialog;
var AuthorActions = require('../actions/AuthorActions').AuthorActions;

var AuthorPanel = React.createClass({
    getInitialState: function() {
        return {};
    },
    render: function() {
        var authorExists = false ;
        if(this.props.authors) {
            var ids = this.props.authors.map(function(x) {
                return x.id*1;
            });

            if(ids.indexOf(1*this.props.author)&gt;=0 ) {
                authorExists = true;
            }
        }

        return(
            &lt;div className='one-half column'&gt;
                &lt;AuthorDialog showDialog={this.props.showDialog} /&gt;
                &lt;label forHtml='date'&gt;Author&lt;/label&gt;
                &lt;DropDown options={this.props.authors} dropDownValueChanged={this.props.onAuthorChanged} value={authorExists?this.props.author:''} /&gt;
                &lt;button onClick={this.addAuthor} &gt;+&lt;/button&gt;
                {authorExists?&lt;button onClick={this.deleteAuthor}&gt;-&lt;/button&gt;:&quot;&quot;}
            &lt;/div&gt;
        );
    },
    addAuthor: function(e) {
        e.preventDefault();
        console.log(&quot;ADD AUTHOR&quot;);
        AuthorActions.show_add_author();
    },
    deleteAuthor: function(e) {
        e.preventDefault();
        AuthorActions.delete_author(this.props.author);
        console.log(&quot;DELETE AUTHOR&quot;);
        console.log(this.props.author);
    },
});

module.exports.AuthorPanel = AuthorPanel;
</pre>
<p>As we can see, there are three properties that are passed to this&nbsp;component:</p>
<ul class="simple">
<li><tt class="docutils literal">props.author</tt>: The currently selected&nbsp;author</li>
<li><tt class="docutils literal">props.authors</tt>: The list of all&nbsp;authors</li>
<li><tt class="docutils literal">props.onAuthorChanged</tt>: A callback that is called when the author is changed. Here, we could have used an action (just like for add/delete author) instead of a callback, however its not actually required. When the author is changed, it means that the currently edited book&#8217;s author is changed. So we could propagate the change to the parent (form) component that handles the book change along with the other changes (i.e title, publish date&nbsp;etc).</li>
</ul>
</div>
<div class="section" id="statpanel-react-js">
<h3><a class="toc-backref" href="#toc-entry-17">StatPanel.react.js</a></h3>
<p>The StatPanel is an interesting, read-only component that displays the number of
authors and books. This component requests updates from both the <tt class="docutils literal">BookStore</tt> and
<tt class="docutils literal">AuthorStore</tt> - when their state is updated the component will be re-rendered
with the number of books and&nbsp;authors:</p>
<pre class="code literal-block">
var React = require('react');
var BookStore = require('../stores/BookStore').BookStore;
var AuthorStore = require('../stores/AuthorStore').AuthorStore;

var StatPanel = React.createClass({
    getInitialState: function() {
        return {};
    },
    render: function() {
        var book_len = '-';
        var author_len = '-';
        if(this.state.books) {
            book_len = this.state.books.length
        }
        if(this.state.authors) {
            author_len = this.state.authors.length
        }
        return(
            &lt;div className=&quot;row&quot;&gt;
                &lt;div className=&quot;one-half column&quot;&gt;
                    Books number: {book_len}
                &lt;/div&gt;
                &lt;div className=&quot;one-half column&quot;&gt;
                    Authors number: {author_len}
                &lt;/div&gt;
                &lt;br /&gt;
            &lt;/div&gt;
        );
    },
    _onBookChange: function() {
        this.setState({
            books:BookStore.getState().books
        });
    },
    _onAuthorChange: function() {
        this.setState({
            authors: AuthorStore.getState().authors
        });
    },
    componentWillUnmount: function() {
        AuthorStore.removeChangeListener(this._onAuthorChange);
        BookStore.removeChangeListener(this._onBookChange);
    },
    componentDidMount: function() {
        AuthorStore.addChangeListener(this._onAuthorChange);
        BookStore.addChangeListener(this._onBookChange);
    }
});

module.exports.StatPanel = StatPanel ;
</pre>
<p>We&#8217;ve added different change listeners in case we wanted to do
some more computations for book or author change (instead of just
getting their books / authors property). Of course the same behavior
could be achieved with just a single change listener that would
get both the books and&nbsp;authors.</p>
</div>
<div class="section" id="bookform-react-js">
<h3><a class="toc-backref" href="#toc-entry-18">BookForm.react.js</a></h3>
<p>The BookForm is one of the most complex panels of this application (along with BookPanel) because
it actually contains a bunch of other panels and has some callbacks for them to&nbsp;use.</p>
<p>We can see that, as explained before, when the current book form values are changed (through callbacks) the change_book action will be&nbsp;called.</p>
<pre class="code literal-block">
var React = require('react');
var BookActions = require('../actions/BookActions').BookActions;
var DropDown = require('./DropDown.react.js').DropDown;
var StatPanel = require('./StatPanel.react.js').StatPanel;
var MessagePanel = require('./MessagePanel.react.js').MessagePanel;
var DatePicker = require('./DatePicker.react.js').DatePicker;
var ButtonPanel = require('./ButtonPanel.react.js').ButtonPanel;
var AuthorPanel = require('./AuthorPanel.react.js').AuthorPanel;
var CategoryStore = require('../stores/CategoryStore').CategoryStore;
var AuthorStore = require('../stores/AuthorStore').AuthorStore;
var loadCategories = require('../stores/CategoryStore').loadCategories;
var loadAuthors = require('../stores/AuthorStore').loadAuthors;

var BookForm = React.createClass({
    getInitialState: function() {
        return {};
    },
    render: function() {
        return(
            &lt;form onSubmit={this.onSubmit}&gt;
                &lt;div className='row'&gt;
                    &lt;div className='one-half column'&gt;
                        &lt;label forHtml='title'&gt;Title&lt;/label&gt;
                        &lt;input ref='title' name='title' type='text' value={this.props.book.title} onChange={this.onTitleChange} /&gt;
                    &lt;/div&gt;
                    &lt;div className='one-half column'&gt;
                        &lt;label forHtml='date'&gt;Publish date&lt;/label&gt;
                        &lt;DatePicker ref='date' onChange={this.onDateChange} value={this.props.book.publish_date} /&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div className='row'&gt;
                    &lt;div className='one-half column'&gt;
                        &lt;label forHtml='category'&gt;Category&lt;/label&gt;
                        &lt;DropDown options={this.state.categories} dropDownValueChanged={this.onCategoryChanged} value={this.props.book.category} /&gt;
                        &lt;DropDown options={this.state.subcategories} dropDownValueChanged={this.onSubCategoryChanged} value={this.props.book.subcategory} /&gt;
                    &lt;/div&gt;
                    &lt;AuthorPanel authors={this.state.authors} author={this.props.book.author} onAuthorChanged={this.onAuthorChanged} showDialog={this.state.showDialog} /&gt;
                &lt;/div&gt;

                &lt;ButtonPanel book={this.props.book}  /&gt;
                &lt;MessagePanel /&gt;
                &lt;StatPanel  /&gt;
            &lt;/form&gt;
        );
    },
    onSubmit: function(e) {
        e.preventDefault();
        BookActions.save(this.props.book)
    },
    onTitleChange: function() {
        this.props.book.title = React.findDOMNode(this.refs.title).value;
        BookActions.change_book(this.props.book);
    },
    onDateChange: function(date) {
        this.props.book.publish_date = date;
        BookActions.change_book(this.props.book);
    },
    onCategoryChanged: function(cat) {
        this.props.book.category = cat;
        this.props.book.subcategory = '';
        BookActions.change_book(this.props.book);
    },
    onSubCategoryChanged: function(cat) {
        this.props.book.subcategory = cat;
        BookActions.change_book(this.props.book);
    },
    onAuthorChanged: function(author) {
        this.props.book.author = author;
        BookActions.change_book(this.props.book);
    },
    _onChangeCategories: function() {
        this.setState(CategoryStore.getState());
    },
    _onChangeAuthors: function() {
        this.setState(AuthorStore.getState());
    },
    componentWillUnmount: function() {
        CategoryStore.removeChangeListener(this._onChangeCategories);
        AuthorStore.removeChangeListener(this._onChangeAuthors);
    },
    componentDidMount: function() {
        CategoryStore.addChangeListener(this._onChangeCategories);
        AuthorStore.addChangeListener(this._onChangeAuthors);
        loadCategories();
        loadAuthors();
    }
});

module.exports.BookForm = BookForm;
</pre>
<p>The above component listens for updates on both Category and Author store to update
when the authors (when an author is added or deleted) and the categories are changed (for example to implement the cascading dropdown
functionality), so the list of authors and the list of categories and subcategoreis are all stored in
the local state. The book that is edited is just passed as a property - actually, this is the only
property that this component needs to&nbsp;work.</p>
</div>
<div class="section" id="bookpanel-react-js">
<h3><a class="toc-backref" href="#toc-entry-19">BookPanel.react.js</a></h3>
<p>Finally, BookPanel is the last component we&#8217;ll talk about. This is the central component
of the application - however we&#8217;ll see that it is not very complex (since most user interaction
is performed in other components). This component just listens on changes in the BookStore state
and depending on the parameters either displays the &#8220;Loading&#8221; message or the table of books
(depending on the state of ajax calls that load the books). The other parameters like the
list of books, the ordering of the books etc are passed to the child&nbsp;components.</p>
<pre class="code literal-block">
var React = require('react');
var BookStore = require('../stores/BookStore').BookStore;
var BookActions = require('../actions/BookActions').BookActions;
var SearchPanel = require('./SearchPanel.react').SearchPanel;
var BookTable = require('./BookTable.react').BookTable;
var PagingPanel = require('./PagingPanel.react').PagingPanel;
var BookForm = require('./BookForm.react').BookForm;

var reloadBooks = require('../stores/BookStore').reloadBooks;

var BookPanel = React.createClass({
    getInitialState: function() {
        return BookStore.getState();
    },
    render: function() {
        return(
            &lt;div className=&quot;row&quot;&gt;
                &lt;div className=&quot;one-half column&quot;&gt;
                    {
                        this.state.loading?
                        &lt;div class='loading' &gt;Loading...&lt;/div&gt;:
                        &lt;div&gt;
                            &lt;SearchPanel query={this.state.query} &gt;&lt;/SearchPanel&gt;
                            &lt;BookTable books={this.state.books} ordering={this.state.ordering} /&gt;
                            &lt;PagingPanel page_size='5' total={this.state.total} page={this.state.page} /&gt;
                        &lt;/div&gt;
                    }
                &lt;/div&gt;
                &lt;div className=&quot;one-half column&quot;&gt;
                    &lt;BookForm
                        book={this.state.editingBook}
                    /&gt;
                &lt;/div&gt;
                &lt;br /&gt;
            &lt;/div&gt;
        );
    },
    _onChange: function() {
        this.setState( BookStore.getState() );
    },
    componentWillUnmount: function() {
        BookStore.removeChangeListener(this._onChange);
    },
    componentDidMount: function() {
        BookStore.addChangeListener(this._onChange);
        reloadBooks();
    }
});

module.exports.BookPanel = BookPanel ;
</pre>
</div>
</div>
<div class="section" id="the-actions">
<h2><a class="toc-backref" href="#toc-entry-20">The&nbsp;Actions</a></h2>
<p>All actions are rather simple components without other dependencies as we&#8217;ve already discussed. They
just define &#8220;actions&#8221; (which are simple functions) that create the correct parameter object type and pass it
to the dispatcher. The only attribute that is required for this object is the <tt class="docutils literal">actionType</tt> that
should get a value from the constants. I won&#8217;t go into any more detail about the actions &#8212; please check
the source code and all your questions will be&nbsp;resolved.</p>
</div>
<div class="section" id="the-stores">
<h2><a class="toc-backref" href="#toc-entry-21">The&nbsp;Stores</a></h2>
<p>First of all, all stores are defined through the following code that is already discussed in the previous&nbsp;part:</p>
<pre class="code literal-block">
var MessageStore = $.extend({}, EventEmitter.prototype, {
    getState: function() {
        return _state;
    },
    emitChange: function() {
        this.emit('change');
    },
    addChangeListener: function(callback) {
        this.on('change', callback);
    },
    removeChangeListener: function(callback) {
        this.removeListener('change', callback);
    }
});
</pre>
<p>When the state of a store is changed its <tt class="docutils literal">emitChange</tt> function will be called (I mean
called manually from the code that actually changes the state and knows that it has
actually been changed - nothing will be called automatically). When <tt class="docutils literal">emitChange</tt> is called,
all the components that listen for changes for this component (that have called <tt class="docutils literal">addChangeListener</tt>
of the store with a callback)
will be notified (their callback will be called) and will use
<tt class="docutils literal">getState</tt> of the store to get its current state - after that, these components will set their own state
to re-render and display the changes to the&nbsp;store.</p>
<p>Let&#8217;s now discuss the four stores defined &#8212; I will include only the parts of each file that are
actually interesting, for everything else <em>use the source Luke</em>!</p>
<div class="section" id="messagestore-js-1">
<h3><a class="toc-backref" href="#toc-entry-22">MessageStore.js</a></h3>
<p>A very simple store that goes together with MessagePanel and MessageActions. It just keeps a state with
the current message object and just changes this message when the MESSAGE_ADD message
type is dispatched. After changing the message, the listeners (only one in this case) will be notified to
update the displayed&nbsp;message:</p>
<pre class="code literal-block">
var _state = {
    message: {}
};

MessageStore.dispatchToken = AppDispatcher.register(function(action) {
    switch(action.actionType) {
        case BookConstants.MESSAGE_ADD:
            _state.message = action.message;
            MessageStore.emitChange();
        break;
    }
    return true;
});
</pre>
</div>
<div class="section" id="authorstore-js">
<h3><a class="toc-backref" href="#toc-entry-23">AuthorStore.js</a></h3>
<p>Here we see that the local state has an array of the authors and a <tt class="docutils literal">showDialog</tt> flag that
controls the state of the add author popup. For the <tt class="docutils literal">AUTHOR_ADD</tt> and <tt class="docutils literal">HIDE_ADD_AUTHOR</tt>
cases of the dispatch we just change the state of this flag and emit the change; the <tt class="docutils literal">BookForm</tt>
listens for changes to the <tt class="docutils literal">AuthorStore</tt> and will pass the <tt class="docutils literal">showDialog</tt> to the <tt class="docutils literal">AuthorPanel</tt>
as a property which in turn will pass it to <tt class="docutils literal">AuthorDialog</tt> and it will display the panel (or not)
depending on the value of that flag. This flag will also take a false value when the add author
ajax call&nbsp;returns.</p>
<p>The <tt class="docutils literal">showDialog</tt> flag is not related to the actual data but is <span class="caps">UI</span>-related. This
is something that we should keep in mind when creating stores: Stores don&#8217;t only contain the actual
data (like models in an <span class="caps">MVC</span> application) but they should also contain <span class="caps">UI</span> (controller/view in an <span class="caps">MVC</span>
architecture) related information since that is <em>also</em> part of the&nbsp;state!</p>
<p>We can see that the ajax calls just issue the corresponding <span class="caps">HTTP</span> method to the <tt class="docutils literal">authors_url</tt> and
when they return the <tt class="docutils literal">add_message_ok</tt> or <tt class="docutils literal">add_message_error</tt> methods of
<tt class="docutils literal">MessageActions</tt> will be called. These calls are in a different call stack so everything will work fine
(please remember the discussion about dispatches in different call stacks&nbsp;before).</p>
<p>Finally, on the success of <tt class="docutils literal">_load_authors</tt> the map array method is called to transform the returned data
as we want&nbsp;it:</p>
<pre class="code literal-block">
var $ = require('jquery');

var _state = {
    authors: [],
    showDialog: false
}

var _load_authors = function() {
    $.ajax({
        url: _props.authors_url,
        dataType: 'json',
        cache: false,
        success: function(data) {
            _state.authors = data.map(function(a){
                return {
                    id: a.id,
                    name: a.last_name+' '+a.first_name
                }
            });
            AuthorStore.emitChange();
        },
        error: function(xhr, status, err) {
            MessageActions.add_message_error(err.toString());
        }
    });
};

var _deleteAuthor = function(authorId) {
    $.ajax({
        url: _props.authors_url+authorId,
        method: 'DELETE',
        cache: false,
        success: function(data) {
            _load_authors();
            MessageActions.add_message_ok(&quot;Author delete ok&quot;);
            AuthorActions.delete_author_ok();
        },
        error: function(xhr, status, err) {
            MessageActions.add_message_error(err.toString());
        }
    });
};

var _addAuthor = function(author) {
    $.ajax({
        url: _props.authors_url,
        dataType: 'json',
        method: 'POST',
        data:author,
        cache: false,
        success: function(data) {
            MessageActions.add_message_ok(&quot;Author add  ok&quot;);
            _state.showDialog = false;
            _load_authors();
        },
        error: function(xhr, status, err) {
            MessageActions.add_message_error(err.toString());
        }
    });

};

AuthorStore.dispatchToken = AppDispatcher.register(function(action) {
    switch(action.actionType) {
        case BookConstants.SHOW_ADD_AUTHOR:
            _state.showDialog = true;
            AuthorStore.emitChange();
        break;
        case BookConstants.HIDE_ADD_AUTHOR:
            _state.showDialog = false;
            AuthorStore.emitChange();
        break;
        case BookConstants.AUTHOR_ADD:
            _addAuthor(action.author);
        break;
        case BookConstants.AUTHOR_DELETE:
            _deleteAuthor(action.authorId);
        break;
    }
    return true;
});
</pre>
</div>
<div class="section" id="categorystore-js">
<h3><a class="toc-backref" href="#toc-entry-24">CategoryStore.js</a></h3>
<p>The CategoryStore has an interesting functionality concerning the load_subcategory
function. This function is called whenever a book is changed (so its category form field
may be changed and the subcategories may be reloaded based on this category) or is edited
(so the category is that of the new book and once again the subcategories may need to because
rerendered). It is important that we <em>actually</em> pass the current category to the book to the
action. If for example we wanted to retrieve that from the state of the BookStore then we&#8217;d
need to use the <tt class="docutils literal">waitFor</tt> functionality of the dispatcher so that the category of the
current book would be changed first then the load_category (that would read that value to
read the subcategoreis) would be called after&nbsp;that.</p>
<p>Also, another thing to notice here is that there&#8217;s a simple subcat_cache that for each category
contains the subcategories of that category so that we won&#8217;t do repeated ajax calls to reload
the subcategories each time the category is&nbsp;changed.</p>
<pre class="code literal-block">
var _state = {
    categories: [],
    subcategories: []
}

var _current_cat = ''
var _subcat_cache = []

var _load_categories = function() {
    $.ajax({
        url: _props.categories_url,
        dataType: 'json',
        cache: false,
        success: function(data) {
            _state.categories = data;
            CategoryStore.emitChange();
        },
        error: function(xhr, status, err) {
            console.error(this.props.url, status, err.toString());
        }
    });
};

var _load_subcategories = function(cat) {

    if(!cat) {
        _state.subcategories = [];
        CategoryStore.emitChange();
        return ;
    }
    if(_subcat_cache[cat]) {
        _state.subcategories = _subcat_cache[cat] ;
        CategoryStore.emitChange();
    }
    $.ajax({
        url: _props.subcategories_url+'?category='+cat,
        dataType: 'json',
        cache: false,
        success: function(data) {
            _state.subcategories = data;
            _subcat_cache[cat] = data;
            CategoryStore.emitChange();
        },
        error: function(xhr, status, err) {
            console.error(this.props.url, status, err.toString());
        }
    });
};

CategoryStore.dispatchToken = AppDispatcher.register(function(action) {
    switch(action.actionType) {
        case BookConstants.BOOK_EDIT:
        case BookConstants.BOOK_CHANGE:
            _load_subcategories(action.book.category);
        break;
        case BookConstants.BOOK_EDIT_CANCEL:
            _state.subcategories = [];
            CategoryStore.emitChange();
        break;
    }
    return true;
});
</pre>
</div>
<div class="section" id="bookstore-js">
<h3><a class="toc-backref" href="#toc-entry-25">BookStore.js</a></h3>
<p>Here, beyond the book-related functionality we have also implemented the
<span class="caps">URL</span> updating. The getUrlParameter that returns the value of a <span class="caps">URL</span> parameter has been taken from
<a class="reference external" href="http://stackoverflow.com/questions/19491336/get-url-parameter-jquery">http://stackoverflow.com/questions/19491336/get-url-parameter-jquery</a>. Depending on the url parameters, we set some initial properties of
the local state and, on the other hand, when the search query, ordering or page are changed,
the <tt class="docutils literal">_update_href</tt> function is called to update the url parameters. This is not really related
to the flux architecture beyond the initialization of&nbsp;state.</p>
<p>Another thing to notice is that the when the <tt class="docutils literal">_search</tt> is executed whenever there&#8217;s
a change in the list of books (query is updated, sorting is changed, page is changed or
when an author is deleted since the books that have that author should now display an
empty field). The setTimeout in the _search ajax return is to simulate a 400ms delay (in order for the &#8220;Loading&#8221; text to
be&nbsp;visible).</p>
<pre class="code literal-block">
function getUrlParameter(sParam) {
    var sPageURL = $(location).attr('hash');
    sPageURL = sPageURL.substr(1)
    var sURLVariables = sPageURL.split('&amp;');
    for (var i = 0; i &lt; sURLVariables.length; i++)  {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam)  {
            return sParameterName[1];
        }
    }
}

var _page_init = 1*getUrlParameter('page');
if(!_page_init) _page_init = 1 ;
var _ordering_init = getUrlParameter('ordering');
if(!_ordering_init) _ordering_init = '' ;
var _query_init = getUrlParameter('query');
if(!_query_init) _query_init = ''

var _state = {
    loading: false,
    books: [],
    message:{},
    page: _page_init,
    total: 0,
    editingBook: {},
    query: _query_init,
    ordering: _ordering_init
}


var _search = function() {
    _state.loading = true;
    BookStore.emitChange();

    $.ajax({
        url: _props.url+'?search='+_state.query+&quot;&amp;ordering=&quot;+_state.ordering+&quot;&amp;page=&quot;+_state.page,
        dataType: 'json',
        cache: false,
        success: function(data) {
            // Simulate a small delay in server response
            setTimeout(function() {
                _state.books = data.results;
                _state.total = data.count;
                _state.loading = false;
                BookStore.emitChange();
            }, 400);
        },
        error: function(xhr, status, err) {
            _state.loading = false;
            MessageActions.add_message_error(err.toString());
            BookStore.emitChange();
        }
    });
};

var _reloadBooks = function() {
    _search('');
};


var _clearEditingBook = function() {
    _state.editingBook = {};
};

var _editBook = function(book) {
    _state.editingBook = book;
    BookStore.emitChange();
};

var _cancelEditBook = function() {
    _clearEditingBook();
    BookStore.emitChange();
};

var _update_href = function() {
    var hash = 'page='+_state.page;
    hash += '&amp;ordering='+_state.ordering;
    hash += '&amp;query='+_state.query;
    $(location).attr('hash', hash);
}

BookStore.dispatchToken = AppDispatcher.register(function(action) {
    switch(action.actionType) {
        case BookConstants.BOOK_EDIT:
            _editBook(action.book);
        break;
        case BookConstants.BOOK_EDIT_CANCEL:
            _cancelEditBook();
        break;
        case BookConstants.BOOK_SAVE:
            _saveBook(action.book);
        break;
        case BookConstants.BOOK_SEARCH:
            _state.query = action.query
            _state.page = 1;
            _update_href();
            _search();
        break;
        case BookConstants.BOOK_DELETE:
            _deleteBook(action.bookId);
        break;
        case BookConstants.BOOK_CHANGE:
            _state.editingBook = action.book;
            BookStore.emitChange();
        break;
        case BookConstants.BOOK_PAGE:
            _state.page = action.page;
            _update_href();
            _search();
        break;
        case BookConstants.AUTHOR_DELETE_OK:
            _search();
        break;
        case BookConstants.BOOK_SORT:
            _state.page = 1;
            if(_state.ordering == action.field) {
                _state.ordering = '-'+_state.ordering
            } else {
                _state.ordering = action.field;
            }
            _update_href();
            _search();
        break;
    }
    return true;
});
</pre>
</div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#toc-entry-26">Conclusion</a></h2>
<p>The application presented here has a number of techniques that will help
you when you actually try to create a more complex react flux application.
I hope that in the whole three part series I&#8217;ve thoroughly explained the
flux architecture and how each
part of (actions, stores, components) it works. Also, I tried to cover
almost anything that somebody creating react/flux application
will need to use &#8212; if you feel that something is not covered and
could be integrated to the authors/book application I&#8217;d be happy
to research and implement&nbsp;it!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2015/09/01/django-rq-redux/">django-rq redux: advanced techniques and tools</a>
      </h1>
    <p class="meta">
<time datetime="2015-09-01T14:20:00+03:00" pubdate>Tue 01 September 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title"><a class="reference internal" href="#top">Contents</a></p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="toc-entry-1">Introduction</a></li>
<li><a class="reference internal" href="#displaying-your-task-progress" id="toc-entry-2">Displaying your task&nbsp;progress</a></li>
<li><a class="reference internal" href="#displaying-your-queue-statistics" id="toc-entry-3">Displaying your queue&nbsp;statistics</a></li>
<li><a class="reference internal" href="#making-sure-that-workers-for-your-queue-are-actually-running" id="toc-entry-4">Making sure that workers for your queue are actually&nbsp;running</a></li>
<li><a class="reference internal" href="#checking-how-many-jobs-are-in-the-queue" id="toc-entry-5">Checking how many jobs are in the&nbsp;queue</a></li>
<li><a class="reference internal" href="#better-exception-handling" id="toc-entry-6">Better exception&nbsp;handling</a></li>
<li><a class="reference internal" href="#multiple-django-apps-single-redis-db" id="toc-entry-7">Multiple django-apps, single redis&nbsp;db</a></li>
<li><a class="reference internal" href="#low-level-debugging" id="toc-entry-8">Low level&nbsp;debugging</a></li>
<li><a class="reference internal" href="#conclusion" id="toc-entry-9">Conclusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#toc-entry-1">Introduction</a></h2>
<p>In the <a class="reference external" href="https://www.spapas.net/2015/01/27/async-tasks-with-django-rq/">previous django-rq article</a>
we presented a quick introduction to asynchronous job queues and created a
small (but complete) project that used rq and django-rq to implement asynchronous
job queues in a django&nbsp;project.</p>
<p>In this article, we will present some more advanced techniques and tools
for improving the capabilities of our asynchronous tasks and
integrate them to the <a class="reference external" href="https://github.com/spapas/django-test-rq">https://github.com/spapas/django-test-rq</a> project (please
checkout tag django-rq-redux
<tt class="docutils literal">git checkout <span class="pre">django-rq-redux</span></tt>)</p>
</div>
<div class="section" id="displaying-your-task-progress">
<h2><a class="toc-backref" href="#toc-entry-2">Displaying your task&nbsp;progress</a></h2>
<p>Sometimes, especially for long-running tasks it is useful to let
the user (task initiator) know what is the status of each task he&#8217;s started. For this,
I recommend creating a task-description model that will hold the required information for this
task with more or less the following fields (please also check <tt class="docutils literal">LongTask</tt> model of&nbsp;django-test-rq):</p>
<pre class="code literal-block">
class LongTask(models.Model):
  created_on = models.DateTimeField(auto_now_add=True)
  name = models.CharField(max_length=128, help_text='Enter a unique name for the task',)
  progress = models.PositiveIntegerField(default=0)
  result = models.CharField(max_length=128, blank=True, null=True)
</pre>
<p>Now, when the view that starts the task is <tt class="docutils literal"><span class="caps">POST</span></tt> ed, you&#8217;ll first create
the <tt class="docutils literal">LongTask</tt> model instance with a result of <tt class="docutils literal">'<span class="caps">QUEUED</span>'</tt> and a progress
of 0 (and a name that identifies your task) and then you&#8217;ll start the real task
asynchronously by passing the LongTask instance, something like this (also check
<tt class="docutils literal">LongTaskCreateView</tt>):</p>
<pre class="code literal-block">
long_task = LongTask.objects.create(...)
long_runnig_task.delay(long_task)
</pre>
<p>In your asynchronous job, the first thing you&#8217;ll need to do is to set its result
to &#8216;<span class="caps">STARTED</span>&#8217; and save it so that the user will immediately see when he&#8217;s job is
actually started. Also, if you can estimate its progress, you can update its
progress value with the current value so that the user will know how close he
is to finishing. Finally, when the job finished (or if it throws an expectable
exception) you&#8217;ll update its status accordingly. Here&#8217;s an example of my
long_running_task that just waits for the specifid amount of&nbsp;seconds:</p>
<pre class="code literal-block">
&#64;job('django-test-rq-low')
def long_runnig_task(task):
  job = get_current_job()
  task.job_id = job.get_id()

  task.result = 'STARTED'

  duration_in_second_persentages = task.duration*1.0 / 100
  for i in range(100):
      task.progress = i
      task.save()
      print task.progress
      time.sleep(duration_in_second_persentages)

  task.result = 'FINISHED'
  task.save()
  return task.result
</pre>
<p>To have proper feedback I propose to have your task-description model instance
created by the view that starts the asynchronous task and <em>not</em> by the
actual task! This is important since the worker may be full so the asynchronous
task will need a lot of time until is actually started (or maybe there are no
running workers - more on this later) and the user will not be able to see
his task instance anywhere (unless of course you provide him access to the actual task
queue but I don&#8217;t recommend&nbsp;this).</p>
</div>
<div class="section" id="displaying-your-queue-statistics">
<h2><a class="toc-backref" href="#toc-entry-3">Displaying your queue&nbsp;statistics</a></h2>
<p>django-rq has a really nice dashboard with a lot of queue statistics (
instructions here
<a class="reference external" href="https://github.com/ui/django-rq#queue-statistics">https://github.com/ui/django-rq#queue-statistics</a> and also on django-test-rq
project) which I recommend to always&nbsp;enable.</p>
<p>Also, there&#8217;s the individual use <a class="reference external" href="https://github.com/brutasse/django-rq-dashboard">django-rq-dashboard</a> project that could
be installed to display some more statistics, however the only extra
statistic that you can see throuh django-rq-dashboard is the status of
your scheduled jobs so I don&#8217;t recommend installing it if you don&#8217;t
use&nbsp;scheduling.</p>
</div>
<div class="section" id="making-sure-that-workers-for-your-queue-are-actually-running">
<h2><a class="toc-backref" href="#toc-entry-4">Making sure that workers for your queue are actually&nbsp;running</a></h2>
<p>Using the django-rq dashboard you can make sure that all queues
have at least one worker. However, sometimes workers fail, or
maybe you&#8217;ve forgotten to start your workers or not configured
your application correctly (this happens to me all the time for
test/uat projects). So, for tasks that you want to display feedback
to the user, you can easily add a check to make sure that there are
active workers using the following&nbsp;code:</p>
<pre class="code literal-block">
from rq import Worker
import django_rq

redis_conn = django_rq.get_connection('default')
if len([
    x for x in Worker.all(connection=redis_conn)
        if 'django-test-rq-low' in x.queue_names()
]) == 0:
    # Error -- no workers
</pre>
<p>With <tt class="docutils literal">Worker.all()</tt> you get all workers for a connection and the <tt class="docutils literal">queue_names()</tt>
method returns the names that each worker serves. So we check that we have at least one
worker for that&nbsp;queue.</p>
<p>This check can be added when the job is started and display a feedback error
to the user (check example in&nbsp;django-test-rq).</p>
<p>For quick tasks (for example sending emails etc) you should not display anything
to the user even if no workers are running (since the task <em>will</em> be queued and
will be executed eventually when the workers are started) but instead send an email to the administrators
so that they will start the&nbsp;workers.</p>
</div>
<div class="section" id="checking-how-many-jobs-are-in-the-queue">
<h2><a class="toc-backref" href="#toc-entry-5">Checking how many jobs are in the&nbsp;queue</a></h2>
<p>To find out programatically how many jobs are actually in the queue (and display a message
if the queue has too many jobs etc) you&#8217;ll need to use the <tt class="docutils literal">Queue</tt> class, something like&nbsp;this:</p>
<pre class="code literal-block">
from rq import Queue

redis_conn = django_rq.get_connection('default')
queue = Queue('django-test-rq-default', connection=redis_conn)
print queue.name
print len(queue.jobs)
</pre>
</div>
<div class="section" id="better-exception-handling">
<h2><a class="toc-backref" href="#toc-entry-6">Better exception&nbsp;handling</a></h2>
<p>When a job fails, rq will put it in a failed jobs queue and finish with it. You (as administrator)
won&#8217;t get any feedback and the user (unless he has access to that failed jobs queue) won&#8217;t be
able to do anything aboutt this&nbsp;job.</p>
<p>In almost all cases you can&#8217;t rely only on this behavior but instead you have to
<a class="reference external" href="http://python-rq.org/docs/exceptions/">install a custom exception handler</a>. Using the custom exception handler you can
do whatever you want for each failed job. For instance, you can create a new instance
of a <tt class="docutils literal">FailedTask</tt> model which will have information about the failure and the
original task allow the user (or administrator) to restart the failed task after
he&#8217;s fixed the error&nbsp;conditions.</p>
<p>Or, if you want to be informed when a job is failed, you can just send an email
to <tt class="docutils literal"><span class="caps">ADMINS</span></tt> and fall back to the default behavior to enqueue the failed task the
failed jobs queue (since job exception handlers can be&nbsp;chained).</p>
<p>A simple management command that starts a worker for a specific queue and installs
a custom exception handler&nbsp;follows:</p>
<pre class="code literal-block">
from django.conf import settings
from django.core.management.base import BaseCommand

import django_rq
from rq import Queue, Worker

def my_handler(job, *exc_info):
    print &quot;FAILURE&quot;
    print job
    print exc_info

class Command(BaseCommand):
    def handle(self, *args, **options):
        redis_conn = django_rq.get_connection('default')

        q = Queue(settings.DJANGO_TEST_RQ_LOW_QUEUE, connection=redis_conn)
        worker = Worker([q], exc_handler=my_handler, connection=redis_conn)
        worker.work()
</pre>
<p>This handler is for demonstration purposes since it just prints a message to the console
(so please do not use&nbsp;it)!</p>
</div>
<div class="section" id="multiple-django-apps-single-redis-db">
<h2><a class="toc-backref" href="#toc-entry-7">Multiple django-apps, single redis&nbsp;db</a></h2>
<p>One thing to keep in mind is that the only thing that seperates the queues are
their name. If you have many django applications that define a &#8220;default&#8221; (or &#8220;low&#8221;, &#8220;hight&#8221; etc)
and they all use the <em>same</em> redis database to store their queue, the workers
of each application won&#8217;t know which jobs belong to them and they&#8217;ll end up
dequeuing the wrong job types. This will lead to an exception or, if you
are really unlucky to a very nasty&nbsp;bug!</p>
<p>To avoid this, you can either use a different redis database (not database server)
for each of your apps or add a prefix with the name of your app to your queue&nbsp;names:</p>
<p>Each redis database server can host a number of databases that are identified
by a number (that&#8217;s what the /0 you see in <tt class="docutils literal"><span class="pre">redis://127.0.0.1:6379/0</span></tt> means)
and each one of them has a totally different keyspace. So, if you use /0 in an
application and /1 in another application, you&#8217;ll have no problems. This solution
has the disadvantage that you need to be really careful to use different database
numbers for your projects and also the number of possible databases that redis
can use is limited by a configuration file (so if you reach the maximum you&#8217;ll
need to also increase that&nbsp;number)!</p>
<p>Instead of this, you can avoid using the &#8216;default&#8217; queue, and use queues that
contain your application name in their name, for example, for the sample project
you could create something like &#8216;django-test-rq-default&#8217;, &#8216;django-test-rq-low&#8217;,
&#8216;django-test-rq-high&#8217; etc. You need to configure the extra queues by adding them
to the <tt class="docutils literal">RQ_QUEUES</tt> dictionary (check settings.py of django-test-rq) and then
put the jobs to these queues using for example the job decorator
(<tt class="docutils literal"><span class="pre">&#64;job('django-test-rq-default')</span></tt>)
and run your workers so that they will retrieve jobs from these queues
(<tt class="docutils literal">python manage.py rqworker <span class="pre">django-test-rq-default</span></tt>) and not the
default one (which may contain jobs of other&nbsp;applications).</p>
<p>If you use the default queue, and because you&#8217;ll need to use its name to
many places, I recommend to add a (f.i) <tt class="docutils literal">QUEUE_NAME = <span class="pre">'django-test-rq-default'</span></tt>
setting and use this instead of just a string to be totally <span class="caps">DRY</span>.</p>
<p><strong>Update 13/09/2015</strong>: Please notice that using a <em>single</em> redis database server
(either with multiple numeric databases or in the same database using a keyword
in keys to differentiate the apps) <a class="reference external" href="https://redislabs.com/blog/benchmark-shared-vs-dedicated-redis-instances#.VfUl0xHtmko">is not recommended</a> as commenter
Itamar Haber pointed out to&nbsp;me!</p>
<p>This is because for speed reasons redis uses a single thread to handle all requests
(regardless if they are in the same or different numerical databases), so all
resources may be used by a single, redis hungry, application and leave all others to&nbsp;starve!</p>
<p>Therefore, the recommended solution is to have a <em>different redis</em> server for each different
application. This does not mean that you need to have different servers, just to run
different instances of redis binding to different <span class="caps">IP</span> ports. Redis uses very little
resourecs when it is idle (<a class="reference external" href="http://redis.io/topics/faq">empty instance uses ~ 1 <span class="caps">MB</span> <span class="caps">RAM</span></a>) so you can run a lot
of instances in a single&nbsp;server.</p>
<p>Long story short, my proposal is to have a redis.conf <em>inside</em> your application root tree
(next to manage.py and requirements.txt) which has the redis options for each
application. The options in redis.conf that need to be changed per application
is the port that this redis instance will bind (this port also needs to be passed to
django settings.py) and the pid filename if you daemonize redis &#8212; I recommend using
a tool like <a class="reference external" href="http://supervisord.org/">supervisord</a> instead so that you won&#8217;t need any daemonizing and pid files for
each&nbsp;per-app-redis-instance!</p>
</div>
<div class="section" id="low-level-debugging">
<h2><a class="toc-backref" href="#toc-entry-8">Low level&nbsp;debugging</a></h2>
<p>In this section I&#8217;ll present some commands that you can issue to your redis
server using a simple telnet connection to get various info about your queues. You
probably will never need to issue these commands to actually debug, but they
will answer some of your (scientific) questions! In the following, <tt class="docutils literal">&gt;</tt> is
things I type, <tt class="docutils literal">#</tt> are comments, <tt class="docutils literal"><span class="pre">[...]</span></tt> is more output and everything else is the output I&nbsp;get:</p>
<pre class="code literal-block">
&gt; telnet 127.0.0.1 6379

# You won't see anything at first but you'll be connected and you can try typing things

&gt; INFO

$1020
redis_version:2.4.10
redis_git_sha1:00000000
# [...]
db0:keys=83,expires=2
db1:keys=26,expires=1 # My redis server has two databases

# Now you'll see what you type!

&gt; SELECT 1
+ OK # Now queries will be issued to database 1
&gt; SELECT 0
+ OK # Now queries will be issued to database 0

KEYS rq* # List all rq related queues
*25
$43
rq:job:1d7afa32-3f90-4502-912f-d58eaa049fb1
$43
rq:queue:django-test-rq-low
$43
[...]

&gt; SMEMBERS rq:workers # See workers
*1
$26
rq:worker:SERAFEIM-PC.6892

&gt; LRANGE rq:queue:django-test-rq-low 0 100 # Check queued jobs
*2
$36
def896f4-84cb-4833-be6a-54d917f05271
$36
53cb1367-2fb5-46b3-99b2-7680397203b9

&gt; HGETALL rq:job:def896f4-84cb-4833-be6a-54d917f05271 # Get info about this job
*16
$6
status
$6
queued
$11
description
$57
tasks.tasks.long_runnig_task(&lt;LongTask: LongTask object&gt;)
$10
created_at
$20
2015-09-01T09:04:38Z
$7
timeout
$3
180
$6
origin
$18
django-test-rq-low
$11
enqueued_at
$20
2015-09-01T09:04:38Z
$4
data
$409
[...] # data is the pickled parameters passed to the job !

&gt; HGET rq:job:def896f4-84cb-4833-be6a-54d917f05271 status # Get only status
$6
queued
</pre>
<p>For more info on querying redis you can check the <a class="reference external" href="http://redis.io/documentation">redis documentation</a> and especially
<a class="reference external" href="http://redis.io/topics/data-types">http://redis.io/topics/data-types</a> and <a class="reference external" href="http://redis.io/commands">http://redis.io/commands</a>.</p>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#toc-entry-9">Conclusion</a></h2>
<p>Using some of the above techniques will help you in your asynchronous
task adventures with rq. I&#8217;ll try to keep this article updated with
any new techniques or tools I find in the&nbsp;future!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2015/07/02/comprehensive-react-flux-tutorial-2/">A comprehensive React and Flux tutorial part 2: Flux</a>
      </h1>
    <p class="meta">
<time datetime="2015-07-02T14:20:00+03:00" pubdate>Thu 02 July 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title"><a class="reference internal" href="#top">Contents</a></p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="toc-entry-1">Introduction</a></li>
<li><a class="reference internal" href="#flux-components" id="toc-entry-2">Flux&nbsp;components</a></li>
<li><a class="reference internal" href="#the-react-flux-version" id="toc-entry-3">The react-flux version</a><ul>
<li><a class="reference internal" href="#main-js" id="toc-entry-4">main.js</a></li>
<li><a class="reference internal" href="#constants-js" id="toc-entry-5">constants.js</a></li>
<li><a class="reference internal" href="#actions-js" id="toc-entry-6">actions.js</a></li>
<li><a class="reference internal" href="#stores-js" id="toc-entry-7">stores.js</a></li>
<li><a class="reference internal" href="#components-js" id="toc-entry-8">components.js</a></li>
</ul>
</li>
<li><a class="reference internal" href="#explaining-the-data-flow" id="toc-entry-9">Explaining the data&nbsp;flow</a></li>
<li><a class="reference internal" href="#a-better-code-organization" id="toc-entry-10">A better code&nbsp;organization</a></li>
<li><a class="reference internal" href="#conclusion" id="toc-entry-11">Conclusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#toc-entry-1">Introduction</a></h2>
<p>In the <a class="reference external" href="https://www.spapas.net/2015/06/05/comprehensive-react-flux-tutorial/">first part of this series</a> we implemented a
not-so-simple one page application with full <span class="caps">CRUD</span> capabilities. In this part, we will
modify that application to make it use the Flux architecture. The full source code can
be found at <a class="reference external" href="https://github.com/spapas/react-tutorial">https://github.com/spapas/react-tutorial</a> (tag name react-flux). In the
<a class="reference external" href="https://www.spapas.net/2015/09/08/more-complex-react-flux-example/">next part,</a> we will create an even more complex application
using&nbsp;react/flux!</p>
<p>I recommend reading Facebook&#8217;s <a class="reference external" href="https://facebook.github.io/flux/docs/overview.html">Flux overview</a> before reading this article &#8212; please
read it even if you find some concepts difficult to grasp (I know I found it difficult
the first time I read it), I will try to explain everything here. Also,
because a rather large number of extra components will need to be created, we are
going to split our javascript code to different files using <a class="reference external" href="http://browserify.org/">browserify</a> - you can
learn <a class="reference external" href="https://www.spapas.net/2015/05/27/using-browserify-watchify/">how to use browserify here</a>.</p>
</div>
<div class="section" id="flux-components">
<h2><a class="toc-backref" href="#toc-entry-2">Flux&nbsp;components</a></h2>
<p>To implement the Flux architecture, an application needs to have at least a store and a&nbsp;dispatcher.</p>
<p>The store is the central place of truth for the application and the dispacher is the central
place of communications. The store should hold the
state (and any models/DAOs) of the application and notify the react components when this state is changed. Also,
the store will be notified by the dispatcher when an action happens (for example a button is clicked)
so that it will change the state. As a flow, we can think of something like&nbsp;this:</p>
<pre class="code literal-block">
a ui action on a component (click, change, etc) -&gt;
 ^   dispatcher is notified -&gt;
 |   store is notified (by the dispacher)-&gt;
 |   store state is changed -&gt;
 └─  component is notified (by the store) and updated to reflect the change
</pre>
<p>One thing to keep in mind is that although each flux application will have only one dispatcher, it may
have more stores, depending on the application&#8217;s architecture and separation of concerns. If there are
more than store, all will be notified by the dispatcher and change their state (if needed of course).
The ui will pass the action type and any optional parameters to the dispatcher and the dispatcher
will notify all stores with these&nbsp;parameters.</p>
<p>An optional component in the Flux architecture is the Action. An action is a store related class that
acts as an intermediate between the ui and the dispatcher. So, when a user clicks a button, an action
will be called that will notify the dispatcher. As we will see we can just call the dispatcher directly
from the components ui, but calling it through the Action makes the calls more consistent and creates
an&nbsp;interface.</p>
</div>
<div class="section" id="the-react-flux-version">
<h2><a class="toc-backref" href="#toc-entry-3">The react-flux&nbsp;version</a></h2>
<p>Since we are using browserify, we will include a single file in our html file with a <tt class="docutils literal">&lt;script&gt;</tt> tag
and everything else will be included through the <tt class="docutils literal">require</tt> function. We have the following packages
as requirements for&nbsp;browserify:</p>
<pre class="code literal-block">
&quot;dependencies&quot;: {
  &quot;flux&quot;: &quot;^2.0.3&quot;,
  &quot;jquery&quot;: &quot;^2.1.4&quot;,
  &quot;react&quot;: &quot;^0.13.3&quot;,
  &quot;reactify&quot;: &quot;^1.1.1&quot;
}
</pre>
<p>Also, in order to be able to use <span class="caps">JSX</span> with browserify, will use the <a class="reference external" href="https://github.com/andreypopp/reactify">reactify</a> transform. To apply it to
your project, change the <tt class="docutils literal">scripts</tt> of your <tt class="docutils literal">package.json</tt> to:</p>
<pre class="code literal-block">
&quot;scripts&quot;: {
  &quot;watch&quot;: &quot;watchify -v -d static/main.js -t reactify -o static/bundle.js&quot;,
  &quot;build&quot;: &quot;browserify static/main.js -t reactify  | uglifyjs -mc warnings=false &gt; static/bundle.js&quot;
},
</pre>
<div class="section" id="main-js">
<h3><a class="toc-backref" href="#toc-entry-4">main.js</a></h3>
<p>The <tt class="docutils literal">main.js</tt> file will
just render the BookPanel component (the <tt class="docutils literal">components.js</tt> file contains the source for all React components) and call
the <tt class="docutils literal">reloadBooks</tt> function from <tt class="docutils literal">stores.js</tt> that will reload all books from the <span class="caps">REST</span> <span class="caps">API</span>:</p>
<pre class="code literal-block">
var React = require('react');
var components = require('./components');
var stores = require('./stores');

React.render(&lt;components.BookPanel url='/api/books/' /&gt;, document.getElementById('content'));

stores.reloadBooks();
</pre>
</div>
<div class="section" id="constants-js">
<h3><a class="toc-backref" href="#toc-entry-5">constants.js</a></h3>
<p>Before going into more complex modules, let&#8217;s present the <tt class="docutils literal">constants.js</tt> which just
exports some strings that will be passed to the dispatcher to differentiate between each
ui&nbsp;action:</p>
<pre class="code literal-block">
module.exports = {
    BOOK_EDIT: 'BOOK_EDIT',
    BOOK_EDIT_CANCEL: 'BOOK_EDIT_CANCEL',
    BOOK_SAVE: 'BOOK_SAVE',
    BOOK_SEARCH: 'BOOK_SEARCH',
    BOOK_DELETE: 'BOOK_DELETE',
};
</pre>
<p>As we can see, these constants are exported as a single object so when we do something like
<tt class="docutils literal">var BookConstants = <span class="pre">require('./constants')</span></tt> we&#8217;ll the be able to refer to each constant
through <tt class="docutils literal">BookConstants.CONSTANT_NAME</tt>.</p>
</div>
<div class="section" id="actions-js">
<h3><a class="toc-backref" href="#toc-entry-6">actions.js</a></h3>
<p>The <tt class="docutils literal">actions.js</tt> creates the dispatcher singleton and a BookActions object that defines the
actions for&nbsp;books.</p>
<pre class="code literal-block">
var BookConstants = require('./constants')
var Dispatcher = require('flux').Dispatcher;
var AppDispatcher = new Dispatcher();

var BookActions = {
    search: function(query) {
        AppDispatcher.dispatch({
            actionType: BookConstants.BOOK_SEARCH,
            query: query
        });
    },
    save: function(book) {
        AppDispatcher.dispatch({
            actionType: BookConstants.BOOK_SAVE,
            book: book
        });
    },
    edit: function(book) {
        AppDispatcher.dispatch({
            actionType: BookConstants.BOOK_EDIT,
            book: book
        });
    },
    edit_cancel: function() {
        AppDispatcher.dispatch({
            actionType: BookConstants.BOOK_EDIT_CANCEL
        });
    },
    delete: function(bookId) {
        AppDispatcher.dispatch({
            actionType: BookConstants.BOOK_DELETE,
            bookId: bookId
        });
    }
};

module.exports.BookActions = BookActions;
module.exports.AppDispatcher = AppDispatcher;
</pre>
<p>As we can see, the BookActions is just a collection of methods that will
be called from the ui. Instead of calling BookActions.search() we could
just call the dispatch method with the correct parameter object (actionType
and optional parameter), both the BookActions object and the AppDispatcher
singleton are&nbsp;exported.</p>
<p>The dispatcher is imported from the flux requirement: It offers a functionality
to register callbacks for the various actions as we will see in the
next module. This is a rather simple class that we could implement ourselves
(each store passes a callback to the dispatcher that is called on the dispatch
method, passing actionType and any other parameters). The dispatcher also
offers a <tt class="docutils literal">waitFor</tt> method that can be used to ensure that the dispatch callback
for a store will be finished before another store&#8217;s dispatch callback (
when the second store uses the state of the first store &#8212; for example
when implementing a series of related dropdowns&nbsp;).</p>
</div>
<div class="section" id="stores-js">
<h3><a class="toc-backref" href="#toc-entry-7">stores.js</a></h3>
<p>The next module we will discuss is the <tt class="docutils literal">stores.js</tt> that contains the
<tt class="docutils literal">BookStore</tt> object.</p>
<pre class="code literal-block">
var $ = require('jquery');
var EventEmitter = require('events').EventEmitter;
var AppDispatcher = require('./actions').AppDispatcher;
var BookConstants = require('./constants')

var _state = {
    books: [],
    message:&quot;&quot;,
    editingBook: null
}

var _props = {
    url: '/api/books/'
}

var _search = function(query) {
    $.ajax({
        url: _props.url+'?search='+query,
        dataType: 'json',
        cache: false,
        success: function(data) {
            _state.books = data;
            BookStore.emitChange();
        },
        error: function(xhr, status, err) {
            console.error(this.props.url, status, err.toString());
            _state.message = err.toString();
            BookStore.emitChange();
        }
    });
};

var _reloadBooks = function() {
    _search('');
};

var _deleteBook = function(bookId) {
    $.ajax({
        url: _props.url+bookId,
        method: 'DELETE',
        cache: false,
        success: function(data) {
            _state.message = &quot;Successfully deleted book!&quot;
            _clearEditingBook();
            _reloadBooks();
        },
        error: function(xhr, status, err) {
            console.error(this.props.url, status, err.toString());
            _state.message = err.toString();
            BookStore.emitChange();
        }
    });
};

var _saveBook = function(book) {
    if(book.id) {
        $.ajax({
            url: _props.url+book.id,
            dataType: 'json',
            method: 'PUT',
            data:book,
            cache: false,
            success: function(data) {
                _state.message = &quot;Successfully updated book!&quot;
                _clearEditingBook();
                _reloadBooks();
            },
            error: function(xhr, status, err) {
                _state.message = err.toString()
                BookStore.emitChange();
            }
        });
    } else {
        $.ajax({
            url: _props.url,
            dataType: 'json',
            method: 'POST',
            data:book,
            cache: false,
            success: function(data) {
                _state.message = &quot;Successfully added book!&quot;
                _clearEditingBook();
                _reloadBooks();
            },
            error: function(xhr, status, err) {
                _state.message = err.toString()
                BookStore.emitChange();
            }
        });
    }
};

var _clearEditingBook = function() {
    _state.editingBook = null;
};

var _editBook = function(book) {
    _state.editingBook = book;
    BookStore.emitChange();
};

var _cancelEditBook = function() {
    _clearEditingBook();
    BookStore.emitChange();
};

var BookStore = $.extend({}, EventEmitter.prototype, {
    getState: function() {
        return _state;
    },
    emitChange: function() {
        this.emit('change');
    },
    addChangeListener: function(callback) {
        this.on('change', callback);
    },
    removeChangeListener: function(callback) {
        this.removeListener('change', callback);
    }
});

AppDispatcher.register(function(action) {
    switch(action.actionType) {
        case BookConstants.BOOK_EDIT:
            _editBook(action.book);
        break;
        case BookConstants.BOOK_EDIT_CANCEL:
            _cancelEditBook();
        break;
        case BookConstants.BOOK_SAVE:
            _saveBook(action.book);
        break;
        case BookConstants.BOOK_SEARCH:
            _search(action.query);
        break;
        case BookConstants.BOOK_DELETE:
            _deleteBook(action.bookId);
        break;
    }
    return true;
});

module.exports.BookStore = BookStore;
module.exports.reloadBooks = _reloadBooks;
</pre>
<p>The <tt class="docutils literal">stores.js</tt> module exports only the <tt class="docutils literal">BookStore</tt> object and the <tt class="docutils literal">reloadBooks</tt> method (that could also be
called from inside the module since it&#8217;s just called when the application is loaded to load the books for the
first time). All other objects/funtions are private to the&nbsp;module.</p>
<p>As we saw, the <tt class="docutils literal">_state</tt> objects keep the global state of the application which are the list of books, the book
that is edited right now and the result message for any update we are doing. The ajax methods are more or less
the same as the ones in the react-only version of the application. However, please notice that when the ajax methods
return and have to set the result, instead of setting the state of a React object they are just calling the
<tt class="docutils literal">emitChange</tt> method of the <tt class="docutils literal">BookStore</tt> that will notify all react objects that &#8220;listen&#8221; to this store.
This is possible because the ajax (<span class="caps">DAO</span>) methods are in the same module with the store - if we wanted instead
to put them in different modules, we&#8217;d just need to add another action (e.g <tt class="docutils literal">ReloadBooks</tt>) that would
be called when the ajax method returns &#8212; this action would call the dispatcher which would in turn update the
state of the&nbsp;store.</p>
<p>We can see that we are importing the
AppDispatcher singleton and, depending on the action type we call the correct method that changes the state. So
when a BookActions action is called it will call the corresponding <tt class="docutils literal">AppDispatcher.register</tt> case branch which
will call the corresponding state-changing&nbsp;function.</p>
<p>The  BookStore extends the <tt class="docutils literal">EventEmitter</tt> object (so we need to <tt class="docutils literal">require</tt> the <tt class="docutils literal">events</tt> module) in order to
notify the React components when the state of the store is changed. Instead of using <tt class="docutils literal">EventEmitter</tt> we could
just implement the emit change logic ourselves by saving all the listener callbacks to an array and calling them
all when there&#8217;s a state change (if we wanted to also add the &#8216;change&#8217; parameter to group the listener
callbacks we&#8217;d just make the complex more complex, something not needed for our&nbsp;case):</p>
<pre class="code literal-block">
var BookStore = {
    listeners: [],
    getState: function() {
        return _state;
    },
    emitChange: function() {
        var i;
        for(i=0;i&lt;this.listeners.length;i++) {
            this.listeners[i]();
        }
    },
    addChangeListener: function(callback) {
        this.listeners.push(callback);
    },
    removeChangeListener: function(callback) {
        this.listeners.splice(this.listeners.indexOf(callback), 1);
    }
};
</pre>
</div>
<div class="section" id="components-js">
<h3><a class="toc-backref" href="#toc-entry-8">components.js</a></h3>
<p>Finally, the <tt class="docutils literal">components.js</tt> module contains all the React components. These are more
or less the same with the react-only version with three&nbsp;differences:</p>
<ul class="simple">
<li>When something happens in the ui, the corresponding <tt class="docutils literal">BookAction</tt> action is called with the needed parameter &#8212; no callbacks are passed between the&nbsp;components</li>
<li>The <tt class="docutils literal">BookPanel</tt> component registers with the <tt class="docutils literal">BookStore</tt> in order to be notified when the state changes and just gets its state from the store &#8212; these values are propagated to all other components through&nbsp;properties</li>
<li>The <tt class="docutils literal">BookForm</tt> and <tt class="docutils literal">SearcchPanel</tt> now hold their own temporary state instead of using the global state &#8212; notice that when a book is edited this book will be propagated to the <tt class="docutils literal">BookForm</tt> through the book property, however <tt class="docutils literal">BookForm</tt> needs to update its state through the <tt class="docutils literal">componentWillReceiveProps</tt> method.</li>
</ul>
<pre class="code literal-block">
var React = require('react');
var BookStore = require('./stores').BookStore;
var BookActions = require('./actions').BookActions;

var BookTableRow = React.createClass({
    render: function() {
        return (
            &lt;tr&gt;
                &lt;td&gt;{this.props.book.id}&lt;/td&gt;
                &lt;td&gt;{this.props.book.title}&lt;/td&gt;
                &lt;td&gt;{this.props.book.category}&lt;/td&gt;
                &lt;td&gt;&lt;a href='#' onClick={this.onClick}&gt;Edit&lt;/a&gt;&lt;/td&gt;
            &lt;/tr&gt;
        );
    },
    onClick: function(e) {
        e.preventDefault();
        BookActions.edit(this.props.book);
    }
});

var BookTable = React.createClass({
    render: function() {
        var rows = [];
        this.props.books.forEach(function(book) {
            rows.push(&lt;BookTableRow key={book.id} book={book} /&gt;);
        });
        return (
            &lt;table&gt;
                &lt;thead&gt;
                    &lt;tr&gt;
                        &lt;th&gt;Id&lt;/th&gt;
                        &lt;th&gt;Title&lt;/th&gt;
                        &lt;th&gt;Category&lt;/th&gt;
                        &lt;th&gt;Edit&lt;/th&gt;
                    &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;{rows}&lt;/tbody&gt;
            &lt;/table&gt;
        );
    }
});

var BookForm = React.createClass({
    getInitialState: function() {
        if (this.props.book) {
            return this.props.book;
        } else {
            return {};
        }
    },
    componentWillReceiveProps: function(props) {
        if (props.book) {
            this.setState(props.book);
        } else {
            this.replaceState({});
        }
    },
    render: function() {
        return(
            &lt;form onSubmit={this.onSubmit}&gt;
                &lt;label forHtml='title'&gt;Title&lt;/label&gt;&lt;input ref='title' name='title' type='text' value={this.state.title} onChange={this.onFormChange} /&gt;
                &lt;label forHtml='category'&gt;Category&lt;/label&gt;
                &lt;select ref='category' name='category' value={this.state.category} onChange={this.onFormChange} &gt;
                    &lt;option value='CRIME' &gt;Crime&lt;/option&gt;
                    &lt;option value='HISTORY'&gt;History&lt;/option&gt;
                    &lt;option value='HORROR'&gt;Horror&lt;/option&gt;
                    &lt;option value='SCIFI'&gt;SciFi&lt;/option&gt;
                &lt;/select&gt;
                &lt;br /&gt;
                &lt;input type='submit' value={this.state.id?&quot;Save (id = &quot; +this.state.id+ &quot;)&quot;:&quot;Add&quot;} /&gt;
                {this.state.id?&lt;button onClick={this.onDeleteClick}&gt;Delete&lt;/button&gt;:&quot;&quot;}
                {this.state.id?&lt;button onClick={this.onCancelClick}&gt;Cancel&lt;/button&gt;:&quot;&quot;}
                {this.props.message?&lt;div&gt;{this.props.message}&lt;/div&gt;:&quot;&quot;}
            &lt;/form&gt;
        );
    },
    onFormChange: function() {
        this.setState({
            title: React.findDOMNode(this.refs.title).value,
            category: React.findDOMNode(this.refs.category).value
        })
    },
    onSubmit: function(e) {
        e.preventDefault();
        BookActions.save(this.state)
    },
    onCancelClick: function(e) {
        e.preventDefault();
        BookActions.edit_cancel()
    },
    onDeleteClick: function(e) {
        e.preventDefault();
        BookActions.delete(this.state.id)
    }
});

var SearchPanel = React.createClass({
    getInitialState: function() {
        return {
            search: '',
        }
    },
    render: function() {
        return (
            &lt;div className=&quot;row&quot;&gt;
                &lt;div className=&quot;one-fourth column&quot;&gt;
                    Filter: &amp;nbsp;
                    &lt;input ref='search' name='search' type='text' value={this.state.search} onChange={this.onSearchChange} /&gt;
                    {this.state.search?&lt;button onClick={this.onClearSearch} &gt;x&lt;/button&gt;:''}
                &lt;/div&gt;
            &lt;/div&gt;
        )
    },
    onSearchChange: function() {
        var query = React.findDOMNode(this.refs.search).value;
        if (this.promise) {
            clearInterval(this.promise)
        }
        this.setState({
            search: query
        });
        this.promise = setTimeout(function () {
            BookActions.search(query);
        }.bind(this), 200);
    },
    onClearSearch: function() {
        this.setState({
            search: ''
        });
        BookActions.search('');
    }
});

var BookPanel = React.createClass({
    getInitialState: function() {
        return BookStore.getState();
    },
    render: function() {
        return(
            &lt;div className=&quot;row&quot;&gt;
                &lt;div className=&quot;one-half column&quot;&gt;
                    &lt;SearchPanel&gt;&lt;/SearchPanel&gt;
                    &lt;BookTable books={this.state.books} /&gt;
                &lt;/div&gt;
                &lt;div className=&quot;one-half column&quot;&gt;
                    &lt;BookForm
                        book={this.state.editingBook}
                        message={this.state.message}
                    /&gt;
                &lt;/div&gt;
                &lt;br /&gt;
            &lt;/div&gt;
        );
    },
    _onChange: function() {
        this.setState( BookStore.getState() );
    },
    componentWillUnmount: function() {
        BookStore.removeChangeListener(this._onChange);
    },
    componentDidMount: function() {
        BookStore.addChangeListener(this._onChange);
    }
});

module.exports.BookPanel = BookPanel ;
</pre>
<p>Only the <tt class="docutils literal">BookPanel</tt> is exported &#8212; all other react components will be private to the&nbsp;module.</p>
<p>We can see that, beyond BookPanel, the code of all other components
are more or less the same. However, <em>not</em> having to pass callbacks for state upddates
is a huge win for readability and&nbsp;DRYness.</p>
</div>
</div>
<div class="section" id="explaining-the-data-flow">
<h2><a class="toc-backref" href="#toc-entry-9">Explaining the data&nbsp;flow</a></h2>
<p>I&#8217;ve added a bunch of console.log statements to see how the data/actions flow between
all the components when the &#8220;Edit&#8221; book is clicked. So, when we click &#8220;Edit&#8221; we see
the following messages to our&nbsp;console:</p>
<pre class="code literal-block">
Inside BookTableRow.onClick
Inside BookActions.edit
Inside AppDispatcher.register
Inside AppDispatcher.register case BookConstants.BOOK_EDIT
Inside _editBook
Inside BookStore.emitChange
Inside BookPanel._onChange
Inside BookForm.componentWillReceiveProps
Inside BookForm.render
</pre>
<p>First of all the <tt class="docutils literal">onClick</tt> method of <tt class="docutils literal">BookTableRow</tt> will be called (which is the onClick property of the
a href link) which will call <tt class="docutils literal">BookActions.edit</tt> and pass it the book of that specific row. The <tt class="docutils literal">edit</tt>
method will create a new dispatcher object by setting the <tt class="docutils literal">actionType</tt> and passing the <tt class="docutils literal">book</tt> and
pass it to <tt class="docutils literal">AppDispatcher.register</tt>. <tt class="docutils literal">register</tt> will go to the <tt class="docutils literal">BookConstants.BOOK_EDIT</tt> case branch
which will call the private <tt class="docutils literal">_editBook</tt> function. <tt class="docutils literal">_editBook</tt> will update the state of the store (by
setting the <tt class="docutils literal">_state.editingBook</tt> property and will call the <tt class="docutils literal">BookStore.emitChange</tt> method
which calls the dispatcher&#8217;s emit method, so all listening components will update. We only have one
component that listens to this emit, <tt class="docutils literal">BookPanel</tt> whose <tt class="docutils literal">_onChange</tt> method is called. This method
gets the application state from the <tt class="docutils literal">BookStore</tt> and updates its own state. Now, the state will be
propagated through properties - for example, for <tt class="docutils literal">BookForm</tt>, first its <tt class="docutils literal">componentWillReceiveProps</tt>
method will be called (with the new properties) and finally its <tt class="docutils literal">render</tt> method!</p>
<p>So the full data flow is something like&nbsp;this:</p>
<pre class="code literal-block">
user action/callback etc -&gt;
  component calls action -&gt;
    dispatcher informes stores -&gt;
      stores set their state -&gt;
        state holding components are notified and update their state -&gt;
          all other components are updated through properties
</pre>
</div>
<div class="section" id="a-better-code-organization">
<h2><a class="toc-backref" href="#toc-entry-10">A better code&nbsp;organization</a></h2>
<p>As you&#8217;ve seen, I&#8217;ve only created four javascript modules (components, stores, actions and constants)
and put them all in the same folder. I did this for clarity and to keep everything together since
our tutorial is a very small project. Facebook proposes a much better organization that what I did
as can be seen in the <a class="reference external" href="https://facebook.github.io/flux/docs/todo-list.html">TodoMVC tutorial</a>: Instead of putting everything to a single folder, create
a different foloder for each type of object: actions (for all your actions), components (for all
your React components), constants and stores and put inside the objects each in a different javascript
module, for example, the components folder should contain the following&nbsp;files:</p>
<ul class="simple">
<li>BookTable.react.js</li>
<li>BookTableRow.react.js</li>
<li>BookForm.react.js</li>
<li>BookPanel.react.js</li>
<li>SearchPanel.react.js</li>
</ul>
<p>Each one will export only the same-named React component and <tt class="docutils literal">require</tt> only the components that it&nbsp;uses.</p>
<p>If you want to see the code of this tutorial organized like this go to the tag <tt class="docutils literal"><span class="pre">react-flux-better-organization</span></tt>.</p>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#toc-entry-11">Conclusion</a></h2>
<p>In this two-part series we saw how we can create a full <span class="caps">CRUD</span> application with React.js and how can
we enable it with the Facebook proposed Flux architecture. Comparing the react-only with the react-flux
version we can see that we added a number of objects in the second version (dispatcher, store, actions, constants)
whose usefulness may not be obvious from our example. However, our created application (and especially
the better organized version) is war-ready and can easily fight any complexities that we throw to it!
Unfortunately, if we really wanted to show the usefulness of the Flux architecture we&#8217;d need to create
a really complex application that won&#8217;t be suitable for a&nbsp;tutorial.</p>
<p>However, we can already understand the obvious advantages of the React / Flux&nbsp;architecture:</p>
<ul class="simple">
<li>Components can easily be re-used by changing their properties - <span class="caps">DRY</span></li>
<li>Easy to grasp (but a little complex) data flow between components and&nbsp;stores</li>
<li>Separation of concerns - react components for the view, stores to hold the state/models, dispatcher to handle the data&nbsp;flow</li>
<li>Really easy to test - all components are simple objects and can be easily created fom&nbsp;tests</li>
<li>Works well for complex architectures - one dispatcher, multiple stores/action collections, react components only interact with actions and get their state from&nbsp;stores</li>
</ul>
<p>I&#8217;ve tried to make the above as comprehensive as possible for the readers of these posts
(and also resolve some of my own questions). I have to mention again that although React/Flux may
seem complex at a first glance, when it is used in a complex architecture it will shine and
make everything much easier. Everything is debuggable and we can always understand what&#8217;s
really going on! This is in contrast with more complex frameworks that do various hidden
stuff (two way data binding, magic in the <span class="caps">REST</span> etc) where, although it is easier to
create a simple app, moving to something more complex (and especially debugging it) is a real&nbsp;nightmare!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2015/06/05/comprehensive-react-flux-tutorial/">A comprehensive React and Flux tutorial part 1: React</a>
      </h1>
    <p class="meta">
<time datetime="2015-06-05T14:20:00+03:00" pubdate>Fri 05 June 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title"><a class="reference internal" href="#top">Contents</a></p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="toc-entry-1">Introduction</a></li>
<li><a class="reference internal" href="#our-project" id="toc-entry-2">Our&nbsp;project</a></li>
<li><a class="reference internal" href="#a-top-level-view-of-the-components" id="toc-entry-3">A top-level view of the&nbsp;components</a></li>
<li><a class="reference internal" href="#the-react-only-version" id="toc-entry-4">The react-only version</a><ul>
<li><a class="reference internal" href="#searchpanel" id="toc-entry-5"><tt class="docutils literal">SearchPanel</tt></a></li>
<li><a class="reference internal" href="#booktablerow" id="toc-entry-6"><tt class="docutils literal">BookTableRow</tt></a></li>
<li><a class="reference internal" href="#booktable" id="toc-entry-7"><tt class="docutils literal">BookTable</tt></a></li>
<li><a class="reference internal" href="#interlude-the-bind-function-method" id="toc-entry-8">Interlude: The <tt class="docutils literal">bind</tt> function&nbsp;method</a></li>
<li><a class="reference internal" href="#bookform" id="toc-entry-9"><tt class="docutils literal">BookForm</tt></a></li>
<li><a class="reference internal" href="#bookpanel" id="toc-entry-10"><tt class="docutils literal">BookPanel</tt></a><ul>
<li><a class="reference internal" href="#component-methods" id="toc-entry-11">Component&nbsp;methods</a></li>
<li><a class="reference internal" href="#non-ajax-object-methods" id="toc-entry-12">Non-ajax object&nbsp;methods</a></li>
<li><a class="reference internal" href="#ajax-object-methods" id="toc-entry-13">Ajax object&nbsp;methods</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#local-state" id="toc-entry-14">Local&nbsp;state</a></li>
<li><a class="reference internal" href="#adding-form-validation" id="toc-entry-15">Adding form&nbsp;validation</a></li>
<li><a class="reference internal" href="#conclusion-to-the-first-part" id="toc-entry-16">Conclusion to the first&nbsp;part</a></li>
</ul>
</div>
<p><strong>Update 15/12/2015</strong>: Added some insights for form&nbsp;validation.</p>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#toc-entry-1">Introduction</a></h2>
<p><a class="reference external" href="https://facebook.github.io/react/">React</a> is a rather new library from Facebook for building dynamic components for web pages.
It introduces a really simple, fresh approach to javascript user interface building. React
allows you to define composable and self-contained <span class="caps">HTML</span> components through Javascript (or a special syntax that compiles
to javascript named <span class="caps">JSX</span>) and that&#8217;s all &#8212; it doesn&#8217;t force you into any specific
framework or architecture, you may use whatever you like. It&#8217;s like writing pure
<span class="caps">HTML</span> but you have the advantage of using classes with all their advantages for your
components (self-contained, composable, reusable, mixins&nbsp;etc).</p>
<p>Although React components can be used however you like in your client-side applications, Facebook proposes a specific
architecture for the data flow of your events/data between the components called <a class="reference external" href="https://facebook.github.io/flux/docs/overview.html">Flux</a>.
It&#8217;s important to keep in your mind that Flux is not a
specific framework but a way to organize the flow of events and data in your applicition.
Unfortunately, although Flux is a rather simple architecture it is a little difficult to understand
without a proper example (at least it was difficult for me to understand by reading the
Facebook documentation and some tutorials I&nbsp;found).</p>
<p>So, in this two-part tutorial we are going to build a (not-so-simple) single page <span class="caps">CRUD</span> application using
React and Flux. Two versions of the same application will be built and explained: One with
React (this part) only and one with React and Flux (part two). This will help us understand how
Flux architecture fits to our project and why it greatly improves the experience with&nbsp;React.</p>
<p><strong>Warning</strong>: This is not an introduction to react. Before reading this you need
to be familiar with basic react usage, having read  at least the following three
pages from react&nbsp;documentation:</p>
<ul class="simple">
<li><a class="reference external" href="https://facebook.github.io/react/docs/getting-started.html">https://facebook.github.io/react/docs/getting-started.html</a></li>
<li><a class="reference external" href="https://facebook.github.io/react/docs/tutorial.html">https://facebook.github.io/react/docs/tutorial.html</a></li>
<li><a class="reference external" href="https://facebook.github.io/react/docs/thinking-in-react.html">https://facebook.github.io/react/docs/thinking-in-react.html</a></li>
</ul>
</div>
<div class="section" id="our-project">
<h2><a class="toc-backref" href="#toc-entry-2">Our&nbsp;project</a></h2>
<p>We are going to built a <span class="caps">CRUD</span> single-page application for editing views, let&#8217;s take a look at how it&nbsp;works:</p>
<img alt="Our project" src="/images/demo.gif" style="width: 780px;" />
<p>Our application will be seperated to two panels: In  the left one the user will be able to filter (search) for
a book and in the right panel she&#8217;ll be able to add / edit / delete a book. Everything is supported by
a <a class="reference external" href="http://www.django-rest-framework.org/">django-rest-framework</a> implemented <span class="caps">REST</span> <span class="caps">API</span>. You can find the complete source code at
<a class="reference external" href="https://github.com/spapas/react-tutorial">https://github.com/spapas/react-tutorial</a>. I&#8217;ve added a couple of git tags to the source history in
order to help us identify the differences between variou stages of the project (before and
after integrating the Flux&nbsp;architecture).</p>
<p>Django-rest-framework is used in the server-side back-end to create a really simple <span class="caps">REST</span> <span class="caps">API</span> - I won&#8217;t
provide any tutorial details on that (unless somebody wants it !), however
you may either use the source code as is or create it from scratch using a different language/framework
or even just a static json file (however you won&#8217;t see any changes to the data this&nbsp;way).</p>
<p>For styling (mainly to have a simple grid) we&#8217;ll use <a class="reference external" href="http://getskeleton.com/">skeleton</a>. For the ajax calls and some utils we&#8217;ll
use <a class="reference external" href="https://jquery.com/">jquery</a>.</p>
<p>All client-side code will be contained in the file static/main.js. The placeholder <span class="caps">HTML</span> for our
application&nbsp;is:</p>
<pre class="code literal-block">
&lt;html&gt;
  &lt;!-- styling etc ignored --&gt;
&lt;body&gt;
  &lt;h1&gt;Hello, React!&lt;/h1&gt;
  &lt;div class=&quot;container&quot;&gt;&lt;div id=&quot;content&quot;&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;script src=&quot;//fb.me/react-0.13.3.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;//fb.me/JSXTransformer-0.13.3.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;//code.jquery.com/jquery-2.1.3.min.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/jsx&quot; src=&quot;{% static 'main.js' %}&quot;&gt;&lt;/script&gt;
&lt;/html&gt;
</pre>
<p>We are using the version 0.13.3 of react and the same version of the JSXTransformer to translate <span class="caps">JSX</span>
code to pure&nbsp;javascript.</p>
</div>
<div class="section" id="a-top-level-view-of-the-components">
<h2><a class="toc-backref" href="#toc-entry-3">A top-level view of the&nbsp;components</a></h2>
<p>The following image shows how our components are&nbsp;composed:</p>
<img alt="Our components" src="/images/components.png" style="width: 780px;" />
<p>So, the main component of our application is <tt class="docutils literal">BookPanel</tt> which contains three&nbsp;components:</p>
<ul class="simple">
<li><tt class="docutils literal">SearchPanel</tt>: To allow search (filtering) books based on their&nbsp;title/category</li>
<li><tt class="docutils literal">BookForm</tt>: To add/update/delete&nbsp;books</li>
<li><tt class="docutils literal">BookTable</tt>: To display all available books - each book is displayed in a <tt class="docutils literal">BookTableRow</tt> component.</li>
</ul>
<p><tt class="docutils literal">BookPanel</tt> is the only component having state &#8212; all other components will be initialized by property
passing. The <tt class="docutils literal">BookPanel</tt> element will be mounted to the <tt class="docutils literal">#content</tt> element when the page&nbsp;loads.</p>
</div>
<div class="section" id="the-react-only-version">
<h2><a class="toc-backref" href="#toc-entry-4">The react-only&nbsp;version</a></h2>
<p>The first version, using only react (and not flux) will use <tt class="docutils literal">BookPanel</tt> as a central information <span class="caps">HUB</span>.</p>
<div class="section" id="searchpanel">
<h3><a class="toc-backref" href="#toc-entry-5"><tt class="docutils literal">SearchPanel</tt></a></h3>
<p><tt class="docutils literal">SearchPanel</tt> renders an input element with a value defined by the <tt class="docutils literal">search</tt> key of this component&#8217;same
properties. When this is changed the <tt class="docutils literal">onSearchChanged</tt> method of the component will be called, which in turn,
retrieves the value of the input (using refs) and passes it to the properties <tt class="docutils literal">onSearchChanged</tt> callback function.
Finally, with the line <tt class="docutils literal"><span class="pre">{this.props.search?&lt;button</span> <span class="pre">onClick={this.props.onClearSearch}</span> <span class="pre">&gt;x&lt;/button&gt;:null}</span></tt>
we check if the search property contains any text and if yes, we display a clear filter button that will call
properties onClearSearch&nbsp;method:</p>
<pre class="code literal-block">
var SearchPanel = React.createClass({
  render: function() {
    return (
      &lt;div className=&quot;row&quot;&gt;
        &lt;div className=&quot;one-fourth column&quot;&gt;
          Filter: &amp;nbsp;
          &lt;input ref='search' type='text' value={this.props.search} onChange={this.onSearchChanged} /&gt;
          {this.props.search?&lt;button onClick={this.props.onClearSearch} &gt;x&lt;/button&gt;:null}
        &lt;/div&gt;
      &lt;/div&gt;
    )
  },
  onSearchChanged: function() {
    var query = React.findDOMNode(this.refs.search).value;
    this.props.onSearchChanged(query);
  }
});
</pre>
<p>So, this component has three&nbsp;properties:</p>
<ul class="simple">
<li>search which is the text to display in the input&nbsp;box</li>
<li>onSearchChanged (callback) which is called when the contents of the input box are&nbsp;changed</li>
<li>onClearSearch (callback) which is called when the button is&nbsp;pressed</li>
</ul>
<p>Notice that this component doesn&#8217;t do anything - for all actions it uses the callbacks passed to it &#8212;this
means that exactly the same component would easily be reused in a totally different application or could
be duplicated if we wanted to have a different search component for the book title and&nbsp;category.</p>
<p>Another thing to notice is that the local <tt class="docutils literal">onSearchChanged</tt> method is defined only to help us retrieve the
value of the input and use it to call the <tt class="docutils literal">onSearchChanged</tt> callback. Instead, we could just call the
passed
<tt class="docutils literal">this.props.onSearchChanged</tt> &#8212; however to do this we&#8217;d need a way to find the value of the input. This
could be done if we added a ref to the included <tt class="docutils literal">SearchPanel</tt> from the parent component, so
we&#8217;d be able to use something like
<tt class="docutils literal"><span class="pre">React.findDOMNode(this.refs.searchPanel.refs.search).value</span></tt> to find out the value of the input
(see that we use a ref to go to the searchPanel component and another ref to go to input&nbsp;component).</p>
<p>Both versions (getting the value directly from the child component or using the callback) could be used, however I
believe that the callback version defines a more clear interface since the parent component shouldn&#8217;t need
to know the implementation details of its&nbsp;children.</p>
</div>
<div class="section" id="booktablerow">
<h3><a class="toc-backref" href="#toc-entry-6"><tt class="docutils literal">BookTableRow</tt></a></h3>
<p><tt class="docutils literal">BookTableRow</tt> will render a table row by creating a simple table row that will contain the <tt class="docutils literal">title</tt>
and <tt class="docutils literal">category</tt> attributes of the passed book property and an edit link that will call the <tt class="docutils literal">handleEditClickPanel</tt>
property by passing the id of that&nbsp;book:</p>
<pre class="code literal-block">
var BookTableRow = React.createClass({
  render: function() {
    return (
      &lt;tr&gt;
        &lt;td&gt;{this.props.book.title}&lt;/td&gt;
        &lt;td&gt;{this.props.book.category}&lt;/td&gt;
        &lt;td&gt;&lt;a href='#' onClick={this.onClick}&gt;Edit&lt;/a&gt;&lt;/td&gt;
      &lt;/tr&gt;
    );
  },
  onClick: function(id) {
    this.props.handleEditClickPanel(this.props.book.id);
  }
});
</pre>
<p>This component is used by <tt class="docutils literal">BookTable</tt> to render each one of the&nbsp;books.</p>
</div>
<div class="section" id="booktable">
<h3><a class="toc-backref" href="#toc-entry-7"><tt class="docutils literal">BookTable</tt></a></h3>
<p>This component create the left-side table using an array of <tt class="docutils literal"><span class="pre">BookTableRow``s</span> by passing it each one of the
books of the ``books</tt> array property. The <tt class="docutils literal">handleEditClickPanel</tt>
property is retrieved from the parent of the component and passed as is to the&nbsp;row.</p>
<pre class="code literal-block">
var BookTable = React.createClass({
  render: function() {
    var rows = [];
    this.props.books.forEach(function(book) {
      rows.push(&lt;BookTableRow key={book.id} book={book} handleEditClickPanel={this.props.handleEditClickPanel}  /&gt;);
    }.bind(this));
    return (
      &lt;table&gt;
        &lt;thead&gt;
          &lt;tr&gt;
            &lt;th&gt;Title&lt;/th&gt;
            &lt;th&gt;Category&lt;/th&gt;
            &lt;th&gt;Edit&lt;/th&gt;
          &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;{rows}&lt;/tbody&gt;
      &lt;/table&gt;
    );
  }
});
</pre>
<p>The key attribute is used by React to uniquely identify each component - we are using the id (primary key)
of each book. Before continuing with the other components, I&#8217;d like to explain what is the purpose of that
strange <tt class="docutils literal">bind</tt> call!</p>
</div>
<div class="section" id="interlude-the-bind-function-method">
<h3><a class="toc-backref" href="#toc-entry-8">Interlude: The <tt class="docutils literal">bind</tt> function&nbsp;method</a></h3>
<p><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind">bind</a> is a method of the function javascript object, since in javascript <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function">functions are objects</a>! This
method is useful for a number of things, however here we use it to set the <tt class="docutils literal">this</tt> keyword of the
anonymous function that is passed to foreach to the <tt class="docutils literal">this</tt> keyword of the <tt class="docutils literal">render</tt> method of <tt class="docutils literal">BookTable</tt>,
which will be the current BookTable&nbsp;instance.</p>
<p>To make things crystal: Since we are using an anonymous function to pass to <tt class="docutils literal">forEach</tt>, this anonymous
function won&#8217;t have a <tt class="docutils literal">this</tt> keyword set to the current <tt class="docutils literal">BookTable</tt> object so we will get an error
that <tt class="docutils literal">this.props</tt> is undefined. That&#8217;s why we use bind to set <tt class="docutils literal">this</tt> to the current <tt class="docutils literal">BookTable</tt>. If
instead of using the anonymous function we had created a <tt class="docutils literal">createBookTableRow</tt> method inside the
<tt class="docutils literal">BookTable</tt> object that returned the <tt class="docutils literal">BookTableRow</tt> and passed <tt class="docutils literal">this.createBookTableRow</tt> to
<tt class="docutils literal">forEach</tt>, we wouldn&#8217;t have to use bind (notice that we&#8217;d also need to make rows a class attribute
and  refer to it through <tt class="docutils literal">this.rows</tt> for this to&nbsp;work).</p>
</div>
<div class="section" id="bookform">
<h3><a class="toc-backref" href="#toc-entry-9"><tt class="docutils literal">BookForm</tt></a></h3>
<p><tt class="docutils literal">BookForm</tt> will create a form to either create a new book or update/delete an existing one. It has a <tt class="docutils literal">book</tt> object
property - when this object has an <tt class="docutils literal">id</tt> (so it is saved to the database) the update/delete/cancel buttons will be shown,
when it doesn&#8217;t have an id the add button will be&nbsp;shown.</p>
<pre class="code literal-block">
var BookForm = React.createClass({
  render: function() {
    return(
      &lt;form onSubmit={this.props.handleSubmitClick}&gt;
        &lt;label forHtml='title'&gt;Title&lt;/label&gt;&lt;input ref='title' name='title' type='text' value={this.props.book.title} onChange={this.onChange}/&gt;
        &lt;label forHtml='category'&gt;Category&lt;/label&gt;
        &lt;select ref='category' name='category' value={this.props.book.category} onChange={this.onChange} &gt;
          &lt;option value='CRIME' &gt;Crime&lt;/option&gt;
          &lt;option value='HISTORY'&gt;History&lt;/option&gt;
          &lt;option value='HORROR'&gt;Horror&lt;/option&gt;
          &lt;option value='SCIFI'&gt;SciFi&lt;/option&gt;
        &lt;/select&gt;
        &lt;br /&gt;
        &lt;input type='submit' value={this.props.book.id?&quot;Save (id = &quot; +this.props.book.id+ &quot;)&quot;:&quot;Add&quot;} /&gt;
        {this.props.book.id?&lt;button onClick={this.props.handleDeleteClick}&gt;Delete&lt;/button&gt;:null}
        {this.props.book.id?&lt;button onClick={this.props.handleCancelClick}&gt;Cancel&lt;/button&gt;:null}
        {this.props.message?&lt;div&gt;{this.props.message}&lt;/div&gt;:null}
      &lt;/form&gt;
    );
  },
  onChange: function() {
    var title = React.findDOMNode(this.refs.title).value;
    var category = React.findDOMNode(this.refs.category).value;
    this.props.handleChange(title, category);
  }
});
</pre>
<p>As we can see, this component uses many properties &#8212; most are passed callbacks functions for various&nbsp;actions:</p>
<ul class="simple">
<li><tt class="docutils literal">book</tt>: This will either be a new book object (without and id) when adding one or an existing (from the database) book when updating&nbsp;one.</li>
<li><tt class="docutils literal">message</tt>: To display the result of the last operation (save/delete) &#8212; this is passed by the parent and probably it would be better if I had put it in a different component (and added styling&nbsp;etc).</li>
<li><tt class="docutils literal">handleSubmitClick</tt>: Will be called when the submit button is pressed to save the form (either by adding or&nbsp;updating).</li>
<li><tt class="docutils literal">handleCancelClick</tt>: Will be called when the cancel button is pressed &#8212; we decide that we want actually want to edit a&nbsp;book.</li>
<li><tt class="docutils literal">handleDeleteClick</tt>: Will be called when the delete button is&nbsp;pressed.</li>
<li><tt class="docutils literal">handleChange</tt>: Will be called whenever the title or the category of the currently edited book is changed through the local onChange method. The onChange will retrieve that values of title and category and pass them to handleChange to do the state update. As already discussed, we could retrieve the values immediately from the parent but this creates a better interface to our&nbsp;component.</li>
</ul>
</div>
<div class="section" id="bookpanel">
<h3><a class="toc-backref" href="#toc-entry-10"><tt class="docutils literal">BookPanel</tt></a></h3>
<p>The <tt class="docutils literal">BookPanel</tt> component will contain all other components, will keep the global state
and will also act as a central communications <span class="caps">HUB</span> between the components and the server. Because
it is rather large class, I will explain it in three&nbsp;parts:</p>
<div class="section" id="component-methods">
<h4><a class="toc-backref" href="#toc-entry-11">Component&nbsp;methods</a></h4>
<p>In the first part of <tt class="docutils literal">BookPanel</tt>, its react component methods will be&nbsp;presented:</p>
<pre class="code literal-block">
var BookPanel = React.createClass({
  getInitialState: function() {
    return {
      books: [],
      editingBook: {
        title:&quot;&quot;,
        category:&quot;&quot;,
      },
      search:&quot;&quot;,
      message:&quot;&quot;
    };
  },
  render: function() {
    return(
      &lt;div className=&quot;row&quot;&gt;
        &lt;div className=&quot;one-half column&quot;&gt;
          &lt;SearchPanel
            search={this.state.search}
            onSearchChanged={this.onSearchChanged}
            onClearSearch={this.onClearSearch}
          /&gt;
          &lt;BookTable books={this.state.books} handleEditClickPanel={this.handleEditClickPanel} /&gt;
        &lt;/div&gt;
        &lt;div className=&quot;one-half column&quot;&gt;
          &lt;BookForm
            book={this.state.editingBook}
            message={this.state.message}
            handleChange={this.handleChange}
            handleSubmitClick={this.handleSubmitClick}
            handleCancelClick={this.handleCancelClick}
            handleDeleteClick={this.handleDeleteClick}
          /&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    );
  },
  componentDidMount: function() {
    this.reloadBooks('');
  },
  // To be continued ...
</pre>
<p><tt class="docutils literal">getInitialState</tt> is called the first time the component is created or mounted (attached to an <span class="caps">HTML</span> component in the page
and should return the initial values of the state - here we return an object with empty placeholders. <tt class="docutils literal">componentDidMount</tt>
will be called <em>after</em> the component is mounted and that&#8217;s the place we should do any initializationn &#8212; here we call the
<tt class="docutils literal">reloadBooks</tt> method (with an empty search string) to just retrieve all books. Finally, the <tt class="docutils literal">render</tt> method creates a
<tt class="docutils literal">div</tt> that will contain all other components and initializes their properties with either state variables or object methods
(these are the callbacks that were used in all other&nbsp;components).</p>
</div>
<div class="section" id="non-ajax-object-methods">
<h4><a class="toc-backref" href="#toc-entry-12">Non-ajax object&nbsp;methods</a></h4>
<pre class="code literal-block">
// Continuing from above
onSearchChanged: function(query) {
  if (this.promise) {
    clearInterval(this.promise)
  }
  this.setState({
    search: query
  });
  this.promise = setTimeout(function () {
    this.reloadBooks(query);
  }.bind(this), 200);
},
onClearSearch: function() {
  this.setState({
    search: ''
  });
  this.reloadBooks('');
},
handleEditClickPanel: function(id) {
  var book = $.extend({}, this.state.books.filter(function(x) {
    return x.id == id;
  })[0] );

  this.setState({
    editingBook: book,
    message: ''
  });
},
handleChange: function(title, category) {
  this.setState({
    editingBook: {
      title: title,
      category: category,
      id: this.state.editingBook.id
    }
  });
},
handleCancelClick: function(e) {
  e.preventDefault();
  this.setState({
    editingBook: {}
  });
},
// to be continued ...
</pre>
<p>All the above function change the <tt class="docutils literal">BookPanel</tt> state so that the properties of the child components will
also be&nbsp;updated:</p>
<ul class="simple">
<li><tt class="docutils literal">onSearchChanged</tt> is called when the search text is changed. The behavior here is interesting: Instead of immediately reloading the books, we create a timeout to be executed after 200 ms (also notice the usage of the <tt class="docutils literal">bind</tt> function method to allow us call the <tt class="docutils literal">reloadBooks</tt> method). If the user presses a key before these 200 ms, we cancel the previous timeout (using <tt class="docutils literal">clearInterval</tt>) and create a new one. This technique greatly reduces ajax calls to the server when the user is just typing something in the search box &#8212; we could even increase the delay to reduce even more the ajax calls (but hurt the user experience a bit since the user will notice that his search results won&#8217;t be updated&nbsp;immediately).</li>
<li><tt class="docutils literal">onClearSearch</tt> is called when the clear filter button is pressed and removes the search text and reloads all&nbsp;books.</li>
<li><tt class="docutils literal">handleEditClickPanel</tt> is called when the edit link of a <tt class="docutils literal">BookTableRow</tt> is clicked. The book with the passed <tt class="docutils literal">id</tt> will be found (using filter) and then a clone of it will be created with (<tt class="docutils literal">$.extend</tt>) and will be used to set the <tt class="docutils literal">editingBook</tt> state attribute. If instead of the clone we passed the filtered book object we&#8217;d see that when the title or category in the <tt class="docutils literal">BookForm</tt> were changed they&#8217;d also be changed in the <tt class="docutils literal">BookTableRow</tt>!</li>
<li><tt class="docutils literal">handleChange</tt> just changes the state of the currently edited book based on the values passed (it does not modify the id of the&nbsp;book)</li>
<li><tt class="docutils literal">handleCancelClick</tt> when the cancel editing is pressed we clear the <tt class="docutils literal">editingBook</tt> state attribute. Notice the <tt class="docutils literal">e.preventDefault()</tt> method that needs to be there in order to prevent the form from submitting since the form submitting would result in an undesirable full page&nbsp;reload!</li>
</ul>
</div>
<div class="section" id="ajax-object-methods">
<h4><a class="toc-backref" href="#toc-entry-13">Ajax object&nbsp;methods</a></h4>
<p>Finally, we need a buncch of object methods that use ajax calls to retrieve or update&nbsp;books:</p>
<pre class="code literal-block">
  // Continuing from above
  reloadBooks: function(query) {
    $.ajax({
      url: this.props.url+'?search='+query,
      dataType: 'json',
      cache: false,
      success: function(data) {
        this.setState({
          books: data
        });
      }.bind(this),
      error: function(xhr, status, err) {
        console.error(this.props.url, status, err.toString());
        this.setState({
          message: err.toString(),
          search: query
        });
      }.bind(this)
    });
  },
  handleSubmitClick: function(e) {
    e.preventDefault();
    if(this.state.editingBook.id) {
      $.ajax({
        url: this.props.url+this.state.editingBook.id,
        dataType: 'json',
        method: 'PUT',
        data:this.state.editingBook,
        cache: false,
        success: function(data) {
          this.setState({
            message: &quot;Successfully updated book!&quot;
          });
          this.reloadBooks('');
        }.bind(this),
        error: function(xhr, status, err) {
          console.error(this.props.url, status, err.toString());
          this.setState({
            message: err.toString()
          });
        }.bind(this)
      });
    } else {
      $.ajax({
        url: this.props.url,
        dataType: 'json',
        method: 'POST',
        data:this.state.editingBook,
        cache: false,
        success: function(data) {
          this.setState({
            message: &quot;Successfully added book!&quot;
          });
          this.reloadBooks('');
        }.bind(this),
        error: function(xhr, status, err) {
          console.error(this.props.url, status, err.toString());
          this.setState({
            message: err.toString()
          });
        }.bind(this)
      });
    }
    this.setState({
      editingBook: {}
    });
  },
  handleDeleteClick: function(e) {
  e.preventDefault();
  $.ajax({
    url: this.props.url+this.state.editingBook.id,
    method: 'DELETE',
    cache: false,
    success: function(data) {
      this.setState({
          message: &quot;Successfully deleted book!&quot;,
          editingBook: {}
      });
      this.reloadBooks('');
    }.bind(this),
    error: function(xhr, status, err) {
      console.error(this.props.url, status, err.toString());
      this.setState({
          message: err.toString()
      });
    }.bind(this)
    });
  },
});
</pre>
<ul class="simple">
<li><tt class="docutils literal">reloadBooks</tt> will try to load the books using an ajax <span class="caps">GET</span> and pass its query parameter to filter the books (or get all books if query is an empty string). If the ajax call was successfull the state will be updated with the retrieved books and the search text (to clear the  search text when we reload because of a save/edit/delete) while if there was an error the state will be updated with the error message. The books will be returned as a json array of book&nbsp;objects.</li>
<li><tt class="docutils literal">handleSubmitClick</tt> checks if the state&#8217;s <tt class="docutils literal">editingBook</tt> has an id and  will do either a <span class="caps">POST</span> to create a new book or a <span class="caps">PUT</span> to update the existing one. Depending on the result of the operation will either reload books and clear the editingBook or set the error&nbsp;message.</li>
<li><tt class="docutils literal">handleDeleteClick</tt> will do a <span class="caps">DELETE</span> to delete the state&#8217;s <tt class="docutils literal">editingBook</tt> and clear&nbsp;it.</li>
</ul>
<p>Notice that all success and error functions above were binded to <tt class="docutils literal">this</tt> so that they could update the state of the current <tt class="docutils literal">BookPanel</tt> object.</p>
<p>After each succesfull ajax call we do a reload to the books to keep the state between server and client side consistent. We could
instead update the book array immediately before doing the ajax call - however this would increase complexity
(what should happen if an error happens at the ajax call) without improving the <span class="caps">UX</span> that much. A better solution
would be to add a loading css&nbsp;animation.</p>
</div>
</div>
</div>
<div class="section" id="local-state">
<h2><a class="toc-backref" href="#toc-entry-14">Local&nbsp;state</a></h2>
<p>One thing to keep in mind is that there should only be one place of truth for the state and
that the state should be as high in the component hierarch as possible. All changes should
be propagated to thhe child components through properties.
That&#8217;s the only way to be sure of the your data flow: When a change should happen
(either because of a user action or an asynchronous call e.g ajax or timeout) just
go to the state-holding component up in the hierarchy and change its state. Then the
changes will be propagated in a top-down fashion from that component to its&nbsp;children.</p>
<p>The above paragraph does not mean that the state should be contained in just a single
component! For example, let&#8217;s say that we had an <tt class="docutils literal">AuthorPanel</tt> in the same web application
and both <tt class="docutils literal">BookPanel</tt> and <tt class="docutils literal">AuthorPanel</tt> would be contained in a <tt class="docutils literal">BookAuthorPanel</tt>.
In this case, we should keep a different state object for <tt class="docutils literal">BookPanel</tt> and <tt class="docutils literal">AuthorPanel</tt>,
we wouldn&#8217;t need to combine them into a single object contained in the <tt class="docutils literal">BookAuthorPanel</tt>
since they are&nbsp;unrelated!</p>
<p>One decision that we took in <tt class="docutils literal">BookForm</tt> (and also to the <tt class="docutils literal">SearchPanel</tt> before) is to <em>not</em> keep a local state for the
book that is edited but move it to <tt class="docutils literal">BookPanel</tt>. This means that whenever the value of the <tt class="docutils literal">title</tt> or <tt class="docutils literal">category</tt> is changed the parent
component will be informed (through <tt class="docutils literal">handleChange</tt>) so that it will change its state and the new values will
be passed down to <tt class="docutils literal">BookForm</tt> as properties so our changes will be reflected to the inputs. To make it more
clear, when you press a letter on the <tt class="docutils literal">title</tt> input:</p>
<ul class="simple">
<li>the <tt class="docutils literal">onChange</tt> method of <tt class="docutils literal">BookForm</tt> will be&nbsp;called,</li>
<li>it will get the values of both <tt class="docutils literal">title</tt> and <tt class="docutils literal">category</tt> fields</li>
<li>and call <tt class="docutils literal">handleChange</tt> with these&nbsp;values.</li>
<li>The <tt class="docutils literal">handleChange</tt> method of  <tt class="docutils literal">BookPanel</tt> will update the <tt class="docutils literal">editingBook</tt> state&nbsp;attribute,</li>
<li>so the <tt class="docutils literal">book</tt> property of <tt class="docutils literal">BookForm</tt> will be also&nbsp;updated</li>
<li>and the new value of the <tt class="docutils literal">title</tt> will be displayed (since the components will be re-rendered due to the state&nbsp;update)</li>
</ul>
<p>Conceptually, the above seems like a lot of work for just pressing a simple key! However, due to how react
is implemented (virtual <span class="caps">DOM</span>) it won&#8217;t actually introduce any performance problems in our application.
If nevertheless we wanted to have a local state of the currently edited book inside the <tt class="docutils literal">BookForm</tt> then we&#8217;d need to use
<tt class="docutils literal">state.book</tt> and update the state using the <tt class="docutils literal">componentWillReceiveProps</tt> method of <tt class="docutils literal">BookForm</tt>: If we
have a book to edit in the properties then copy it to the state or else just create an empty book. Also,
the <tt class="docutils literal">onChange</tt> method of the <tt class="docutils literal">BookForm</tt> won&#8217;t need to notify the parent component that there is a
state change (but only update the local state) and of course when the submit button is pressed the
current book should be passed to the parent component (to either save it or delete it) since it won&#8217;t
know the book that is currently&nbsp;edited.</p>
<p>So we could either have a local state object for the edited book in the <tt class="docutils literal">BookForm</tt> or
just save it as a property of the global state object in <tt class="docutils literal">BookPanel</tt> &#8212; both solutions are
correct. What wouldn&#8217;t be correct is if we had two copies of the same information in both the
states of <tt class="docutils literal">BookPanel</tt> and <tt class="docutils literal">BookForm</tt>, for example the book id that is&nbsp;edited.</p>
</div>
<div class="section" id="adding-form-validation">
<h2><a class="toc-backref" href="#toc-entry-15">Adding form&nbsp;validation</a></h2>
<p>Commenter Nitish Kumar made a nice comment about how we could do some validating to our form&nbsp;fields.</p>
<p>First of all, this adds to the complexity of the application so maybe it would be better to do it in
the <a class="reference external" href="https://www.spapas.net/2015/07/02/comprehensive-react-flux-tutorial-2/">flux-architectured version</a>. However, it&#8217;s not really difficult
to also have form validation using&nbsp;react-only:</p>
<p>Here&#8217;s what we&nbsp;need:</p>
<ul class="simple">
<li>A property (or properties) to pass the errors for each form field to the <tt class="docutils literal">BookForm</tt> component</li>
<li>A way to display the form errors if they exist in <tt class="docutils literal">BookForm</tt></li>
<li>Execute an error handler when the form contents change and update the state if there&#8217;s an&nbsp;error</li>
</ul>
<p>As an example, I&#8217;d like to check that the book title is not written in uppercase, so I will add another
attribute to the <tt class="docutils literal">book</tt> propery of <tt class="docutils literal">BookForm</tt> called <tt class="docutils literal">titleError</tt> and display it if it is defined,
something like&nbsp;this:</p>
<p><tt class="docutils literal"><span class="pre">{this.props.book.titleError?&lt;div&gt;{this.props.book.titleError}&lt;/div&gt;:null}</span></tt></p>
<p>Now, the <tt class="docutils literal">handleChange</tt> method of <tt class="docutils literal">BookPanel</tt> should do the actual check and change the sate, so I&#8217;m
changing it like&nbsp;this:</p>
<pre class="code literal-block">
handleChange: function(title, category) {
    var titleError = undefined;
    if(title.length &gt; 1 &amp;&amp; title === title.toUpperCase()) {
        titleError='Please don\'t use only capital letters for book titles';
    }
    this.setState({
        editingBook: {
            title: title,
            titleError: titleError,
            category: category,
            id: this.state.editingBook.id
        }
    });
},
</pre>
<p>So, the titleError attribute of editingBook will be defined only if there&#8217;s an&nbsp;error.</p>
<p>Finally, we must remember to <em>not</em> create/update the book if there&#8217;s an error so
we add the following check to the <tt class="docutils literal">handleSubmitClick</tt> method:</p>
<pre class="code literal-block">
if(this.state.editingBook.titleError) {
    this.setState({
        message: &quot;Please fix errors!&quot;
    });
    return ;
}
</pre>
<p>The above could be easily generalized for checks on multiple fields. I am not really fond
of doing the form validation in the <tt class="docutils literal">BookPanel</tt> component (I&#8217;d prefer to do it on <tt class="docutils literal">BookForm</tt>
or even better on the corresponding field - if it was a component) however this would mean that
I&#8217;d need to keep a local state with the error to the <tt class="docutils literal">BookForm</tt> (please see the discussion of
the previous&nbsp;paragraph).</p>
<p>I&#8217;ve added a new tag named <tt class="docutils literal"><span class="pre">react-only-validation</span></tt> to the <a class="reference external" href="https://github.com/spapas/react-tutorial/">https://github.com/spapas/react-tutorial/</a>
repository that contains the changes to have the&nbsp;validation.</p>
</div>
<div class="section" id="conclusion-to-the-first-part">
<h2><a class="toc-backref" href="#toc-entry-16">Conclusion to the first&nbsp;part</a></h2>
<p>We just created a not-so-simple React single page application offering <span class="caps">CRUD</span> for an object.
This application of course could be improved by adding a pagination component to the table,
but I&#8217;m going to leave that as an excersie to the reader: To do that, I propose to create
another component named <tt class="docutils literal">TablePager</tt> that would have two properties: <tt class="docutils literal">currentPage</tt> and
a <tt class="docutils literal">changePageTo</tt> callback. The <tt class="docutils literal">currentPage</tt> would also be needed to added to the global
state. When the <tt class="docutils literal">changePageTo` is called by the ``TablePager</tt> it would update the global
<tt class="docutils literal">currentPage</tt> and will do a <tt class="docutils literal">reloadBooks</tt> that will use the <tt class="docutils literal">currentPage</tt> to fetch
the correct&nbsp;page.</p>
<p>For application state keeping, we have selected to store all state attributes in <tt class="docutils literal">BookPanel</tt>,
for every state changing action we create a method that we pass in the child components
so that the children can call it when the state needs to be&nbsp;updated.</p>
<p>As we will see <a class="reference external" href="https://www.spapas.net/2015/07/02/comprehensive-react-flux-tutorial-2/">in the next part</a>, with Flux, Facebook proposes a design pattern for
where to store the state and how to update it. We&#8217;ll see how to convert our React
application to also use Flux and find out how Flux will help us when developing
complex client-side&nbsp;applications!</p>
</div>
</div>
  		</article>
<div class="pagination">
    <a class="prev" href="https://www.spapas.net/index12.html">&larr; Older</a>

    <a class="next" href="https://www.spapas.net/index10.html">Newer &rarr;</a>
  <br />
</div></div>
<aside class="sidebar">
  
  <section>
    <br />
    <a href='/feeds/all.atom.xml'>Atom</a>
    |
    <a href='/feeds/all.rss.xml'>RSS</a>
  </section>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- Sidebar unit -->
  <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7673322832689008" data-ad-slot="2720624730"
    data-ad-format="auto" data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>


  <script async src="https://cse.google.com/cse.js?cx=612920e5ca9da850c"></script>
  <div class="gcse-search"></div>

  
  <section>
    <h1>Support me</h1>

    You can show your appreciation for anything useful you've found here by 
    buying me a coffee 
    <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="spapas" data-color="#FFDD00" data-emoji=""  data-font="Lato" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script>

    or donating me some bitcoin to this address:
    <small><pre>bc1qx42vp8napheaewhnx0rk0mttdrdrtvw6czvxhl</pre></small>
    <svg shape-rendering="crispEdges" height="200" width="200" viewBox="0 0 29 29" class="qrcode">
      <path fill="#FFFFFF" d="M0,0 h29v29H0z"></path><path fill="#000000" d="M0 0h7v1H0zM9 0h2v1H9zM12 0h1v1H12zM14 0h2v1H14zM18 0h2v1H18zM22,0 h7v1H22zM0 1h1v1H0zM6 1h1v1H6zM8 1h1v1H8zM11 1h1v1H11zM14 1h5v1H14zM22 1h1v1H22zM28,1 h1v1H28zM0 2h1v1H0zM2 2h3v1H2zM6 2h1v1H6zM8 2h4v1H8zM17 2h1v1H17zM22 2h1v1H22zM24 2h3v1H24zM28,2 h1v1H28zM0 3h1v1H0zM2 3h3v1H2zM6 3h1v1H6zM9 3h2v1H9zM14 3h3v1H14zM18 3h1v1H18zM22 3h1v1H22zM24 3h3v1H24zM28,3 h1v1H28zM0 4h1v1H0zM2 4h3v1H2zM6 4h1v1H6zM8 4h1v1H8zM11 4h1v1H11zM13 4h1v1H13zM15 4h2v1H15zM18 4h1v1H18zM22 4h1v1H22zM24 4h3v1H24zM28,4 h1v1H28zM0 5h1v1H0zM6 5h1v1H6zM8 5h2v1H8zM14 5h2v1H14zM19 5h2v1H19zM22 5h1v1H22zM28,5 h1v1H28zM0 6h7v1H0zM8 6h1v1H8zM10 6h1v1H10zM12 6h1v1H12zM14 6h1v1H14zM16 6h1v1H16zM18 6h1v1H18zM20 6h1v1H20zM22,6 h7v1H22zM8 7h2v1H8zM11 7h1v1H11zM15 7h1v1H15zM17 7h2v1H17zM0 8h2v1H0zM3 8h1v1H3zM6 8h2v1H6zM10 8h1v1H10zM12 8h3v1H12zM20 8h1v1H20zM22 8h3v1H22zM26 8h2v1H26zM1 9h1v1H1zM3 9h3v1H3zM8 9h1v1H8zM10 9h1v1H10zM12 9h2v1H12zM16 9h2v1H16zM20 9h1v1H20zM22 9h1v1H22zM25 9h1v1H25zM27,9 h2v1H27zM0 10h1v1H0zM3 10h2v1H3zM6 10h1v1H6zM8 10h3v1H8zM12 10h2v1H12zM16 10h1v1H16zM19 10h1v1H19zM22 10h3v1H22zM27 10h1v1H27zM0 11h1v1H0zM2 11h1v1H2zM4 11h2v1H4zM7 11h1v1H7zM13 11h4v1H13zM18 11h4v1H18zM26 11h2v1H26zM0 12h1v1H0zM2 12h3v1H2zM6 12h1v1H6zM11 12h1v1H11zM13 12h1v1H13zM15 12h3v1H15zM20 12h1v1H20zM22 12h2v1H22zM27,12 h2v1H27zM4 13h1v1H4zM8 13h3v1H8zM12 13h1v1H12zM14 13h1v1H14zM17 13h4v1H17zM25 13h2v1H25zM0 14h1v1H0zM4 14h3v1H4zM8 14h2v1H8zM11 14h3v1H11zM16 14h1v1H16zM21 14h2v1H21zM24,14 h5v1H24zM3 15h3v1H3zM7 15h2v1H7zM10 15h1v1H10zM12 15h2v1H12zM15 15h1v1H15zM17 15h2v1H17zM20 15h2v1H20zM23 15h1v1H23zM1 16h1v1H1zM4 16h1v1H4zM6 16h4v1H6zM16 16h2v1H16zM20 16h1v1H20zM23 16h1v1H23zM25 16h1v1H25zM28,16 h1v1H28zM2 17h1v1H2zM5 17h1v1H5zM7 17h2v1H7zM11 17h3v1H11zM17 17h1v1H17zM22 17h1v1H22zM25 17h1v1H25zM27,17 h2v1H27zM0 18h1v1H0zM3 18h1v1H3zM5 18h4v1H5zM10 18h1v1H10zM12 18h1v1H12zM18 18h1v1H18zM20 18h1v1H20zM22 18h2v1H22zM25,18 h4v1H25zM2 19h3v1H2zM8 19h1v1H8zM16 19h2v1H16zM21 19h1v1H21zM23 19h1v1H23zM25 19h1v1H25zM27 19h1v1H27zM0 20h1v1H0zM2 20h5v1H2zM8 20h2v1H8zM13 20h4v1H13zM19 20h6v1H19zM26 20h1v1H26zM28,20 h1v1H28zM8 21h2v1H8zM12 21h3v1H12zM16 21h1v1H16zM20 21h1v1H20zM24 21h1v1H24zM26,21 h3v1H26zM0 22h7v1H0zM8 22h3v1H8zM17 22h1v1H17zM20 22h1v1H20zM22 22h1v1H22zM24 22h2v1H24zM27 22h1v1H27zM0 23h1v1H0zM6 23h1v1H6zM10 23h2v1H10zM13 23h2v1H13zM19 23h2v1H19zM24,23 h5v1H24zM0 24h1v1H0zM2 24h3v1H2zM6 24h1v1H6zM9 24h2v1H9zM12 24h2v1H12zM17 24h1v1H17zM20 24h6v1H20zM28,24 h1v1H28zM0 25h1v1H0zM2 25h3v1H2zM6 25h1v1H6zM8 25h3v1H8zM12 25h1v1H12zM14 25h1v1H14zM18 25h1v1H18zM22 25h3v1H22zM26 25h1v1H26zM0 26h1v1H0zM2 26h3v1H2zM6 26h1v1H6zM10 26h5v1H10zM16 26h3v1H16zM21 26h1v1H21zM24 26h1v1H24zM26 26h1v1H26zM28,26 h1v1H28zM0 27h1v1H0zM6 27h1v1H6zM8 27h3v1H8zM12 27h4v1H12zM17 27h1v1H17zM20 27h1v1H20zM23 27h2v1H23zM27 27h1v1H27zM0 28h7v1H0zM8 28h3v1H8zM14 28h1v1H14zM16 28h3v1H16zM20 28h1v1H20zM22 28h1v1H22zM24 28h2v1H24zM27 28h1v1H27z"></path>
    </svg>
  </section>
  

  <section>
    <h1>Subscribe</h1>
    Do you want to get notified via email when I post new content?
    <style>
      .subscribe-button {
        /* margin: 10px !important; */
        padding: 10px !important;
        background-color: black;
        display: inline-block;
        color: white !important;
        text-decoration: none;

        line-height: 36px !important;
        height: 37px !important;
        text-decoration: none !important;
        display: inline-block !important;
        color: #ffffff !important;
        background-color: #000000 !important;
        border-radius: 3px !important;
        border: 1px solid transparent !important;
        padding: 1px 9px !important;
        font-size: 23px !important;
        letter-spacing: 0.6px !important;
        box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
        -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
        margin: 0 auto !important;
        font-family: 'Cookie', cursive !important;
        -webkit-box-sizing: border-box !important;
        box-sizing: border-box !important;
        -o-transition: 0.3s all linear !important;
        -webkit-transition: 0.3s all linear !important;
        -moz-transition: 0.3s all linear !important;
        -ms-transition: 0.3s all linear !important;
        transition: 0.3s all linear !important;

      }
    </style>
    <a class='subscribe-button' target="_blank" href="http://eepurl.com/dxI3PP">Click here to subscribe!</a>
  </section>


  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
        <a href="https://www.spapas.net/2024/08/22/multiple-erl-elixir-windows/">Multiple Erlang/Elixir versions in Windows</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/11/29/openid-connect-tutorial/">A simple OpenID connect tutorial</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/05/23/simple-django-datatables-integration/">Simple Django - DataTables integration</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/05/22/ai-auto-subtitling/">AI auto-subtitling</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/05/12/disable-your-forms/">HTML form disable after submit</a>
      </li>
    </ul>
  </section>
  <section>

    <h1>Categories</h1>
    <ul id="recent_posts">
      <li><a href="https://www.spapas.net/category/ai.html">ai</a></li>
      <li><a href="https://www.spapas.net/category/android.html">android</a></li>
      <li><a href="https://www.spapas.net/category/clojure.html">clojure</a></li>
      <li><a href="https://www.spapas.net/category/css.html">css</a></li>
      <li><a href="https://www.spapas.net/category/django.html">django</a></li>
      <li><a href="https://www.spapas.net/category/elixir.html">elixir</a></li>
      <li><a href="https://www.spapas.net/category/flask.html">flask</a></li>
      <li><a href="https://www.spapas.net/category/gaming.html">gaming</a></li>
      <li><a href="https://www.spapas.net/category/git.html">git</a></li>
      <li><a href="https://www.spapas.net/category/html.html">html</a></li>
      <li><a href="https://www.spapas.net/category/javascript.html">javascript</a></li>
      <li><a href="https://www.spapas.net/category/networking.html">networking</a></li>
      <li><a href="https://www.spapas.net/category/pelican.html">pelican</a></li>
      <li><a href="https://www.spapas.net/category/postgresql.html">postgresql</a></li>
      <li><a href="https://www.spapas.net/category/python.html">python</a></li>
      <li><a href="https://www.spapas.net/category/spring.html">spring</a></li>
      <li><a href="https://www.spapas.net/category/unix.html">unix</a></li>
      <li><a href="https://www.spapas.net/category/wagtail.html">wagtail</a></li>
    </ul>
  </section>

  <section>
    <h1>Tags</h1>
    <a href="https://www.spapas.net/tag/erlang.html">erlang</a>,    <a href="https://www.spapas.net/tag/elixir.html">elixir</a>,    <a href="https://www.spapas.net/tag/windows.html">windows</a>,    <a href="https://www.spapas.net/tag/openid.html">openid</a>,    <a href="https://www.spapas.net/tag/openid-connect.html">openid-connect</a>,    <a href="https://www.spapas.net/tag/oidc.html">oidc</a>,    <a href="https://www.spapas.net/tag/http.html">http</a>,    <a href="https://www.spapas.net/tag/keycloak.html">keycloak</a>,    <a href="https://www.spapas.net/tag/python.html">python</a>,    <a href="https://www.spapas.net/tag/django.html">django</a>,    <a href="https://www.spapas.net/tag/jquery.html">jquery</a>,    <a href="https://www.spapas.net/tag/datatables.html">datatables</a>,    <a href="https://www.spapas.net/tag/ai.html">ai</a>,    <a href="https://www.spapas.net/tag/whisper.html">whisper</a>,    <a href="https://www.spapas.net/tag/whispercpp.html">whisper.cpp</a>,    <a href="https://www.spapas.net/tag/subtitles.html">subtitles</a>,    <a href="https://www.spapas.net/tag/video.html">video</a>,    <a href="https://www.spapas.net/tag/auto-subtitling.html">auto-subtitling</a>,    <a href="https://www.spapas.net/tag/subtitiling.html">subtitiling</a>,    <a href="https://www.spapas.net/tag/transcribe.html">transcribe</a>,    <a href="https://www.spapas.net/tag/html.html">html</a>,    <a href="https://www.spapas.net/tag/javascript.html">javascript</a>,    <a href="https://www.spapas.net/tag/media.html">media</a>,    <a href="https://www.spapas.net/tag/storage.html">storage</a>,    <a href="https://www.spapas.net/tag/unpoly.html">unpoly</a>,    <a href="https://www.spapas.net/tag/access.html">access</a>,    <a href="https://www.spapas.net/tag/database.html">database</a>,    <a href="https://www.spapas.net/tag/accdb.html">accdb</a>,    <a href="https://www.spapas.net/tag/mdb.html">mdb</a>,    <a href="https://www.spapas.net/tag/postgresql.html">postgresql</a>,    <a href="https://www.spapas.net/tag/development.html">development</a>,    <a href="https://www.spapas.net/tag/inlines.html">inlines</a>,    <a href="https://www.spapas.net/tag/clojure.html">clojure</a>,    <a href="https://www.spapas.net/tag/cmd.html">cmd</a>,    <a href="https://www.spapas.net/tag/pdf.html">pdf</a>,    <a href="https://www.spapas.net/tag/wkhtmltopdf.html">wkhtmltopdf</a>,    <a href="https://www.spapas.net/tag/forward-proxy.html">forward-proxy</a>,    <a href="https://www.spapas.net/tag/reverse-proxy.html">reverse-proxy</a>,    <a href="https://www.spapas.net/tag/proxy.html">proxy</a>,    <a href="https://www.spapas.net/tag/networking.html">networking</a>,    <a href="https://www.spapas.net/tag/dj-rest-auth.html">dj-rest-auth</a>,    <a href="https://www.spapas.net/tag/rest.html">rest</a>,    <a href="https://www.spapas.net/tag/django-rest-framework.html">django-rest-framework</a>,    <a href="https://www.spapas.net/tag/authentication.html">authentication</a>,    <a href="https://www.spapas.net/tag/tokens.html">tokens</a>,    <a href="https://www.spapas.net/tag/migrations.html">migrations</a>,    <a href="https://www.spapas.net/tag/foreignkey.html">foreignkey</a>,    <a href="https://www.spapas.net/tag/dark-souls.html">dark-souls</a>,    <a href="https://www.spapas.net/tag/dark-souls-2.html">dark-souls-2</a>,    <a href="https://www.spapas.net/tag/dark-souls-3.html">dark-souls-3</a>,    <a href="https://www.spapas.net/tag/autohotkey.html">autohotkey</a>,    <a href="https://www.spapas.net/tag/matplotlib.html">matplotlib</a>,    <a href="https://www.spapas.net/tag/hashids.html">hashids</a>,    <a href="https://www.spapas.net/tag/wagtail.html">wagtail</a>,    <a href="https://www.spapas.net/tag/osmon.html">osmon</a>,    <a href="https://www.spapas.net/tag/phoenix.html">phoenix</a>,    <a href="https://www.spapas.net/tag/os-monitoring.html">os-monitoring</a>,    <a href="https://www.spapas.net/tag/forms.html">forms</a>,    <a href="https://www.spapas.net/tag/django-crispy-forms.html">django-crispy-forms</a>,    <a href="https://www.spapas.net/tag/django-widget-tweaks.html">django-widget-tweaks</a>,    <a href="https://www.spapas.net/tag/ecto.html">ecto</a>,    <a href="https://www.spapas.net/tag/queries.html">queries</a>,    <a href="https://www.spapas.net/tag/declarative.html">declarative</a>,    <a href="https://www.spapas.net/tag/form.html">form</a>,    <a href="https://www.spapas.net/tag/php.html">php</a>,    <a href="https://www.spapas.net/tag/select2.html">select2</a>,    <a href="https://www.spapas.net/tag/autocompelte.html">autocompelte</a>,    <a href="https://www.spapas.net/tag/ajax.html">ajax</a>,    <a href="https://www.spapas.net/tag/android.html">android</a>,    <a href="https://www.spapas.net/tag/kotlin.html">kotlin</a>,    <a href="https://www.spapas.net/tag/adapter.html">adapter</a>,    <a href="https://www.spapas.net/tag/filter.html">filter</a>,    <a href="https://www.spapas.net/tag/async.html">async</a>,    <a href="https://www.spapas.net/tag/tasks.html">tasks</a>,    <a href="https://www.spapas.net/tag/django-rq.html">django-rq</a>,    <a href="https://www.spapas.net/tag/rq.html">rq</a>,    <a href="https://www.spapas.net/tag/du.html">du</a>,    <a href="https://www.spapas.net/tag/unix.html">unix</a>,    <a href="https://www.spapas.net/tag/linux.html">linux</a>,    <a href="https://www.spapas.net/tag/disk-usage.html">disk-usage</a>,    <a href="https://www.spapas.net/tag/cbv.html">cbv</a>,    <a href="https://www.spapas.net/tag/middleware.html">middleware</a>,    <a href="https://www.spapas.net/tag/class-based-views.html">class-based-views</a>,    <a href="https://www.spapas.net/tag/react.html">react</a>,    <a href="https://www.spapas.net/tag/redux.html">redux</a>,    <a href="https://www.spapas.net/tag/hyperapp.html">hyperapp</a>,    <a href="https://www.spapas.net/tag/immutable.html">immutable</a>,    <a href="https://www.spapas.net/tag/es6.html">es6</a>,    <a href="https://www.spapas.net/tag/youtube.html">youtube</a>,    <a href="https://www.spapas.net/tag/youtube-dl.html">youtube-dl</a>,    <a href="https://www.spapas.net/tag/ffmpeg.html">ffmpeg</a>,    <a href="https://www.spapas.net/tag/django-rest-auth.html">django-rest-auth</a>,    <a href="https://www.spapas.net/tag/python-2.html">python-2</a>,    <a href="https://www.spapas.net/tag/python-3.html">python-3</a>,    <a href="https://www.spapas.net/tag/plpgsql.html">plpgsql</a>,    <a href="https://www.spapas.net/tag/component.html">component</a>,    <a href="https://www.spapas.net/tag/ag-grid.html">ag-grid</a>,    <a href="https://www.spapas.net/tag/grid.html">grid</a>,    <a href="https://www.spapas.net/tag/bash.html">bash</a>,    <a href="https://www.spapas.net/tag/cron.html">cron</a>,    <a href="https://www.spapas.net/tag/pandas.html">pandas</a>,    <a href="https://www.spapas.net/tag/scipy.html">scipy</a>,    <a href="https://www.spapas.net/tag/numpy.html">numpy</a>,    <a href="https://www.spapas.net/tag/pivot.html">pivot</a>,    <a href="https://www.spapas.net/tag/pivot_table.html">pivot_table</a>,    <a href="https://www.spapas.net/tag/ipython.html">ipython</a>,    <a href="https://www.spapas.net/tag/jupyter.html">jupyter</a>,    <a href="https://www.spapas.net/tag/notebook.html">notebook</a>,    <a href="https://www.spapas.net/tag/query.html">query</a>,    <a href="https://www.spapas.net/tag/q.html">q</a>,    <a href="https://www.spapas.net/tag/imgur.html">imgur</a>,    <a href="https://www.spapas.net/tag/console.html">console</a>,    <a href="https://www.spapas.net/tag/research.html">research</a>,    <a href="https://www.spapas.net/tag/debug.html">debug</a>,    <a href="https://www.spapas.net/tag/werkzeug.html">werkzeug</a>,    <a href="https://www.spapas.net/tag/django-extensions.html">django-extensions</a>,    <a href="https://www.spapas.net/tag/404.html">404</a>,    <a href="https://www.spapas.net/tag/error.html">error</a>,    <a href="https://www.spapas.net/tag/spring.html">spring</a>,    <a href="https://www.spapas.net/tag/spring-boot.html">spring-boot</a>,    <a href="https://www.spapas.net/tag/java.html">java</a>,    <a href="https://www.spapas.net/tag/ldap.html">ldap</a>,    <a href="https://www.spapas.net/tag/profiles.html">profiles</a>,    <a href="https://www.spapas.net/tag/settings.html">settings</a>,    <a href="https://www.spapas.net/tag/properties.html">properties</a>,    <a href="https://www.spapas.net/tag/yaml.html">yaml</a>,    <a href="https://www.spapas.net/tag/configuration.html">configuration</a>,    <a href="https://www.spapas.net/tag/deploy.html">deploy</a>,    <a href="https://www.spapas.net/tag/initd.html">init.d</a>,    <a href="https://www.spapas.net/tag/react-redux.html">react-redux</a>,    <a href="https://www.spapas.net/tag/redux-thunk.html">redux-thunk</a>,    <a href="https://www.spapas.net/tag/redux-form.html">redux-form</a>,    <a href="https://www.spapas.net/tag/react-router.html">react-router</a>,    <a href="https://www.spapas.net/tag/react-router-redux.html">react-router-redux</a>,    <a href="https://www.spapas.net/tag/react-notification.html">react-notification</a>,    <a href="https://www.spapas.net/tag/history.html">history</a>,    <a href="https://www.spapas.net/tag/babel.html">babel</a>,    <a href="https://www.spapas.net/tag/babelify.html">babelify</a>,    <a href="https://www.spapas.net/tag/browserify.html">browserify</a>,    <a href="https://www.spapas.net/tag/watchify.html">watchify</a>,    <a href="https://www.spapas.net/tag/uglify.html">uglify</a>,    <a href="https://www.spapas.net/tag/boilerplate.html">boilerplate</a>,    <a href="https://www.spapas.net/tag/tutorial.html">tutorial</a>,    <a href="https://www.spapas.net/tag/introduction.html">introduction</a>,    <a href="https://www.spapas.net/tag/fixed-data-tables.html">fixed-data-tables</a>,    <a href="https://www.spapas.net/tag/fixeddatatable.html">FixedDataTable</a>,    <a href="https://www.spapas.net/tag/reportlab.html">reportlab</a>,    <a href="https://www.spapas.net/tag/xhtml2pdf.html">xhtml2pdf</a>,    <a href="https://www.spapas.net/tag/node.html">node</a>,    <a href="https://www.spapas.net/tag/npm.html">npm</a>,    <a href="https://www.spapas.net/tag/generic.html">generic</a>,    <a href="https://www.spapas.net/tag/tables.html">tables</a>,    <a href="https://www.spapas.net/tag/flux.html">flux</a>,    <a href="https://www.spapas.net/tag/jobs.html">jobs</a>,    <a href="https://www.spapas.net/tag/asynchronous.html">asynchronous</a>,    <a href="https://www.spapas.net/tag/scheduling.html">scheduling</a>,    <a href="https://www.spapas.net/tag/redis.html">redis</a>,    <a href="https://www.spapas.net/tag/pusher.html">pusher</a>,    <a href="https://www.spapas.net/tag/auditing.html">auditing</a>,    <a href="https://www.spapas.net/tag/css.html">css</a>,    <a href="https://www.spapas.net/tag/design.html">design</a>,    <a href="https://www.spapas.net/tag/boostrap-material-design.html">boostrap-material-design</a>,    <a href="https://www.spapas.net/tag/less.html">less</a>,    <a href="https://www.spapas.net/tag/nodejs.html">node.js</a>,    <a href="https://www.spapas.net/tag/gmail.html">gmail</a>,    <a href="https://www.spapas.net/tag/security.html">security</a>,    <a href="https://www.spapas.net/tag/google.html">google</a>,    <a href="https://www.spapas.net/tag/flask.html">flask</a>,    <a href="https://www.spapas.net/tag/mongodb.html">mongodb</a>,    <a href="https://www.spapas.net/tag/heroku.html">heroku</a>,    <a href="https://www.spapas.net/tag/spring-security.html">spring-security</a>,    <a href="https://www.spapas.net/tag/git.html">git</a>,    <a href="https://www.spapas.net/tag/github.html">github</a>,    <a href="https://www.spapas.net/tag/branching.html">branching</a>,    <a href="https://www.spapas.net/tag/static-html.html">static-html</a>,    <a href="https://www.spapas.net/tag/githubio.html">github.io</a>,    <a href="https://www.spapas.net/tag/pelican.html">pelican</a>,    <a href="https://www.spapas.net/tag/github-pages.html">github-pages</a>,    <a href="https://www.spapas.net/tag/rst.html">rst</a>  </section>

  <section>
    <h1>Yearly archives</h1>
    <a href="https://www.spapas.net/posts/2013/">2013</a>,    <a href="https://www.spapas.net/posts/2014/">2014</a>,    <a href="https://www.spapas.net/posts/2015/">2015</a>,    <a href="https://www.spapas.net/posts/2016/">2016</a>,    <a href="https://www.spapas.net/posts/2017/">2017</a>,    <a href="https://www.spapas.net/posts/2018/">2018</a>,    <a href="https://www.spapas.net/posts/2019/">2019</a>,    <a href="https://www.spapas.net/posts/2020/">2020</a>,    <a href="https://www.spapas.net/posts/2021/">2021</a>,    <a href="https://www.spapas.net/posts/2022/">2022</a>,    <a href="https://www.spapas.net/posts/2023/">2023</a>,    <a href="https://www.spapas.net/posts/2024/">2024</a>  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/spapas">@spapas</a> on GitHub
    <script  src="//code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script type="text/javascript">
      $(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = 'https://www.spapas.net/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'spapas',
              count: 5,
              skip_forks: true,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="https://www.spapas.net/theme/js/github.js" type="text/javascript"> </script>
  </section>


  <section>
    <a href="https://twitter.com/_serafeim_?ref_src=twsrc%5Etfw" class="twitter-follow-button"
      data-show-count="false">Follow @_serafeim_</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2013&ndash;2024  Serafeim Papastefanos &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="https://www.spapas.net/theme/js/modernizr-2.0.js"></script>
  <script src="https://www.spapas.net/theme/js/ender.js"></script>
  <script src="https://www.spapas.net/theme/js/octopress.js" type="text/javascript"></script>
  <script src="https://www.spapas.net/theme/js/ads.js"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44750952-1', 'auto');

    ga('send', 'pageview');
    </script>

<script defer data-domain="spapas.net" src="https://plausible.hcg.gr/js/script.js"></script>  <script type="text/javascript">
    var disqus_shortname = 'spapas-github-io';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>

</body>

</html>
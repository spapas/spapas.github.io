<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta name="google-site-verification" content="5_8DTmIiEq4gFvNAfxAD6TsGOgrMAjp8lQFQvfA6zZc" />
    <title>/var/</title>
    <meta name="author" content="Serafeim Papastefanos">


    
<style type="text/css">
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: var(--jp-cell-editor-active-background) }
.highlight { background: var(--jp-cell-editor-background); color: var(--jp-mirror-editor-variable-color) }
.highlight .c { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment */
.highlight .err { color: var(--jp-mirror-editor-error-color) } /* Error */
.highlight .k { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword */
.highlight .o { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator */
.highlight .p { color: var(--jp-mirror-editor-punctuation-color) } /* Punctuation */
.highlight .ch { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Multiline */
.highlight .cp { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Preproc */
.highlight .cpf { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Single */
.highlight .cs { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Special */
.highlight .kc { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Type */
.highlight .m { color: var(--jp-mirror-editor-number-color) } /* Literal.Number */
.highlight .s { color: var(--jp-mirror-editor-string-color) } /* Literal.String */
.highlight .ow { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator.Word */
.highlight .pm { color: var(--jp-mirror-editor-punctuation-color) } /* Punctuation.Marker */
.highlight .w { color: var(--jp-mirror-editor-variable-color) } /* Text.Whitespace */
.highlight .mb { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Bin */
.highlight .mf { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Float */
.highlight .mh { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Hex */
.highlight .mi { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer */
.highlight .mo { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Oct */
.highlight .sa { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Affix */
.highlight .sb { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Backtick */
.highlight .sc { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Char */
.highlight .dl { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Delimiter */
.highlight .sd { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Doc */
.highlight .s2 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Double */
.highlight .se { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Escape */
.highlight .sh { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Heredoc */
.highlight .si { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Interpol */
.highlight .sx { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Other */
.highlight .sr { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Regex */
.highlight .s1 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Single */
.highlight .ss { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Symbol */
.highlight .il { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer.Long */
</style>

<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
div.entry-content {
  overflow: visible;
  padding: 8px;
}
.input_area {
  padding: 0.2em;
}

a.heading-anchor {
 white-space: normal;
}

.rendered_html
code {
 font-size: .8em;
}

pre.ipynb {
  color: black;
  background: #f7f7f7;
  border: none;
  box-shadow: none;
  margin-bottom: 0;
  padding: 0;
  margin: 0px;
  font-size: 13px;
}

/* remove the prompt div from text cells */
div.text_cell .prompt {
    display: none;
}

/* remove horizontal padding from text cells, */
/* so it aligns with outer body text */
div.text_cell_render {
    padding: 0.5em 0em;
}

img.anim_icon{padding:0; border:0; vertical-align:middle; -webkit-box-shadow:none; -box-shadow:none}

div.collapseheader {
    width=100%;
    background-color:#d3d3d3;
    padding: 2px;
    cursor: pointer;
    font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
}
</style>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true,
        displayMath: [['$$','$$'], ["\\[","\\]"]]
    }
});
</script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<script type="text/javascript">
jQuery(document).ready(function($) {
    $("div.collapseheader").click(function () {
    $header = $(this).children("span").first();
    $codearea = $(this).children(".input_area");
    console.log($(this).children());
    $codearea.slideToggle(500, function () {
        $header.text(function () {
            return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
        });
    });
});
});
</script>




    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="https://www.spapas.net/favicon.png" rel="icon">

    <link href="https://www.spapas.net/theme/css/main.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://www.spapas.net/theme/css/extra_style.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://fonts.googleapis.com/css?family=Fira+Mono|Fira+Sans:400,700&amp;subset=greek" rel="stylesheet">

<style>
#gHPzseYvFrhZ123 {
  padding: 5px !important;
  display: block;
  margin-bottom: 10px !important;
  background: #900;
  color: #fff;
  border-radius: 5px;
  font-size: 1.0rem !important;
}
</style>


  <script>
    
      
  </script>

    <script data-ad-client="ca-pub-7673322832689008" async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
      onerror="adBlockFunction();"></script>
  </head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="https://www.spapas.net/">/var/</a></h1>
    <h2>Various programming stuff</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li >
        <a href="https://www.spapas.net/category/ai.html">Ai</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/android.html">Android</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/clojure.html">Clojure</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/css.html">Css</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/django.html">Django</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/elixir.html">Elixir</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/flask.html">Flask</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/gaming.html">Gaming</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/git.html">Git</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/html.html">Html</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/javascript.html">Javascript</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/networking.html">Networking</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/pelican.html">Pelican</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/postgresql.html">Postgresql</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/python.html">Python</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/spring.html">Spring</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/unix.html">Unix</a>
      </li>
      <li >
        <a href="https://www.spapas.net/category/wagtail.html">Wagtail</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
    <div id="gHPzseYvFrhZ123">
      Hello! If you are using an ad blocker but find something useful here 
      and want to support me please consider disabling your ad blocker for this site. 
      <br />
      <br />
      Thank you,<br />
      Serafeim
      
    </div>
<div class="blog-index">
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2016/03/31/spring-boot-settings/">Configuring Spring Boot</a>
      </h1>
    <p class="meta">
<time datetime="2016-03-31T19:20:00+03:00" pubdate>Thu 31 March 2016</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title"><a class="reference internal" href="#top">Contents</a></p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="toc-entry-1">Introduction</a></li>
<li><a class="reference internal" href="#properties-vs-yml-files" id="toc-entry-2">properties vs yml&nbsp;files</a></li>
<li><a class="reference internal" href="#structuring-your-configuration-files" id="toc-entry-3">Structuring your configuration files</a><ul>
<li><a class="reference internal" href="#main-application-settings" id="toc-entry-4">Main application&nbsp;settings</a></li>
<li><a class="reference internal" href="#profiles" id="toc-entry-5">Profiles</a><ul>
<li><a class="reference internal" href="#some-more-advanced-profile-usage" id="toc-entry-6">Some more advanced profile&nbsp;usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#overriding-settings" id="toc-entry-7">Overriding settings</a><ul>
<li><a class="reference internal" href="#using-a-config-application-properties" id="toc-entry-8">Using a&nbsp;config/application.properties</a></li>
<li><a class="reference internal" href="#passing-command-line-arguments" id="toc-entry-9">Passing command line&nbsp;arguments</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#deploying-spring-boot-applications" id="toc-entry-10">Deploying Spring Boot&nbsp;applications</a></li>
<li><a class="reference internal" href="#conclusion" id="toc-entry-11">Conclusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#toc-entry-1">Introduction</a></h2>
<p>The <a class="reference external" href="http://projects.spring.io/spring-boot/">Spring Boot</a> project is great way of building Java applications using
Spring. Instead of trying to integrate everything by hand (and usually
end up with a configuration hell) you use spring-boot to help you to
bootstrap your application: Just include its
dependencies in your pom.xml and Spring Boot will try its
best to auto-configure all these&nbsp;components!</p>
<p>Of course, no matter how hard Spring Boot tries to auto-configure everything,
you&#8217;ll still need to pass some configuration to configure your databases,
caches, email sending, security etc. Thankfully, Spring Boot
can be configured without <em>any</em> xml (actually, its a bad practice to
use xml-based configuration with it), using plain Java .properties
files or (if you prefer the more compact syntax) <a class="reference external" href="https://en.wikipedia.org/wiki/YAML"><span class="caps">YAML</span></a> .yml&nbsp;files!</p>
<p>In this guide, along with a simple introduction to the way Spring Boot configuration
works, we&#8217;ll talk about a specific way of stucturing your settings configuration files in
order to&nbsp;have:</p>
<ul class="simple">
<li>A global configuration file that will contain all your&nbsp;settings</li>
<li>Different settings for each of your environments (development, <span class="caps">UAT</span>, staging, production and&nbsp;test)</li>
<li>A way to configure your passwords and other sensitive data (that you don&#8217;t want to put to your <span class="caps">VCS</span>)</li>
<li>Being able to override any setting in any&nbsp;environment</li>
<li>Deploying your Spring Boot app in Linux using <tt class="docutils literal">init.d</tt></li>
</ul>
<p>To quickly test the proposed settings configuration I&#8217;ve created a simple
Spring Boot project &#64; <a class="reference external" href="https://github.com/spapas/spring-boot-config">https://github.com/spapas/spring-boot-config</a>. Just clone
it, optionally change the packaged settings (more on this later), package it (<tt class="docutils literal">mvn package</tt>), optionally change
the <tt class="docutils literal">config</tt> settings (more on this also later) and run it
(using something like <tt class="docutils literal">java <span class="pre">-jar</span> <span class="pre">spring-boot-config-0.0.1-<span class="caps">SNAPSHOT</span>.jar</span></tt>) optionally passing it command line settings (more on this
also later). You&#8217;ll then be able to visit <tt class="docutils literal"><span class="pre">http://127.0.0.1:8080</span></tt> and check the current&nbsp;settings!</p>
</div>
<div class="section" id="properties-vs-yml-files">
<h2><a class="toc-backref" href="#toc-entry-2">properties vs yml&nbsp;files</a></h2>
<p>You can use two kinds of files to configure your settings: Normal Java .properties files
or <a class="reference external" href="https://en.wikipedia.org/wiki/YAML"><span class="caps">YAML</span></a> .yml files. The .properties files have the&nbsp;form:</p>
<pre class="code literal-block">
config.value.a=1
config.value.b=2
config.value.c=3
</pre>
<p>while the .yml files are&nbsp;like:</p>
<pre class="code literal-block">
config:
    value:
        a: 1
        b: 2
        c: 3
</pre>
<p>You may use whatever you wish - in the examples I&#8217;ll use normal Java .properties
files because they are more compact (you don&#8217;t need to use multiple lines to represent
a single setting like in <span class="caps">YAML</span>).</p>
</div>
<div class="section" id="structuring-your-configuration-files">
<h2><a class="toc-backref" href="#toc-entry-3">Structuring your configuration&nbsp;files</a></h2>
<p>Spring Boot reads its configuration from <a class="reference external" href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html">various places</a>, however in this article we&#8217;ll talk
about four of them which should be enough for most cases. Starting from the most global to the most
specific ones (i.e the latter ones will override the previous ones) these&nbsp;are:</p>
<ul class="simple">
<li>Main (global) application&nbsp;settings</li>
<li>Profile&nbsp;settings</li>
<li>Local (/config)&nbsp;settings</li>
<li>Command line&nbsp;arguments</li>
</ul>
<p>The first two are setting files that will be contained inside the artifact (jar or war) that will be
created and should be commited to your version control system. I&#8217;ll call them jar-packaged
settings. The other two won&#8217;t be commited to the version control but will be created directly
on the server to-deploy. Let&#8217;s see a little more about&nbsp;them:</p>
<div class="section" id="main-application-settings">
<h3><a class="toc-backref" href="#toc-entry-4">Main application&nbsp;settings</a></h3>
<p>These are kept in a file named <tt class="docutils literal">application.properties</tt> (or <tt class="docutils literal">yml</tt> &#8212; from now on I&#8217;ll just use
<cite>.properties`</cite> but keep in mind that you may use <tt class="docutils literal">.yml</tt>): This file should reside
inside the <tt class="docutils literal">src\main\resources</tt> folder
of your project and ideally contain all the settings your spring-boot application users. Some
of these settings will be overriden by settings kept in the next source so they may have a
default value or even be empty if they will be always overriden (or contain sensitive data
like passwords), however I still prefer to list
them all in this file even as placeholders to have a central source of all the settings that
your Spring Boot application&nbsp;uses.</p>
</div>
<div class="section" id="profiles">
<h3><a class="toc-backref" href="#toc-entry-5">Profiles</a></h3>
<p>A profile is a set of settings that can be configured to override settings from <tt class="docutils literal">application.properties</tt>.
Each profile is contained in a file named <tt class="docutils literal"><span class="pre">application-profilename.properties</span></tt> where <tt class="docutils literal">profilename</tt> is
the name of the profile. Now, a profile could configure anything you want, however
for most projects I propose to
have the following&nbsp;profiles:</p>
<ul class="simple">
<li><tt class="docutils literal">dev</tt> for your local development&nbsp;settings</li>
<li><tt class="docutils literal">uat</tt> for your <span class="caps">UAT</span> server&nbsp;settings</li>
<li><tt class="docutils literal">staging</tt> for your staging server&nbsp;settings</li>
<li><tt class="docutils literal">prod</tt> for your production&nbsp;settings</li>
<li><tt class="docutils literal">test</tt> for running your&nbsp;tests</li>
</ul>
<p>(depending of course on what are your requirements, some projects may not
need <tt class="docutils literal">uat</tt> or <tt class="docutils literal">staging</tt> but all projects should have a <tt class="docutils literal">dev</tt>, a <tt class="docutils literal">prod</tt> and a <tt class="docutils literal">test</tt> profile).
The configuration for these environemnts needs to be different for obvious reasons.
For example when developing you may want
to use a local database, when running tests an ephemeral in memory database
and your production database when deploying to production.
These profile configuration files will be stored inside your <tt class="docutils literal">src\main\resources</tt> folder,
right next to the <tt class="docutils literal">application.properties</tt>, i.e you&#8217;ll have
<tt class="docutils literal"><span class="pre">application-dev.properties</span></tt>, <tt class="docutils literal"><span class="pre">application-prod.properties</span></tt>,
<tt class="docutils literal"><span class="pre">application-test.properties</span></tt> etc - and all these files will be kept
in your <span class="caps">VCS</span> (and will also be jar-packaged since they will be
contained in the resulting&nbsp;artifact).</p>
<p>How do you select which profile is active each time (i.e pick it
when running the Spring Boot application under
its corresponding&nbsp;environment)?</p>
<p>For tests, since they can be run by a different <tt class="docutils literal">Main</tt> than
the normal application, you should use the <tt class="docutils literal">&#64;ActiveProfiles</tt> annotation
(for example <tt class="docutils literal"><span class="pre">&#64;ActiveProfiles(&quot;test&quot;)</span></tt>) to make sure that the tests
will run with the correct settings. So if the contents of your <tt class="docutils literal"><span class="pre">application-test.properties</span></tt>
are <tt class="docutils literal">config.value=Hello test!</tt> running this test should produce no&nbsp;errors:</p>
<div class="highlight"><pre><span></span><span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@SpringApplicationConfiguration</span><span class="p">(</span><span class="n">classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringBootConfigApplication</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@ActiveProfiles</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringBootConfigApplicationTests</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${config.value}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${spring.profiles.active}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">profile</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">contextLoads</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">is</span><span class="p">(</span><span class="s">&quot;Hello test!&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span><span class="w"> </span><span class="n">is</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>To activate a different profile when running your Spring Boot applications
you&#8217;ll need to use the <tt class="docutils literal">spring.profiles.active</tt> setting, so if you set
<tt class="docutils literal">spring.profiles.active=prod</tt> in your <tt class="docutils literal">application.properties</tt> and
create the packaged jar (or war) then you&#8217;ll have the production settings
when you run your application (i.e the contents of <tt class="docutils literal"><span class="pre">application-prod.properties</span></tt>
will be used to override your <tt class="docutils literal">application.properties</tt>). Of course, to deploy it
to <span class="caps">UAT</span>, you&#8217;ll need to change
<tt class="docutils literal">spring.profiles.active</tt> to <tt class="docutils literal">uat</tt> and re-create the packaged artifact &#8212;
see some repetition and penal labour here? Definitely you don&#8217;t want to do re-create
your artifacts for each of the environments you may want to deploy &#8212;
we&#8217;ll see in the next sections how to improve this flow by overriding
jar-packaged&nbsp;settings!</p>
<div class="section" id="some-more-advanced-profile-usage">
<h4><a class="toc-backref" href="#toc-entry-6">Some more advanced profile&nbsp;usage</a></h4>
<p>You may have noticed in the previous section that the name of the
annotation is <tt class="docutils literal">&#64;ActiveProfiles</tt> and the name of the setting
<tt class="docutils literal">spring.profiles.active</tt> - both in plural. This of course is
on purpose: You may have <em>more than one</em> active&nbsp;profiles!</p>
<p>This, along with the fact that you can make <tt class="docutils literal">&#64;Components</tt> or <tt class="docutils literal">&#64;Configuration</tt>
available <em>only</em> on certail profiles is a really powerful&nbsp;tool!</p>
<p>Here are some&nbsp;examples:</p>
<ul class="simple">
<li>Configure two spring-security <tt class="docutils literal">&#64;Configuration</tt> s: Use in memory security for your dev environment, while using <span class="caps">LDAP</span> for your&nbsp;production.</li>
<li>If you want to support more than one database you can configure multiple profiles &#8212; and use them along with the dev/uat/prod I mentioned&nbsp;before.</li>
<li>Create verbose and non-verbose logging profiles and quickly change between&nbsp;them</li>
</ul>
</div>
</div>
<div class="section" id="overriding-settings">
<h3><a class="toc-backref" href="#toc-entry-7">Overriding&nbsp;settings</a></h3>
<p>All the above settings we&#8217;ve defined should be safely kept inside
your <span class="caps">VCS</span> - however we wouldn&#8217;t like storing passwords or other
sensitive data to a <span class="caps">VCS</span>! Sensitive settings should be empty
(or have a default value) when
saved to <span class="caps">VCS</span> and overriden by &#8220;local&#8221;&nbsp;settings.</p>
<p>Also, all the previous are jar-packaged
and we definitely need a way to override them without messing
with the artifacts (for example, we need to select the
correct profile for running the application by overriding
<tt class="docutils literal">spring.profiles.active</tt>).</p>
<p>There two methods of overriding settings, and these are the last
two methods of the four we discussed&nbsp;above:</p>
<div class="section" id="using-a-config-application-properties">
<h4><a class="toc-backref" href="#toc-entry-8">Using a&nbsp;config/application.properties</a></h4>
<p>You can put files in a directory named <tt class="docutils literal">config</tt> that is at the same level
as the location from which you try to run your jar. These file should be
named either <tt class="docutils literal">application.properties</tt> or <tt class="docutils literal"><span class="pre">application-profilename.properties</span></tt>
and will be used to override your jar-packaged&nbsp;settings.</p>
<p>What happens is that Spring will at first try to load a file named <tt class="docutils literal">config/application.properties</tt> that will
override your jar-packaged <tt class="docutils literal">application.properties</tt> (so here you can set your current profile). Then, it will also try to load
a file named <tt class="docutils literal"><span class="pre">config/application-profilename.properties</span></tt> that will override
your jar-packaged <tt class="docutils literal"><span class="pre">application-profilename.properties</span></tt> (so here you may
override any profile related&nbsp;properties).</p>
<p>The priority of the files from lowest to&nbsp;highest:</p>
<ul class="simple">
<li>jar-packaged <tt class="docutils literal">application.properties</tt></li>
<li>local <tt class="docutils literal">config/application.properties</tt></li>
<li>jar-packaged <tt class="docutils literal"><span class="pre">application-profilename.properties</span></tt></li>
<li>local <tt class="docutils literal"><span class="pre">config/application-profilename.properties</span></tt></li>
</ul>
<p>So (repeating for emphasis) the settings in your jar-packaged <tt class="docutils literal"><span class="pre">application-profilename.properties</span></tt> will <em>only</em>
be overriden by <tt class="docutils literal"><span class="pre">config/application-profilename.properties</span></tt> (and not by the <tt class="docutils literal">config/application.properties</tt>
which will only override settings on the jar-packaged <tt class="docutils literal">application.properties</tt>).</p>
<p>Also, to make everything clear about where the <tt class="docutils literal">config</tt> directory should be&nbsp;kept:</p>
<p>If the current directory from which you&#8217;ll run your jar is <tt class="docutils literal">/home/serafeim</tt> and
you want to execute <tt class="docutils literal"><span class="pre">/opt/spring/my-spring-app.jar</span></tt> (so you&#8217;ll run something like
<tt class="docutils literal">/home/serafeim$ java <span class="pre">-jar</span> <span class="pre">/opt/spring/my-spring-app.jar</span></tt>) then
the <tt class="docutils literal">config</tt> directory should
be at <tt class="docutils literal">/home/serafeim/config</tt> (i.e at the same directory from where you execute
jar). Normally however and to avoid confusion, the best approach would
be to just put it at <tt class="docutils literal">/opt/spring/config</tt> and <tt class="docutils literal">cd /opt/spring</tt> before running
your jar (so <tt class="docutils literal">config</tt> will be right next to your jar and run the jar from the&nbsp;directory).</p>
<p>Finally, my recommendation is to keep these <tt class="docutils literal"><span class="pre">config/*properties</span></tt> files off version control
(after all they should be different for each of your environments - common settings should
go to the jar-packaged files)
and to put only the profile selection setting and sensitive settings there. That means that
the <tt class="docutils literal">config/application.properties</tt> file should <em>only</em> contain a <tt class="docutils literal">spring.profiles.active=profilename</tt>
setting to set the correct profile for this instance of your app and the <tt class="docutils literal"><span class="pre">config/application-profilename.properties</span></tt>
will contain all sensitive information that you&#8217;ll need to run that&nbsp;profile.</p>
<p>For example in your <span class="caps">UAT</span> server you&#8217;ll have <tt class="docutils literal">spring.profiles.active=uat</tt> in your <tt class="docutils literal">application.properties</tt>
and your uat server passwords in your <tt class="docutils literal"><span class="pre">application-uat.properties</span></tt></p>
</div>
<div class="section" id="passing-command-line-arguments">
<h4><a class="toc-backref" href="#toc-entry-9">Passing command line&nbsp;arguments</a></h4>
<p>The most specific way of overriding parameters (including the active profile of course) is by
directly passing these parameters as arguments when running your jar. For example,
if you run <tt class="docutils literal">java <span class="pre">-Dconfig.value=foo</span> <span class="pre">-jar</span> <span class="pre">my-spring-app.jar</span></tt> then the <tt class="docutils literal">config.value</tt>
will always have a value of <tt class="docutils literal">foo</tt> no matter what you have in your other config&nbsp;files.</p>
<p>That&#8217;s a different way to set your active profile (by passing <tt class="docutils literal"><span class="pre">-Dspring.profiles.active=profilename</span></tt>)
or to quickly set sensitive settings however
I prefer to keep the settings in properties files (and not to put them in scripts where they will definitely
be missed and will be more difficult to be managed)
so I&#8217;ll recommend the previous way of using a non-commited to version control local config/application.properties.
Use command line arguments only for quick tests (run something with a specific setting to test how it&nbsp;works).</p>
</div>
</div>
</div>
<div class="section" id="deploying-spring-boot-applications">
<h2><a class="toc-backref" href="#toc-entry-10">Deploying Spring Boot&nbsp;applications</a></h2>
<p>If you check
the deployment documentation of Spring Boot you&#8217;ll see that it has various hints on
<a class="reference external" href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#deployment">on deploying Spring Boot applications</a>. I won&#8217;t go into much detail about these however I&#8217;ll
represent my recommendation on deploying Spring Boot apps on Linux as an init.d&nbsp;script:</p>
<p>What is really interesting about Spring boot is that it allows you to make your jar-packaged jars <a class="reference external" href="https://docs.spring.io/spring-boot/docs/current/reference/html/deployment-install.html">executable as an init.d script</a> so that you will
be able to manage it using something like <tt class="docutils literal">service springbootapp start/stop/restart</tt> etc. To do that,
you&#8217;ll just need to add the <tt class="docutils literal"><span class="pre">&lt;executable&gt;true&lt;/executable&gt;</span></tt> <tt class="docutils literal">configuration</tt> for your pom&#8217;s
<tt class="docutils literal"><span class="pre">spring-boot-maven-plugin</span></tt>. This will add some things in the start of your resulting jar file
that will make it behave as a unix init.d script. If you take a look at your package artifact
you&#8217;ll see something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1">#    .   ____          _            __ _ _</span>
<span class="c1">#   /\\ / ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span>
<span class="c1">#  ( ( )\___ | &#39;_ | &#39;_| | &#39;_ \/ _` | \ \ \ \</span>
<span class="c1">#   \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span>
<span class="c1">#    &#39;  |____| .__|_| |_|_| |_\__, | / / / /</span>
<span class="c1">#   =========|_|==============|___/=/_/_/_/</span>
<span class="c1">#   :: Spring Boot Startup Script ::</span>
<span class="c1">#</span>

<span class="c1">### BEGIN INIT INFO</span>
<span class="c1"># Provides:          spring-boot-config</span>
<span class="c1"># Required-Start:    $remote_fs $syslog $network</span>
<span class="c1"># Required-Stop:     $remote_fs $syslog $network</span>
<span class="c1"># Default-Start:     2 3 4 5</span>
<span class="c1"># Default-Stop:      0 1 6</span>
<span class="c1"># Short-Description: spring-boot-config</span>
<span class="c1"># Description:       Demo project for Spring Boot configuration</span>
<span class="c1"># chkconfig:         2345 99 01</span>
<span class="c1">### END INIT INFO</span>

<span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DEBUG</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span>-x

<span class="c1"># Initialize variables that cannot be provided by a .conf file</span>
<span class="nv">WORKING_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="c1"># shellcheck disable=SC2153</span>
<span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$JARFILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">jarfile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$JARFILE</span><span class="s2">&quot;</span>
<span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$APP_NAME</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">identity</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$APP_NAME</span><span class="s2">&quot;</span>

...
</pre></div>
<p>One thing that may seem puzzling at first is that if make this jar executable
and try to run it you&#8217;ll see that, instead of offering you the well known
options of the init scripts (Usage &#8230; start/stop/restart etc)  it will immediatelly
run the application! This is because the embedded script is smart enough to
check that it will be executed as an init script only when it is executed
as a link from <tt class="docutils literal">/etc/init.d</tt> - else it will immediately run the&nbsp;application.</p>
<p>If
you want to quickly test that behavior, you may override the <tt class="docutils literal"><span class="caps">MODE</span></tt> parameter
which forces the mode of operation of the jar. If you want to run it as a
script (without using a links from /etc/ini.d) then just set <tt class="docutils literal"><span class="caps">MODE</span>=service</tt>.
So, try&nbsp;runnin:</p>
<pre class="code literal-block">
&gt; MODE=service ./springapplication.jar
Usage: ./hsk9eea.jar {start|stop|restart|force-reload|status|run}
</pre>
<p>Success! Of course, this is just for testing purposes, to actually deploy
your application then please create a link to it from <tt class="docutils literal">/etc/init.d</tt> as
proposed by the Spring Boot&nbsp;docs.</p>
<p>If you want to <a class="reference external" href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#deployment-script-customization">customize the init.d script</a>  you can use a file named
<tt class="docutils literal">sprinbootapp.conf</tt> in the same directory as your <tt class="docutils literal">springbootapp.jar</tt>
(i.e it should have the same name as your jar with an extension of .conf). The
options from it will be sourced before running your application &#8212; for example
you could set the active profile using <tt class="docutils literal">RUN_ARGS</tt>, however as I already
recommended, explicitly setting it to a file named <tt class="docutils literal">config/applications.properties</tt>
is&nbsp;preferrable.</p>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#toc-entry-11">Conclusion</a></h2>
<p>Using the described file structure you should be able to fully configure Spring Boot and have all the
goodies you&#8217;d expect from a modern framework: global settings, profiles, non-version control settings! Also, using the
advanced profiles techniques (multiple profiles, profile enabled
&#64;Components and &#64;Configurations) you&#8217;ll be able to implement
some really complex configurations! Finally, you&#8217;ll be able to really
quickly deploy the resulting jar as an init.d system&nbsp;service!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2016/03/02/react-redux-tutorial/">A comprehensive react-redux tutorial</a>
      </h1>
    <p class="meta">
<time datetime="2016-03-02T11:20:00+02:00" pubdate>Wed 02 March 2016</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title"><a class="reference internal" href="#top">Contents</a></p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="toc-entry-1">Introduction</a></li>
<li><a class="reference internal" href="#introduction-to-redux" id="toc-entry-2">Introduction to redux</a><ul>
<li><a class="reference internal" href="#a-simple-example" id="toc-entry-3">A simple&nbsp;example</a></li>
<li><a class="reference internal" href="#interlude-so-what-s-a-reducer" id="toc-entry-4">Interlude: So what&#8217;s a&nbsp;reducer?</a></li>
<li><a class="reference internal" href="#what-about-react-redux" id="toc-entry-5">What about&nbsp;react-redux?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#our-project" id="toc-entry-6">Our project</a><ul>
<li><a class="reference internal" href="#other-libraries-used" id="toc-entry-7">Other libraries&nbsp;used</a></li>
<li><a class="reference internal" href="#redux-thunk" id="toc-entry-8">redux-thunk?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#explaining-the-application" id="toc-entry-9">Explaining the application</a><ul>
<li><a class="reference internal" href="#main-js" id="toc-entry-10">main.js</a></li>
<li><a class="reference internal" href="#store-js" id="toc-entry-11">store.js</a><ul>
<li><a class="reference internal" href="#interlude-combining-reducers" id="toc-entry-12">Interlude: Combining&nbsp;reducers</a></li>
<li><a class="reference internal" href="#interlude-middlewares" id="toc-entry-13">Interlude:&nbsp;Middlewares</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reducers-js" id="toc-entry-14">reducers.js</a><ul>
<li><a class="reference internal" href="#the-global-state-tree" id="toc-entry-15">The global state&nbsp;tree</a></li>
</ul>
</li>
<li><a class="reference internal" href="#actions-js" id="toc-entry-16">actions.js</a></li>
<li><a class="reference internal" href="#components-app-js" id="toc-entry-17">components/app.js</a><ul>
<li><a class="reference internal" href="#components-notification-js" id="toc-entry-18">components/notification.js</a></li>
<li><a class="reference internal" href="#creating-a-re-usable-notification" id="toc-entry-19">Creating a re-usable&nbsp;notification</a></li>
<li><a class="reference internal" href="#components-loading-js" id="toc-entry-20">components/loading.js</a></li>
<li><a class="reference internal" href="#components-statpanel-js" id="toc-entry-21">components/StatPanel.js</a></li>
</ul>
</li>
<li><a class="reference internal" href="#components-bookpanel-js" id="toc-entry-22">components/BookPanel.js</a><ul>
<li><a class="reference internal" href="#components-booksearchpanel-js" id="toc-entry-23">components/BookSearchPanel.js</a></li>
<li><a class="reference internal" href="#components-table-js" id="toc-entry-24">components/Table.js</a></li>
<li><a class="reference internal" href="#components-pagingpanel-js" id="toc-entry-25">components/PagingPanel.js</a></li>
<li><a class="reference internal" href="#interlude-a-more-functional-component" id="toc-entry-26">Interlude: A more functional&nbsp;component</a></li>
</ul>
</li>
<li><a class="reference internal" href="#components-bookform" id="toc-entry-27">components/BookForm</a><ul>
<li><a class="reference internal" href="#components-input" id="toc-entry-28">components/Input</a></li>
<li><a class="reference internal" href="#components-select" id="toc-entry-29">components/Select</a></li>
<li><a class="reference internal" href="#components-datepicker" id="toc-entry-30">components/DatePicker</a></li>
<li><a class="reference internal" href="#should-i-create-my-own-input-components" id="toc-entry-31">Should I create my own input&nbsp;components?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#components-authorpanel" id="toc-entry-32">components/AuthorPanel</a></li>
<li><a class="reference internal" href="#components-authorform" id="toc-entry-33">components/AuthorForm</a></li>
</ul>
</li>
<li><a class="reference internal" href="#changing-the-ui-when-the-data-is-changed" id="toc-entry-34">Changing the <span class="caps">UI</span> when the data is&nbsp;changed</a></li>
<li><a class="reference internal" href="#conclusion" id="toc-entry-35">Conclusion</a></li>
</ul>
</div>
<p><strong>Update 10/05/2016</strong>: Add a section on how to update the <span class="caps">UI</span> when the data in the database is changed without using the <span class="caps">UI</span>.</p>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#toc-entry-1">Introduction</a></h2>
<p>Continuing the series of React-related articles, we&#8217;ll try to make a comprehensive
tutorial to the <a class="reference external" href="https://github.com/rackt/redux">redux</a> framework and its integrations with React, using the
<a class="reference external" href="https://github.com/rackt/react-redux">react-redux</a> library. Redux can be used as an alternative to Flux
(which we discussed in <a class="reference external" href="https://www.spapas.net/2015/07/02/comprehensive-react-flux-tutorial-2/">a previous article</a>)
to orchestrate the message passing between&nbsp;ui/components/data.</p>
<p>This tutorial will also produce as a result an opinionated (my opinion) boilerplate
project for creating react-redux Single Page Applications. I have used Django
as the back end however you could use any server-side framework you like,
Django is only used for implementing a bunch of <span class="caps">REST</span> APIs through django-rest-framework.
You may replace it with any other <span class="caps">REST</span> framework you&nbsp;like.</p>
<p>I have also used <tt class="docutils literal">browserify</tt> to pack the client-side code &#8212; I prefer it
from webpack as I find it much easier, clear and less-magical, and, since
it fills all my needs I don&#8217;t see any reason to take the webpack&nbsp;pill.</p>
<p>All client side code is written in <span class="caps">ES6</span> javascript using the latest trends &#8212; I will
try to explain anything I feel that is not very&nbsp;clear.</p>
<p>Before continuing, I have to mention that although I will provide an
(as comprehensive as possible) introduction to redux,
I will concentrate on the correct integration between redux, react-redux and
React in a complex, production level application. I&#8217;ll try to explain everything
I talk about, however, before reading the rest of
this article I recommend reading the introduction and basics sections
of <a class="reference external" href="http://rackt.org/redux/index.html">redux documentation</a> and watching the <a class="reference external" href="https://egghead.io/series/getting-started-with-redux">getting started with redux</a> from the
creator of redux &#8212; I can&#8217;t recommend the videos enough, they are really&nbsp;great!</p>
<p>One final thing: This is a <em>really long</em> article (more than 100 kb). It will
require a lot of time to read and understand it, especially if you are not
familiar with the concepts described here. Please take your time when reading
it and try verifying what I say here through the project that accompanies
this article &#64; <a class="reference external" href="https://github.com/spapas/react-tutorial/">https://github.com/spapas/react-tutorial/</a>, tag <tt class="docutils literal"><span class="pre">react-redux</span></tt>.</p>
</div>
<div class="section" id="introduction-to-redux">
<h2><a class="toc-backref" href="#toc-entry-2">Introduction to&nbsp;redux</a></h2>
<p>I have to say that I got interested in redux because of all that buzz this
framework generated. However, I got really interested in it when I
understood how close its philosophy was to functional programming -
this, when combined with the usage of react functional components will
enable you to write great code <em>and</em> (most important for me) really
enjoy coding with it (if you like functional programming of course :)&nbsp;)</p>
<p>Redux is simpler, having fewer and less complex concepts than the original Flux
implementation and more opinionated - this is a good&nbsp;thing!</p>
<p>Here are the basic building blocks of&nbsp;redux:</p>
<ul class="simple">
<li>One (and only one) <strong>state</strong>: It is an object that keeps the <em>global</em> state of your application. Everything has to be in that object, both data and&nbsp;ui.</li>
<li>A bunch of <strong>actions</strong>: These are simple objects that are created/dispatched when something happens (ui interaction, server response etc) with a mandatory property (their type) and a number of optional properties that define the data that accompanies each&nbsp;action.</li>
<li>A bunch of <strong>action creators</strong>: These are very simple functions that create action objects. Usually, there are as many action creators as actions (unless you use redux-thunk, we&#8217;ll talk about it&nbsp;later).</li>
<li>One (and only one) <strong>reducer</strong>: It is a function that retrieves the current state and an action and creates the resulting state. This is the central component of a redux application - every action along with the current state will be passed to the reducer and the state of the application will be the resulting, new&nbsp;state.</li>
<li>One (and only one) <strong>store</strong>: It is an object that is created by redux and is used as a glue between the state, the reducer and the&nbsp;components</li>
</ul>
<p>The general idea/flow&nbsp;is:</p>
<ul class="simple">
<li>Something (let&#8217;s call it event) happens (i.e a user clicks a button, a timeout is fired, an ajax request&nbsp;responds)</li>
<li>An action describing that event is created by its the corresponding action creator and dispatched (i.e passed to the reducer along with the current state) through the&nbsp;store</li>
<li>The dispach calls the reducer with the current state object and the action as&nbsp;parameters</li>
<li>The reducer checks the type of the action and, depending on the action type and any other properties this action has, creates a new state&nbsp;object</li>
<li>The store applies the new state to all&nbsp;components</li>
</ul>
<p>One thing we can see from the above is that redux is not react-only (although its general architecture is a perfect fit to react) but
could be also used with different view frameworks, or even with <em>no view framework</em>!</p>
<div class="section" id="a-simple-example">
<h3><a class="toc-backref" href="#toc-entry-3">A simple&nbsp;example</a></h3>
<p>I&#8217;ve implemented a very simple redux example &#64; jsfiddle that increases and decreases
a number using two buttons to support the&nbsp;above:</p>
<div class="jsfiddle"><iframe width="100%" height="300" src="http://jsfiddle.net/8aba3sp6/embedded/js,resources,html,css,result/light/" allowfullscreen="allowfullscreen" frameborder="0"></iframe></div><p>Its html&nbsp;is:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;state_container&#39;</span><span class="p">&gt;</span>0<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&#39;increase()&#39;</span><span class="p">&gt;</span>+<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&#39;decrease()&#39;</span><span class="p">&gt;</span>-<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</pre></div>
<p>while its javascript (es6) code&nbsp;is:</p>
<div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="nx">reducer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;INCREASE&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">state</span><span class="o">+</span><span class="mf">1</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;DECREASE&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">state</span><span class="o">-</span><span class="mf">1</span>
<span class="w">    </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">state</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Redux</span><span class="p">.</span><span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">)</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">unsubscribe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">store</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;state_container&#39;</span><span class="p">).</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">()</span>
<span class="p">)</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">increase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
<span class="w">  </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;INCREASE&#39;</span>
<span class="p">})</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">decrease</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
<span class="w">  </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;DECREASE&#39;</span>
<span class="p">})</span>
</pre></div>
<p>The <span class="caps">HTML</span> just displays a div which keeps the current number value
and two buttons that call the increase and decrease&nbsp;functions.</p>
<p>Now, for the javascript, we create a reducer function that
gets the previous state value (which initially is the number 0) and the
action that is dispatched. When the reducer is called it will check if the action type is &#8216;<span class="caps">INCREASE</span>&#8217;
or &#8216;<span class="caps">DECREASE</span>&#8217; and correspondigly increase or decreases the state,
which is just that number. Normally, the state will be a (rather fat)&nbsp;object.</p>
<p>We then create a store which gets the reducer as its only parameter
then and call its subscribe method passing a callback. This callback will be
called whenever the state is changed - in our case, the callback just updates
the div with the current number from the state. Finally, the increase
and decrease methods that are called when the butts are clicked
will just dispatch the corresponding&nbsp;action.</p>
<p>Please notice that in the above example I didn&#8217;t use action creators for
simplicity. For completeness, the action creator for increase would be something&nbsp;like</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">increaseCreator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;INCREASE&#39;</span>
<span class="p">}</span>
</pre></div>
<p>i.e it would just return an <tt class="docutils literal"><span class="caps">INCREASE</span></tt> action and <tt class="docutils literal">window.increase</tt>
would be <tt class="docutils literal">window.increase = e =&gt; <span class="pre">store.dispatch(increaseCreator())</span></tt>. Notice that
the <tt class="docutils literal">increaseCreator</tt> is called (has <tt class="docutils literal">()</tt>) so that <tt class="docutils literal">dispatch</tt> will receive the
resulting action object as a&nbsp;parameter.</p>
<p>The flow of the data when the increase button is clicked is the&nbsp;following:</p>
<ul class="simple">
<li><tt class="docutils literal">button.onClick</tt></li>
<li><tt class="docutils literal">increase()</tt></li>
<li><tt class="docutils literal">increaseCreator()</tt> (if we used action creators - this a param to <tt class="docutils literal">dispatch</tt> so it will be called&nbsp;first)</li>
<li><tt class="docutils literal"><span class="pre">store.dispatch({type:</span> '<span class="caps">INCREASE</span>' })</tt></li>
<li><tt class="docutils literal">reducer(current_state, {type: <span class="pre">'<span class="caps">INCREASE</span>'})</span></tt></li>
<li>Reducer returns the new state (<tt class="docutils literal">state+1</tt>)</li>
<li><tt class="docutils literal">callback()</tt></li>
<li>value is&nbsp;updated</li>
</ul>
<p>Having one and only one store/state makes the flow of the data crystal and
resolves some of the dillemas I had when using the original Flux architecture!
Some people may argue that although a single reducer function is nice for
the above simple demo, having a huge (spaghetti-like) switch statement in
your reducer is not a very good practice - thankfully redux has a bunch
of tools that will presented later and greatly help on this (seperating the
reducing logic, using different modules for each module&nbsp;etc).</p>
</div>
<div class="section" id="interlude-so-what-s-a-reducer">
<h3><a class="toc-backref" href="#toc-entry-4">Interlude: So what&#8217;s a&nbsp;reducer?</a></h3>
<p>I&#8217;d like to talk a bit about the &#8220;reducer&#8221;, mainly for people not familiar with
functional programming (although people writing Javascript <em>should</em> be familiar
with functional programming since Javascript has functional features) to clarify
my statement above that the redux philosophy is close to functional&nbsp;programming.</p>
<p>One basic concept of functional programming is the concept of
&#8220;map-reduce&#8221;. Mapping means calling a function (let&#8217;s call it mapper)
for all elements of a list and creating a new list with the output of each
individual call. So, a mapper gets only one parameter, the current value of
the list. For example the &#8220;double&#8221; mapper, defined like
<tt class="docutils literal">let double = x =&gt; x*2</tt> would &#8220;map&#8221; the list <tt class="docutils literal">[1,2,3]</tt> to <tt class="docutils literal">[2,4,6]</tt>.</p>
<p>Reducing means calling a function (let&#8217;s call it <em>reducer</em>) for all elements
of a list and creating a single value that accumulates the result of each
individual call. This can be done because the reducer gets <em>two</em> parameters,
the accumulated value of the list until this point and the current value of the list.
Also, when doing a reduce we need to define a starting value for the accumulator.
For example, the &#8220;sum&#8221; reducer, defined like <tt class="docutils literal">let sum = (s=0, x) =&gt; s+x</tt>,
(which has an initial value of 0), would &#8220;reduce&#8221; the list <tt class="docutils literal">[1,2,3]</tt> to <tt class="docutils literal">6</tt> by calling
the <tt class="docutils literal">sum</tt> reducer three&nbsp;times:</p>
<div class="highlight"><pre><span></span><span class="nx">tmp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sum</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// tmp1 = 1</span>
<span class="nx">tmp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sum</span><span class="p">(</span><span class="nx">tmp1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// tmp2 = 3</span>
<span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sum</span><span class="p">(</span><span class="nx">tmp2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">);</span><span class="w"> </span><span class="c1">// result = 6</span>
</pre></div>
<p>So, a redux reducer is <em>actually</em> a (rather complex) functional reducer, getting the current
state (as the accumulated value) and each individual action as the value and
returning the new state which is the result of applying this action to the&nbsp;state!</p>
<p>Three extra things to make sure about your redux reducers are&nbsp;that:</p>
<ul class="simple">
<li>they should have an initial value (with the initial state of the application) or know how to handle an undefined initial&nbsp;state</li>
<li>they must not not mutate (change) the state object but instead create and return a new one (not allowing object mutations is a general practice in functional programming but in redux also helps to quickly apply the changes to the&nbsp;components)</li>
<li>always return a valid state as a result (or else the application will have invalid&nbsp;state)</li>
</ul>
</div>
<div class="section" id="what-about-react-redux">
<h3><a class="toc-backref" href="#toc-entry-5">What about&nbsp;react-redux?</a></h3>
<p>React-redux is a rather simple framework that offers two helpful utilities for integrating
redux with&nbsp;React:</p>
<ul class="simple">
<li>A <tt class="docutils literal">connect</tt> function that &#8220;connects&#8221; React components to the redux store. This function (among others) retrieves a callback parameter that defines properties that will be passed to that component and each one will be (magically) mapped to state&nbsp;properties.</li>
<li>A <tt class="docutils literal">Provider</tt> component. This is a parent component that can be used to (magically) pass the store properties to its children&nbsp;components.</li>
</ul>
<p>Please notice that nothing actually magical happens when the store properties are passed to the children
components through <tt class="docutils literal">connect</tt> and <tt class="docutils literal">Provider</tt>! this is accomplished through the <a class="reference external" href="https://facebook.github.io/react/docs/context.html">react context</a> feature
that allows you to &#8220;pass data through the component tree without having to pass the props down manually
at every level&#8221;. So <tt class="docutils literal"><span class="pre">connect``ed</span> components used context to retrieve the store properties that
have been passed to the context by the ``Provider</tt>.</p>
<p>How react-redux is used be made more clear with another jsfiddle that will convert the previous example to React and&nbsp;react-redux:</p>
<div class="jsfiddle"><iframe width="100%" height="300" src="http://jsfiddle.net/8aba3sp6/2/embedded/js,resources,html,css,result/light/" allowfullscreen="allowfullscreen" frameborder="0"></iframe></div><p>The html is just <tt class="docutils literal">&lt;div <span class="pre">id='container'&gt;&lt;/div&gt;</span></tt> since the components will
be rendered through react, while the es6/jsx code&nbsp;is:</p>
<div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="nx">reducer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;INCREASE&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">state</span><span class="o">+</span><span class="mf">1</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;DECREASE&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">state</span><span class="o">-</span><span class="mf">1</span>
<span class="w">    </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">state</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span><span class="w"> </span><span class="nx">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Redux</span><span class="p">.</span><span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">)</span>

<span class="kd">class</span><span class="w"> </span><span class="nx">RootComponent</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">{</span><span class="nx">number</span><span class="p">,</span><span class="w"> </span><span class="nx">increase</span><span class="p">,</span><span class="w"> </span><span class="nx">decrease</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">number</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span><span class="p">=&gt;</span><span class="nx">increase</span><span class="p">()}</span><span class="o">&gt;+&lt;</span><span class="err">/button&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span><span class="p">=&gt;</span><span class="nx">decrease</span><span class="p">()}</span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="err">/button&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span><span class="w"> </span><span class="nx">mapStateToProps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">number</span><span class="o">:</span><span class="w"> </span><span class="nx">state</span>
<span class="p">})</span>

<span class="kd">let</span><span class="w"> </span><span class="nx">mapDispatchToProps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dispatch</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">increase</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;INCREASE&#39;</span><span class="p">}),</span>
<span class="w">  </span><span class="nx">decrease</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;DECREASE&#39;</span><span class="p">})</span>
<span class="p">})</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">ConnectedRootComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ReactRedux</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span>
<span class="w">    </span><span class="nx">mapStateToProps</span><span class="p">,</span><span class="w"> </span><span class="nx">mapDispatchToProps</span>
<span class="p">)(</span><span class="nx">RootComponent</span><span class="p">)</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
<span class="w">  </span><span class="o">&lt;</span><span class="nx">ReactRedux</span><span class="p">.</span><span class="nx">Provider</span><span class="w"> </span><span class="nx">store</span><span class="o">=</span><span class="p">{</span><span class="nx">store</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">ConnectedRootComponent</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="err">/ReactRedux.Provider&gt;,</span>
<span class="w">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;container&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
<p>As we can see, the reducer and store are the same as the non-react version. What is new
here is that I&#8217;ve added a React <tt class="docutils literal">RootComponent</tt> that has two properties, one named <tt class="docutils literal">number</tt>
and one named <tt class="docutils literal">dispatch</tt> that can be used to dispatch an action through the&nbsp;store.</p>
<p>Using react-redux&#8217;s <tt class="docutils literal">connect</tt> function we create a new component, <tt class="docutils literal">ConnnectedRootComponent</tt>
which is a new component with the redux-enabled functionality (i.e it will have access to
store). The <tt class="docutils literal">connect()</tt> function takes
a bunch of optional arguments. I won&#8217;t go into much detail since its a little complex
(the <a class="reference external" href="https://github.com/rackt/react-redux/blob/master/docs/api.md#connectmapstatetoprops-mapdispatchtoprops-mergeprops-options">react-redux documentation</a> is clear enough), however in our example we have defined
two objects named <tt class="docutils literal">mapStateToProps</tt> and <tt class="docutils literal">mapDispatchToProps</tt>
which are passed to <tt class="docutils literal">connect</tt> and define how the state and the dispatch are mapped to
the properties the connected component will&nbsp;have.</p>
<p>The <tt class="docutils literal">mapStateToProps</tt> is a function that will be called whenever the store&#8217;s state
changes and should return an object whose attributes will be passed to the connected component
as properties. In our example,
we return an object with a number attribute having the current state
(which don&#8217;t forget that is just a number) as its value -
that&#8217;s why we can extract the <tt class="docutils literal">number</tt> attribute from <tt class="docutils literal">this.props</tt> when&nbsp;rendering.</p>
<p>The <tt class="docutils literal">mapDispatchToProps</tt> as we use it, once again returns an object
whose attributes will be passed to the connected component and will dispatch
actions when&nbsp;called.</p>
<p>Of course, in order for
the <tt class="docutils literal">ConnectedRootComponent</tt> to <em>actually</em> have these properties that we passed through <tt class="docutils literal">connect</tt>,
it must
be enclosed in a <tt class="docutils literal">&lt;Provider&gt;</tt> parent component (so that the correct react context will be initialized).
Notice that this is recursive so if we had&nbsp;something</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">Provider</span> <span class="na">store</span><span class="o">=</span><span class="s">{store}</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">Component1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">Component2</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">ConnectedComponent</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">ConnectedComponent</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">Component2</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">Component1</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">Provider</span><span class="p">&gt;</span>
</pre></div>
<p>the <tt class="docutils literal">&lt;ConnectedComponent&gt;</tt> would still get the props (dispatch + state slice) we mentioned above
even if its parent components were not&nbsp;connected.</p>
<p>Although we could have avoided using react-redux  by passing the store directly
to <tt class="docutils literal">&lt;RootComponent&gt;</tt> and subscibing to the store changes from the <tt class="docutils literal">RootComponent</tt>&#8216;s <tt class="docutils literal">componentWillMount</tt> method,
the added-value of react-redux is that using <tt class="docutils literal">connect</tt> and <tt class="docutils literal">Provider</tt> we could pass dispatch and
state slices deep inside our component hierarchy without the need to explicitly pass the store
to each individual component and also that react-redux will make optimizations so that the
each connected component will be re-rendered only when needed (depending on the state slice it uses)
and not for every state change. Please be warned that this does not mean that you should connect everything
so that everything will have access to the global state and be able to dispatch actions. You should be very
careful to connect only the components that really need to be connected (redux calls them container components)
and pass dispatch and state as
properties to their children (which are called presentational components). Also, each connected component should receive only
the part of the global state it
needs and not everything (so that each particular component will update only when needed and not for
every state update). The above is absolutely necessary if you want to crate re-usable (<span class="caps">DRY</span>) and
easily testable components. I&#8217;ll discuss this a little more when
describing the sample&nbsp;project.</p>
<p>Finally, notice how easy it is to create reusable container
components using <tt class="docutils literal">mapStateToProps</tt> and <tt class="docutils literal">mapDispatchToProps</tt>:
Both the way the component gets its state and calls its actions are
defined through these two objects so you can create
as many connected objects as you want by passing different
<tt class="docutils literal">mapStateToProps</tt> and <tt class="docutils literal">mapDispatchToProps</tt> - more on this&nbsp;later.</p>
</div>
</div>
<div class="section" id="our-project">
<h2><a class="toc-backref" href="#toc-entry-6">Our&nbsp;project</a></h2>
<p>After this rather lengthy introduction to redux and react-redux we may move on to our
project. First of all, let&#8217;s see an example of what we&#8217;ll actually build&nbsp;here:</p>
<img alt="Our project" src="/images/demo3.gif" style="width: 600px;" />
<p>This is a single-page application that supports client side routing and
has four different routes: A books list, an authors list, a book editing/create
form and an author editing/create form.
The books list supports searching (with the filter field),
pagination (with 5 books per page) and per-column sorting when
clicking the column name (ascending/descending). The book form
supports validation (on the book title), cascading drop downs
(changing category limits the subcategory choices) and a
jquery ui datepicker to select the book publish date. Also,
you can delete books or authors from their corresponding
form. Notice that there&#8217;s a statistics panel showing the current
number of authors and books. A nice loading spinner
will be displayed when asynchronous ajax actions are executed
and a snackbar notification will be shown when such an action
is executed. Finally, although you won&#8217;t be able to see it,
the url of the application is changed according to the choices
the user&nbsp;makes.</p>
<div class="section" id="other-libraries-used">
<h3><a class="toc-backref" href="#toc-entry-7">Other libraries&nbsp;used</a></h3>
<p>React (and redux) have a big ecosystem of great libraries. Some of these have been used
for this project and will also be discussed in this&nbsp;article:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/gaearon/redux-thunk">redux-thunk</a>: This is a nice add-on for redux that generalizes action&nbsp;creators.</li>
<li><a class="reference external" href="https://github.com/erikras/redux-form">redux-form</a>: A better way to use forms with react and redux. Always use it if you have non-trivial&nbsp;forms.</li>
<li><a class="reference external" href="https://github.com/rackt/react-router">react-router</a>: A library to create routes for single page applications with&nbsp;React.</li>
<li><a class="reference external" href="https://github.com/rackt/react-router-redux">react-router-redux</a> (ex redux-simple-router): This library will help integrating react-router with&nbsp;redux.</li>
<li><a class="reference external" href="https://github.com/rackt/history">history</a>: This is used bt react-router to crete the page history (so that back forward etc&nbsp;work).</li>
<li><a class="reference external" href="https://github.com/pburtchaell/react-notification">react-notification</a>: A simple react component to display&nbsp;notifications.</li>
</ul>
<p>The triplet react-router, react-router-redux and history needs to be used for projects that
enable client side routing. The redux-form is really useful if you have non-trivial forms
in your projects - you may skip it if you don&#8217;t use forms or for example you use a form for
searching/filtering with a single input. react-notification just displays notifications,
you can easily exchange it with other similar components or create your&nbsp;own.</p>
</div>
<div class="section" id="redux-thunk">
<h3><a class="toc-backref" href="#toc-entry-8">redux-thunk?</a></h3>
<p>Now, about redux-thunk. I won&#8217;t go into much detail here, you can read more about it in this <a class="reference external" href="http://stackoverflow.com/a/35415559/119071">great <span class="caps">SO</span> answer</a>,
however I&#8217;d like to point out here that <strong>everything that can be done with redux-thunk
can also be done without it</strong> so you may safely skip it if you feel that you don&#8217;t really
need it in your&nbsp;project.</p>
<p>But what does it do? Well, redux-thunk allows you to create action creators that don&#8217;t only return
action objects but can do various other things, like calling other actions or
dispatching actions conditionally. When using redux-thunk, an action returns a function
that can do any of the above mentioned things, something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">thunkAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span><span class="w"> </span><span class="nx">getState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// here you may</span>
<span class="w">    </span><span class="c1">// dispatch other actions (more than one) using the provided dispatch() parameter</span>
<span class="w">    </span><span class="c1">// or</span>
<span class="w">    </span><span class="c1">// check the current state using the getState() parameter and do conditional dispatches</span>
<span class="w">    </span><span class="c1">// or</span>
<span class="w">    </span><span class="c1">// call functions asynchronously so that these will use the provided</span>
<span class="w">    </span><span class="c1">// dispatch function when they return</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>Let&#8217;s say that we wanted to implement an asynchronous, ajax call.
If we don&#8217;t want to use redux thunk,
then we need to create a normal function that gets <tt class="docutils literal">dispatch</tt> as an argument, something
like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">showLoadingAction</span><span class="p">,</span><span class="w"> </span><span class="nx">hideLoadingAction</span><span class="p">,</span><span class="w"> </span><span class="nx">showDataAction</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./actions&#39;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">getData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">showLoadingAction</span><span class="p">())</span>
<span class="w">  </span><span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">data_url</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">hideLoadingAction</span><span class="p">())</span>
<span class="w">      </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">showDataAction</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>
</pre></div>
<p>The main problem with this approach is that the getData functions <em>is not</em>
called like a normal
action creator (like <tt class="docutils literal">showLoadingAction</tt>, <tt class="docutils literal">hideLoadingAction</tt> and <tt class="docutils literal">showDataAction</tt>)
since it actually returns nothing (so nothing will be dispatched),
so you&#8217;ll need to remember to call it directly
and pass it the <tt class="docutils literal">dispatch</tt> <em>instead of</em> passing its return value to <tt class="docutils literal">dispatch</tt>!</p>
<p>If however we used thunk, then we&#8217;d have something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">getDataThunk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span><span class="w"> </span><span class="nx">getState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">showLoadingAction</span><span class="p">())</span>
<span class="w">    </span><span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">data_url</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">hideLoadingAction</span><span class="p">())</span>
<span class="w">        </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">showDataAction</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>Now, the above can be used like a normal action (i.e it can be called using <tt class="docutils literal"><span class="pre">dispatch(getDataThunk())</span></tt>).
That&#8217;s more or less the main advantage of redux-thunk: You are able to create thunk action creators that
can be called like normal actions and can do more complex things than just returning action objects
so you don&#8217;t have to remember how to call each&nbsp;function.</p>
<p>I have to repeat
again that everything that you be done with thunk action creators, can also be done with normal functions
that get <tt class="docutils literal">dispatch</tt> as a paremeter - the advantage of thunk action creators is that you don&#8217;t need to
remember if an action creator needs to be called through <tt class="docutils literal"><span class="pre">disaptch(actionCreator())</span></tt>
or <tt class="docutils literal">actionCreator(dispatch)</tt>.</p>
<p>In this tutorial you&#8217;ll see heavy use of redux-thunk. This is just my personal preference - you may
use it less or not at all (however, if you&#8217;ve configured your project to use redux-thunk then I propose
to go all the way and use it all the time for those more complex action&nbsp;creators).</p>
</div>
</div>
<div class="section" id="explaining-the-application">
<h2><a class="toc-backref" href="#toc-entry-9">Explaining the&nbsp;application</a></h2>
<p>In the following paragraphs we&#8217;ll see together the structure and source code of
this application. I&#8217;ll try to go into as much detail as possible in order to solve
any questions you may have (I know I had many when I tried setting up everything for
the first time). I&#8217;ll skip imports and non-interesting components - after all the
complete source code can be found &#64; <a class="reference external" href="https://github.com/spapas/react-tutorial/">https://github.com/spapas/react-tutorial/</a>,
checkout the tag <tt class="docutils literal"><span class="pre">react-redux</span></tt>.
We&#8217;ll use a top down approach, starting from the main component where the
client side routing
is defined and the application is mounted to the <span class="caps">DOM</span>:</p>
<div class="section" id="main-js">
<h3><a class="toc-backref" href="#toc-entry-10">main.js</a></h3>
<p>This module is used as an entry point for browserify (i.e we call browserify with
<tt class="docutils literal">browserify main.js <span class="pre">-o</span> bundle.js</tt> ) and uses components defined elsewhere to
create the basic structure of our application. Let&#8217;s take a look at the important
part of&nbsp;it:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">About</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">About</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Link</span><span class="w"> </span><span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;</span><span class="nx">Home</span><span class="o">&lt;</span><span class="err">/Link&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">}</span>

<span class="nx">render</span><span class="p">((</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Provider</span><span class="w"> </span><span class="nx">store</span><span class="o">=</span><span class="p">{</span><span class="nx">store</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Router</span><span class="w"> </span><span class="nx">history</span><span class="o">=</span><span class="p">{</span><span class="nx">history</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">Route</span><span class="w"> </span><span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">App</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">IndexRoute</span><span class="w"> </span><span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">BookPanel</span><span class="p">}</span><span class="o">/&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">Route</span><span class="w"> </span><span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/book_create/&quot;</span><span class="w"> </span><span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">BookForm</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">Route</span><span class="w"> </span><span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/book_update/:id&quot;</span><span class="w"> </span><span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">BookForm</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>

<span class="w">                </span><span class="o">&lt;</span><span class="nx">Route</span><span class="w"> </span><span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/authors/&quot;</span><span class="w"> </span><span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">AuthorPanel</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">Route</span><span class="w"> </span><span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/author_create/&quot;</span><span class="w"> </span><span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">AuthorForm</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">Route</span><span class="w"> </span><span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/author_update/:id&quot;</span><span class="w"> </span><span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">AuthorForm</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>

<span class="w">                </span><span class="o">&lt;</span><span class="nx">Route</span><span class="w"> </span><span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/about&quot;</span><span class="w"> </span><span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">About</span><span class="p">}</span><span class="o">/&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">Route</span><span class="w"> </span><span class="nx">path</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="w"> </span><span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">NoMatch</span><span class="p">}</span><span class="o">/&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/Route&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/Router&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Provider&gt;</span>
<span class="w">  </span><span class="p">),</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
<p>We can see the well-known <tt class="docutils literal">render</tt> function from ReactDOM that gets a component
and a <span class="caps">DOM</span> element to mount it to. The domponent we provide to render is the <tt class="docutils literal">Provider</tt>
from react-redux we talked about before in order to enable all children components
to use <tt class="docutils literal">connect</tt> to have access to the store properties and dispatch. This is the usual
approact with react-redux: <em>The outer component will always be the&nbsp;&#8220;Provider&#8220;.</em></p>
<p>The <tt class="docutils literal">Provider</tt> component gets one parameter which is the store that redux will use. We
have initialized our store in a different module which I will present&nbsp;below.</p>
<p>Inside the <tt class="docutils literal">Provider</tt> we are defining a <tt class="docutils literal">Router</tt> from <tt class="docutils literal"><span class="pre">react-router</span></tt>. This should
be the parent component inside which all client-side routes of our appliccation are defined.
The <tt class="docutils literal">Router</tt> gets a <tt class="docutils literal">history</tt> parameter which is initialized elsewhere (stick with me
for now, I will talk about it&nbsp;later).</p>
<p>Now, inside <tt class="docutils literal">Router</tt> we are defining the actual routes of this application. As we
can see,
there&#8217;s a parent <tt class="docutils literal">Route</tt> that is connnected to the <tt class="docutils literal">App</tt> component which actually
contains everything else. The parent route contains an <tt class="docutils literal">IndexRoute</tt> whose corresponding
component (<tt class="docutils literal">BookPanel</tt>) is called
when no route is defined and a bunch of normal <tt class="docutils literal">Route</tt> components whose
components are called when the url matches their part. Notice how we pass parameters
to urls (e.g <tt class="docutils literal"><span class="pre">/book_update/:id</span></tt>) and the match-all route
(<tt class="docutils literal">&lt;Route <span class="pre">path=&quot;*&quot;</span> <span class="pre">component={NoMatch}/&gt;</span></tt>).</p>
<p>Finally as an example of a routed-to component, notice the <tt class="docutils literal">About</tt> component
which is rendered when the route is <tt class="docutils literal">/about</tt>. This is just a normal react component that-
will be rendered <em>inside</em> the <tt class="docutils literal">App</tt> component -
the <tt class="docutils literal">Link</tt> is a <tt class="docutils literal"><span class="pre">react-router</span></tt> component that renders a link to a defined&nbsp;route.</p>
</div>
<div class="section" id="store-js">
<h3><a class="toc-backref" href="#toc-entry-11">store.js</a></h3>
<p>The <tt class="docutils literal">store.js</tt> module contains the definition of the global store of our application
(which is passed to the <tt class="docutils literal">Provider</tt>).
Here, we also define the <tt class="docutils literal">history</tt> object we passed to the parent <tt class="docutils literal">Router</tt>.</p>
<div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">reducer</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">formReducer</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;redux-form&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="nx">createHistory</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;history/lib/createHashHistory&#39;</span>

<span class="c1">// Opt-out of persistent state, not recommended.</span>
<span class="c1">// https://github.com/reactjs/history/blob/master/docs/HashHistoryCaveats.md</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">history</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createHistory</span><span class="p">({</span>
<span class="w">    </span><span class="nx">queryKey</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">});</span>
</pre></div>
<p>First of all, we see that our <tt class="docutils literal">history</tt> object is of type <tt class="docutils literal">HashHistory</tt>
(<a class="reference external" href="https://github.com/reactjs/react-router/blob/latest/docs/guides/Histories.md#hashhistory">more info about history types</a>) and I&#8217;ve also opted out of using
<tt class="docutils literal">queryKey</tt>. If I hadn&#8217;t used the <tt class="docutils literal">queryKey: false</tt> configuration
then there&#8217;d be a <tt class="docutils literal"><span class="pre">?_k=ckuvup</span></tt> query parameter in the <span class="caps">URL</span>. Now, this
parameter is actually useful (it stores location state <em>not</em> present
in the <span class="caps">URL</span> for example <span class="caps">POST</span> form data) but I don&#8217;t need it for this
example (and generally I prefer cleaner <span class="caps">URLS</span>) - but if you don&#8217;t like
the behavior of your history without it then go ahead and add&nbsp;it.</p>
<p>Also, notice that I&#8217;ve used <tt class="docutils literal">HashHistory</tt> which will append a <tt class="docutils literal">#</tt>
to the <span class="caps">URL</span> and the client-side <span class="caps">URL</span> will come after that, so all
URLs will be under (for example) <tt class="docutils literal">/index.html</tt> like <tt class="docutils literal"><span class="pre">/index.html#/authors</span></tt>.
The react-router
documentation recommends using <tt class="docutils literal">BrowserHistory</tt> which uses normal (clean)
urls &#8212; so instead of <tt class="docutils literal"><span class="pre">/index.html#/authors</span></tt> we&#8217;d see <tt class="docutils literal">/authors</tt> if we&#8217;d
used <tt class="docutils literal">BrowserHistory</tt>.</p>
<p>The problem with <tt class="docutils literal">BrowserHistory</tt> is that you&#8217;ll need to configure correctly
your <span class="caps">HTTP</span> server so that it will translate every <span class="caps">URL</span> (/foo) to the same
<span class="caps">URL</span> under <tt class="docutils literal">/index.html</tt> (<tt class="docutils literal"><span class="pre">/index.html#/foo</span></tt>) - as can be understood,
without that configuration the <span class="caps">HTTP</span> server doesn&#8217;t know anything about the
client side urls so when the webserver sees <tt class="docutils literal">/authors</tt> it will pass
<tt class="docutils literal">/authors</tt> to your server side framework (which will return a 404 error) - that&#8217;s
why this translation is&nbsp;needed.</p>
<p>However, in my case, I don&#8217;t think
that configuring your <span class="caps">HTTP</span> server to rewrite urls is worth the trouble and also I do really
prefer using <tt class="docutils literal">#</tt> for client-side urls! This is a common patter, recognised
by everybody and even without the <span class="caps">HTTP</span> server-configuration part I&#8217;d still
prefer <tt class="docutils literal">HashHistory</tt> over <tt class="docutils literal">BrowserHistory</tt> - of course this is just my opinion, feel free to use
<tt class="docutils literal">BrowserHistory</tt> if you don&#8217;t like the hash <tt class="docutils literal">#</tt>!</p>
<p>The next block of code from the <tt class="docutils literal">store</tt> module creates the
most important thing of a redux application, its reducer
along with the global&nbsp;store:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">reducer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">combineReducers</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">books</span><span class="p">,</span>
<span class="w">        </span><span class="nx">notification</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ui</span><span class="p">,</span>
<span class="w">        </span><span class="nx">categories</span><span class="p">,</span>
<span class="w">        </span><span class="nx">authors</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">routing</span><span class="o">:</span><span class="w"> </span><span class="nx">routeReducer</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">form</span><span class="o">:</span><span class="w"> </span><span class="nx">formReducer</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">)</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">reduxRouterMiddleware</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">syncHistory</span><span class="p">(</span><span class="nx">history</span><span class="p">)</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span><span class="w"> </span><span class="nx">applyMiddleware</span><span class="p">(</span>
<span class="w">    </span><span class="nx">thunk</span><span class="p">,</span><span class="w"> </span><span class="nx">reduxRouterMiddleware</span>
<span class="p">));</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">store</span>
</pre></div>
<p>Please notice above that the <tt class="docutils literal">Object.assign</tt> method is used - I&#8217;ll talk about
it later &#8212;  however, another common <span class="caps">ES6</span> idiom that I&#8217;ve used here
is that when you define
an object you can change  <tt class="docutils literal">{ x: x }</tt> to <tt class="docutils literal">{ x }</tt> (so <tt class="docutils literal">{books}</tt>
means <tt class="docutils literal">{'books': books}</tt>).</p>
<p>The <tt class="docutils literal">combineReducers</tt> function is provided
by redux and is a helper function that helps you in &#8230; combining reducers!
As you see, I&#8217;ve combined the reducers defined in this application
<tt class="docutils literal">(books, notification, ui, categories, authors)</tt> with the reducers
of <tt class="docutils literal"><span class="pre">react-router-redux</span></tt> and <tt class="docutils literal"><span class="pre">redux-form</span></tt>
to create <em>the reducer</em>. We&#8217;ll talk a bit in the next
interlude on what does combining reducers&nbsp;is.</p>
<p>The <tt class="docutils literal">routeReducer</tt> and <tt class="docutils literal">formReducer</tt> reducers are provided by
react-router-redux and refux-form to properly handle the routing
and form-related&nbsp;actions.</p>
<p>The remaining of the code generates the <tt class="docutils literal">store</tt>: First of all, a middleware
(please see next-next interlude for more)
is created with <tt class="docutils literal">syncHistory</tt> that allows actions to call history methods
(so that when the <span class="caps">URL</span> is changed through actions they will be reflected to the
history). Then, the <tt class="docutils literal">createStoreWithMiddleware</tt> function is called to generate
the store that will be passed to the <tt class="docutils literal">Provider</tt>. This function takes the
reducer as a parameter along with any store enchancers that we&#8217;d like to
apply. A store enchancer is a function that modifies the store. The only
store enchanccer that we use now is the output of the
<tt class="docutils literal">applyMiddleware</tt> function that combines the two middlewares we&#8217;ve defined (one is for
redux thunk, the other is for <tt class="docutils literal">syncHistory</tt>). I know, your head hurts but
I&#8217;ll try to clear things out&nbsp;below.</p>
<div class="section" id="interlude-combining-reducers">
<h4><a class="toc-backref" href="#toc-entry-12">Interlude: Combining&nbsp;reducers</a></h4>
<p>So, what does the <tt class="docutils literal">combineReducers</tt> function do? As we&#8217;ve already seen,
the reducer is a simple function that gets the current state and an
action as parameters and returns the next state (which is the result of applying
the action to the state). The reducer will have a big switch statement that
checks the type of the action and returns the correct new state. Unfortunately,
this switch statement may get way too fat and unmaintainable for large&nbsp;projects.</p>
<p>That&#8217;s where combining reducers comes to the rescue: Instead of having one big,
monolithic reducer for all the parts of our application state tree, we can break it to individual
reducers depending only on specific slices of the state object. What this means is
that if we have for example a state tree like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="s1">&#39;data&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">  </span><span class="s1">&#39;ui&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</pre></div>
<p>with actions that manipulate either data or ui, we could create two indivdual reducers,
one for the <tt class="docutils literal">data</tt> slice, and one for the <tt class="docutils literal">ui</tt> slice of the state tree. These reducers would get <em>only</em>
the slice of the state that they are interested in, so the <tt class="docutils literal">dataReducer</tt> will get
only the <tt class="docutils literal">data</tt> part of the state tree and the <tt class="docutils literal">uiReducer</tt> will get only the <tt class="docutils literal">ui</tt>
part of the state&nbsp;tree.</p>
<p>To <em>combine</em> these reducers the <tt class="docutils literal">combineReducers</tt> function is used. This function
gets an object with the name of the state part for each sub-reducer as attribute names
and that sub-reducer
as values and returns a reducer function that passes the action along with
the correct state slice to each of the sub-reducers and creates the global state object by
combining the output of each&nbsp;sub-reducer.</p>
<p>This may be clarified more with our own version of a combine reducers&nbsp;function:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">combineReducers2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="p">{},</span><span class="w"> </span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mapped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">o</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">k</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">              </span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="nx">k</span><span class="p">,</span>
<span class="w">              </span><span class="nx">slice</span><span class="o">:</span><span class="w"> </span><span class="nx">o</span><span class="p">[</span><span class="nx">k</span><span class="p">](</span><span class="nx">state</span><span class="p">[</span><span class="nx">k</span><span class="p">],</span><span class="w"> </span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="c1">// call k sub-reducer and get result</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">      </span><span class="p">))</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">reduced</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mapped</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)=&gt;{</span>
<span class="w">          </span><span class="nx">s</span><span class="p">[</span><span class="nx">x</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]]</span><span class="o">=</span><span class="nx">x</span><span class="p">[</span><span class="s1">&#39;slice&#39;</span><span class="p">]</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="nx">s</span>
<span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="p">{})</span>

<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">reduced</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>The above function gets an object (<tt class="docutils literal">o</tt>) with state slices and sub-reducers
as input and returns a function (that function is the resulting reducer)&nbsp;that:</p>
<ul class="simple">
<li>Creates an array (named <tt class="docutils literal">mapped</tt>) of objects with two attributes: <tt class="docutils literal">key</tt> for each attribute of <tt class="docutils literal">o</tt> and <tt class="docutils literal">slice</tt> after applying the sub-reducer to the corresponding state&nbsp;slice</li>
<li>Reduces and returns the above array (<tt class="docutils literal">reduced</tt>) to a single object that has attributes for each state slice and the resulting state slice as values (this is actually the global&nbsp;state)</li>
</ul>
<p>To show-off the <span class="caps">ES6</span> code (and my most sadistic tendencies),
the above code could be also writen like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">combineReducers3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="p">{},</span><span class="w"> </span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">o</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">k</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="nx">k</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">[</span><span class="nx">k</span><span class="p">](</span><span class="nx">state</span><span class="p">[</span><span class="nx">k</span><span class="p">],</span><span class="w"> </span><span class="nx">action</span><span class="p">)</span>
<span class="p">]).</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">[</span><span class="nx">x</span><span class="p">[</span><span class="mf">0</span><span class="p">]]</span><span class="o">:</span><span class="w"> </span><span class="nx">x</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span>
<span class="p">}),</span><span class="w"> </span><span class="p">{})</span>
</pre></div>
<p>I wouldn&#8217;t like to explain this - its more or less a more functional version of <tt class="docutils literal">combineReducers2</tt>.</p>
</div>
<div class="section" id="interlude-middlewares">
<h4><a class="toc-backref" href="#toc-entry-13">Interlude:&nbsp;Middlewares</a></h4>
<p>A redux middleware is <a class="reference external" href="http://redux.js.org/docs/advanced/Middleware.html">rather difficult to explain</a> technically but easier to explain
conceptually: What it does it that it can be used to extend the store&#8217;s dispatch by providing
extra functionality. We&#8217;ve already seen such functionality, the ability to use
thunk action creators (for action creators that don&#8217;t return the next state&nbsp;object).</p>
<p>If you take a look at the <tt class="docutils literal">createStore</tt> function, you&#8217;ll see that
its second parameter is called <tt class="docutils literal">enhancer</tt>. When <tt class="docutils literal">enhancer</tt>
is a function (like in our case where it is the
result of <tt class="docutils literal">applyMiddleware</tt>) the return value of <tt class="docutils literal">createStore</tt>
is <tt class="docutils literal"><span class="pre">enhancer(createStore(...))</span></tt> so it will call the result of <tt class="docutils literal">applyMiddleware</tt>
with the store as&nbsp;parameter.</p>
<p>Now, what does <tt class="docutils literal">applyMiddleware</tt>? It gets a variable
number of functions (using the spread <tt class="docutils literal">...</tt> operator) as input arguments (let&#8217;s call
them middlewares) and returns
<em>another</em> function (this is the <tt class="docutils literal">enhancer</tt> we mentioned in the previous paragraph)
that gets a store as an input and
returns the same store with its <tt class="docutils literal">dispatch</tt> method modified so that it will
call each middleware and pass the result to the next. So, in our case the
resulting store&#8217;s dispatch function would be something&nbsp;like:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">reduxRouterMiddleware</span><span class="p">(</span><span class="nx">thunk</span><span class="p">(</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">action</span><span class="p">)))</span>
</pre></div>
<p>Now, a middleware function looks like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">middleware</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">store</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">next</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">//</span>
<span class="p">}</span>
</pre></div>
<p>it returns a function that gets the <tt class="docutils literal">store</tt> as input
and returns another function. This returned function
gets <tt class="docutils literal">next</tt> as an input. What is next? It&#8217;s just the
next <tt class="docutils literal">dispatch</tt> function to be called. So the first middleware will have the original
store&#8217;s <tt class="docutils literal">dispatch</tt> as its <tt class="docutils literal">next</tt> parameter, the second middleware will have the
result of passing the store&#8217;s <tt class="docutils literal">dispatch</tt> from the first middleware, etc. Something like
this: <tt class="docutils literal">middleware2Dispatch(next=middleware1Dispatch(next=storeDispatch))</tt>.</p>
<p>Another
explanation of the above is that a&nbsp;middleware:</p>
<ul class="simple">
<li>is a function (that gets a store to enhance as input) that&nbsp;returns</li>
<li>another function (that gets the next dispatcher to be called as input) that&nbsp;returns</li>
<li>another function (that gets an action as input) which&nbsp;is</li>
<li>the dispatcher modified by this&nbsp;middleware</li>
</ul>
<p>Let&#8217;s take a look at the thunk middleware to actually see what it looks&nbsp;like:</p>
<div class="highlight"><pre><span></span><span class="kd">function</span><span class="w"> </span><span class="nx">thunkMiddleware</span><span class="p">({</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">,</span><span class="w"> </span><span class="nx">getState</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">next</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;function&#39;</span><span class="w"> </span><span class="o">?</span>
<span class="w">      </span><span class="nx">action</span><span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span><span class="w"> </span><span class="nx">getState</span><span class="p">)</span><span class="w"> </span><span class="o">:</span>
<span class="w">      </span><span class="nx">next</span><span class="p">(</span><span class="nx">action</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>So, it gets the store (<tt class="docutils literal">dispatch</tt> and <tt class="docutils literal">getState</tt> are store attributes)
as an input and returns a function that gets <tt class="docutils literal">next</tt> (i.e
the next dispatcher to be called) as input. This function returns <em>another function</em>
(the modified <tt class="docutils literal">dispatch</tt>). Since this function is a dispatcher, it will get
an <tt class="docutils literal">action</tt> as an input and if that action
is a function it calls this function passing it dispatch (remember how we
said if we didn&#8217;t want to use thunk then we&#8217;d just create normal functions
to which we&#8217;d pass the dispatch as a parameter - that&#8217;s what it does here!).
If this action is not a function
(so it is a normal object) it just returns <tt class="docutils literal">dispatch(action)</tt> to dispatch&nbsp;it.</p>
<p>Finally, we&#8217;ll create a simple middleware that will output the action type and the
state for every&nbsp;dispatch:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">logStateMiddleware</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">dispatch</span><span class="p">,</span><span class="w"> </span><span class="nx">getState</span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">next</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// log the action type</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span><span class="w"> </span><span class="nx">getState</span><span class="p">())</span>
<span class="w">  </span><span class="c1">// now we must call next(action) to propagate and finally dispatch the action object</span>
<span class="w">  </span><span class="nx">next</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p>just put it in the applyMiddleware parameter list and observe all state&nbsp;changes!</p>
</div>
</div>
<div class="section" id="reducers-js">
<h3><a class="toc-backref" href="#toc-entry-14">reducers.js</a></h3>
<p>This module contains the definition for our own defined sub-reducers that we combined
in the previous paragraph (<tt class="docutils literal">books, notification, ui, categories, authors</tt>) to create
the global reducer of the application. I&#8217;ve put everything in a single file, however
it is more common to create a <tt class="docutils literal">reducers</tt> directory and put every sub-reducer inside it
as a different module. Let&#8217;s start reviewing the code of the <tt class="docutils literal">reducers.js</tt> module:</p>
<div class="highlight"><pre><span></span><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">notification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="p">{},</span><span class="w"> </span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;SHOW_NOTIFICATION&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">notification_type</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">action</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">message</span><span class="p">,</span>
<span class="w">                </span><span class="nx">notification_type</span><span class="p">,</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;CLEAR_NOTIFICATION&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">state</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">ui</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="p">{},</span><span class="w"> </span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;IS_LOADING&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">isLoading</span><span class="o">:</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">isLoading</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;IS_SUBMITTING&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">isSubmitting</span><span class="o">:</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">isSubmitting</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">state</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>The <tt class="docutils literal">notification</tt> and <cite>ui</cite> are two sub-reducers that control the state of the notification popup and if
the application is loading / is submitting. I won&#8217;t go into much detail about
them, they are really simple. However, notice that they both create a new state object
for each of their actions. To achieve this, the <tt class="docutils literal">Object.assign()</tt> method is used.
This method is defined like this:
<tt class="docutils literal">Object.assign(target, <span class="pre">...sources)</span></tt>. Its first parameter is an object (a new, empty object) while the rest
parameters (<tt class="docutils literal">sources</tt>) are other objects whose properties will be assigned <tt class="docutils literal">target</tt>. The rightmost members of
<tt class="docutils literal">sources</tt> overwrite the previous ones if they have the same names. So, for example the&nbsp;code</p>
<div class="highlight"><pre><span></span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">rows</span><span class="o">:</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">results</span><span class="p">,</span>
<span class="w">    </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">count</span><span class="p">,</span>
<span class="p">});</span>
</pre></div>
<p>creates a new object which will have all the properties of the current <tt class="docutils literal">state</tt> with the exception of the
<tt class="docutils literal">rows</tt> and <tt class="docutils literal">count</tt> attributes which will get their values from the <tt class="docutils literal">action</tt>. This is a common idiom in
redux and you are going to see it all the time so please make sure that you grok it before continuing. Also,
notice that the new state is a new, empty object in which
all the attributes of the new state are copied - this is because
the old state cannot be&nbsp;mutated.</p>
<p>Now we&#8217;ll see the reducer that handles books. Before understanding the actual reducer, I will present
the initial value of the books state&nbsp;slice:</p>
<div class="highlight"><pre><span></span><span class="c1">//http://stackoverflow.com/a/5158301/119071</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">getParameterByName</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;[?&amp;]&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;=([^&amp;]*)&#39;</span><span class="p">).</span><span class="nx">exec</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">match</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\+/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">));</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">BOOKS_INITIAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">rows</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">    </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="nx">page</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">    </span><span class="nx">sorting</span><span class="o">:</span><span class="w"> </span><span class="nx">getParameterByName</span><span class="p">(</span><span class="s1">&#39;sorting&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">search</span><span class="o">:</span><span class="w"> </span><span class="nx">getParameterByName</span><span class="p">(</span><span class="s1">&#39;search&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">book</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
<span class="p">}</span>
</pre></div>
<p>As we see, the <tt class="docutils literal">BOOK_INITIAL</tt>
constant is used to setup an initial state for the books slice of the global state. The <tt class="docutils literal">BOOKS_INITIAL</tt>
attributs&nbsp;are:</p>
<ul class="simple">
<li><tt class="docutils literal">rows</tt>: The rows of the book&nbsp;table</li>
<li><tt class="docutils literal">count</tt>: The number of rows that are&nbsp;displayed</li>
<li><tt class="docutils literal">page</tt>: The current page we are&nbsp;on</li>
<li><tt class="docutils literal">sorting</tt>: User-defined&nbsp;sorting</li>
<li><tt class="docutils literal">search</tt>: User-search /&nbsp;filtering</li>
<li><tt class="docutils literal">book</tt>: The data of the book to be&nbsp;edited/displayed</li>
</ul>
<p>The <tt class="docutils literal">BOOK_INITIAL</tt> constant
gets the <tt class="docutils literal">sorting</tt> and the <tt class="docutils literal">search</tt> initial values from the <span class="caps">URL</span> to allow these parameters
to be initialized from the <span class="caps">URL</span> (so that using a url like <tt class="docutils literal"><span class="pre">#?search=foo</span></tt> will show all books
containing <tt class="docutils literal">foo</tt>). To get the parameters from the <span class="caps">URL</span> I&#8217;m using the <tt class="docutils literal">getParameterByName</tt>
function. Now, the actual reducer&nbsp;is:</p>
<div class="highlight"><pre><span></span><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">books</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="nx">BOOKS_INITIAL</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;SHOW_BOOKS&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">rows</span><span class="o">:</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">results</span><span class="p">,</span>
<span class="w">                </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">count</span><span class="p">,</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;SHOW_BOOK&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">book</span><span class="o">:</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">book</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;CHANGE_PAGE&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">page</span><span class="o">:</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">page</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;TOGGLE_SORTING&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">sorting</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">sorting</span><span class="o">==</span><span class="nx">action</span><span class="p">.</span><span class="nx">sorting</span><span class="p">)</span><span class="o">?</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nx">action</span><span class="p">.</span><span class="nx">sorting</span><span class="p">)</span><span class="o">:</span><span class="nx">action</span><span class="p">.</span><span class="nx">sorting</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;CHANGE_SEARCH&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">search</span><span class="o">:</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">search</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;ADD_BOOK&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">book</span><span class="o">:</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">book</span><span class="p">,</span>
<span class="w">                </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="o">+</span><span class="mf">1</span><span class="p">,</span>
<span class="w">                </span><span class="nx">rows</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                    </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">action</span><span class="p">.</span><span class="nx">book</span><span class="p">,</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;UPDATE_BOOK&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">book</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="nx">idx</span><span class="o">==-</span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">book</span><span class="o">:</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">book</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">book</span><span class="o">:</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">book</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">rows</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                        </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">idx</span><span class="p">),</span>
<span class="w">                        </span><span class="nx">action</span><span class="p">.</span><span class="nx">book</span><span class="p">,</span>
<span class="w">                        </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">idx</span><span class="o">+</span><span class="mf">1</span><span class="p">),</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;DELETE_BOOK&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">action</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="nx">idx</span><span class="o">==-</span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">book</span><span class="o">:</span><span class="w"> </span><span class="kc">undefined</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">book</span><span class="o">:</span><span class="w"> </span><span class="kc">undefined</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">rows</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                        </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">idx</span><span class="p">),</span>
<span class="w">                        </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">idx</span><span class="o">+</span><span class="mf">1</span><span class="p">),</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">state</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>The books subreducer handles the <tt class="docutils literal">SHOW_BOOKS, SHOW_BOOK, CHANGE_PAGE, TOGGLE_SORTING</tt> and <tt class="docutils literal">CHANGE_SEARCH</tt>
actions by retrieving the paramaters of these actions and returning a new books-state-slice object
with the correct parameters using <tt class="docutils literal">Object.assign</tt>.</p>
<p>The <tt class="docutils literal">ADD_BOOK</tt> action is a little more complicated: This action will be dispached when a new book is added with
the data of that new book as a parameter (<tt class="docutils literal">action.book</tt>). In order to make everything easier, I just append the new
book to the end of the books that are displayed on the
current page and increase the count number (I also set the new book to be the <tt class="docutils literal">book</tt> attribute
of the state). This means that the newly created book will not go to its correct place (based on the ordering) and
that the visible items will be more than the ajax page coun (also notice that if you add another book then the visible
items will also be increased by one more). This is not a problem (for me) since if the user changes page or does a search
everything will fall back to its place. However, if you don&#8217;t like it there are two solutions, one easier and one more&nbsp;difficult:</p>
<ul class="simple">
<li>Easier solution: When adding a book just <em>invalidate</em> (make undefined) the <tt class="docutils literal">books</tt> state attribute. This will result in an ajax call to reload the books and everything will be in place. However the user may not see the newly added book if it does not fall to the currently selected page (and there&#8217;d be an extra, unnecessary ajax&nbsp;call)</li>
<li>Harder solution: Depending on the sorting you may check if the current books should be displayed or not on the current page and push it to its correct place (and remove the last item of <tt class="docutils literal">rows</tt> so that count is not increased). Once again, the newly book may no be displayed at all if it does not belong to the visible&nbsp;page</li>
</ul>
<p>The <tt class="docutils literal">UPDATE_BOOK</tt> and <tt class="docutils literal">DELETE_BOOK</tt> actions are even more complex. I&#8217;ll only explain update, delete is more or less
the same (with the difference that update has the updated book as an action parameter while delete has only its id
as an acton parameter): First of all we check if the updated book is currently displayed (if one of the books of
<tt class="docutils literal">rows</tt> has the same <tt class="docutils literal">id</tt> as the updated book). If the book is not displayed then only the current edited book
is set to the new state. However, if it is displayed then it would need to be updated because the <tt class="docutils literal">rows</tt> array
does not know anything about the updated values of the&nbsp;book!</p>
<p>So, inside the <tt class="docutils literal">else</tt> branch, the <tt class="docutils literal">idx</tt> variable will hold its current index and the
<tt class="docutils literal">rows</tt> attribute of the new state will get the following&nbsp;value:</p>
<div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">    </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">idx</span><span class="p">),</span>
<span class="w">    </span><span class="nx">action</span><span class="p">.</span><span class="nx">book</span><span class="p">,</span>
<span class="w">    </span><span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">idx</span><span class="o">+</span><span class="mf">1</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
<p>The <tt class="docutils literal">...</tt> spread operator expands an array so, for example <tt class="docutils literal">[ <span class="pre">...[1,2,3]</span> ]</tt> would be like <tt class="docutils literal">[1,2,3]</tt>
and the <tt class="docutils literal">slice</tt> method gets two parameters and returns a copy of the array elements between them. Using
this knowledge, we can understand that the above code returns an array (<tt class="docutils literal">[]</tt>) that contains the books of
<tt class="docutils literal">rows</tt> from the first to the updated one (not including the updated one), the updated book
object (which we get
from <tt class="docutils literal">action</tt>) and the rest of the books of <tt class="docutils literal">rows</tt> (after the updated&nbsp;one).</p>
<p>The code for the <tt class="docutils literal">authors</tt> and <tt class="docutils literal">categories</tt> sub-reducers does not have any surprises so I won&#8217;t go
into detail about&nbsp;it.</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">AUTHORS_INITIAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">authors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="nx">AUTHORS_INITIAL</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">CATEGORIES_INITIAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="nx">CATEGORIES_INITIAL</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
<div class="section" id="the-global-state-tree">
<h4><a class="toc-backref" href="#toc-entry-15">The global state&nbsp;tree</a></h4>
<p>Remember that all the above are sub-reducers, each one taking only a slice
of the global state tree. They are all combined, along with the routing and
form reducers to create the global reducer&nbsp;function.</p>
<p>This also means, that the global state object will be something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nx">books</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">  </span><span class="nx">notification</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">  </span><span class="nx">ui</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">  </span><span class="nx">categories</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">  </span><span class="nx">authors</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">  </span><span class="nx">routing</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">  </span><span class="nx">form</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
<span class="p">}</span>
</pre></div>
<p>We won&#8217;t see this object anywhere because each sub-reducer will get its corresponding
slice of that&nbsp;object.</p>
</div>
</div>
<div class="section" id="actions-js">
<h3><a class="toc-backref" href="#toc-entry-16">actions.js</a></h3>
<p>The <tt class="docutils literal">actions.js</tt> module should probably have been named <tt class="docutils literal">action_creators.js</tt> since
it actually contains redux action creators. Also, a common practice is create a folder
named <tt class="docutils literal">actions</tt> and put there individual modules that contain action creators for
the sub-reducers (in our case, for example there would be <tt class="docutils literal">books.js</tt>, <tt class="docutils literal">authors.s</tt> etc).</p>
<p>In any case, for simplicity I chose to just use a module named <tt class="docutils literal">actions.js</tt> and put
everything there. One important thing to keep in mind is that <tt class="docutils literal">actions.js</tt> contains both
normal action creators (i.e functions that return actions and should be &#8220;dispatched&#8221;)
<em>and</em> thunk action creators (i.e
functions that not necessarily return actions but can be &#8220;dispatcher&#8221;) - please see the
discussion about redux-thunk on a previous&nbsp;paragraph.</p>
<p>First of all, there&#8217;s a bunch of some simple action creators that just return
the corresponding action object with the correct parameters. Notice that
the action creators that end in <tt class="docutils literal">*Result</tt> are called when an
(async) ajax request returns, for example <tt class="docutils literal">showBooksResult</tt> will be
called when the book loading has returned and pass its result data to
the reducer. The other action creators change various parts of the state
object, for example <tt class="docutils literal">loadingChanged</tt> will create an action that when
dispatched it will set <tt class="docutils literal">ui.isLoading</tt> attribute
to the action&nbsp;parameter.</p>
<pre class="code literal-block">
showBooksResult(books) for &quot;SHOW_BOOKS&quot;,
showBookResult(book) for &quot;SHOW_BOOK&quot;,
addBookResult(book) for &quot;ADD_BOOK&quot;,
updateBookResult(book) for &quot;UPDATE_BOOK&quot;,
deleteBookResult(id) for &quot;DELETE_BOOK&quot;,

showAuthorsResult(authors) for &quot;SHOW_AUTHORS&quot;,
showAuthorResult(author) for &quot;SHOW_AUTHOR&quot;,
addAuthorResult(author) for &quot;ADD_AUTHOR&quot;,
updateAuthorResult(author) for &quot;UPDATE_AUTHOR&quot;,
deleteAuthorResult(id) &quot;DELETE_AUTHOR&quot;,

showCategoriesResult(categories) for &quot;SHOW_CATEGORIES&quot;,
showSubCategoriesResult(subcategories) for &quot;SHOW_SUBCATEGORIES&quot;,
loadingChanged(isLoading) for &quot;IS_LOADING&quot;,
submittingChanged(isSubmitting) for &quot;IS_SUBMITTING&quot;,
toggleSorting(sorting) for &quot;TOGGLE_SORTING&quot;,
changePage(page) for &quot;CHANGE_PAGE&quot;,
changeSearch(search) for 'CHANGE_SEARCH',
showSuccessNotification(message) for 'SHOW_NOTIFICATION' (type: success),
showErrorNotification(message) for 'SHOW_NOTIFICATION', (type: error)
hideNotification() for 'CLEAR_NOTIFICATION'
</pre>
<p>The following two are thunk action creators that are called when either the
user sorting or the search/filtering parameters of the displayed books are&nbsp;changed:</p>
<div class="highlight"><pre><span></span><span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">changeSearchAndLoadBooks</span><span class="p">(</span><span class="nx">search</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span><span class="w"> </span><span class="nx">getState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">changeSearch</span><span class="p">(</span><span class="nx">search</span><span class="p">))</span>
<span class="w">        </span><span class="nx">history</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">search</span><span class="o">:</span><span class="w"> </span><span class="nx">formatUrl</span><span class="p">(</span><span class="nx">getState</span><span class="p">().</span><span class="nx">books</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadBooks</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">toggleSortingAndLoadBooks</span><span class="p">(</span><span class="nx">sorting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span><span class="w"> </span><span class="nx">getState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">toggleSorting</span><span class="p">(</span><span class="nx">sorting</span><span class="p">))</span>
<span class="w">        </span><span class="nx">history</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">search</span><span class="o">:</span><span class="w"> </span><span class="nx">formatUrl</span><span class="p">(</span><span class="nx">getState</span><span class="p">().</span><span class="nx">books</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadBooks</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>Notice that these are thunk action creators (they return a function) and
the important thing that they do is that they call two other action creators
(<tt class="docutils literal">toggleSorting</tt> or <tt class="docutils literal">changeSearch</tt> and <tt class="docutils literal">loadBooks</tt>) and update the
<span class="caps">URL</span> using <tt class="docutils literal">history.push</tt>. The <tt class="docutils literal">history</tt> object is the one we had created in
the <tt class="docutils literal">store.js</tt> and its <tt class="docutils literal">push</tt> method changes the displayed <span class="caps">URL</span>. This
method <a class="reference external" href="https://github.com/reactjs/history/blob/master/docs/Location.md#location-descriptors">uses a location descriptor</a> that contains
an attribute for the path name and an attribute for the query parameters
- in or case we just want to update the query parameters (i.e <tt class="docutils literal"><span class="pre">#/url/?search=query1&amp;sorting=query2</span></tt>),
so we pass an obect with only the <tt class="docutils literal">search</tt> attribute. The <tt class="docutils literal">formatUrl</tt> function, to
which the books state slice is passsed, is a rather simple function
that checks if either the sorting or the search should exist in th <span class="caps">URL</span> and
returns the full <span class="caps">URL</span>. This function is contained in the <tt class="docutils literal">util/formatters.s</tt> module.</p>
<p>The following thunk action creators are used for asynchronous, ajax&nbsp;queries:</p>
<div class="highlight"><pre><span></span><span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">loadBooks</span><span class="p">(</span><span class="nx">page</span><span class="o">=</span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span><span class="w"> </span><span class="nx">getState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getState</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">page</span><span class="p">,</span><span class="w"> </span><span class="nx">sorting</span><span class="p">,</span><span class="w"> </span><span class="nx">search</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">books</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`//127.0.0.1:8000/api/books/?format=json&amp;page=</span><span class="si">${</span><span class="nx">page</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="nx">sorting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">url</span><span class="o">+=</span><span class="sb">`&amp;ordering=</span><span class="si">${</span><span class="nx">sorting</span><span class="si">}</span><span class="sb">`</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="nx">search</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">url</span><span class="o">+=</span><span class="sb">`&amp;search=</span><span class="si">${</span><span class="nx">search</span><span class="si">}</span><span class="sb">`</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadingChanged</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
<span class="w">        </span><span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">showBooksResult</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
<span class="w">                </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadingChanged</span><span class="p">(</span><span class="kc">false</span><span class="p">));</span>
<span class="w">            </span><span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">loadBookAction</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span><span class="w"> </span><span class="nx">getState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`//127.0.0.1:8000/api/books/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">/?format=json`</span><span class="p">;</span>
<span class="w">        </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadingChanged</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
<span class="w">        </span><span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">showBookResult</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
<span class="w">            </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadingChanged</span><span class="p">(</span><span class="kc">false</span><span class="p">));</span>
<span class="w">            </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadSubCategories</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">category</span><span class="p">));</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">loadAuthors</span><span class="p">(</span><span class="nx">page</span><span class="o">=</span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// similar to loadBooks</span>
<span class="p">}</span>


<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">loadAuthor</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// similar to loadBook</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">loadCategories</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// similar to loadBooks</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">loadSubCategories</span><span class="p">(</span><span class="nx">category</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span><span class="w"> </span><span class="nx">getState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">category</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">showSubCategoriesResult</span><span class="p">([]));</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`//127.0.0.1:8000/api/subcategories/?format=json&amp;category=</span><span class="si">${</span><span class="nx">category</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

<span class="w">        </span><span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">showSubCategoriesResult</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>The <tt class="docutils literal">loadBooks</tt> thunk action creator creates the <span class="caps">URL</span> parameters that should
be passed to the <span class="caps">REST</span> <span class="caps">API</span> using the <tt class="docutils literal">getState()</tt> method that returns the current state.
It then dispatches the <tt class="docutils literal">loadingChanged</tt> action so that the <tt class="docutils literal">ui.isLoading</tt> will be
changed to true. After that it asynchronously calls the load books <span class="caps">REST</span> <span class="caps">API</span> passing
it the created url and returns.
Since this is a thunk action there&#8217;s no problem that nothing is returned. When the
ajax call returns it will dispatch the <tt class="docutils literal">showBooksResult</tt>, passing the book data to
change the state with the loaded book data and the <tt class="docutils literal">loadingChanged</tt> to hide the loading
spinner. Also, please notice that I&#8217;ve put the return of the ajax call inside a <tt class="docutils literal">setTimeout</tt>
to emulate a 1 second delay and be able to see the loading&nbsp;spinner.</p>
<p>I may have used
setTimeout in some other places to make sure to be able to emulate server-side delays so
<em>please don&#8217;t forget to remove these &#8220;setTimeout&#8220;s from your&nbsp;code!</em></p>
<p>The <tt class="docutils literal">loadBook</tt> is more or less the same - however here only a single book&#8217;s data will
be loaded. When this book is loaded the <tt class="docutils literal">loadSubCategories</tt> action will also be dispatched,
passing it the loaded book&#8217;s category (so that the correct subcategories based on the category
will be displayed to the&nbsp;form).</p>
<p>I won&#8217;t go into any detail about the other thunk action creators, they are simpler than those
we&#8217;ve already described, except <tt class="docutils literal">loadSubCategories</tt>: This one, checks if there&#8217;s a category
and if not it will just set the displayed subcategories to and empty list (by dispatching
<tt class="docutils literal"><span class="pre">showSubCategoriesResult([])</span></tt>). If the category is not empty, it will retrieve asynchronously the
subcategories of the passed&nbsp;category.</p>
</div>
<div class="section" id="components-app-js">
<h3><a class="toc-backref" href="#toc-entry-17">components/app.js</a></h3>
<p>We&#8217;ll now start explaining the actual react components (modified to be used through redux of course).
The parent of all other components is the <tt class="docutils literal">App</tt> which, as we&#8217;ve already seen in <tt class="docutils literal">main.js</tt>
is connected with the parent&nbsp;route:</p>
<div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nx">App</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nx">render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">isLoading</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">ui</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>

<span class="w">            </span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">}</span>

<span class="w">            </span><span class="o">&lt;</span><span class="nx">NotificationContainer</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">LoadingContainer</span><span class="w"> </span><span class="nx">isLoading</span><span class="o">=</span><span class="p">{</span><span class="nx">isLoading</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>

<span class="w">            </span><span class="o">&lt;</span><span class="nx">br</span><span class="w"> </span><span class="o">/&gt;</span>

<span class="w">            </span><span class="o">&lt;</span><span class="nx">StatPanel</span><span class="w"> </span><span class="nx">bookLength</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">count</span><span class="p">}</span><span class="w"> </span><span class="nx">authorLength</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">authors</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">Link</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;button&#39;</span><span class="w"> </span><span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;</span><span class="nx">Books</span><span class="o">&lt;</span><span class="err">/Link&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">Link</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;button&#39;</span><span class="w"> </span><span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/authors/&quot;</span><span class="o">&gt;</span><span class="nx">Authors</span><span class="o">&lt;</span><span class="err">/Link&gt;</span>

<span class="w">        </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">componentDidMount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">loadBooks</span><span class="p">,</span><span class="w"> </span><span class="nx">loadAuthors</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">loadBooks</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">authors</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">loadAuthors</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">mapStateToProps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">books</span><span class="o">:</span><span class="nx">state</span><span class="p">.</span><span class="nx">books</span><span class="p">,</span>
<span class="w">    </span><span class="nx">authors</span><span class="o">:</span><span class="nx">state</span><span class="p">.</span><span class="nx">authors</span><span class="p">,</span>
<span class="w">    </span><span class="nx">ui</span><span class="o">:</span><span class="nx">state</span><span class="p">.</span><span class="nx">ui</span><span class="p">,</span>
<span class="p">})</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">mapDispatchToProps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dispatch</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">bindActionCreators</span><span class="p">({</span>
<span class="w">    </span><span class="nx">loadBooks</span><span class="p">,</span><span class="w"> </span><span class="nx">loadAuthors</span>
<span class="p">},</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">)</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">connect</span><span class="p">(</span><span class="nx">mapStateToProps</span><span class="p">,</span><span class="w"> </span><span class="nx">mapDispatchToProps</span><span class="p">)(</span><span class="nx">App</span><span class="p">);</span>
</pre></div>
<p>As we can see, there&#8217;s an internal component (named <tt class="docutils literal">App</tt>) but we export the <tt class="docutils literal"><span class="pre">connect``ed</span> component.
One interesting thing to notice is that ``App</tt> is an <span class="caps">ES6</span> class based react component (i.e it extends
<tt class="docutils literal">React.Component</tt> &#8212; I&#8217;ll talk a bit about these components while taking a look at
the <tt class="docutils literal">BookSearchPanel</tt> which has some more interesting&nbsp;features).</p>
<p>Concerning the exported,
connected component, it
uses <tt class="docutils literal">mapStateToProps</tt> for defining the state attributes that should be passed as properties
to the componnt (<tt class="docutils literal"><span class="pre">state.{books,</span> authors, ui}</tt>) and <tt class="docutils literal">mapDispatchToProps</tt> for defining the <tt class="docutils literal">props</tt> methods that will
dispatch actions. To make <tt class="docutils literal">mapDispatchToProps</tt> more compact I&#8217;ve used the <tt class="docutils literal">bindActionCreators</tt> method from redux.
This method gets an object whose values are action creators and the <tt class="docutils literal">dispatch</tt> (from store) and returns an object
whose values are the dispatch-enabled corresponding action creators. So, in our case
the returned object would be something&nbsp;like:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nx">loadBooks</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadBooks</span><span class="p">()),</span>
<span class="w">    </span><span class="nx">loadAuthors</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadAuthors</span><span class="p">()),</span>
<span class="p">}</span>
</pre></div>
<p>This object of course could be created by hand, however <tt class="docutils literal">bindActionCreators</tt> would be really useful if we wanted
to dispatch lots of actions in a component (or if we had seperated our action creators to different modules) &#8212;
we could for example do something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">actions</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../actions&#39;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">mapDispatchToProps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dispatch</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">bindActionCreators</span><span class="p">(</span><span class="nx">actions</span><span class="p">,</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">)</span>
</pre></div>
<p>The <tt class="docutils literal">import *</tt> statemenet will create an object named item that will have all the exported actions and then
<tt class="docutils literal">bindActionCreators</tt> will return an object that dispatches these actions &#8212; passing this <tt class="docutils literal">mapDispatchToProps</tt>
to connect will allow your component to call every action and automatically dispatch&nbsp;it.</p>
<p>The internal component returns a <tt class="docutils literal">&lt;div /&gt;</tt> containing, among others <tt class="docutils literal">{this.props.children}</tt> - this
will be provided by rendering the child routes. It also renders a <tt class="docutils literal">NotificationContainer</tt> to render the notifications, a
<tt class="docutils literal">LoadingContainer</tt> to display a css &#8220;loading&#8221; spinner and a <tt class="docutils literal">StatPanel</tt> to display some stats about books and
authors. It also renders two Links one for the books table and one for the authors&nbsp;table.</p>
<p>Beyond these, when the component is mounted it checks if the authors and books have been loaded and if not, it
dispatches the <tt class="docutils literal">loadBooks</tt> and <tt class="docutils literal">loadAuthors</tt> actions (remember, because we used <tt class="docutils literal">mapDispatchToProps</tt> by
calling these methods from <tt class="docutils literal">props</tt> they&#8217;ll be automatically dspatched when&nbsp;called).</p>
<p>Let&#8217;s take a quick look at the three small components that are contained in <tt class="docutils literal">App</tt></p>
<div class="section" id="components-notification-js">
<h4><a class="toc-backref" href="#toc-entry-18">components/notification.js</a></h4>
<p>This component is responsible for displaying a notification if there&#8217;s an active one.
It also defines an internal component and exports a connected version of it, passing it the
<tt class="docutils literal">notification</tt> slice of the state tree and an <tt class="docutils literal">onHide</tt> method that dispatches the
<tt class="docutils literal">hidNotification</tt> action.</p>
<p>When the internal component is rendered, it checks to see if the notification should be
displayed (<tt class="docutils literal">isActive</tt> will be true if there&#8217;s an actual message) and select the color
of the background. Finally, it passes this information along with some styling
to the real <tt class="docutils literal">Notification</tt>  component from <tt class="docutils literal"><span class="pre">react-notification</span></tt>.</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">NotificationContainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">props</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">notification_type</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">props</span><span class="p">.</span><span class="nx">notification</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">onHide</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">props</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">isActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">message</span><span class="o">?</span><span class="kc">true</span><span class="o">:</span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">color</span><span class="p">;</span>

<span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="nx">notification_type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;SUCCESS&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">colors</span><span class="p">.</span><span class="nx">success</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;ERROR&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">colors</span><span class="p">.</span><span class="nx">danger</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;INFO&#39;</span><span class="o">:</span>
<span class="w">            </span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">colors</span><span class="p">.</span><span class="nx">info</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Notification</span>
<span class="w">        </span><span class="nx">isActive</span><span class="o">=</span><span class="p">{</span><span class="nx">isActive</span><span class="p">}</span>
<span class="w">        </span><span class="nx">message</span><span class="o">=</span><span class="p">{</span><span class="nx">message</span><span class="o">?</span><span class="nx">message</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="w">        </span><span class="nx">dismissAfter</span><span class="o">=</span><span class="p">{</span><span class="mf">5000</span><span class="p">}</span>
<span class="w">        </span><span class="nx">onDismiss</span><span class="o">=</span><span class="p">{</span><span class="w"> </span><span class="p">()=&gt;</span><span class="nx">onHide</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="nx">action</span><span class="o">=</span><span class="s1">&#39;X&#39;</span>
<span class="w">        </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="w"> </span><span class="p">()=&gt;</span><span class="nx">onHide</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="nx">style</span><span class="o">=</span><span class="p">{{</span>
<span class="w">            </span><span class="nx">bar</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">background</span><span class="o">:</span><span class="w"> </span><span class="nx">color</span><span class="p">,</span>
<span class="w">                </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">fontSize</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2rem&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">active</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">left</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3rem&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;#FFCCBC&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">fontSize</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3rem&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">border</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1 pt solid black&#39;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}}</span>
<span class="w">    </span><span class="o">/&gt;</span>
<span class="p">}</span>

<span class="kd">let</span><span class="w"> </span><span class="nx">mapStateToProps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">notification</span><span class="o">:</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">notification</span>
<span class="p">})</span>

<span class="kd">let</span><span class="w"> </span><span class="nx">mapDispatchToProps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dispatch</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">onHide</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">hideNotification</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">})</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">connect</span><span class="p">(</span><span class="nx">mapStateToProps</span><span class="p">,</span><span class="w"> </span><span class="nx">mapDispatchToProps</span><span class="p">)(</span><span class="nx">NotificationContainer</span><span class="p">);</span>
</pre></div>
<p>Notice the <tt class="docutils literal"><span class="pre">style={{</span> .. }}</tt> snippet above: The external <tt class="docutils literal">{}</tt> are the Javascript code
inclusion tags of <span class="caps">JSX</span> while the internal <tt class="docutils literal">{}</tt> are for creating a normal javascript object
that defines the styling of the&nbsp;notification.</p>
</div>
<div class="section" id="creating-a-re-usable-notification">
<h4><a class="toc-backref" href="#toc-entry-19">Creating a re-usable&nbsp;notification</a></h4>
<p>Please notice that although I&#8217;ve implemented this as a connected component this is not the only
way to do it! Actually, probably my implementation is less-reusable from the others I will&nbsp;propose&#8230;</p>
<p>In any case, instead of implementing <tt class="docutils literal">NotificationContainer</tt> as a connected component we could
have implemented it as a normal, non connected component that would receive two properties
from its parent:
the <tt class="docutils literal">notification</tt> slice of state and an <tt class="docutils literal">onHide</tt> function that would dispatch
<tt class="docutils literal">hideNotification</tt>. Doing this would be very easy, just change
<tt class="docutils literal">App</tt> so that its <tt class="docutils literal">mapDispatchToProps</tt> would also return the <tt class="docutils literal">notification</tt> slice of
the state - and pass this slice as a property to the <tt class="docutils literal">NotificationContainer</tt>. Also, the
<tt class="docutils literal">onHide</tt> method should have been also defined in the <tt class="docutils literal">mapDispatchToProps</tt> of <tt class="docutils literal">App</tt> and
passed as a property to <tt class="docutils literal">NotificationContainer</tt>. Notice that this makes <tt class="docutils literal">NotificationContainer</tt>
a reusable component since we could pass anything we wanted as the <tt class="docutils literal">notification</tt> object and
<tt class="docutils literal">onHide</tt> method.</p>
<p>Also, if we needed to implement <tt class="docutils literal">NotificationContainer</tt> as a connected object but we still
needed it to be reusable we&#8217;d then export the non-connected <tt class="docutils literal">NotificationContainer</tt>
and create a bunch of <tt class="docutils literal">ConnectedNotificationContainer</tt> that would
define <tt class="docutils literal">mapStateToProps</tt> and <tt class="docutils literal">mapDispatchToProps</tt>
and export the connected component. This way, each <tt class="docutils literal">ConnecteNotificationContainer</tt> would
receive a different state slice and a different <tt class="docutils literal">onHide</tt> method, for example we may had
different notifications for books and different notifications for authors. Notice that this
approach, i.e create a reusable non-connected component and use it to create connected
components by defining their <tt class="docutils literal">mapStateToProps</tt> and <tt class="docutils literal">mapDispatchToProps</tt> is the
approach proposed by react-redux to create&nbsp;components.</p>
<p>Finally, one last comment on this approach that may clarify more
the purpose of  <tt class="docutils literal">mapStateToProps</tt> and
<tt class="docutils literal">mapDispatchToProps</tt> of connected components
is that these two functions are <em>dual</em>&nbsp;(mirror):</p>
<ul class="simple">
<li>Using <tt class="docutils literal">mapStateToProps</tt> we define which parts of the state will actually be passed to the component (= reading the&nbsp;state).</li>
<li>Using <tt class="docutils literal">mapDispatchToProps</tt> we define the actions which will be dispatched by the component (= changing/writing the&nbsp;state)</li>
</ul>
</div>
<div class="section" id="components-loading-js">
<h4><a class="toc-backref" href="#toc-entry-20">components/loading.js</a></h4>
<p>This is a really simple component: If the <tt class="docutils literal">isLoading</tt> parameter is true, display a <tt class="docutils literal">div</tt> with the <tt class="docutils literal">loading</tt> class:</p>
<div class="highlight"><pre><span></span><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">({</span><span class="nx">isLoading</span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">{</span><span class="nx">isLoading</span><span class="o">?&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;loading&quot;</span><span class="o">&gt;</span><span class="nx">Loading</span><span class="o">&amp;</span><span class="err">#</span><span class="mf">8230</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/div&gt;:null}</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>
<p>The important thing here is what the <tt class="docutils literal">loading</tt> class does to display the spinner - I&#8217;m leaving it to you to check
it at <tt class="docutils literal">static/cssloader.css</tt> (this is not my css code - I&#8217;ve copied it from <a class="reference external" href="http://codepen.io/MattIn4D/pen/LiKFC">http://codepen.io/MattIn4D/pen/LiKFC</a>&nbsp;).</p>
<p>Also, please notice that in this module we just export a function, taking an object which
has an <tt class="docutils literal">isLoading</tt> attribute as a parameter. That&#8217;s a functional react component: A
function that gets a <tt class="docutils literal">params</tt> object as an input and implements the render method,
returning a&nbsp;component.</p>
<p>Using functional components is recommended for reasons that
are far too obvious (easy to test - just call the function, idemponent - no state
to keep track of, less code to write, easier to the eye, <em>functional</em> )
- you should use class based components only when absolutely
necessary (i.e when the component needs to keep some local state or when it needs
to do stuff on <tt class="docutils literal">componentWillMount</tt>).</p>
</div>
<div class="section" id="components-statpanel-js">
<h4><a class="toc-backref" href="#toc-entry-21">components/StatPanel.js</a></h4>
<p>Another very simple functional component - just display the number of books and authors from the passed&nbsp;parameter.</p>
</div>
</div>
<div class="section" id="components-bookpanel-js">
<h3><a class="toc-backref" href="#toc-entry-22">components/BookPanel.js</a></h3>
<p>Continuing our top-down approach on exploring the project, we&#8217;ll now talk
about the <tt class="docutils literal">BookPanel</tt> component which is displayed by the <tt class="docutils literal">IndexRoute</tt>.
Before talking about the actual component, I&#8217;d like to present
the <tt class="docutils literal">getCols</tt> function that is used to create an array of the columns
that will be displayed by the <tt class="docutils literal">Table</tt> we render in this&nbsp;panel.</p>
<p>As we can see, the <tt class="docutils literal">getCols</tt> gets one parameter which is the sort method &#8212;
this method gets a string and uses it to toggle sorting by this string.
We use a function to create the columns instead of a constant because
that <tt class="docutils literal">sort_function</tt> needs to <tt class="docutils literal">dispatch</tt> an action &#8212; <tt class="docutils literal">dispatch</tt> is available from
the <tt class="docutils literal">props</tt> that the functional <tt class="docutils literal">BookPanel</tt> component receives so the function
will be called from inside that functional&nbsp;component.</p>
<p>Each column, has up to four&nbsp;parameters:</p>
<ul class="simple">
<li>A <tt class="docutils literal">key</tt> which is the attribute  of the <tt class="docutils literal">row</tt> object to&nbsp;display</li>
<li>A <tt class="docutils literal">title</tt> which is the column&nbsp;title</li>
<li>A <tt class="docutils literal">format</tt> (optional) which may be used to display the value of that column&nbsp;and</li>
<li>A <tt class="docutils literal">sorting</tt> (optional) which is a function that will be called when the column title is clicked (so that the sorting is changed ) - this attribute is created using the <tt class="docutils literal">sort_method</tt></li>
</ul>
<p>We&#8217;ll see how these attributes are used by the <tt class="docutils literal">Table</tt> in the corresponding section. Five
columns have been defined: <tt class="docutils literal">id</tt> (which, when clicked will update the book
that&#8217;s where <tt class="docutils literal">format</tt> is used), <tt class="docutils literal">title</tt>, <tt class="docutils literal">category_name</tt>, <tt class="docutils literal">publish_date</tt>
and <tt class="docutils literal">author_name</tt>:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">getCols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sort_method</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">label</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ID&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">format</span><span class="o">:</span><span class="w"> </span><span class="nx">x</span><span class="p">=&gt;</span><span class="o">&lt;</span><span class="nx">Link</span><span class="w"> </span><span class="nx">to</span><span class="o">=</span><span class="p">{</span><span class="sb">`/book_update/</span><span class="si">${</span><span class="nx">x</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">/`</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">x</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Link&gt;,</span>
<span class="w">        </span><span class="nx">sorting</span><span class="o">:</span><span class="w"> </span><span class="nx">sort_method</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">label</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Title&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">sorting</span><span class="o">:</span><span class="w"> </span><span class="nx">sort_method</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)},</span>
<span class="w">    </span><span class="p">{</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;category_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">label</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Category&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">sorting</span><span class="o">:</span><span class="w"> </span><span class="nx">sort_method</span><span class="p">(</span><span class="s1">&#39;subcategory__name&#39;</span><span class="p">)},</span>
<span class="w">    </span><span class="p">{</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;publish_date&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">label</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Publish date&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">sorting</span><span class="o">:</span><span class="w"> </span><span class="nx">sort_method</span><span class="p">(</span><span class="s1">&#39;publish_date&#39;</span><span class="p">)},</span>
<span class="w">    </span><span class="p">{</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;author_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">label</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Author&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">sorting</span><span class="o">:</span><span class="w"> </span><span class="nx">sort_method</span><span class="p">(</span><span class="s1">&#39;author__last_name&#39;</span><span class="p">)},</span>
<span class="p">]</span>
</pre></div>
<p>The actual (exported) <tt class="docutils literal">BookPanel</tt> is a connected component - we need to use connect because we can&#8217;t
actually pass properties or <tt class="docutils literal">dispatch</tt> to this component since it is
rendered through a route (and not as a child of another component), so it
must be connected to the store through <tt class="docutils literal">connect</tt> to be able to receive
state attributes and <tt class="docutils literal">dispatch</tt>. We pass the <tt class="docutils literal">books</tt> state
slice as a property using <tt class="docutils literal">mapStateToProps</tt> and use the same techique as
before in <tt class="docutils literal">App</tt>  with
<tt class="docutils literal">bindActionCreators</tt> to create auto-dispatchable&nbsp;actions.</p>
<p>As we can see, after retrieving the needed properties from the <tt class="docutils literal">books</tt> state slice
and the actions to dispatch, we define an <tt class="docutils literal">onSearchChanged</tt> function that will be
passed to the <tt class="docutils literal">BookSearchPanel</tt> to be called when the search query is&nbsp;changed.</p>
<p>Next, the <tt class="docutils literal">sort_method</tt> is defined. This is
a function that gets a <tt class="docutils literal">key</tt> parameter and returns another function that
dispatches <tt class="docutils literal">toggleSortingAndLoadBooks</tt> passing it that <tt class="docutils literal">key</tt>. This is the
parameter that is passed to <tt class="docutils literal">getCols</tt>. So, for example for the <tt class="docutils literal">id</tt>,
the result of the <tt class="docutils literal">sort_method</tt> would be the following function:
<tt class="docutils literal">() =&gt; <span class="pre">toggleSortingAndLoadBooks('id')</span></tt>.</p>
<p>Finally, the <tt class="docutils literal">BookPanel</tt> renders the&nbsp;following:</p>
<ul class="simple">
<li>A <tt class="docutils literal">BookSearchPanel</tt> passing it the <tt class="docutils literal">search</tt> property and the <tt class="docutils literal">onSearchChanged</tt> action</li>
<li>A <tt class="docutils literal">Link</tt> to create a new&nbsp;book</li>
<li>A <tt class="docutils literal">Table</tt> passing it the <tt class="docutils literal">sorting</tt> and <tt class="docutils literal">rows</tt> parameters and the <tt class="docutils literal">cols</tt> constant we just&nbsp;defined</li>
<li>A <tt class="docutils literal">PagingPanel</tt> passing it the total number of books (<tt class="docutils literal">count</tt>), the current page (<tt class="docutils literal">page</tt>) and two methods <tt class="docutils literal">onNextPage</tt> and <tt class="docutils literal">onPreviousPage</tt> that will be called when switch to the next or previous&nbsp;page.</li>
</ul>
<p>As we can see, the <tt class="docutils literal">onNextPage</tt> and <tt class="docutils literal">onPreviousPage</tt> functions dispach the <tt class="docutils literal">changePage</tt> action passing it
the page to change to and reload the books by dispatch <tt class="docutils literal">loadBooks</tt>. Instead of this we could create
a <tt class="docutils literal">changePageAndLoadBooks</tt> thunk action creator that would call these two methods when dispatched
(similarly to how <tt class="docutils literal">changeSearchAndLoadBooks</tt> and <tt class="docutils literal">toggleSortingAndLoadBooks</tt> have been implemented)
- I&#8217;m leaving it like this to show all&nbsp;possibilities:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">BookPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">props</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">rows</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">page</span><span class="p">,</span><span class="w"> </span><span class="nx">sorting</span><span class="p">,</span><span class="w"> </span><span class="nx">search</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">props</span><span class="p">.</span><span class="nx">books</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">loadBooks</span><span class="p">,</span><span class="w"> </span><span class="nx">changePage</span><span class="p">,</span><span class="w"> </span><span class="nx">toggleSortingAndLoadBooks</span><span class="p">,</span><span class="w"> </span><span class="nx">changeSearchAndLoadBooks</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">props</span><span class="p">;</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">onSearchChanged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">changeSearchAndLoadBooks</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sort_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">toggleSortingAndLoadBooks</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getCols</span><span class="p">(</span><span class="nx">sort_method</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">BookSearchPanel</span><span class="w"> </span><span class="nx">search</span><span class="o">=</span><span class="p">{</span><span class="nx">search</span><span class="p">}</span><span class="w"> </span><span class="nx">onSearchChanged</span><span class="o">=</span><span class="p">{</span><span class="nx">onSearchChanged</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;twelve columns&quot;</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">Book</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Link</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;button button-primary&#39;</span><span class="w"> </span><span class="nx">style</span><span class="o">=</span><span class="p">{{</span><span class="nx">fontSize</span><span class="o">:</span><span class="s1">&#39;1em&#39;</span><span class="p">}}</span><span class="w"> </span><span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/book_create/&quot;</span><span class="o">&gt;+&lt;</span><span class="err">/Link&gt;&lt;/h3&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">Table</span><span class="w"> </span><span class="nx">sorting</span><span class="o">=</span><span class="p">{</span><span class="nx">sorting</span><span class="p">}</span><span class="w"> </span><span class="nx">cols</span><span class="o">=</span><span class="p">{</span><span class="nx">cols</span><span class="p">}</span><span class="w"> </span><span class="nx">rows</span><span class="o">=</span><span class="p">{</span><span class="nx">rows</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">PagingPanel</span><span class="w"> </span><span class="nx">count</span><span class="o">=</span><span class="p">{</span><span class="nx">count</span><span class="p">}</span><span class="w"> </span><span class="nx">page</span><span class="o">=</span><span class="p">{</span><span class="nx">page</span><span class="p">}</span><span class="w"> </span><span class="nx">onNextPage</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">changePage</span><span class="p">(</span><span class="nx">page</span><span class="o">+</span><span class="mf">1</span><span class="p">);</span>
<span class="w">            </span><span class="nx">loadBooks</span><span class="p">()</span>
<span class="w">        </span><span class="p">}}</span><span class="w"> </span><span class="nx">onPreviousPage</span><span class="o">=</span><span class="p">{</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">changePage</span><span class="p">(</span><span class="nx">page</span><span class="o">-</span><span class="mf">1</span><span class="p">);</span>
<span class="w">            </span><span class="nx">loadBooks</span><span class="p">()</span>
<span class="w">        </span><span class="p">}}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">mapStateToProps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">books</span><span class="o">:</span><span class="nx">state</span><span class="p">.</span><span class="nx">books</span><span class="p">,</span>
<span class="p">})</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">mapDispatchToProps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dispatch</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">bindActionCreators</span><span class="p">({</span>
<span class="w">    </span><span class="nx">loadBooks</span><span class="p">,</span><span class="w"> </span><span class="nx">changePage</span><span class="p">,</span><span class="w"> </span><span class="nx">toggleSortingAndLoadBooks</span><span class="p">,</span><span class="w"> </span><span class="nx">changeSearchAndLoadBooks</span>
<span class="p">},</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">)</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">connect</span><span class="p">(</span><span class="nx">mapStateToProps</span><span class="p">,</span><span class="w"> </span><span class="nx">mapDispatchToProps</span><span class="p">)(</span><span class="nx">BookPanel</span><span class="p">);</span>
</pre></div>
<div class="section" id="components-booksearchpanel-js">
<h4><a class="toc-backref" href="#toc-entry-23">components/BookSearchPanel.js</a></h4>
<p>The <tt class="docutils literal">BookSearchPanel</tt> is a component used for searching books. What
is interesting about this component is that it has internal state (i.e
state that is not reflected to the global search tree). Notice that
<tt class="docutils literal">BookSearchPanel</tt> is an <span class="caps">ES6</span> class component. Here are some of its
characteristics as opposed to non-<span class="caps">ES6</span> react&nbsp;components:</p>
<ul class="simple">
<li>It extends <tt class="docutils literal">React.Component</tt> instead of using <tt class="docutils literal">React.CreateClass</tt></li>
<li>It has a constructor that initializes the local state instead of implementing <tt class="docutils literal">getInitialState</tt></li>
<li>It does not automatically bind the methods to <tt class="docutils literal">this</tt> so we do it in the constructor (or else <tt class="docutils literal">this</tt> would be undefined in <tt class="docutils literal">onSearchChange</tt> and <tt class="docutils literal">onClearSearch</tt>) - <em>be very careful with that, its a common&nbsp;problem</em></li>
</ul>
<p>So, what happens
here? We render an <span class="caps">HTML</span> <tt class="docutils literal">input</tt> element and call <tt class="docutils literal">this.onSearchChange</tt>
method. This method retrieves the current value of the input (using <tt class="docutils literal">this.refs</tt>)
and, if the previous change was more than 400 ms ago calls the provided
(through <tt class="docutils literal">props</tt>) <tt class="docutils literal">onSearchChanged</tt> method that will dispatch the
<tt class="docutils literal">changeSearchAndLoadBooks</tt> action with the current value as a parameter
(notice however that <tt class="docutils literal">this.setState</tt> is <em>always</em> called immediately or else the
user keypresses wouldn&#8217;t be reflected to the&nbsp;input).</p>
<p>The whole thing with the <tt class="docutils literal">ths.promise</tt> and <tt class="docutils literal">clearInterval</tt> is to make
sure that the provided <tt class="docutils literal">onSearchChanged</tt> will not be called too often
(i.e it will be called 400 ms after the last&nbsp;keypress):</p>
<div class="highlight"><pre><span></span><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">SearchPanel</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">super</span><span class="p">()</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">onSearchChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">onSearchChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">onClearSearch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">onClearSearch</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;one-fourth column&quot;</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="nx">Filter</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span>
<span class="w">                    </span><span class="o">&lt;</span><span class="nx">input</span><span class="w"> </span><span class="nx">ref</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="w"> </span><span class="nx">name</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="w"> </span><span class="nx">defaultValue</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">search</span><span class="p">}</span><span class="w"> </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">search</span><span class="p">}</span><span class="w"> </span><span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">onSearchChange</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">                    </span><span class="p">{(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">search</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">search</span><span class="p">)</span><span class="o">?&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">onClearSearch</span><span class="p">}</span><span class="w"> </span><span class="o">&gt;</span><span class="nx">x</span><span class="o">&lt;</span><span class="err">/button&gt;:&#39;&#39;}</span>
<span class="w">                </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">onSearchChange</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">findDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">search</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">promise</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">promise</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
<span class="w">            </span><span class="nx">search</span><span class="o">:</span><span class="w"> </span><span class="nx">query</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">promise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onSearchChanged</span><span class="p">(</span><span class="nx">query</span><span class="p">),</span><span class="w"> </span><span class="mf">400</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">onClearSearch</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
<span class="w">            </span><span class="nx">search</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onSearchChanged</span><span class="p">(</span><span class="kc">undefined</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>Let&#8217;s take a closer look at the <tt class="docutils literal">&lt;input&gt;</tt> element:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">input</span><span class="w"> </span><span class="nx">ref</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="w"> </span><span class="nx">name</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="w"> </span><span class="nx">defaultValue</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">search</span><span class="p">}</span><span class="w"> </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">search</span><span class="p">}</span><span class="w"> </span><span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">onSearchChange</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
</pre></div>
<p>The <tt class="docutils literal">ref</tt> property is used to reference this element using <tt class="docutils literal">ReactDOM.findDOMNode</tt> - that&#8217;s
one possible way to retrieve the value of this object. Another way would be to add an <tt class="docutils literal">event</tt>
parameter to <tt class="docutils literal">onSearchChange</tt> - this parameter would receive the <span class="caps">DOM</span> event of the change so
the value of the element could be retrieved using <tt class="docutils literal">event.target.value</tt>.</p>
<p>The difference between the <tt class="docutils literal">defaultValue</tt> and <tt class="docutils literal">value</tt> parameters is really important: The
<tt class="docutils literal">defaultValue</tt> is just the initial value of this specific input and it will be equal to
<tt class="docutils literal">props.search</tt> (so that if the user enters a <span class="caps">URL</span> which has a search query parameter this will
be pre-filled here). On the other hand, the <tt class="docutils literal">value</tt> parameter is the current value of
the element and will be equal to the <tt class="docutils literal">state.search</tt>. When the user types in the input,
the <tt class="docutils literal">onSearchChange</tt> will be called which will <em>always</em> change the <tt class="docutils literal">state.search</tt>
and the <tt class="docutils literal">value</tt> will get the correct, new value (or
else the change wouldn&#8217;t be reflected to the&nbsp;user)!</p>
<p>Finally concerning the clear search query button,
when there&#8217;s a search query a  <tt class="docutils literal">x</tt> button will be displayed
if there&#8217;s something to the input field which, when
clicked the search local state will be cleared
and the provided <tt class="docutils literal">onSearchChanged</tt> will be called with an empty&nbsp;query.</p>
</div>
<div class="section" id="components-table-js">
<h4><a class="toc-backref" href="#toc-entry-24">components/Table.js</a></h4>
<p>The <tt class="docutils literal">Table</tt> is a reusable, functional react component that is used for both books and&nbsp;authors.</p>
<p>First of all, we define a formatHeader function that is used to format the
table header: This function gets an object with key and label as parameters (which
is the column to be formated) and a sorting parameter (which is the current table&#8217;s
sorting) and returns the label with a <tt class="docutils literal">'+'</tt> in front of it if the sorting is ascending
by this column or a <tt class="docutils literal"><span class="pre">'-'</span></tt> if the sorting is descending by this column or just the
label if this column is not used for&nbsp;sorting:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">formatHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">label</span><span class="p">},</span><span class="w"> </span><span class="nx">sorting</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">sorting</span><span class="o">==</span><span class="nx">key</span><span class="p">)</span><span class="o">?</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="o">+</span><span class="nx">label</span><span class="p">)</span><span class="o">:</span><span class="p">(</span>
<span class="w">    </span><span class="p">(</span><span class="nx">sorting</span><span class="o">==</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nx">key</span><span class="p">)</span><span class="o">?</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nx">label</span><span class="p">)</span><span class="o">:</span><span class="nx">label</span>
<span class="p">)</span>
</pre></div>
<p>The <tt class="docutils literal">Table</tt>
uses the props we mentioned before when talking about
<tt class="docutils literal">BookPanel</tt>. When it is rendered, the headers of the table are constructed by
applying a map method on the items of the <tt class="docutils literal">cols</tt> attribute. Remember that map
will apply a function to all items of a list and return a new list with the results.
So this will create a list of correctly formatted <tt class="docutils literal">&lt;th&gt;</tt> elements.</p>
<p>In our case, the mapper
checks if each column has a <tt class="docutils literal">sorting</tt> attribute and if yes it
creates a clickable header that calls <tt class="docutils literal">sorting</tt> when clicked and is
formatted with <tt class="docutils literal">formatHeader</tt> (remember <tt class="docutils literal">sort_method</tt> we talked about
in <tt class="docutils literal">BookPanel</tt>). If there&#8217;s no <tt class="docutils literal">sorting</tt> for that column it just
displays the column&nbsp;header.</p>
<p>The rows of the table are created using two maps, one that maps the <tt class="docutils literal">rows</tt>
which, for each row maps <tt class="docutils literal">cols</tt> to get the individual values for this row and column.
So, for the rows a list of <tt class="docutils literal">&lt;tr&gt;</tt> elements each one including the correct
<tt class="docutils literal">&lt;td&gt;</tt> elements will be&nbsp;created:</p>
<div class="highlight"><pre><span></span><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">(</span><span class="nx">props</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">props</span><span class="p">.</span><span class="nx">cols</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">col</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">th</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">col</span><span class="p">.</span><span class="nx">key</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">col</span><span class="p">.</span><span class="nx">sorting</span><span class="o">?&lt;</span><span class="nx">a</span><span class="w"> </span><span class="nx">href</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="w">            </span><span class="nx">col</span><span class="p">.</span><span class="nx">sorting</span><span class="p">()</span>
<span class="w">        </span><span class="p">}}</span><span class="o">&gt;</span>
<span class="w">            </span><span class="p">{</span><span class="nx">formatHeader</span><span class="p">(</span><span class="nx">col</span><span class="p">,</span><span class="w"> </span><span class="nx">props</span><span class="p">.</span><span class="nx">sorting</span><span class="p">)}</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/a&gt;:col.label</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/th&gt;)</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">props</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">row</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">tr</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">row</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">props</span><span class="p">.</span><span class="nx">cols</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">col</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">td</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">col</span><span class="p">.</span><span class="nx">key</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">                </span><span class="p">{(</span><span class="nx">col</span><span class="p">.</span><span class="nx">format</span><span class="o">?</span><span class="nx">col</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">row</span><span class="p">)</span><span class="o">:</span><span class="nx">row</span><span class="p">[</span><span class="nx">col</span><span class="p">.</span><span class="nx">key</span><span class="p">])}</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/td&gt;)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/tr&gt;)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">table</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">thead</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
<span class="w">                </span><span class="p">{</span><span class="nx">headers</span><span class="p">}</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/tr&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/thead&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">tbody</span><span class="o">&gt;</span>
<span class="w">            </span><span class="p">{</span><span class="nx">rows</span><span class="p">}</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/tbody&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/table&gt;</span>
<span class="p">}</span>
</pre></div>
<p>The <tt class="docutils literal">key</tt> property I am passing to all elements that belong to a list is to
help React identify these child elements - we&#8217;d get a <tt class="docutils literal">Warning: Each
child in an array or iterator should have a unique &quot;key&quot; prop.</tt>
error without this&nbsp;property.</p>
<p>Also, please notice that the <tt class="docutils literal">const headers</tt> and <tt class="docutils literal">rows</tt> we&#8217;ve defined are there just
for clarity - we could instead put them directly inside the returned <tt class="docutils literal">&lt;table&gt;</tt>
and have a cool, totally <em>functional function</em>!</p>
</div>
<div class="section" id="components-pagingpanel-js">
<h4><a class="toc-backref" href="#toc-entry-25">components/PagingPanel.js</a></h4>
<p>Another functional and reusable component - this one has  params with the
attributes <tt class="docutils literal">page</tt>, <tt class="docutils literal">page_size</tt>, <tt class="docutils literal">count</tt>, <tt class="docutils literal">onNextPage</tt>,
<tt class="docutils literal">onPreviousPage</tt> and, after finding out the total number of pages
it renders the current page number and the total pages number along
with two buttons that will execute the <tt class="docutils literal">onNextPage</tt> and <tt class="docutils literal">onPreviousPage</tt>
that are passed as properties (these methods will dispatch the changePage and
loadBooks actions as we&#8217;ve already seen in <tt class="docutils literal">BookPanel</tt>). One thing to notice
here is that the next and previous page buttons will only be rendered if
we are not in the first or last page (so if there&#8217;s only one page you won&#8217;t
see any&nbsp;buttons).</p>
<div class="highlight"><pre><span></span><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">({</span><span class="nx">page</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">page_size</span><span class="o">=</span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">onNextPage</span><span class="p">,</span><span class="w"> </span><span class="nx">onPreviousPage</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">props</span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">total_pages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">page_size</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">page</span><span class="o">==</span><span class="mf">1</span><span class="o">?</span><span class="kc">null</span><span class="o">:&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="w">            </span><span class="nx">onPreviousPage</span><span class="p">();</span>
<span class="w">        </span><span class="p">}}</span><span class="o">&gt;&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/button&gt;}</span>
<span class="w">        </span><span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="w"> </span><span class="nx">Page</span><span class="w"> </span><span class="p">{</span><span class="nx">page</span><span class="p">}</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="p">{</span><span class="nx">total_pages</span><span class="p">}</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">page</span><span class="o">==</span><span class="nx">total_pages</span><span class="o">?</span><span class="kc">null</span><span class="o">:&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="w">            </span><span class="nx">onNextPage</span><span class="p">();</span>
<span class="w">        </span><span class="p">}}</span><span class="o">&gt;&amp;</span><span class="nx">gt</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/button&gt;}</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">}</span>
</pre></div>
<p>The same paging panel could be used for any table we wanted to have paging: Just pass it
the page number, page size, total number of items and what to do when next or previous page
buttons are&nbsp;clicked.</p>
</div>
<div class="section" id="interlude-a-more-functional-component">
<h4><a class="toc-backref" href="#toc-entry-26">Interlude: A more functional&nbsp;component</a></h4>
<p>How could we make <tt class="docutils literal">PagingPanel</tt> more functional (i.e how could we remove the
<tt class="docutils literal">const total_pages</tt> definition) ? The easy way would be to just substitute it
with its definition inside the returned <tt class="docutils literal">&lt;div&gt;</tt> however we&#8217;d need to substitute it <em>two</em> times
so we&#8217;d loose our precious DRYness! So we&#8217;d need to think of another&nbsp;way.</p>
<p>People from the django world will be familiar with the  <a class="reference external" href="https://docs.djangoproject.com/es/1.9/ref/templates/builtins/#with">with template tag</a>. This tag
is used in django templates to assign a complex value to a constant and use this value
instead of the complex value. Something like&nbsp;this</p>
<pre class="code literal-block">
{% with simple=a.complex|calculation %}
    In here I can just use {{ simple }} instead of {{ a.complex|calculation }}!
{% endwith %}
</pre>
<p>Having such a concept in <span class="caps">ES6</span> would be ideal for our case! I am not sure if something
like <tt class="docutils literal">with</tt> actually exists, however we can really easy emulate it with a function
closure, something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">({</span><span class="nx">page</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">page_size</span><span class="o">=</span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">onNextPage</span><span class="p">,</span><span class="w"> </span><span class="nx">onPreviousPage</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">props</span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">total_pages</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">page</span><span class="o">==</span><span class="mf">1</span><span class="o">?</span><span class="kc">null</span><span class="o">:&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}}</span><span class="o">&gt;&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/button&gt;}</span>
<span class="w">        </span><span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="w"> </span><span class="nx">Page</span><span class="w"> </span><span class="p">{</span><span class="nx">page</span><span class="p">}</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="p">{</span><span class="nx">total_pages</span><span class="p">}</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">page</span><span class="o">==</span><span class="nx">total_pages</span><span class="o">?</span><span class="kc">null</span><span class="o">:&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}}</span><span class="o">&gt;&amp;</span><span class="nx">gt</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/button&gt;}</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">)(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">page_size</span><span class="p">))</span>
</pre></div>
<p>We define a function that gets <tt class="docutils literal">total_pages</tt> as a parameter and returns <em>another function</em> (
this one is the actual render method of the <tt class="docutils literal">PagingPanel</tt>) and <em>call the outer function</em>
passing it the value we want to give to <tt class="docutils literal">total_pages</tt>. This way, the <tt class="docutils literal">total_pages</tt> will
have a value in the inner function! Thank you, function&nbsp;closure!!!</p>
<p>Now <tt class="docutils literal">PagingPanel</tt> is also a completely functional function&nbsp;component!</p>
</div>
</div>
<div class="section" id="components-bookform">
<h3><a class="toc-backref" href="#toc-entry-27">components/BookForm</a></h3>
<p>The last book-related component is <tt class="docutils literal">BookForm</tt>. This component is used to both create and update
a book. It also has a delete button for removing books. To decide if this is a create or an
update form, it relies on the parameter passed from the route - remember how the two routes have
been defined in <tt class="docutils literal">main.js</tt>:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">Route</span> <span class="na">path</span><span class="o">=</span><span class="s">&quot;/book_create/&quot;</span> <span class="na">component</span><span class="o">=</span><span class="s">{BookForm}</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">Route</span> <span class="na">path</span><span class="o">=</span><span class="s">&quot;/book_update/:id&quot;</span> <span class="na">component</span><span class="o">=</span><span class="s">{BookForm}</span> <span class="p">/&gt;</span>
</pre></div>
<p>So, although create and update render the same component, their difference
is that update will contain the <tt class="docutils literal">id</tt> of the book to be
updated in the url. This (along with any other url parameters) is passed by react-router as a property
through an object named <tt class="docutils literal">params</tt> to the <tt class="docutils literal">BookForm</tt> component, so, when updating a book
the <tt class="docutils literal">props.params.id</tt> of <tt class="docutils literal">BookForm</tt>
should have a&nbsp;value.</p>
<p>The <tt class="docutils literal">BookForm</tt> is a connected component (because it needs access to the state slice and dispatch and
is rendered through a route), however because it is also a redux-form, a special
method (<tt class="docutils literal">reduxForm</tt>) is used to connect the component and pass the form-related props to the&nbsp;component:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">mapStateToProps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">props</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">initial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">book</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">books</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">book</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">initial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">book</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">book</span><span class="o">:</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">book</span><span class="p">,</span>
<span class="w">        </span><span class="nx">categories</span><span class="o">:</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">categories</span><span class="p">,</span>
<span class="w">        </span><span class="nx">authors</span><span class="o">:</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">authors</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ui</span><span class="o">:</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">ui</span><span class="p">,</span>
<span class="w">        </span><span class="nx">initialValues</span><span class="o">:</span><span class="w"> </span><span class="nx">initial</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">reduxForm</span><span class="p">({</span>
<span class="w">    </span><span class="nx">form</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bookForm&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">fields</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;category&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;subcategory&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;publish_date&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;author&#39;</span><span class="w"> </span><span class="p">],</span>
<span class="w">    </span><span class="nx">validate</span>
<span class="p">},</span><span class="w"> </span><span class="nx">mapStateToProps</span><span class="p">)(</span><span class="nx">BookForm</span><span class="p">);</span>
</pre></div>
<p>The <tt class="docutils literal">mapStateToProps</tt> contains a bunch of required things from the state (we need
the current <tt class="docutils literal">book</tt> that is edited, the <tt class="docutils literal">categories</tt> to select from, the <tt class="docutils literal">authors</tt> to also
select from and the <tt class="docutils literal">ui</tt> to find out if submitting has finished and render the buttons
as enabled/disabled). Beyond these, we see
that there&#8217;s an <tt class="docutils literal">initialValues</tt> attribute to the object returned from <tt class="docutils literal">mapStateToProps</tt>. This
attribute is used to initialize the form fields. So if our form has
fields named <tt class="docutils literal">title</tt> and <tt class="docutils literal">category</tt>, if the <tt class="docutils literal">initial</tt> object had <tt class="docutils literal">title</tt> and
<tt class="docutils literal">category</tt> attributes the form fields would be initialized by them. In our case, we just
check if the <tt class="docutils literal">props.params.id</tt> method is defined and the to-be-updated book has been loaded
to the state and just assign the to-be-updated <tt class="docutils literal">book</tt> to <tt class="docutils literal">initialValues</tt>.</p>
<p>The <tt class="docutils literal">reduxForm</tt> method is used to <tt class="docutils literal">connect</tt> the form component: Beyond the usual
<tt class="docutils literal">mapStateToProps</tt> and <tt class="docutils literal">mapDispatchToProps</tt> (we don&#8217;t actually use <tt class="docutils literal">mapDispatchToProps</tt> here
because I feel that just getting <tt class="docutils literal">dispatch</tt> is more clear),
it needs a required parameter which is the object used to initialize the redux-form form: This
object should&nbsp;have</p>
<ul class="simple">
<li>A <tt class="docutils literal">form</tt> attribute with the name of the form. This must be unique among all forms in your application and will be used as a parameter to the actions that redux-form will&nbsp;dispatch</li>
<li>A <tt class="docutils literal">fields</tt> string array with the names of the form fields. For each one of them a <tt class="docutils literal">field</tt> will be passed to the <tt class="docutils literal">props.fields</tt> array in the form&nbsp;component</li>
<li>A optional <tt class="docutils literal">validate</tt> attribute that is a function that will be called when the form fields are&nbsp;changed</li>
</ul>
<p>The validate function gets an object with the field names with their corresponding values as attributes and
should return another object with the field names that have an error and the error message. In our case,
we want the <tt class="docutils literal">title</tt> to be required and the date to be valid (if exists), so the <tt class="docutils literal">validate</tt> is:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">values</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">errors</span><span class="p">.</span><span class="nx">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Required&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">values</span><span class="p">.</span><span class="nx">publish_date</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/^\d{4}-\d{2}-\d{2}$/</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">re</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">values</span><span class="p">.</span><span class="nx">publish_date</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">errors</span><span class="p">.</span><span class="nx">publish_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Invalid&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>I just used a very simple regular expression to check the validity of
the date (it must be in the format <span class="caps">YYYY</span>-<span class="caps">MM</span>-<span class="caps">DD</span>) - this is just to make
a point, for normal date rendered you should use <a class="reference external" href="http://momentjs.com/">moment.js</a>.</p>
<p>This validate function is called <em>whenever a form field is changed</em> so, depending on the implementation
of course, the error messages will be shown and hidden as the user types in the fields. Please notice
that when the user starts typing in a field in an empty form, this field may be valid but all other
fields will be empty - to avoid displaying an error message for fields that the user has not been yet
been able to modify, we can use the <tt class="docutils literal">touched</tt> property of each field &#8212; only display the
field&#8217;s error message if this field has been <tt class="docutils literal">touched</tt>. When the form is submitted all fields are
changed to <tt class="docutils literal">touched</tt> so all error messages will be&nbsp;displayed.</p>
<p>The internal <tt class="docutils literal">BookForm</tt> is an <span class="caps">ES6</span> class based component that needs to do some things
when the <tt class="docutils literal">componentDidMount</tt> method is&nbsp;called:</p>
<ul class="simple">
<li>Check if the categories have been loaded - if not dispatch the <tt class="docutils literal">loadCategories</tt> action</li>
<li>Check if the this is an update and if yes, check to see if the to-be-updated book needs to be loaded and, if it needs dispatch <tt class="docutils literal">loadBook</tt> with the book&#8217;s&nbsp;id</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nx">BookForm</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nx">componentDidMount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">categories</span><span class="p">.</span><span class="nx">categories</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadCategories</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">book</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">book</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadBook</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// New book</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="nx">fields</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">title</span><span class="p">,</span><span class="w"> </span><span class="nx">category</span><span class="p">,</span><span class="w"> </span><span class="nx">subcategory</span><span class="p">,</span><span class="w"> </span><span class="nx">publish_date</span><span class="p">,</span><span class="w"> </span><span class="nx">author</span>
<span class="w">        </span><span class="p">},</span><span class="w"> </span><span class="nx">handleSubmit</span><span class="p">,</span><span class="w"> </span><span class="nx">dispatch</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">isSubmitting</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">ui</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">categories</span><span class="p">,</span><span class="w"> </span><span class="nx">subcategories</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">categories</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">authors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">authors</span><span class="p">.</span><span class="nx">rows</span><span class="p">;</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">tsubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">submit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span><span class="nx">id</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">dsubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">del</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">form</span><span class="w"> </span><span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">(</span><span class="nx">tsubmit</span><span class="p">)}</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;six columns&#39;</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="o">&lt;</span><span class="nx">Input</span><span class="w"> </span><span class="nx">label</span><span class="o">=</span><span class="s1">&#39;Title&#39;</span><span class="w"> </span><span class="nx">field</span><span class="o">=</span><span class="p">{</span><span class="nx">title</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;six columns&#39;</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="o">&lt;</span><span class="nx">Select</span><span class="w"> </span><span class="nx">label</span><span class="o">=</span><span class="s1">&#39;Category&#39;</span><span class="w"> </span><span class="nx">field</span><span class="o">=</span><span class="p">{</span><span class="nx">category</span><span class="p">}</span><span class="w"> </span><span class="nx">options</span><span class="o">=</span><span class="p">{</span><span class="nx">categories</span><span class="p">}</span><span class="w"> </span><span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">category</span><span class="p">.</span><span class="nx">onChange</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
<span class="w">                        </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadSubCategories</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span>
<span class="w">                    </span><span class="p">}}</span><span class="o">/&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;six columns&#39;</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="o">&lt;</span><span class="nx">Select</span><span class="w"> </span><span class="nx">label</span><span class="o">=</span><span class="s1">&#39;Subcategory&#39;</span><span class="w"> </span><span class="nx">field</span><span class="o">=</span><span class="p">{</span><span class="nx">subcategory</span><span class="p">}</span><span class="w"> </span><span class="nx">options</span><span class="o">=</span><span class="p">{</span><span class="nx">subcategories</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;six columns&#39;</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="o">&lt;</span><span class="nx">DatePicker</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;u-full-width&quot;</span><span class="w"> </span><span class="nx">label</span><span class="o">=</span><span class="s1">&#39;Publish Date&#39;</span><span class="w"> </span><span class="nx">field</span><span class="o">=</span><span class="p">{</span><span class="nx">publish_date</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;six columns&#39;</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="o">&lt;</span><span class="nx">Select</span><span class="w"> </span><span class="nx">label</span><span class="o">=</span><span class="s1">&#39;Author&#39;</span><span class="w"> </span><span class="nx">field</span><span class="o">=</span><span class="p">{</span><span class="nx">author</span><span class="p">}</span><span class="w"> </span><span class="nx">options</span><span class="o">=</span><span class="p">{</span>
<span class="w">                        </span><span class="nx">authors</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">a</span><span class="p">.</span><span class="nx">first_name</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">a</span><span class="p">.</span><span class="nx">last_name</span><span class="si">}</span><span class="sb">`</span><span class="p">}))</span>
<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">disabled</span><span class="o">=</span><span class="p">{</span><span class="nx">isSubmitting</span><span class="p">}</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;button button-primary&#39;</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">(</span><span class="nx">tsubmit</span><span class="p">)}</span><span class="o">&gt;</span>
<span class="w">                </span><span class="nx">Save</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/button&gt;</span>
<span class="w">            </span><span class="p">{</span><span class="nx">id</span><span class="o">?&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">disabled</span><span class="o">=</span><span class="p">{</span><span class="nx">isSubmitting</span><span class="p">}</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s1">&#39;button&#39;</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;button button-primary&#39;</span><span class="w"> </span><span class="nx">style</span><span class="o">=</span><span class="p">{{</span><span class="nx">backgroundColor</span><span class="o">:</span><span class="w"> </span><span class="nx">danger</span><span class="p">}}</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">dsubmit</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">                </span><span class="nx">Delete</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/button&gt;:null}</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/form&gt;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
<p>The <tt class="docutils literal">render</tt> method of <tt class="docutils literal">BookForm</tt> defines (for convenience) a bunch of constants which are
attributes of <tt class="docutils literal">props</tt>:</p>
<ul class="simple">
<li>The <tt class="docutils literal">fields</tt> object contains the field attributes of the form which have been defined through the <tt class="docutils literal">reduxForm</tt> function.</li>
<li>The <tt class="docutils literal">handleSubmit</tt> is also provided by <tt class="docutils literal">reduxForm</tt> and is used to submit the form - I&#8217;ll explain it a bit&nbsp;later</li>
<li>The <tt class="docutils literal">dispatch</tt> is provided by <tt class="docutils literal">connect</tt> (remember, <tt class="docutils literal">reduxForm</tt> is a special <tt class="docutils literal">connect</tt>). If you don&#8217;t use <tt class="docutils literal">mapDispatchToProps</tt> then <tt class="docutils literal">connect</tt> will provide <tt class="docutils literal">dispatch</tt> to <tt class="docutils literal">props</tt> to use it as you&nbsp;like</li>
<li>The <tt class="docutils literal">id</tt> is from the route - it will have value when updating and will be undefined when creating a new&nbsp;book</li>
<li>The <tt class="docutils literal">isSubmitting</tt>, <tt class="docutils literal">categories</tt>, <tt class="docutils literal">subcategories</tt> and <tt class="docutils literal">authors</tt> are provided from the state attributes through <tt class="docutils literal">mapStateToProps</tt></li>
<li>The <tt class="docutils literal">tsubmit</tt> and <tt class="docutils literal">dsubmit</tt> are used when the form is submitted or the Delete button is clicked. As we&#8217;ll see the <tt class="docutils literal">tsubmit</tt> is passed as an argument to <tt class="docutils literal">handleSubmit</tt> while the <cite>dsubmit`</cite> is used as it&nbsp;is.</li>
</ul>
<p>Beyond <tt class="docutils literal">fields</tt> and <tt class="docutils literal">handleSubmit</tt> a <tt class="docutils literal">reduxForm</tt> enabled form component has various other
<a class="reference external" href="http://erikras.github.io/redux-form/#/api/props?_k=y5rbd2">properties that you can use</a>, like <tt class="docutils literal">active</tt>, <tt class="docutils literal">dirty</tt>, <tt class="docutils literal">error</tt>, <tt class="docutils literal">pristine</tt> etc.
Each <tt class="docutils literal">field</tt> provided from <tt class="docutils literal">reduxForm</tt> also has a bunch of properties, like
<tt class="docutils literal">active</tt>, <tt class="docutils literal">checked</tt>, <tt class="docutils literal">dirty</tt>, <tt class="docutils literal">error</tt>,
<tt class="docutils literal">onBlur</tt>, <tt class="docutils literal">onChange</tt>, <tt class="docutils literal">onFocus</tt>,
<tt class="docutils literal">pristine</tt>, <tt class="docutils literal">touched</tt>,
<tt class="docutils literal">valid</tt>, <tt class="docutils literal">value</tt>, <tt class="docutils literal">visited</tt>. I won&#8217;t use most of these here however please make sure
that you are familiar with these when using&nbsp;redux-form.</p>
<p>After defining the constants, the <tt class="docutils literal">render</tt> method returns the actual component.
Here we are using a bunch of child components we&#8217;ve defined to render the input
fields, like <tt class="docutils literal">Input</tt>, <tt class="docutils literal">DatePicker</tt> and <tt class="docutils literal">Select</tt> which will be explained
later. For each one of these components we pass the corresponding <tt class="docutils literal">field</tt>
property along with the label we want to show. There are some interesting things
in the parameters we pass to these input&nbsp;components:</p>
<p>All fields except <tt class="docutils literal">category</tt> use their own <tt class="docutils literal">onChange</tt>. For the <tt class="docutils literal">category</tt>
field we pass a custom <tt class="docutils literal">onChange</tt> function that will override the <tt class="docutils literal">field</tt>
onChange in order to dispatch <tt class="docutils literal">loadSubCategories</tt> when the <tt class="docutils literal">category</tt>
is changed (notice that in the custom <tt class="docutils literal">onChange</tt>
I actually call the <tt class="docutils literal">category.onChange</tt> first and then
use <tt class="docutils literal">event.target.value</tt> to get the current value of the dropdown to pass it
to the dispatched <tt class="docutils literal">loadSubCategories</tt>).</p>
<p>The <tt class="docutils literal">Select</tt> fields get an <tt class="docutils literal">options</tt> parameter which should be an array
with <tt class="docutils literal">id/name</tt> objects. For <tt class="docutils literal">authors</tt> we create that array on the fly
using <tt class="docutils literal">map</tt> (since an author object has a <tt class="docutils literal">first_name</tt> and <tt class="docutils literal">last_name</tt>).</p>
<p>The submit and delete buttons will be enabled or disabled depending on the <tt class="docutils literal">isSubmitting</tt> flag,
and will call <tt class="docutils literal">handleClick(tsubmit)</tt> or <tt class="docutils literal">dsubmit</tt> correspondingly. Also, the Delete button will
be hidden if no <tt class="docutils literal">id</tt> is&nbsp;provided.</p>
<p>The <tt class="docutils literal">handleSubmit</tt> method provided by <tt class="docutils literal">reduxForm</tt> will run the <tt class="docutils literal">validate</tt> function passing it
the values from the form (notice that this is synchronous validation, we could also do asynchronous -
on the server- validation for example to immediately check if a username is already used), and if
the validation does not return any errors, it will submit the form.
Submitting the form means that <tt class="docutils literal">handleSubmit</tt> will
either call <tt class="docutils literal">this.props.onSubmit</tt> <em>or</em> will call the argument of <tt class="docutils literal">handleSubmit</tt> (that&#8217;s what
we&#8217;ve done here), passing it the data of the&nbsp;form.</p>
<p>In our case, we want to pass the id of the book to be updated (or undefined when the form
is used to create a book) to the submit function, that&#8217;s why I am assigning
<tt class="docutils literal">submit.bind(undefined,id)</tt> to <tt class="docutils literal">tsubmit</tt> (which is what is passed to <tt class="docutils literal">handleSubmit</tt>) - this
will return a new function with the <tt class="docutils literal">id</tt> as its first argument. The <tt class="docutils literal">handleSubmit</tt> also
passes the <tt class="docutils literal">values</tt> of the form as an object along with the <tt class="docutils literal">dispatch</tt> function, so
<tt class="docutils literal">submit</tt> is a function with three&nbsp;arguments:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">submit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="p">,</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;//127.0.0.1:8000/api/books/&#39;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`//127.0.0.1:8000/api/books/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">/`</span>
<span class="w">        </span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;PUT&#39;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">submittingChanged</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span>

<span class="w">    </span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
<span class="w">        </span><span class="nx">type</span><span class="p">,</span>
<span class="w">        </span><span class="nx">url</span><span class="p">,</span>
<span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="nx">values</span><span class="p">,</span>
<span class="w">        </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">submittingChanged</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span>
<span class="w">            </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">showSuccessNotification</span><span class="p">(</span><span class="s1">&#39;Success!&#39;</span><span class="p">))</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">updateBookResult</span><span class="p">(</span><span class="nx">d</span><span class="p">))</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">addBookResult</span><span class="p">(</span><span class="nx">d</span><span class="p">))</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">routeActions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">));</span>

<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">submittingChanged</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
<span class="w">            </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">showErrorNotification</span><span class="p">(</span><span class="sb">`Error (</span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb"> - </span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">) while saving: </span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">responseText</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">};</span>
</pre></div>
<p>As we can see it just checks if the <tt class="docutils literal">id</tt> has a value and creates the
url and the <span class="caps">HTTP</span> method for the update (either a <tt class="docutils literal"><span class="caps">POST</span></tt> when creatign a new book or
a <tt class="docutils literal"><span class="caps">PUT</span></tt> when updating an existing one). It will then <tt class="docutils literal">dispatch</tt> the
<tt class="docutils literal">submittingChanged</tt> action to change the <span class="caps">UI</span> (disable the buttons) and do the ajax call. When
the call returns, if everything was ok it will <tt class="docutils literal">dispatch</tt> the <tt class="docutils literal">submittingChanged</tt>
(with false as a parameter), the <tt class="docutils literal">showSuccessNotification</tt> (with success as parameter),
either <tt class="docutils literal">updateBookResult</tt> or <tt class="docutils literal">addBookResult</tt> with the retrieved data as paramater
(depending if there was an <tt class="docutils literal">id</tt>) and finally it will change the <span class="caps">URL</span> to <tt class="docutils literal">/</tt> to display
the books table. If there was an error it will once again dispatch the
<tt class="docutils literal">submittingChanged</tt> action to turn off the submit flag of the state and
<tt class="docutils literal">showErrorNotification</tt> with information on the error. The url won&#8217;t change
so that the user will be able to fix the error and retry&nbsp;submitting.</p>
<p>The <tt class="docutils literal">del</tt> function is a little different. We bind not only with <tt class="docutils literal">id</tt> but also
with <tt class="docutils literal">dispatch</tt> because we don&#8217;t call it through <tt class="docutils literal">handleSubmit</tt>
(since when deleting no validation is actually needed)
but directly as the <tt class="docutils literal">onclick</tt> handler of the delete button
(so we must pass dispatch&nbsp;manually):</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">del</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">dispatch</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`//127.0.0.1:8000/api/books/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">/`</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s1">&#39;DELETE&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
<span class="w">        </span><span class="nx">type</span><span class="p">,</span>
<span class="w">        </span><span class="nx">url</span><span class="p">,</span>
<span class="w">        </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">showSuccessNotification</span><span class="p">(</span><span class="s1">&#39;Success!&#39;</span><span class="p">))</span>
<span class="w">            </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">deleteBookResult</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span>
<span class="w">            </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">routeActions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">));</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">showErrorNotification</span><span class="p">(</span><span class="sb">`Error (</span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb"> - </span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">) while saving: </span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">responseText</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">};</span>
</pre></div>
<p>This function sends a <tt class="docutils literal"><span class="caps">DELETE</span></tt> method to the correct url and, if everything
was ok <tt class="docutils literal">dispatches</tt> the <tt class="docutils literal">showSuccessNotification</tt>, <tt class="docutils literal">deleteBookResult</tt> and
<tt class="docutils literal">routeActions.push</tt>, similarly with <tt class="docutils literal">submit</tt>.</p>
<p>One thing that I&#8217;d like to discuss here is the nature of the <tt class="docutils literal">submit</tt> and <tt class="docutils literal">del</tt>
functions: These function do dispatch other actions but they are not implemented
as thunks so, in order
to be able to actually dispatch something they need to retrieve <tt class="docutils literal">dispatch</tt>
as a parameter
(please remember the discussion on the redux-thunk section and the difference
between <tt class="docutils literal">dispatch(actionCreator)</tt> and <tt class="docutils literal">actionCreator(dispatch)</tt> ). The
<tt class="docutils literal">submit</tt> function  receives <tt class="docutils literal">dispatch</tt> from <tt class="docutils literal">handleSubmit</tt> while we pass
dispatch directly (using <tt class="docutils literal">bind</tt>) to the <tt class="docutils literal">del</tt> function.</p>
<p>I could
have implemented them as thunks (and put them to the <tt class="docutils literal">actions</tt> module) however
I feel that leaving them here
will make the <span class="caps">API</span> of the application more compact (since if these functions
had been put in the actions module they would need to be exported so they&#8217;d
be a part of the public <span class="caps">API</span> of this application - however these two are only
called from <tt class="docutils literal">BookForm</tt>) and also their purpose and integration with <tt class="docutils literal">handleSubmit</tt>
is more clear if we leave them as plain functions. This is just my personal
opinion - if for example you wanted to allow deleting a book not only from the <tt class="docutils literal">BookForm</tt>
but also from the <tt class="docutils literal">BookPanel</tt> (by adding a delete button to each book row) then
you&#8217;d definitely need to export <tt class="docutils literal">del</tt> as an action creator (preferably as a thunk action
creator to be consistent with the&nbsp;others).</p>
<div class="section" id="components-input">
<h4><a class="toc-backref" href="#toc-entry-28">components/Input</a></h4>
<p>This is a simple functional component that gets a redux-form
text field and a label as properties and renders a text
input with a <tt class="docutils literal">&lt;label&gt;</tt> and an optional error message.
The error message will only be rendered if the field
has been touched (i.e the user has changed the field or
the form has been submitted) and there&#8217;s an actual&nbsp;error:</p>
<div class="highlight"><pre><span></span><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">({</span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="nx">label</span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">label</span><span class="w"> </span><span class="nx">forHtml</span><span class="o">=</span><span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">label</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">input</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;u-full-width&quot;</span><span class="w"> </span><span class="p">{...</span><span class="nx">field</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">    </span><span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">touched</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">error</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">style</span><span class="o">=</span><span class="p">{{</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">backgroundColor</span><span class="o">:</span><span class="w"> </span><span class="nx">danger</span><span class="p">}}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">error</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;}</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>
<p>One thing I&#8217;d like to explain is the <tt class="docutils literal"><span class="pre">{...field}</span></tt> snippet
I pass to <tt class="docutils literal">&lt;input&gt;</tt>. This is the object spread operator and will
convert each attribute of the <tt class="docutils literal">field</tt> object to a corresponding <tt class="docutils literal">attr=value</tt>
pair,&nbsp;i.e</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">input</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nx">name</span><span class="o">=</span><span class="nx">field</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="nx">onChange</span><span class="o">=</span><span class="nx">field</span><span class="p">.</span><span class="nx">onChange</span><span class="w"> </span><span class="nx">value</span><span class="o">=</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="nx">onBlur</span><span class="o">=</span><span class="nx">field</span><span class="p">.</span><span class="nx">OnBlur</span><span class="w"> </span><span class="nx">etc</span><span class="w"> </span><span class="o">/&gt;</span>
</pre></div>
</div>
<div class="section" id="components-select">
<h4><a class="toc-backref" href="#toc-entry-29">components/Select</a></h4>
<p>The <tt class="docutils literal">Select</tt> component renders a dropdown (select) input.
It should receive a redux-form field, a label and an array
of objects with <tt class="docutils literal">id</tt> and <tt class="docutils literal">name</tt> attributes that will be
rendered as the options. The <tt class="docutils literal">label</tt> and <tt class="docutils literal">error` will be
rendered similarly to ``Input</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">({</span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="nx">label</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">props</span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">label</span><span class="w"> </span><span class="nx">forHtml</span><span class="o">=</span><span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">label</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">select</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;u-full-width&quot;</span><span class="w"> </span><span class="p">{...</span><span class="nx">field</span><span class="p">}</span><span class="w"> </span><span class="p">{...</span><span class="nx">props</span><span class="p">}</span><span class="w"> </span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">option</span><span class="o">&gt;&lt;</span><span class="err">/option&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">options</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">option</span><span class="w"> </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">c</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">c</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="o">&gt;</span><span class="p">{</span><span class="nx">c</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/option&gt;)}</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/select&gt;</span>
<span class="w">    </span><span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">touched</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">error</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">style</span><span class="o">=</span><span class="p">{{</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">backgroundColor</span><span class="o">:</span><span class="w"> </span><span class="nx">danger</span><span class="p">}}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">error</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;}</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>
<p>For the options we include an empty option (as a default value) and the other
options are created with the help of a <tt class="docutils literal">map</tt>. Finally, notice that I have
also used <tt class="docutils literal"><span class="pre">...props</span></tt> here in the the function parameter list to capture all parameters not
captured by <tt class="docutils literal">field</tt>, <tt class="docutils literal">label</tt> and <tt class="docutils literal">options</tt> and then pass
both <tt class="docutils literal"><span class="pre">{...field}</span></tt> and <tt class="docutils literal"><span class="pre">{...props}</span></tt> to the <tt class="docutils literal">select</tt> component. This is
to capture the custom <tt class="docutils literal">onChange</tt> (that I pass for the categories <tt class="docutils literal">Select</tt>)
and use that custom <tt class="docutils literal">onChange</tt> when the select value changes. The custom
<tt class="docutils literal">onChange</tt> will override the <tt class="docutils literal">field.onChange</tt> because the {&#8230;props} is
<em>after</em> {&#8230;field}, so the resulting select will be something&nbsp;like:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">select</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nx">onChange</span><span class="o">=</span><span class="nx">field</span><span class="p">.</span><span class="nx">onChange</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nx">onChange</span><span class="o">=</span><span class="nx">props</span><span class="p">.</span><span class="nx">onChange</span><span class="w"> </span><span class="o">&gt;</span>
</pre></div>
<p>This is
a common idiom for overriding properties of objects that are passed
to components - for example I could pass a <tt class="docutils literal">className</tt> property to
<tt class="docutils literal">&lt;Select&gt;</tt> to override the default one (<tt class="docutils literal"><span class="pre">className=&quot;u-full-width&quot;</span></tt>).</p>
</div>
<div class="section" id="components-datepicker">
<h4><a class="toc-backref" href="#toc-entry-30">components/DatePicker</a></h4>
<p>This component is used to render a jquery-ui datepicker. Similarly
to the other input components it receives a redux-form <tt class="docutils literal">field</tt>
and a <tt class="docutils literal">label</tt>. However, this is a
class based component because it needs to have <tt class="docutils literal">this</tt> for attaching
the <tt class="docutils literal">datepicker</tt> to an input. Beyond the normal rendering, we can
see that we have added a <tt class="docutils literal"><span class="pre">ref='date'</span></tt> to the <tt class="docutils literal">input</tt> to allow
us to refer to it later. This ref is used by <tt class="docutils literal">componentDidMount</tt>
and <tt class="docutils literal">handleChange</tt>:</p>
<div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nx">DatePicker</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="nx">label</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span>
<span class="w">        </span><span class="k">return</span><span class="p">(</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">label</span><span class="w"> </span><span class="nx">forHtml</span><span class="o">=</span><span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">label</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">input</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="w"> </span><span class="nx">ref</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;u-full-width&quot;</span><span class="w"> </span><span class="p">{...</span><span class="nx">field</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">                </span><span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">touched</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">error</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">style</span><span class="o">=</span><span class="p">{{</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">backgroundColor</span><span class="o">:</span><span class="w"> </span><span class="nx">danger</span><span class="p">}}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">error</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;}</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">componentDidMount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">findDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">date</span><span class="p">)).</span><span class="nx">datepicker</span><span class="p">({</span><span class="w"> </span><span class="nx">dateFormat</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;yy-mm-dd&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">findDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">date</span><span class="p">)).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">componentWillUnmount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">handleChange</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">findDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">date</span><span class="p">).</span><span class="nx">value</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">field</span><span class="p">.</span><span class="nx">onChange</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>The <tt class="docutils literal">componentDidMount</tt> retrieves the input <span class="caps">DOM</span> element through the <tt class="docutils literal">ref</tt>
and makes it a datepicker. It also sets its <tt class="docutils literal">onchange</tt> method to the
<tt class="docutils literal">handleChange</tt> method (notice the <tt class="docutils literal">bind(this)</tt> part &#8212; this is needed
so that <tt class="docutils literal">this</tt> will be defined correctly inside the <tt class="docutils literal">handleChange</tt>). The
<tt class="docutils literal">handleChange</tt> retrieves the current date (once again from the <tt class="docutils literal">ref</tt>)
and just calls the <tt class="docutils literal">onChange</tt> of the provided <tt class="docutils literal">field</tt>, passing it the
date&nbsp;value.</p>
</div>
<div class="section" id="should-i-create-my-own-input-components">
<h4><a class="toc-backref" href="#toc-entry-31">Should I create my own input&nbsp;components?</a></h4>
<p>As you&#8217;ve seen, I&#8217;ve created my <em>own</em> custom input components. These components
are created with the correct styling for the css framework I use here (<tt class="docutils literal">skeleton.css</tt>) but
of course with small changes could easily be modified to be used with other css frameworks
(I am using <tt class="docutils literal">bootstrap 3</tt> in most of my normal apps and such components work great).
They also have been created for exactly my needs (i.e get the <tt class="docutils literal"><span class="pre">redux-form</span></tt> field as input,
allow overriding onChange&nbsp;etc).</p>
<p>Instead of creating your own components by hand, you could of course use some specific component
libraries like <a class="reference external" href="http://www.material-ui.com/#/">material-ui</a> or <a class="reference external" href="https://react-bootstrap.github.io/">react-bootstrap</a>. These libraries contain components
such as the <tt class="docutils literal">Input</tt> or <tt class="docutils literal">Select</tt> we implemented here with a consistent <span class="caps">API</span> and
styling. Unfortunately, these components are a little more difficult to use than
just creating your&nbsp;own:</p>
<ul class="simple">
<li>You need to learn their <span class="caps">API</span> (the names of the properties they get, their behavior in various conditions&nbsp;etc)</li>
<li>You need to learn their styling <span class="caps">API</span> (most of them make it difficult to customize their&nbsp;appearence)</li>
<li>It is not very easy to integrate them to your existing css framework (if you have one), so you&#8217;ll need to go all the way to use their&nbsp;styles</li>
<li>You may need to use custom components anyway because you want to use a different javascript component that is not provided by these&nbsp;libraries</li>
</ul>
<p>It all boils down to how big is your project and if you already have some styling for
your pages. If you want to build a rather small project or your project already has a consistent
styling then its better to create the required input components by hand. If on the other hand
you want to build a big project from scratch then probably it would be better to bite the
bullet and use a component library, but keep in mind that you may actually need to create
your own&nbsp;components.</p>
</div>
</div>
<div class="section" id="components-authorpanel">
<h3><a class="toc-backref" href="#toc-entry-32">components/AuthorPanel</a></h3>
<p>The <tt class="docutils literal">AuthorPanel</tt> uses <tt class="docutils literal">Table</tt> to list the authors. Since I haven&#8217;t used
pagination or sorting here the component is very&nbsp;simple:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">label</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">format</span><span class="o">:</span><span class="w"> </span><span class="nx">x</span><span class="p">=&gt;</span><span class="o">&lt;</span><span class="nx">Link</span><span class="w"> </span><span class="nx">to</span><span class="o">=</span><span class="p">{</span><span class="sb">`/author_update/</span><span class="si">${</span><span class="nx">x</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">/`</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">x</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Link&gt;},</span>
<span class="w">    </span><span class="p">{</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;last_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">label</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Last name&#39;</span><span class="p">,},</span>
<span class="w">    </span><span class="p">{</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">label</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;First name&#39;</span><span class="p">,},</span>
<span class="p">]</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">AuthorPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">props</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;twelve columns&quot;</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">Author</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Link</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;button button-primary&#39;</span><span class="w"> </span><span class="nx">style</span><span class="o">=</span><span class="p">{{</span><span class="nx">fontSize</span><span class="o">:</span><span class="s1">&#39;1em&#39;</span><span class="p">}}</span><span class="w"> </span><span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/author_create/&quot;</span><span class="o">&gt;+&lt;</span><span class="err">/Link&gt;&lt;/h3&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Table</span><span class="w"> </span><span class="nx">cols</span><span class="o">=</span><span class="p">{</span><span class="nx">cols</span><span class="p">}</span><span class="w"> </span><span class="nx">rows</span><span class="o">=</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">authors</span><span class="p">.</span><span class="nx">rows</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">mapStateToProps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">authors</span><span class="o">:</span><span class="nx">state</span><span class="p">.</span><span class="nx">authors</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>
</div>
<div class="section" id="components-authorform">
<h3><a class="toc-backref" href="#toc-entry-33">components/AuthorForm</a></h3>
<p>The <tt class="docutils literal">AuthorForm</tt> is similar to <tt class="docutils literal">BookForm</tt> and is used to
create a new author, update or delete an existing one. It uses
the <tt class="docutils literal">Input</tt> component to edit the first and last name
of each author. I won&#8217;t go into more detail about this
component since everything must be clear by&nbsp;now.</p>
</div>
</div>
<div class="section" id="changing-the-ui-when-the-data-is-changed">
<h2><a class="toc-backref" href="#toc-entry-34">Changing the <span class="caps">UI</span> when the data is&nbsp;changed</a></h2>
<p>Commenter Tomas Jacobsen asked for a tutorial on <a class="reference external" href="http://spapas.github.io/2015/09/08/more-complex-react-flux-example/#comment-2667922265">how the <span class="caps">UI</span> will be updated when the data is changed in a different window</a>. Well,
requirements like this is actually the reason for using react and redux I decided to add that capability to this application. If you want
to check it out, please <tt class="docutils literal">git checkout</tt> the tag <tt class="docutils literal"><span class="pre">react-redux-poll-update</span></tt> of the same repository (<a class="reference external" href="https://github.com/spapas/react-tutorial/">https://github.com/spapas/react-tutorial/</a>).</p>
<p>This extra functionality simply checks (using polling) every few seconds if the number of authors has changed and if it has, it will reload the authors
and dispaly a notification. Beyond the <span class="caps">ES6</span> code, I&#8217;ve added a small <span class="caps">REST</span> <span class="caps">API</span> view that returns the number of authors in the database (it just
returns a number) and a django management command that adds an author. So, to test the new functionality, run
the django application and thhen run <tt class="docutils literal">python manage.py add_author</tt> in a different window - after a few seconds you should see that the
authors have been updated along with a&nbsp;notification.</p>
<p>To implement the <span class="caps">UI</span> update in <span class="caps">ES6</span>, I&#8217;ve added a file named <tt class="docutils literal">scheduler.js</tt> with the following&nbsp;contents:</p>
<div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nx">store</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./store&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">loadAuthors</span><span class="p">,</span><span class="w"> </span><span class="nx">showSuccessNotification</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./actions&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Starting scheduler&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;http://127.0.0.1:8000/api/authors/get_author_number/&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">realAuthorNumber</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">authorNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">().</span><span class="nx">authors</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="nx">authorNumber</span><span class="o">!=</span><span class="nx">realAuthorNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">showSuccessNotification</span><span class="p">(</span><span class="s2">&quot;Authors have changed - reloading ...&quot;</span><span class="p">));</span>
<span class="w">                </span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadAuthors</span><span class="p">());</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">2000</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
<p>and then just import the default function from <tt class="docutils literal">main.js</tt> and call&nbsp;it:</p>
<div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nx">schedule</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./scheduler&#39;</span><span class="p">;</span>

<span class="nx">schedule</span><span class="p">();</span>
</pre></div>
<p>So, we can see that every 2 seconds we retrieve (using Ajax) the number of authors and,
if their number is different than the current number of authors in the <span class="caps">UI</span> (which we retrieve from
the store using its <tt class="docutils literal">getState</tt> method) display the notification and reload the authors (by
dispatching two actions (which are created through the corresponding actions creators)! That&#8217;s
all that is needed to update the <span class="caps">UI</span>!</p>
<p>Notice that, although I&#8217;ve used ajax and polling to find out when the <span class="caps">UI</span> needs to be updated
you could instead use whatever different method you like, for example&nbsp;WebSockets.</p>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#toc-entry-35">Conclusion</a></h2>
<p>In the above sections we presented and explained
a more or less complete single page react / redux
application, <em>almost</em> ready to be deployed to production.
I tried to explain every concept I came across that&#8217;s why
this article became more fat that I was expecting when I
started writing it! The presented application supports nearly
everything you&#8217;ll want to use when creating your own&nbsp;apps:</p>
<ul class="simple">
<li>Complex&nbsp;forms</li>
<li>Custom&nbsp;components</li>
<li>Asynchronous actions /&nbsp;Ajax</li>
<li>Creating / updating / deleting&nbsp;objects</li>
<li>Client side&nbsp;routing</li>
<li>Result lists with pagination, sorting and&nbsp;filtering</li>
</ul>
<p>The above have been implemented using the following technologies /&nbsp;libraries:</p>
<ul class="simple">
<li>Django /&nbsp;django-rest-framework</li>
<li><span class="caps">ES6</span> with&nbsp;babel</li>
<li>browserify / watchify /&nbsp;babelify</li>
<li>React / redux /&nbsp;react-redux</li>
<li>redux-thunk / redux-form / react-router-redux /&nbsp;react-notification</li>
</ul>
<p>What could be missing from the application we presented&nbsp;here:</p>
<ul class="simple">
<li>Tests!</li>
<li>Integrating <a class="reference external" href="https://github.com/gaearon/redux-devtools">redux-devtools</a></li>
<li>Using envify to seperate development/production client side code (this is needeed if you actually integrate&nbsp;redux-devtools)</li>
<li>Intagration with a component&nbsp;library</li>
</ul>
<p>I advice you to research these subjects a bit - I&#8217;ll also try to
write another (hopefully thinner) post with more info
about&nbsp;these.</p>
<p>Finally, two thing I&#8217;d like to point out and keep in mind are that using
redux/react-redux the flow of the data is <em>crystal</em> and that as you&#8217;ve already
seen by now, writing functional components and reducers is <em>pure fun</em>!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2015/12/22/ajax-with-react-fixed-data-table/">Ajax data with Fixed Data Table for React</a>
      </h1>
    <p class="meta">
<time datetime="2015-12-22T15:20:00+02:00" pubdate>Tue 22 December 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title"><a class="reference internal" href="#top">Contents</a></p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="toc-entry-1">Introduction</a></li>
<li><a class="reference internal" href="#our-project" id="toc-entry-2">Our&nbsp;project</a></li>
<li><a class="reference internal" href="#how-fixeddatatable-gets-its-data" id="toc-entry-3">How FixedDataTable gets its&nbsp;data</a></li>
<li><a class="reference internal" href="#ajaxcell-non-working-version-1" id="toc-entry-4">AjaxCell: Non working version&nbsp;1</a></li>
<li><a class="reference internal" href="#ajaxcell-non-working-version-2" id="toc-entry-5">AjaxCell: Non working version&nbsp;2</a></li>
<li><a class="reference internal" href="#ajaxcell-non-working-version-3" id="toc-entry-6">AjaxCell: Non working version&nbsp;3</a></li>
<li><a class="reference internal" href="#ajaxcell-final-version" id="toc-entry-7">AjaxCell: Final&nbsp;version</a></li>
<li><a class="reference internal" href="#the-table-container-component" id="toc-entry-8">The Table container&nbsp;component</a></li>
<li><a class="reference internal" href="#some-enchancements" id="toc-entry-9">Some&nbsp;enchancements</a></li>
<li><a class="reference internal" href="#conslusion" id="toc-entry-10">Conslusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#toc-entry-1">Introduction</a></h2>
<p><a class="reference external" href="https://facebook.github.io/fixed-data-table/">FixedDataTable</a> is a nice React component from Facebook that is used to render tabular data.
Its main characteristic is that it can handle many rows without sacrificing performance, however
probably due to this fact I was not able to find any examples for loading data using Ajax - all
examples I was able to find had the data already loaded (or created on the&nbsp;fly).</p>
<p>So, although FixedDataTable is able to handle many rows, I am against transfering all of them to the user
whenever our page loads since at most one page of data will be shown on screen (30 rows or so ?) -
any other actions (filtering, sorting, aggregate calculations etc) should be done on the&nbsp;server.</p>
<p>In the following I will present a simple, react-only example with a FixedDataTable that can be
used with server-side, asynchronous, paginated&nbsp;data.</p>
</div>
<div class="section" id="our-project">
<h2><a class="toc-backref" href="#toc-entry-2">Our&nbsp;project</a></h2>
<p>Let&#8217;s see an example of what we&#8217;ll&nbsp;build:</p>
<img alt="Our project" src="/images/ajax_fixed_data_tables.gif" style="width: 600px;" />
<p>As a source of the data I&#8217;ve used the <a class="reference external" href="http://swapi.co/">Star Wars <span class="caps">API</span></a> and specifically its <a class="reference external" href="http://swapi.co/documentation#people">People <span class="caps">API</span></a> by issuing
requests to <a class="reference external" href="http://swapi.co/api/people/?format=json">http://swapi.co/api/people/?format=json</a>. This will return an array of people from the
star wars universe in <span class="caps">JSON</span> format - the results are paginated with a page size of 10 (and we can switch
to another page using the extra <tt class="docutils literal">page=</tt> request&nbsp;parameter).</p>
<p>I will use es6 with the object spread operator (as described in <a class="reference external" href="https://www.spapas.net/2015/11/16/using-browserify-es6/">a previous article</a>)
to write the code, using a single main.js as a source which will be transpiled to <tt class="docutils literal">dist/bundle.js</tt>.</p>
<p>The placeholder <span class="caps">HTML</span> for our application&nbsp;is:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Hello Ajax Fixed Data Table!<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;https://cdnjs.cloudflare.com/ajax/libs/fixed-data-table/0.6.0/fixed-data-table.min.css&#39;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;dist/bundle.js&#39;</span> <span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>The versions that are used are react 14.3 and fixed-data-table 0.6.0. You can find this project in github &#64;
<a class="reference external" href="https://github.com/spapas/react-tables">https://github.com/spapas/react-tables</a> &#8212; tag name <tt class="docutils literal"><span class="pre">fixed-data-table-ajax</span></tt>.</p>
</div>
<div class="section" id="how-fixeddatatable-gets-its-data">
<h2><a class="toc-backref" href="#toc-entry-3">How FixedDataTable gets its&nbsp;data</a></h2>
<p>The data of a <tt class="docutils literal">FixedDataTable</tt> component is defined through a number of <tt class="docutils literal">Column</tt> components
and specifically, the <tt class="docutils literal">cell</tt> attribute of that component which sould either return be a static string
to be displayed in that column or a React component (usually a <tt class="docutils literal">Cell</tt>) that will be displayed in
that column or even a function that returns a string or a react component. The function (or component)
passed to <tt class="docutils literal">cell</tt> will have an object with a <tt class="docutils literal">rowIndex</tt> attribute (among others) as a parameter,
for example the&nbsp;following</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">Column</span>
  <span class="na">header</span><span class="o">=</span><span class="s">{&lt;Cell</span><span class="p">&gt;</span>Url<span class="p">&lt;/</span><span class="nt">Cell</span><span class="p">&gt;</span>}
  cell={props =&gt; props.rowIndex}
  width={200}
/&gt;
</pre></div>
<p>will just display the rowIndex for each&nbsp;cell.</p>
<p>So we can see that for each cell that FixedDataTable wants to display it will use its corresponding
<tt class="docutils literal">cell</tt> attribute.
So, a general though if we wanted to support asynchronous, paginated data
is to check the rowIndex and retrieve the correct page asynchronously.
This would lead to a difficulty: What should the <tt class="docutils literal">cell</tt> function return? We&#8217;ll try to resolve this
using an <tt class="docutils literal">AjaxCell</tt> function that should return a react componet to put in the&nbsp;cell:</p>
</div>
<div class="section" id="ajaxcell-non-working-version-1">
<h2><a class="toc-backref" href="#toc-entry-4">AjaxCell: Non working version&nbsp;1</a></h2>
<p>A first sketch of an <tt class="docutils literal">`AjaxCell</tt> component could be something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="c1">// Careful - not working</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">AjaxCell1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">rowIndex</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">props</span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rowIndex</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">rowIndex</span><span class="o">&gt;=</span><span class="nx">pageSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">rowIndex</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">pageSize</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">        </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rowIndex</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nx">pageSize</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://swapi.co/api/people/?format=json&amp;page=&#39;</span><span class="o">+</span><span class="nx">page</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">    </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Here we have the result ! But where will it go ?</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="c1">/// what ?</span>
<span class="p">}</span>
</pre></div>
<p>The col attribute will later be used to select the attribute we want to display in this cell.
The <tt class="docutils literal">page</tt> and <tt class="docutils literal">idx</tt> will have the correct page number and idx inside that page (for example,
if <tt class="docutils literal">rowIndex</tt> is 33, <tt class="docutils literal">page</tt> will be 4 and idx will be 3. The problem with the above is that
the fetch function will be called <em>asynchronously</em> so when the AjaxCell returns it will <em>not</em> have
the results (yet)! So we won&#8217;t be able to render anything&nbsp;:(</p>
</div>
<div class="section" id="ajaxcell-non-working-version-2">
<h2><a class="toc-backref" href="#toc-entry-5">AjaxCell: Non working version&nbsp;2</a></h2>
<p>To be able to render <em>something</em>, we could put the results of fetching a page to a <tt class="docutils literal">cache</tt> dictionary &#8212; and only
fetch that page if it is not inside the <tt class="docutils literal">cache</tt> - if it is inside the cache then we&#8217;ll just return
the correct&nbsp;value:</p>
<div class="highlight"><pre><span></span><span class="c1">// Careful - not working correctly</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">AjaxCell2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">rowIndex</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="p">,</span><span class="w"> </span><span class="nx">forceUpdate</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">props</span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rowIndex</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">rowIndex</span><span class="o">&gt;=</span><span class="nx">pageSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">rowIndex</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">pageSize</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">        </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rowIndex</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nx">pageSize</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">][</span><span class="nx">idx</span><span class="p">][</span><span class="nx">col</span><span class="p">]}</span><span class="o">&lt;</span><span class="err">/Cell&gt;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Loading page &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">page</span><span class="p">);</span>
<span class="w">        </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://swapi.co/api/people/?format=json&amp;page=&#39;</span><span class="o">+</span><span class="nx">page</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">        </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">];</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;-&lt;</span><span class="err">/Cell&gt;;</span>
<span class="p">}</span>
</pre></div>
<p>The above will work, since it will return an empty (<tt class="docutils literal"><span class="pre">&lt;Cell&gt;-&lt;/Cell&gt;</span></tt>) initially but when the
<tt class="docutils literal">fetch</tt> returns it will set the <tt class="docutils literal">cache</tt> for that page and return the correct value (<tt class="docutils literal"><span class="pre">&lt;Cell&gt;{cache[page][idx][col]}&lt;/Cell&gt;</span></tt>).</p>
<p>However, as can be understood, when the page first loads it will call <tt class="docutils literal">AjaxCell2</tt> for all visible cells &#8212;
because fetch is asynchronous and takes time until it returns (and sets the cache for that page), so the
<tt class="docutils literal">fetch</tt> will be called for <em>all</em>&nbsp;cells!</p>
</div>
<div class="section" id="ajaxcell-non-working-version-3">
<h2><a class="toc-backref" href="#toc-entry-6">AjaxCell: Non working version&nbsp;3</a></h2>
<p><tt class="docutils literal">fetch</tt> ing each page multiple times is of course not acceptable, so we&#8217;ll add a <tt class="docutils literal">loading</tt> flag
and <tt class="docutils literal">fetch</tt> will be called only when this flag is <tt class="docutils literal">false</tt>, like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="c1">// Not ready yet</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">loading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">AjaxCell2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">rowIndex</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">props</span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rowIndex</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">rowIndex</span><span class="o">&gt;=</span><span class="nx">pageSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">rowIndex</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">pageSize</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">        </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rowIndex</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nx">pageSize</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">][</span><span class="nx">idx</span><span class="p">][</span><span class="nx">col</span><span class="p">]}</span><span class="o">&lt;</span><span class="err">/Cell&gt;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">loading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Loading page &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">page</span><span class="p">);</span>
<span class="w">        </span><span class="nx">loading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="w">        </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://swapi.co/api/people/?format=json&amp;page=&#39;</span><span class="o">+</span><span class="nx">page</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">        </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">];</span>
<span class="w">            </span><span class="nx">loading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;-&lt;</span><span class="err">/Cell&gt;;</span>
<span class="p">}</span>
</pre></div>
<p>This works much better - the cells are rendered correctly and each page is loaded only once. However, if for example
I tried to move to the end of the table quickly, I would see some cells that are always loading (they never get their correct value). This is because
there is no way to know that the fetch function has actually completed in order to update with the latest (correct) value of that
cell and will contain the stale placeholder (<tt class="docutils literal"><span class="pre">&lt;Cell&gt;-&lt;/Cell&gt;</span></tt>)&nbsp;value.</p>
</div>
<div class="section" id="ajaxcell-final-version">
<h2><a class="toc-backref" href="#toc-entry-7">AjaxCell: Final&nbsp;version</a></h2>
<p>To clear the stale data we need to do an update to the table data
when each fetch is finished &#8212; this should be done by a callback that will be passed to the <tt class="docutils literal">AjaxCell</tt>, like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">loading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">AjaxCell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">rowIndex</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="p">,</span><span class="w"> </span><span class="nx">forceUpdate</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">props</span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rowIndex</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">rowIndex</span><span class="o">&gt;=</span><span class="nx">pageSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">rowIndex</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">pageSize</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">        </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rowIndex</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nx">pageSize</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">][</span><span class="nx">idx</span><span class="p">][</span><span class="nx">col</span><span class="p">]}</span><span class="o">&lt;</span><span class="err">/Cell&gt;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">loading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Loading page &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">page</span><span class="p">);</span>
<span class="w">        </span><span class="nx">loading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="w">        </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://swapi.co/api/people/?format=json&amp;page=&#39;</span><span class="o">+</span><span class="nx">page</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">        </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">];</span>
<span class="w">            </span><span class="nx">loading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="nx">forceUpdate</span><span class="p">();</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">loadingCell</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>So we pass a forceUpdate callback as a property which is called when a fetch is finished. This may
result to some not needed updates to the table (since we would do a fetch + forceUpdate for non-displayed
data) but we can now be positive that when the data is loaded the table will be updated to dispaly&nbsp;it.</p>
</div>
<div class="section" id="the-table-container-component">
<h2><a class="toc-backref" href="#toc-entry-8">The Table container&nbsp;component</a></h2>
<p>Finally, the component that contains the table is the&nbsp;following:</p>
<div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nx">TableContainer</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Table</span>
<span class="w">            </span><span class="nx">rowHeight</span><span class="o">=</span><span class="p">{</span><span class="mf">30</span><span class="p">}</span><span class="w"> </span><span class="nx">rowsCount</span><span class="o">=</span><span class="p">{</span><span class="mf">87</span><span class="p">}</span><span class="w"> </span><span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="mf">600</span><span class="p">}</span><span class="w"> </span><span class="nx">height</span><span class="o">=</span><span class="p">{</span><span class="mf">200</span><span class="p">}</span><span class="w"> </span><span class="nx">headerHeight</span><span class="o">=</span><span class="p">{</span><span class="mf">30</span><span class="p">}</span><span class="o">&gt;</span>

<span class="w">            </span><span class="o">&lt;</span><span class="nx">Column</span>
<span class="w">              </span><span class="nx">header</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="nx">Name</span><span class="o">&lt;</span><span class="err">/Cell&gt;}</span>
<span class="w">              </span><span class="nx">cell</span><span class="o">=</span><span class="p">{</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">AjaxCell</span><span class="w"> </span><span class="nx">col</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="w"> </span><span class="nx">forceUpdate</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">forceUpdate</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span><span class="w"> </span><span class="o">/&gt;</span><span class="w"> </span><span class="p">}</span>
<span class="w">              </span><span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="mf">200</span><span class="p">}</span>
<span class="w">            </span><span class="o">/&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">Column</span>
<span class="w">              </span><span class="nx">header</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="nx">Birth</span><span class="w"> </span><span class="nx">Year</span><span class="o">&lt;</span><span class="err">/Cell&gt;}</span>
<span class="w">              </span><span class="nx">cell</span><span class="o">=</span><span class="p">{</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">AjaxCell</span><span class="w"> </span><span class="nx">col</span><span class="o">=</span><span class="s1">&#39;birth_year&#39;</span><span class="w"> </span><span class="nx">forceUpdate</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">forceUpdate</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span><span class="w"> </span><span class="o">/&gt;</span><span class="w"> </span><span class="p">}</span>
<span class="w">              </span><span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="mf">200</span><span class="p">}</span>
<span class="w">            </span><span class="o">/&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">Column</span>
<span class="w">              </span><span class="nx">header</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="nx">Url</span><span class="o">&lt;</span><span class="err">/Cell&gt;}</span>
<span class="w">              </span><span class="nx">cell</span><span class="o">=</span><span class="p">{</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">AjaxCell</span><span class="w"> </span><span class="nx">col</span><span class="o">=</span><span class="s1">&#39;url&#39;</span><span class="w"> </span><span class="nx">forceUpdate</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">forceUpdate</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span><span class="w"> </span><span class="o">/&gt;</span><span class="w"> </span><span class="p">}</span>
<span class="w">              </span><span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="mf">200</span><span class="p">}</span>
<span class="w">            </span><span class="o">/&gt;</span>

<span class="w">        </span><span class="o">&lt;</span><span class="err">/Table&gt;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>I&#8217;ve made it a component in order to be able to bind the <tt class="docutils literal">forceUpdate</tt> method of the component to and
<tt class="docutils literal">this</tt> and pass it to the <tt class="docutils literal">forceUpdate</tt> parameter to the <tt class="docutils literal">AjaxCell</tt> component. I&#8217;ve hard-coded
the rowsCount value &#8212; instead we should have done an initial fetch to the first page of the <span class="caps">API</span> to get
the total number of rows and only after that fetch had returned display the <tt class="docutils literal">&lt;Table&gt;</tt> component (left
as an exercise to the&nbsp;reader).</p>
</div>
<div class="section" id="some-enchancements">
<h2><a class="toc-backref" href="#toc-entry-9">Some&nbsp;enchancements</a></h2>
<p>Instead of displaying <tt class="docutils literal"><span class="pre">&lt;Cell&gt;-&lt;/Cell&gt;</span></tt> (or <tt class="docutils literal">&lt;/Cell&gt;</tt>) when the page loads, I propose to define a
cell with an embedded spinner,&nbsp;like</p>
<div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">loadingCell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">img</span><span class="w"> </span><span class="nx">width</span><span class="o">=</span><span class="s2">&quot;16&quot;</span><span class="w"> </span><span class="nx">height</span><span class="o">=</span><span class="s2">&quot;16&quot;</span><span class="w"> </span><span class="nx">alt</span><span class="o">=</span><span class="s2">&quot;star&quot;</span><span class="w"> </span><span class="nx">src</span><span class="o">=</span><span class="s2">&quot;data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="err">/Cell&gt;</span>
</pre></div>
<p>and return this&nbsp;instead.</p>
<p>Also, if your <span class="caps">REST</span> <span class="caps">API</span> returns too fast and you&#8217;d like to see what would happen if the server request took too long to return, you could
change fetch like&nbsp;this</p>
<div class="highlight"><pre><span></span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://swapi.co/api/people/?format=json&amp;page=&#39;</span><span class="o">+</span><span class="nx">page</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setTimeout</span><span class="p">(</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">];</span>
<span class="w">        </span><span class="nx">loading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="nx">forceUpdate</span><span class="p">();</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
<p>to add a 1 second&nbsp;delay.</p>
</div>
<div class="section" id="conslusion">
<h2><a class="toc-backref" href="#toc-entry-10">Conslusion</a></h2>
<p>The above is a just a proof of concept of using FixedDataTable with asynchronously loaded server-side data.
This of course could be used for small projects (I am already using it for an internal project) but I recommend
using the <a class="reference external" href="https://www.spapas.net/2015/07/02/comprehensive-react-flux-tutorial-2/">flux architecture</a> for more complex projects. What this more or
less means is that a store component
should be developed that will actually keep the data for each row, and a <tt class="docutils literal">fetchCompleted</tt> action should be
dispatched when the <tt class="docutils literal">fetch</tt> is finished instead of calling <tt class="docutils literal">forceUpdate</tt> directly.</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2015/11/27/pdf-in-django/">PDFs in Django: The essential guide</a>
      </h1>
    <p class="meta">
<time datetime="2015-11-27T10:20:00+02:00" pubdate>Fri 27 November 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title"><a class="reference internal" href="#top">Contents</a></p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="toc-entry-1">Introduction</a></li>
<li><a class="reference internal" href="#the-players" id="toc-entry-2">The players</a><ul>
<li><a class="reference internal" href="#reportlab" id="toc-entry-3">ReportLab</a></li>
<li><a class="reference internal" href="#xhtml2pdf" id="toc-entry-4">xhtml2pdf</a></li>
<li><a class="reference internal" href="#pypdf2" id="toc-entry-5">PyPDF2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#django-integration" id="toc-entry-6">Django integration</a><ul>
<li><a class="reference internal" href="#using-a-plain-old-view" id="toc-entry-7">Using a plain old&nbsp;view</a></li>
<li><a class="reference internal" href="#using-a-cbv" id="toc-entry-8">Using a <span class="caps">CBV</span></a></li>
<li><a class="reference internal" href="#how-does-django-xhtml2pdf-loads-resources" id="toc-entry-9">How does django-xhtml2pdf loads&nbsp;resources</a></li>
<li><a class="reference internal" href="#using-a-common-style-for-your-pdfs" id="toc-entry-10">Using a common style for your&nbsp;PDFs</a></li>
<li><a class="reference internal" href="#changing-the-font-to-a-unicode-enabled-one" id="toc-entry-11">Changing the font (to a Unicode enabled&nbsp;one)</a></li>
<li><a class="reference internal" href="#configure-django-for-debugging-pdf-creation" id="toc-entry-12">Configure Django for debugging <span class="caps">PDF</span>&nbsp;creation</a></li>
<li><a class="reference internal" href="#concatenating-pdfs-in-django" id="toc-entry-13">Concatenating PDFs in&nbsp;Django</a></li>
</ul>
</li>
<li><a class="reference internal" href="#more-advanced-xhtml2pdf-features" id="toc-entry-14">More advanced xhtml2pdf features</a><ul>
<li><a class="reference internal" href="#laying-out" id="toc-entry-15">Laying&nbsp;out</a></li>
<li><a class="reference internal" href="#extra-stuff" id="toc-entry-16">Extra&nbsp;stuff</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion" id="toc-entry-17">Conclusion</a></li>
</ul>
</div>
<p><strong>Upgrade 23/05/2018</strong> I&#8217;ve upgraded the sample project (<a class="reference external" href="https://github.com/spapas/django-pdf-guide">https://github.com/spapas/django-pdf-guide</a>) for usage with Django 2.0 and Python 3.x.
There were very few changes between the old, Django 1.8 compatible project and the new one. To see the differences, you can just clone it
and do a <tt class="docutils literal">git diff <span class="pre">django-1.8</span> <span class="pre">django-2.0</span></tt>: Most are related to changes between django 1.8 and django 2.0 (in the <span class="caps">URL</span> configuration use <tt class="docutils literal">path</tt> instead of <tt class="docutils literal">url</tt>,
use new style middleware etc) and between python 2.7 and 3.x (small changes in import syntax, <tt class="docutils literal">StringIO</tt> has been moved to the <tt class="docutils literal">io</tt> package). There&#8217;s also
a couple of requirement upgrades, the most important are the upgrade to <tt class="docutils literal">xhtml2pdf 0.2.2</tt> and using my own fork of <tt class="docutils literal">django_xhtml2pdf</tt> since django_xhtml2pdf
does not seem to be maintained&nbsp;anymore.</p>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#toc-entry-1">Introduction</a></h2>
<p>I&#8217;ve noticed that although it is easy to create PDFs with
Python, there&#8217;s no complete guide on how to
integrate these tools with Django and resolve the problems
that you&#8217;ll encounter when trying to actually create PDFs
from your Django web&nbsp;application.</p>
<p>In this article I will present the solution I use for
creating PDFs with Django, along with various tips on how to
solve most of your common requirements. Specifically, here
are some things that we&#8217;ll&nbsp;cover:</p>
<ul class="simple">
<li>Learn how to create PDFs &#8220;by&nbsp;hand&#8221;</li>
<li>Create PDFs with Django using a normal Djang Template (similar to an <span class="caps">HTML</span>&nbsp;page)</li>
<li>Change the fonts of your&nbsp;PDFs</li>
<li>Use styling in your&nbsp;output</li>
<li>Create&nbsp;layouts</li>
<li>Embed images to your&nbsp;PDFs</li>
<li>Add page&nbsp;numbers</li>
<li>Merge (concatenate)&nbsp;PDFs</li>
</ul>
</div>
<div class="section" id="the-players">
<h2><a class="toc-backref" href="#toc-entry-2">The&nbsp;players</a></h2>
<p>We are going to use the following main&nbsp;tools:</p>
<ul class="simple">
<li><a class="reference external" href="https://bitbucket.org/rptlab/reportlab">ReportLab</a> is an open source python library for creating PDFs. It uses a low-level <span class="caps">API</span> that allows &#8220;drawing&#8221; strings on specific coordinates  on the <span class="caps">PDF</span> - for people familiar with creating PDFs in Java it is more or less <a class="reference external" href="http://itextpdf.com/">iText</a> for&nbsp;python.</li>
<li><a class="reference external" href="https://github.com/chrisglass/xhtml2pdf">xhtml2pdf</a> (formerly named <em>pisa</em>) is an open source library that can convert <span class="caps">HTML</span>/<span class="caps">CSS</span> pages to <span class="caps">PDF</span> using&nbsp;ReportLab.</li>
<li><a class="reference external" href="https://github.com/chrisglass/django-xhtml2pdf">django-xhtml2pdf</a> is a wrapper around xhtml2pdf that makes integration with Django&nbsp;easier.</li>
<li><a class="reference external" href="https://github.com/mstamy2/PyPDF2">PyPDF2</a> is an open source tool of that can split, merge and transform pages of <span class="caps">PDF</span>&nbsp;files.</li>
</ul>
<p>I&#8217;ve created a <a class="reference external" href="https://github.com/spapas/django-pdf-guide">django project</a> <a class="reference external" href="https://github.com/spapas/django-pdf-guide">https://github.com/spapas/django-pdf-guide</a> with everything covered here. Please clone it,
install its requirements and play with it to see how everything works&nbsp;!</p>
<p>Before integrating the above tools to a Django project, I&#8217;d like to describe them individually a bit more. Any files
I mention below will be included in this&nbsp;project.</p>
<div class="section" id="reportlab">
<h3><a class="toc-backref" href="#toc-entry-3">ReportLab</a></h3>
<p>ReportLab offers a really low <span class="caps">API</span> for creating PDFs. It is something like having a <tt class="docutils literal">canvas.drawString()</tt> method (for
people familiar with drawing APIs) for your <span class="caps">PDF</span> page. Let&#8217;s take a look at an example, creating a <span class="caps">PDF</span> with a simple&nbsp;string:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">reportlab.pdfgen</span><span class="w"> </span><span class="kn">import</span> <span class="n">canvas</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">reportlab.rl_config</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">reportlab</span><span class="o">.</span><span class="n">rl_config</span><span class="o">.</span><span class="n">warnOnMissingFontGlyphs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="s2">&quot;./hello1.pdf&quot;</span><span class="p">,)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">drawString</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">showPage</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
<p>Save the above in a file named testreportlab1.py. If you run python testreportlab1.py (in an environment that has
reportlab of cours) you should see no errors and a pdf named <tt class="docutils literal">hello1.pdf</tt> created. If you open it in your <span class="caps">PDF</span>
reader you&#8217;ll see a blank page with &#8220;Hello World&#8221; written in its lower right&nbsp;corner.</p>
<p>If you try to add a unicode text, for example &#8220;Καλημέρα ελλάδα&#8221;, you should see something like the&nbsp;following:</p>
<img alt="Hello PDF" src="/images/hellopdf2.png" style="width: 480px;" />
<p>It seems that the default font that ReportLab uses does not have a good support for accented greek characters
since they are missing  (and probably for various other&nbsp;characters).</p>
<p>To resolve this, we could try changing the font to one that contains the missing symbols. You can find free
fonts on the internet (for example the <cite>DejaVu</cite> font), or even grab one from your system fonts (in windows,
check out <tt class="docutils literal"><span class="pre">c:\windows\fonts\</span></tt>). In any case, just copy the ttf file of your font inside the folder of
your project and crate a file named testreportlab2.py with the following (I am using the DejaVuSans&nbsp;font):</p>
<div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">reportlab.rl_config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reportlab.pdfbase</span><span class="w"> </span><span class="kn">import</span> <span class="n">pdfmetrics</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reportlab.pdfbase.ttfonts</span><span class="w"> </span><span class="kn">import</span> <span class="n">TTFont</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="s2">&quot;./hello2.pdf&quot;</span><span class="p">,)</span>
    <span class="n">reportlab</span><span class="o">.</span><span class="n">rl_config</span><span class="o">.</span><span class="n">warnOnMissingFontGlyphs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">pdfmetrics</span><span class="o">.</span><span class="n">registerFont</span><span class="p">(</span><span class="n">TTFont</span><span class="p">(</span><span class="s1">&#39;DejaVuSans&#39;</span><span class="p">,</span> <span class="s1">&#39;DejaVuSans.ttf&#39;</span><span class="p">))</span>

    <span class="n">c</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s1">&#39;DejaVuSans&#39;</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">drawString</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Καλημέρα ελλάδα.&quot;</span><span class="p">)</span>

    <span class="n">c</span><span class="o">.</span><span class="n">showPage</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
<p>The above was just a scratch on the surface of ReportLab, mainly to be confident that
everything <em>will</em> work fine for non-english speaking people! To find out more, you should check the  <a class="reference external" href="http://www.reportlab.com/docs/reportlab-userguide.pdf">ReportLab open-source User Guide</a>.</p>
<p>I also have to mention that
<a class="reference external" href="http://reportlab.com/">the company behind ReportLab</a> offers some great commercial solutions based on ReportLab for creating PDFs (similar to <a class="reference external" href="http://community.jaspersoft.com/project/jasperreports-library">JasperReports</a>) - check it out
if you need support or advanced&nbsp;capabilities.</p>
</div>
<div class="section" id="xhtml2pdf">
<h3><a class="toc-backref" href="#toc-entry-4">xhtml2pdf</a></h3>
<p>The xhtml2pdf is a really great library that allows you to use html files as a template
to a <span class="caps">PDF</span>. Of course, an html cannot always be converted to a <span class="caps">PDF</span> since,
unfortunately, PDFs <em>do</em> have&nbsp;pages.</p>
<p>xhtml2pdf has a nice executable script that can be used to test its capabilities. After
you install it (either globally or to a virtual environment) you should be able to find
out the executable <tt class="docutils literal">$<span class="caps">PYTHON</span>/scripts/xhtml2pdf</tt> (or <tt class="docutils literal">xhtml2pdf.exe</tt> if you are in
Windows) and a corresponding python script &#64; <tt class="docutils literal"><span class="pre">$<span class="caps">PYTHON</span>/scripts/xhtml2pdf-script.py</span></tt>.</p>
<p>Let&#8217;s try to use xhtml2pdf to explore some of its capabilities. Create a file named
testxhtml2pdf.html with the following contents and run <tt class="docutils literal">xhtml2pdf testxhtml2pdf.html</tt>:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Testing xhtml2pdf <span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Hello, world!<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">i</span><span class="p">&gt;</span>Hello, italics<span class="p">&lt;/</span><span class="nt">i</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Καλημέρα Ελλάδα!<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus nulla erat, porttitor ut venenatis eget,
    tempor et purus. Nullam nec erat vel enim euismod auctor et at nisl. Integer posuere bibendum condimentum. Ut
    euismod velit ut porttitor condimentum. In ullamcorper nulla at lectus fermentum aliquam. Nunc elementum commodo
    dui, id pulvinar ex viverra id. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos
    himenaeos.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Interdum et malesuada fames ac ante ipsum primis in faucibus. Sed aliquam vitae lectus sit amet accumsan. Morbi
    nibh urna, condimentum nec volutpat at, lobortis sit amet odio. Etiam quis neque interdum sapien cursus ornare. Cras
    commodo lacinia sapien nec porta. Suspendisse potenti. Nulla hendrerit dolor et rutrum consectetur.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span>  <span class="na">width</span><span class="o">=</span><span class="s">&quot;26&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;20&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;data:image/gif;base64,R0lGODlhEAAOALMAAOazToeHh0tLS/7LZv/0jvb29t/f3//Ub//ge8WSLf/</span>
<span class="s">    rhf/3kdbW1mxsbP//mf///yH5BAAAAAAALAAAAAAQAA4AAARe8L1Ekyky67QZ1hLnjM5UUde0ECwLJoExKcppV0aCcGCmTIHEIUEqjgaORCMxIC6e0C</span>
<span class="s">    cguWw6aFjsVMkkIr7g77ZKPJjPZqIyd7sJAgVGoEGv2xsBxqNgYPj/gAwXEQA7&quot;</span>  <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>header0<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>header1<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>header2<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>header3<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>header4<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>header5<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>Please notice the <tt class="docutils literal">&lt;meta <span class="pre">http-equiv=&quot;Content-Type&quot;</span> <span class="pre">content=&quot;text/html;</span> <span class="pre">charset=utf-8&quot;</span> /&gt;</tt> in the above <span class="caps">HTML</span> &#8212; also it is saved as
Unicode (Encoding - Covert to <span class="caps">UTF</span>-8 in Notepad++). The result (<tt class="docutils literal">testxhtml2pdf.pdf</tt>) should&nbsp;have:</p>
<ul class="simple">
<li>A nice header&nbsp;(h1)</li>
<li>Paragraphs</li>
<li>Horizontal&nbsp;lines</li>
<li>No support for greek characters (same problem as with&nbsp;reportlab)</li>
<li>Images (I am inlining it as a base 64&nbsp;image)</li>
<li>A&nbsp;list</li>
<li>A&nbsp;table</li>
</ul>
<p>Before moving on, I&#8217;d like to fix the problem with the greek characters. You should
set the font to one supporting greek characters, just like you did with ReportLab before.
This can be done with the help of the <tt class="docutils literal"><span class="pre">&#64;font-face</span></tt> <a class="reference external" href="https://github.com/xhtml2pdf/xhtml2pdf/blob/master/doc/usage.rst#fonts">css directive</a>. So, let&#8217;s create
a file named <tt class="docutils literal">testxhtml2pdf2.html</tt> with the following&nbsp;contents:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">@</span><span class="k">font-face</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">font-family</span><span class="o">:</span><span class="w"> </span><span class="nt">DejaVuSans</span><span class="o">;</span>
<span class="w">            </span><span class="nt">src</span><span class="o">:</span><span class="w"> </span><span class="nt">url</span><span class="o">(</span><span class="s2">&quot;c:/progr/py/django-pdf-guide/django_pdf_guide/DejaVuSans.ttf&quot;</span><span class="o">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="n">DejaVuSans</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Δοκιμή του xhtml2pdf <span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Καλημέρα Ελλάδα!<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>Before running <tt class="docutils literal">xhtml2pdf testxhtml2pdf2.html</tt>, please make
sure to change the url of the font file above to the absolute path of that font in your
local system . As a result, after running xhhtml2pdf
you
should see the unicode characters without&nbsp;problems.</p>
<p>I have to mention here that I wasn&#8217;t able to use the font from a relative path, that&#8217;s
why I used the absolute one. In case something is not right, try
running it with the <tt class="docutils literal"><span class="pre">-d</span></tt> option to output debugging information (something like
<tt class="docutils literal">xhtml2pdf <span class="pre">-d</span> testxhtml2pdf2.html</tt>). You must see a line like this&nbsp;one:</p>
<pre class="code literal-block">
DEBUG [xhtml2pdf] C:\progr\py\django-pdf-guide\venv\lib\site-packages\xhtml2pdf\context.py line 857: Load font 'c:\\progr\\py\\django-pdf-guide\\django_pdf_guide\\DejaVuSans.ttf'
</pre>
<p>to make sure that the font is actually&nbsp;loaded!</p>
</div>
<div class="section" id="pypdf2">
<h3><a class="toc-backref" href="#toc-entry-5">PyPDF2</a></h3>
<p>The PyPDF2 library can be used to extract pages from a <span class="caps">PDF</span> to a new one
or combine pages from different PDFs to a a new one. A common requirement is
to have the first and page of a report as static PDFs, create the contents
of this report through your app as a <span class="caps">PDF</span> and combine all three PDFs (front page,
content and back page) to the resulting <span class="caps">PDF</span>.</p>
<p>Let&#8217;s see a quick example of combining two&nbsp;PDFs:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyPDF2</span><span class="w"> </span><span class="kn">import</span> <span class="n">PdfFileMerger</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">pdfs</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">pdfs</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">pdfs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Please enter at least two pdfs for merging!&quot;</span><span class="p">)</span>

    <span class="n">merger</span> <span class="o">=</span> <span class="n">PdfFileMerger</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">pdf</span> <span class="ow">in</span> <span class="n">pdfs</span><span class="p">:</span>
        <span class="n">merger</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>

    <span class="n">output</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;output.pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
    <span class="n">merger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
<p>The above will try to open all input parameters (as files) and append them to a the&nbsp;output.pdf.</p>
</div>
</div>
<div class="section" id="django-integration">
<h2><a class="toc-backref" href="#toc-entry-6">Django&nbsp;integration</a></h2>
<p>To integrate the <span class="caps">PDF</span> creation process with django we&#8217;ll use a simple app with only one model about books. We are
going to use the django-xhtml2pdf library &#8212; I recommend installing the latest version (from github
using something like <tt class="docutils literal">pip install <span class="pre">-e</span> <span class="pre">git+https://github.com/chrisglass/django-xhtml2pdf.git#egg=django-xhtml2pdf</span></tt>
) since the pip package has not been updated in a long&nbsp;time!</p>
<div class="section" id="using-a-plain-old-view">
<h3><a class="toc-backref" href="#toc-entry-7">Using a plain old&nbsp;view</a></h3>
<p>The simplest case is to just create plain old view to display the <span class="caps">PDF</span>. We&#8217;ll use django-xhtml2pdf along with the
followig django&nbsp;template:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Books<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>ID<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        {% for book in books %}
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ book.id }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ book.title }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        {% endfor %}
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>Name it as <tt class="docutils literal">books_plain_old_view.html</tt> and put it on <tt class="docutils literal">books/templates</tt> directory. The view that
returns the above template as <span class="caps">PDF</span> is the&nbsp;following:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.http</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_xhtml2pdf.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_pdf</span>


<span class="k">def</span><span class="w"> </span><span class="nf">books_plain_old_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;books&#39;</span><span class="p">:</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">generate_pdf</span><span class="p">(</span><span class="s1">&#39;books_plain_old_view.html&#39;</span><span class="p">,</span> <span class="n">file_object</span><span class="o">=</span><span class="n">resp</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
<p>We just use the <tt class="docutils literal">generate_pdf</tt> method of django-xhtml2pdf to help us generate the <span class="caps">PDF</span>, passing it
our response object and a context dictionary (containing all&nbsp;books).</p>
<p>Instead of the simple <span class="caps">HTTP</span> response above, we could add a &#8216;Content Disposition&#8217; <span class="caps">HTTP</span> header to
our response
(or use the django-xhtml2pdf method <tt class="docutils literal">render_to_pdf_response</tt> instead of <tt class="docutils literal">generate_pdf</tt>)
to suggest a default filename for the file to be saved by adding the&nbsp;line</p>
<pre class="code literal-block">
resp['Content-Disposition'] = 'attachment; filename=&quot;output.pdf&quot;'
</pre>
<p>after the definition of <tt class="docutils literal">resp</tt>.</p>
<p>This will have the extra effect, at least in Chrome and Firefox to show the &#8220;Save File&#8221; dialog
when clicking on the link instead of retrieving the <span class="caps">PDF</span> and displaying it inside* the browser&nbsp;window.</p>
</div>
<div class="section" id="using-a-cbv">
<h3><a class="toc-backref" href="#toc-entry-8">Using a <span class="caps">CBV</span></a></h3>
<p>I don&#8217;t really recommend using plain old Django views - instead I propose to always use Class Based Views
for their DRYness. The best approach is to create a mixin that would allow any kind of <span class="caps">CBV</span> (at least any
kind of <span class="caps">CBV</span> that uses a template) to be rendered in <span class="caps">PDF</span>. Here&#8217;s how we could implement a <tt class="docutils literal">PdfResponseMixin</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PdfResponseMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">):</span>
        <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">()</span>
        <span class="n">template</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_names</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">generate_pdf</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">file_object</span><span class="o">=</span><span class="n">resp</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
<p>Now, we could use this mixin to create <span class="caps">PDF</span> outputting views from any other view! For example, here&#8217;s how
we could create a book list in&nbsp;pdf:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">BookPdfListView</span><span class="p">(</span><span class="n">PdfResponseMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;books&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
</pre></div>
<p>To display it, you could use the same template as <tt class="docutils literal">books_plain_old_view.html</tt> (so either add a <tt class="docutils literal"><span class="pre">template_name='books_plain_old_view.html'</span></tt>
property to the class or copy <tt class="docutils literal">books_plain_old_view.html</tt> to <tt class="docutils literal">books/book_list.html</tt>).</p>
<p>Also, as another example, here&#8217;s a <tt class="docutils literal">BookPdfDetailView</tt> that outputs <span class="caps">PDF</span>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">BookPdfDetailView</span><span class="p">(</span><span class="n">PdfResponseMixin</span><span class="p">,</span> <span class="n">DetailView</span><span class="p">):</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;book&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
</pre></div>
<p>and a corresponding template (name it <tt class="docutils literal">books/book_detail.html</tt>):</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Book Detail<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>ID<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>: <span class="cp">{{</span> <span class="nv">book.id</span> <span class="cp">}}</span> <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>: <span class="cp">{{</span> <span class="nv">book.title</span> <span class="cp">}}</span> <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>To add the content-disposition header and a name for your <span class="caps">PDF</span>, you can use the following&nbsp;mixin:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PdfResponseMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">):</span>
    <span class="n">pdf_name</span> <span class="o">=</span> <span class="s2">&quot;output&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_pdf_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf_name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">):</span>
        <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">()</span>
        <span class="n">template</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_names</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
        <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;attachment; filename=&quot;</span><span class="si">{0}</span><span class="s1">.pdf&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pdf_name</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">generate_pdf</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">file_object</span><span class="o">=</span><span class="n">resp</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
<p>You see that, in order to havea configurable output name for our <span class="caps">PDF</span> and be consistent with the other
django CBVs, a <tt class="docutils literal">pdf_name</tt> class attribute and a <tt class="docutils literal">get_pdf_name</tt> instance method are added. When
using the above mixin in your classes you can either provide a value for <tt class="docutils literal">pdf_name</tt> (to use the same for all
your instances), or override <tt class="docutils literal">get_pdf_name</tt> to have a dynamic&nbsp;value!</p>
</div>
<div class="section" id="how-does-django-xhtml2pdf-loads-resources">
<h3><a class="toc-backref" href="#toc-entry-9">How does django-xhtml2pdf loads&nbsp;resources</a></h3>
<p>Before doing more advanced things, we need to understand how <tt class="docutils literal"><span class="pre">django-xhtml2pdf</span></tt> works and specifically
how we can refer to things like css, images, fonts etc from our <span class="caps">PDF</span> templates.
If you check the <a class="reference external" href="https://github.com/chrisglass/django-xhtml2pdf/blob/master/django_xhtml2pdf/utils.py">utils.py of django-xhtml2pdf</a> you&#8217;ll see that it uses a function named <tt class="docutils literal">fetch_resources</tt>
for loading these resources. This function checks to see if the resource starts with <tt class="docutils literal">/MEDIA_URL</tt> or
<tt class="docutils literal">/STATIC_URL</tt> and converts it to a local (filesystem) path. For example, if you refer to a font like
<tt class="docutils literal">/static/font1.ttf</tt> in your <span class="caps">PDF</span> template, <tt class="docutils literal">xhtml2pdf</tt> will try to load the file <tt class="docutils literal">STATIC_ROOT + /font1.ttf</tt>
(and if it does not find the file you want to refer to there it will check all <tt class="docutils literal">STATICFILES_DIRS</tt> entries).</p>
<p>Thus, you can just put your resources into your <tt class="docutils literal">STATIC_ROOT</tt> directory and use the <tt class="docutils literal">{% static %}</tt>
template tag to create <span class="caps">URL</span> paths for them &#8212; django-xhtml2pdf will convert these to local paths and
everything will work&nbsp;fine.</p>
<p><strong>Please notice that you *need* to have configured &#8220;STATIC_ROOT&#8220; for this to work</strong> &#8212; if <tt class="docutils literal">STATIC_ROOT</tt> is
empty (and, for example you use <tt class="docutils literal">static</tt> directories in your apps) then the described substitution
mechanism will <em>not</em> work. Also, notice that the <tt class="docutils literal">/static</tt> directory inside your apps <em>cannot be used</em>
for fetch resources like this
(due to how <tt class="docutils literal">fetch_resources</tt> is implemented it only checks if the static resource is contained inside
the <tt class="docutils literal">STATIC_ROOT</tt> or in one of the the <tt class="docutils literal">STATICFILES_DIRS</tt>) so be careful to either put the static files
you need to load from PDFs (fonts, styles and possibly images) to either the <tt class="docutils literal">STATIC_ROOT</tt> or the
one of the <tt class="docutils literal">STATICFILES_DIRS</tt>.</p>
</div>
<div class="section" id="using-a-common-style-for-your-pdfs">
<h3><a class="toc-backref" href="#toc-entry-10">Using a common style for your&nbsp;PDFs</a></h3>
<p>If you need to create a lot of similar PDFs then you&#8217;ll probably want to
use a bunch of common styles for them (same fonts, headers etc). This could be done using
the <tt class="docutils literal">{% static %}</tt> trick we saw on the previous section. However, if we include the
styling css as a static file then we won&#8217;t be able to use the static-file-uri-to-local-path
mechanism described above (since the <tt class="docutils literal">{% static %}</tt> template tag won&#8217;t work in static&nbsp;files).</p>
<p>Thankfully, not everything is lost &#8212; Django comes to the rescue!!! We can create a single <span class="caps">CSS</span> file
that would be used by all our <span class="caps">PDF</span> templates and <em>include</em> it in the templates using the <tt class="docutils literal">{% include %}</tt> Django
template tag! Django will think that this will be a normal template and paste its contents where we wanted and
also execute the templates&nbsp;tags!</p>
<p>We&#8217;ll see an example of all this in the next&nbsp;section.</p>
</div>
<div class="section" id="changing-the-font-to-a-unicode-enabled-one">
<h3><a class="toc-backref" href="#toc-entry-11">Changing the font (to a Unicode enabled&nbsp;one)</a></h3>
<p>The time has finally arrived to change the font! It&#8217;s easy if you know exactly what to do. First of all
configure your <tt class="docutils literal">STATIC_ROOT</tt> and <tt class="docutils literal">STATIC_URL</tt> setting, for example <tt class="docutils literal">STATIC_ROOT = <span class="pre">os.path.join(BASE_DIR,'static')</span></tt>
and <tt class="docutils literal">STATIC_URL = '/static/'</tt>.</p>
<p>Then, add a template-css file for your fonts in one of your templates directories. I am naming the
file <tt class="docutils literal">pdfstylefonts.css</tt> and I&#8217;ve put it to <tt class="docutils literal">books/templates</tt>:</p>
<div class="highlight"><pre><span></span><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">load</span><span class="w"> </span><span class="err">static</span><span class="w"> </span><span class="err">%</span><span class="p">}</span>
<span class="p">@</span><span class="k">font-face</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">font-family</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Calibri&quot;</span><span class="o">;</span>
<span class="w">    </span><span class="nt">src</span><span class="o">:</span><span class="w"> </span><span class="nt">url</span><span class="o">(</span><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">static</span><span class="w"> </span><span class="err">&quot;fonts/calibri.ttf&quot;</span><span class="w"> </span><span class="err">%</span><span class="p">}</span><span class="o">);</span>
<span class="p">}</span>
<span class="p">@</span><span class="k">font-face</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">font-family</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Calibri&quot;</span><span class="o">;</span>
<span class="w">    </span><span class="nt">src</span><span class="o">:</span><span class="w"> </span><span class="nt">url</span><span class="o">(</span><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">static</span><span class="w"> </span><span class="err">&quot;fonts/calibrib.ttf&quot;</span><span class="w"> </span><span class="err">%</span><span class="p">}</span><span class="o">);</span>
<span class="w">    </span><span class="nt">font-weight</span><span class="o">:</span><span class="w"> </span><span class="nt">bold</span><span class="o">;</span>
<span class="p">}</span>
<span class="p">@</span><span class="k">font-face</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">font-family</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Calibri&quot;</span><span class="o">;</span>
<span class="w">    </span><span class="nt">src</span><span class="o">:</span><span class="w"> </span><span class="nt">url</span><span class="o">(</span><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">static</span><span class="w"> </span><span class="err">&quot;fonts/calibrii.ttf&quot;</span><span class="w"> </span><span class="err">%</span><span class="p">}</span><span class="o">);</span>
<span class="w">    </span><span class="nt">font-style</span><span class="o">:</span><span class="w"> </span><span class="nt">italic</span><span class="o">,</span><span class="w"> </span><span class="nt">oblique</span><span class="o">;</span>
<span class="p">}</span>
<span class="p">@</span><span class="k">font-face</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">font-family</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Calibri&quot;</span><span class="o">;</span>
<span class="w">    </span><span class="nt">src</span><span class="o">:</span><span class="w"> </span><span class="nt">url</span><span class="o">(</span><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">static</span><span class="w"> </span><span class="err">&quot;fonts/calibriz.ttf&quot;</span><span class="w"> </span><span class="err">%</span><span class="p">}</span><span class="o">);</span>
<span class="w">    </span><span class="nt">font-weight</span><span class="o">:</span><span class="w"> </span><span class="nt">bold</span><span class="o">;</span>
<span class="w">    </span><span class="nt">font-style</span><span class="o">:</span><span class="w"> </span><span class="nt">italic</span><span class="o">,</span><span class="w"> </span><span class="nt">oblique</span><span class="o">;</span>
<span class="p">}</span>
</pre></div>
<p>I am using Calibri family of fonts (copied from <tt class="docutils literal"><span class="pre">c:\windows\fonts</span></tt>) for this &#8212; I&#8217;ve also configured
all styles (bold, italic, bold-italic) of this font family to use the correct ttf files. All the
ttf files have been copied to the directory <tt class="docutils literal">static/fonts/</tt>.</p>
<p>Now, add another css file that will be your global <span class="caps">PDF</span> styles. This should be put to the <tt class="docutils literal">static</tt> directory
and could be named <tt class="docutils literal">pdfstyle.css</tt>:</p>
<div class="highlight"><pre><span></span><span class="nt">h1</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">blue</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">*,</span><span class="w"> </span><span class="nt">html</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Calibri&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="mi">11</span><span class="kt">pt</span><span class="p">;</span>
<span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">red</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>Next, here&#8217;s a template that lists all books (and contain some greek characters &#8212; the title of the books also contain
greek characters) &#8212; I&#8217;ve named it <tt class="docutils literal">book_list_ex.html</tt>:</p>
<div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="w">        </span><span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;pdfstylefonts.css&quot;</span> <span class="cp">%}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#39;stylesheet&#39;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s2">&quot;pdfstyle.css&quot;</span> <span class="cp">%}</span><span class="s">&#39;</span><span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Λίστα βιβλίων<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s2">&quot;pony.png&quot;</span> <span class="cp">%}</span><span class="s">&#39;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>ID<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Cover<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">book</span> <span class="k">in</span> <span class="nv">books</span> <span class="cp">%}</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">book.id</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">book.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">book.cover.url</span> <span class="cp">}}</span><span class="s">&#39;</span> <span class="p">/&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>You&#8217;ll see that the <tt class="docutils literal">pdfstylefonts.css</tt> is included as a Django template (so that <tt class="docutils literal">{% static %}</tt> will
work in that file) while <tt class="docutils literal">pdfstyle.css</tt> is included using <tt class="docutils literal">{% static %}</tt>.
Als, notice that I&#8217;ve also added a static image (using the <tt class="docutils literal">{% static %}</tt> tag) and a dynamic (media)
file to show off how great the url-to-local-path mechanism works. Please notice that for the
media files to work fine in your development environment you need to configure the
<tt class="docutils literal">MEDIA_URL</tt> and <tt class="docutils literal">MEDIA_ROOT</tt> settigns (similar to <tt class="docutils literal">STATIC_URL</tt> and <tt class="docutils literal">STATIC_ROOT</tt>) and follow the
<a class="reference external" href="https://docs.djangoproject.com/en/1.8/howto/static-files/#serving-files-uploaded-by-a-user-during-development">serve files uploaded by a user during development</a> tutorial on Django&nbsp;docs.</p>
<p>Finally, if you configure a PdfResponseMixin ListView like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">BookExPdfListView</span><span class="p">(</span><span class="n">PdfResponseMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;books&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;books/book_list_ex.html&#39;</span>
</pre></div>
<p>you should see be able to see the correct (calibri) font (defined in <tt class="docutils literal">pdfstylefonts.css</tt>), with unicode characters without problems
including both the static and user uploaded images and with the styles defined in the pdf stylesheet (<tt class="docutils literal">pdfstyle.css</tt>).</p>
</div>
<div class="section" id="configure-django-for-debugging-pdf-creation">
<h3><a class="toc-backref" href="#toc-entry-12">Configure Django for debugging <span class="caps">PDF</span>&nbsp;creation</a></h3>
<p>If you experience any problems, you can configure xhtml2pdf to output <span class="caps">DEBUG</span> information. To do this,
you may change your django logging configuration like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;console&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;logging.StreamHandler&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;xhtml2pdf&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;console&#39;</span><span class="p">],</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>This configuration will keep existing loggers (<tt class="docutils literal">'disable_existing_loggers': False,</tt>) and will configure
<tt class="docutils literal">xhtml2pdf</tt> to log its output to the console, helping us find out why some things won&#8217;t be&nbsp;working.</p>
</div>
<div class="section" id="concatenating-pdfs-in-django">
<h3><a class="toc-backref" href="#toc-entry-13">Concatenating PDFs in&nbsp;Django</a></h3>
<p>The final section of the <span class="caps">PDF</span>-Django-integration is to explain how we can concatenate PDFs in django using PyPDF2. There may be
some other requirements like extracting pages from PDFs however the most common one as explained before is to just append
the pages of one <span class="caps">PDF</span> after the other &#8212; after all using PyPDF2 is really easy after you get the hang of&nbsp;it.</p>
<p>To be more <span class="caps">DRY</span>, I will create a <tt class="docutils literal">CoverPdfResponseMixin</tt> that will output a <span class="caps">PDF</span> <em>with</em> a cover. To be <em>even more</em> <span class="caps">DRY</span>,
I will refactor <tt class="docutils literal">PdfResponseMixin</tt> to put some common code in an extra method so that <tt class="docutils literal">CoverPdfResponseMixin</tt> could inherit from&nbsp;it:</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PdfResponseMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_object</span><span class="p">,</span> <span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">()</span>
        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_names</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">generate_pdf</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">file_object</span><span class="o">=</span><span class="n">file_object</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_pdf</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span>


<span class="k">class</span><span class="w"> </span><span class="nc">CoverPdfResponseMixin</span><span class="p">(</span><span class="n">PdfResponseMixin</span><span class="p">,</span> <span class="p">):</span>
    <span class="n">cover_pdf</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">):</span>
        <span class="n">merger</span> <span class="o">=</span> <span class="n">PdfFileMerger</span><span class="p">()</span>
        <span class="n">merger</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cover_pdf</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>

        <span class="n">pdf_fo</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_pdf</span><span class="p">(</span><span class="n">pdf_fo</span><span class="p">)</span>
        <span class="n">merger</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdf_fo</span><span class="p">)</span>

        <span class="n">resp</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
        <span class="n">merger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span>
</pre></div>
<p>So, <tt class="docutils literal">PdfResponseMixin</tt> now has a <tt class="docutils literal">write_pdf</tt> method that gets a file-like object and outputs the <span class="caps">PDF</span> there.
The new mixin, <tt class="docutils literal">CoverPdfResponseMixin</tt> has a <tt class="docutils literal">cover_pdf</tt> attribute that should be configured with the filesystem
path of the cover file. The <tt class="docutils literal">render_to_response</tt> method now will create a <tt class="docutils literal">PdfFileMerger</tt> (which is empty
initially) to which it appends the contents <tt class="docutils literal">cover_pdf</tt>. After that, it creates a file-stream (using StreamIO)
and uses <tt class="docutils literal">write_pdf</tt> to create the <span class="caps">PDF</span> there and appends that file-stream to the merger. Finally, it writes
the merger contents to the <tt class="docutils literal">HttpResponse</tt>.</p>
<p>One thing that I&#8217;ve seen is that if you want to concatenate many PDFs with many pages sometimes you&#8217;ll get
a strange an error when using <tt class="docutils literal">PdfFileMerger</tt>. I was able to overcome this by reading and appending the pages of each
<span class="caps">PDF</span> to-be-appended one by one using the <tt class="docutils literal">PdfFileReader</tt> and <tt class="docutils literal">PdfFileWriter</tt> objects. Here&#8217;s a small snippet of how
this could be&nbsp;done:</p>
<div class="highlight"><pre><span></span><span class="n">pdfs</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># List of pdfs to be concatenated</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">PdfFileWriter</span><span class="p">()</span>

<span class="k">for</span> <span class="n">pdf</span> <span class="ow">in</span> <span class="n">pdfs</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">PdfFileReader</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">getNumPages</span><span class="p">()):</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">addPage</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">getPage</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
<span class="k">return</span> <span class="n">resp</span>
</pre></div>
</div>
</div>
<div class="section" id="more-advanced-xhtml2pdf-features">
<h2><a class="toc-backref" href="#toc-entry-14">More advanced xhtml2pdf&nbsp;features</a></h2>
<p>In this section I will present some information on how to use various xhtml2pdf features
to create the most common required printed document features, for example adding page
numbers, adding headers and footers&nbsp;etc.</p>
<div class="section" id="laying-out">
<h3><a class="toc-backref" href="#toc-entry-15">Laying&nbsp;out</a></h3>
<p>To find out how you can create your pages you should read the
<a class="reference external" href="https://github.com/xhtml2pdf/xhtml2pdf/blob/master/doc/usage.rst#defining-page-layouts">defining page layouts</a> section of the xhtml2pdf manual. There
you&#8217;ll see that the basic components of laying out in xhtml2pdf is
&#64;page to create pages and &#64;frames to create rectangular components
inside these pages. So each page will have a number of frames
inside it. These frames are seperated to static and dynamic. Staticsome
should be used for things like headers
and footers (so they&#8217;ll be the same across all pages) and dynamic will
contain the main content of the&nbsp;report.</p>
<p>For pages you can use any page size you want, not just the specified ones. For example, in one of my
projects I wanted to create a <span class="caps">PDF</span> print on a normal plastic card, so I&#8217;d used the
following <tt class="docutils literal">size: 8.56cm 5.398cm;</tt>. Also, page templates can be named
and you can use different ones in the same <span class="caps">PDF</span> (so you could create
a cover page with a different page template, use it first and then continue
with the normal pages). To name a tempalte you just use &#64;page template_name {}
and to change the template use the combination of the following two xhtml2pdf&nbsp;tags:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">pdf:nexttemplate</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;back_page&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">pdf:nextpage</span> <span class="p">/&gt;</span>
</pre></div>
<p>Now, one thing I&#8217;ve noticed is that you are not able to use a named template for the first
page of your <span class="caps">PDF</span>. So, what I&#8217;ve done is that I create an anonymous (default) page for the
first page of the report. If I want to <em>reuse</em> it in another page, I copy it and name it
accordingly. I will give an example&nbsp;shortly.</p>
<p>Now, for frames, I recommend using the <tt class="docutils literal"><span class="pre">-pdf-frame-border:</span> 1;</tt> command for debugging where
they are actually printed. Also, I recommend using a normal ruler and measuring completely
where you want them to be. For example, for the following&nbsp;frame:</p>
<div class="highlight"><pre><span></span><span class="p">@</span><span class="k">frame</span><span class="w"> </span><span class="nt">photo_frame</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">-pdf-frame-border</span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="o">;</span>
<span class="w">        </span><span class="nt">top</span><span class="o">:</span><span class="w">  </span><span class="nt">2</span><span class="p">.</span><span class="nc">4cm</span><span class="o">;</span>
<span class="w">        </span><span class="nt">left</span><span class="o">:</span><span class="w"> </span><span class="nt">6</span><span class="p">.</span><span class="nc">2cm</span><span class="o">;</span>
<span class="w">        </span><span class="nt">width</span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="p">.</span><span class="nc">9cm</span><span class="o">;</span>
<span class="w">        </span><span class="nt">height</span><span class="o">:</span><span class="w"> </span><span class="nt">2</span><span class="p">.</span><span class="nc">2cm</span><span class="o">;</span>
<span class="p">}</span>
</pre></div>
<p>I&#8217;d used a ruler to find out that I want it to start 2.4 cm from the top of my page (actually a credit card)
and 6.2 cm from the left and have a width and height of 1.9 and 2.2&nbsp;cm.</p>
<p>I recommend naming all frames to be able to distinguish them however I don&#8217;t think that their name plays
any other role. However, for static frames you must define the id of the content they will contain using <tt class="docutils literal"><span class="pre">-pdf-frame-content</span></tt>
in the css and a div with the corresponding id in the <span class="caps">PDF</span> template. For example, you could define a frame header like&nbsp;this</p>
<div class="highlight"><pre><span></span><span class="p">@</span><span class="k">frame</span><span class="w"> </span><span class="nt">header</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">-pdf-frame-content</span><span class="o">:</span><span class="w"> </span><span class="nt">headerContent</span><span class="o">;</span>
<span class="w">  </span><span class="nt">width</span><span class="o">:</span><span class="w"> </span><span class="nt">8in</span><span class="o">;</span>
<span class="w">  </span><span class="nt">top</span><span class="o">:</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">5cm</span><span class="o">;</span>
<span class="w">  </span><span class="nt">margin-left</span><span class="o">:</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">5cm</span><span class="o">;</span>
<span class="w">  </span><span class="nt">margin-right</span><span class="o">:</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">5cm</span><span class="o">;</span>
<span class="w">  </span><span class="nt">height</span><span class="o">:</span><span class="w"> </span><span class="nt">2cm</span><span class="o">;</span>
<span class="p">}</span>
</pre></div>
<p>and its content like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;headerContent&#39;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span> <span class="p">&gt;</span>
    Header !
  <span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>Please notice that if for some reason the stuff you want to put in your static frames does not fit there the frame will
be totally empty. This means that if you have size for three lines but you want to output five lines in a static frame
then you&#8217;ll see no&nbsp;lines!</p>
<p>Now, for dynamic content you can expect the opposite behavior:
You <em>cannot</em> select to which dynamic frame your content goes, instead the content just just flows to the first dynamic frame it
fits! If it does not fit in any dynamic frames in the current page then a new page will be&nbsp;created.</p>
<p>I&#8217;d like to present a full example here on the already mentioned project of printing a plastic card for the books. I had two page layouts,
one for the front page having a frame with the owner&#8217;s data and another frame with his photo and one for the back page having
a barcode. This is a Django template that is used to print not only but a <span class="caps">PDF</span> with a group of these&nbsp;cards:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="w">    </span><span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;pdfstylefonts.css&quot;</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span> <span class="na">type</span><span class="o">=</span><span class="s">&#39;text/css&#39;</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">@</span><span class="k">page</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">size</span><span class="o">:</span><span class="w"> </span><span class="nt">8</span><span class="p">.</span><span class="nc">56cm</span><span class="w"> </span><span class="nt">5</span><span class="p">.</span><span class="nc">398cm</span><span class="o">;</span>
<span class="w">        </span><span class="nt">margin</span><span class="o">:</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span><span class="o">;</span>
<span class="w">        </span><span class="nt">padding</span><span class="o">:</span><span class="w"> </span><span class="nt">0</span><span class="o">;</span>

<span class="w">        </span><span class="p">@</span><span class="k">frame</span><span class="w"> </span><span class="nt">table_frame</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c">/* -pdf-frame-border: 1; */</span>
<span class="w">            </span><span class="nt">top</span><span class="o">:</span><span class="w">  </span><span class="nt">2</span><span class="p">.</span><span class="nc">4cm</span><span class="o">;</span>
<span class="w">            </span><span class="nt">left</span><span class="o">:</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">4cm</span><span class="o">;</span>
<span class="w">            </span><span class="nt">width</span><span class="o">:</span><span class="w"> </span><span class="nt">5</span><span class="p">.</span><span class="nc">5cm</span><span class="o">;</span>
<span class="w">            </span><span class="nt">height</span><span class="o">:</span><span class="w"> </span><span class="nt">3cm</span><span class="o">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="p">@</span><span class="k">frame</span><span class="w"> </span><span class="nt">photo_frame</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c">/* -pdf-frame-border: 1; */</span>
<span class="w">            </span><span class="nt">top</span><span class="o">:</span><span class="w">  </span><span class="nt">2</span><span class="p">.</span><span class="nc">4cm</span><span class="o">;</span>
<span class="w">            </span><span class="nt">left</span><span class="o">:</span><span class="w"> </span><span class="nt">6</span><span class="p">.</span><span class="nc">2cm</span><span class="o">;</span>
<span class="w">            </span><span class="nt">width</span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="p">.</span><span class="nc">9cm</span><span class="o">;</span>
<span class="w">            </span><span class="nt">height</span><span class="o">:</span><span class="w"> </span><span class="nt">2</span><span class="p">.</span><span class="nc">2cm</span><span class="o">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">@</span><span class="k">page</span><span class="w"> </span><span class="nt">front_page</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">size</span><span class="o">:</span><span class="w"> </span><span class="nt">8</span><span class="p">.</span><span class="nc">56cm</span><span class="w"> </span><span class="nt">5</span><span class="p">.</span><span class="nc">398cm</span><span class="o">;</span>
<span class="w">        </span><span class="nt">margin</span><span class="o">:</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span><span class="o">;</span>
<span class="w">        </span><span class="nt">padding</span><span class="o">:</span><span class="w"> </span><span class="nt">0</span><span class="o">;</span>

<span class="w">        </span><span class="p">@</span><span class="k">frame</span><span class="w"> </span><span class="nt">table_frame</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c">/* -pdf-frame-border: 1; */</span>
<span class="w">            </span><span class="nt">top</span><span class="o">:</span><span class="w">  </span><span class="nt">2</span><span class="p">.</span><span class="nc">4cm</span><span class="o">;</span>
<span class="w">            </span><span class="nt">left</span><span class="o">:</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">4cm</span><span class="o">;</span>
<span class="w">            </span><span class="nt">width</span><span class="o">:</span><span class="w"> </span><span class="nt">5</span><span class="p">.</span><span class="nc">5cm</span><span class="o">;</span>
<span class="w">            </span><span class="nt">height</span><span class="o">:</span><span class="w"> </span><span class="nt">3cm</span><span class="o">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="p">@</span><span class="k">frame</span><span class="w"> </span><span class="nt">photo_frame</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c">/* -pdf-frame-border: 1; */</span>
<span class="w">            </span><span class="nt">top</span><span class="o">:</span><span class="w">  </span><span class="nt">2</span><span class="p">.</span><span class="nc">4cm</span><span class="o">;</span>
<span class="w">            </span><span class="nt">left</span><span class="o">:</span><span class="w"> </span><span class="nt">6</span><span class="p">.</span><span class="nc">2cm</span><span class="o">;</span>
<span class="w">            </span><span class="nt">width</span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="p">.</span><span class="nc">9cm</span><span class="o">;</span>
<span class="w">            </span><span class="nt">height</span><span class="o">:</span><span class="w"> </span><span class="nt">2</span><span class="p">.</span><span class="nc">2cm</span><span class="o">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">@</span><span class="k">page</span><span class="w"> </span><span class="nt">back_page</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">size</span><span class="o">:</span><span class="w"> </span><span class="nt">8</span><span class="p">.</span><span class="nc">56cm</span><span class="w"> </span><span class="nt">5</span><span class="p">.</span><span class="nc">398cm</span><span class="o">;</span>
<span class="w">        </span><span class="nt">margin</span><span class="o">:</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span><span class="w"> </span><span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span><span class="o">;</span>
<span class="w">        </span><span class="nt">padding</span><span class="o">:</span><span class="w"> </span><span class="nt">0</span><span class="o">;</span>

<span class="w">        </span><span class="p">@</span><span class="k">frame</span><span class="w"> </span><span class="nt">barcode_frame</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c">/* -pdf-frame-border: 1; */</span>
<span class="w">            </span><span class="nt">top</span><span class="o">:</span><span class="w">  </span><span class="nt">3</span><span class="p">.</span><span class="nc">9cm</span><span class="o">;</span>
<span class="w">            </span><span class="nt">left</span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="p">.</span><span class="nc">8cm</span><span class="o">;</span>
<span class="w">            </span><span class="nt">width</span><span class="o">:</span><span class="w"> </span><span class="nt">4</span><span class="p">.</span><span class="nc">9cm</span><span class="o">;</span>
<span class="w">            </span><span class="nt">height</span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="p">.</span><span class="nc">1cm</span><span class="o">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">*,</span><span class="w"> </span><span class="nt">html</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Calibri&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">pt</span><span class="p">;</span>
<span class="w">        </span><span class="k">line-height</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="kt">%</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="nc">bigger</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">font-size</span><span class="p">:</span><span class="mi">9</span><span class="kt">pt</span><span class="p">;</span>
<span class="w">        </span><span class="k">font-weight</span><span class="p">:</span><span class="w"> </span><span class="kc">bold</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">book</span> <span class="k">in</span> <span class="nv">books</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="cp">&lt;! -- Here I print the card data. It fits exactly in the table_frame so ... -&gt;</span>
            <span class="cp">{{</span> <span class="nv">book.title</span> <span class="cp">}}</span><span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 2<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 3<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 4<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 5<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 6<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 7<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 8<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 9<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 10<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="cp">&lt;! -- This photo here will be outputted to the photo_frame --&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">book.cover.url</span> <span class="cp">}}</span><span class="s">&#39;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#39;width:1.9cm ; height: 2.2cm ; &#39;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="cp">&lt;! -- Now the template is chaned to print the back of the card --&gt;</span>
        <span class="p">&lt;</span><span class="nt">pdf:nexttemplate</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;back_page&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">pdf:nextpage</span> <span class="p">/&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">center</span><span class="p">&gt;</span>
                <span class="cp">&lt;! -- Print the barcode to the barcode_frame --&gt;</span>
                <span class="p">&lt;</span><span class="nt">pdf:barcode</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">book.id</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;code128&quot;</span> <span class="na">humanreadable</span><span class="o">=</span><span class="s">&quot;1&quot;</span> <span class="na">barwidth</span><span class="o">=</span><span class="s">&quot;0.43mm&quot;</span> <span class="na">barheight</span><span class="o">=</span><span class="s">&quot;0.6cm&quot;</span> <span class="na">align</span><span class="o">=</span><span class="s">&quot;middle&quot;</span> <span class="p">/&gt;</span>
            <span class="p">&lt;/</span><span class="nt">center</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="cm">&lt;!-- Use the front_page template again for the next card --&gt;</span>
        <span class="p">&lt;</span><span class="nt">pdf:nexttemplate</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;front_page&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">pdf:nextpage</span> <span class="p">/&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>Notice that I want to print exactly 10 lines in the <tt class="docutils literal">table_frame</tt> (that&#8217;s why I use &lt;br /&gt; to go to next line) &#8212; if I had printed
3-4 lines (for example) then the photo <em>would fit</em> in the <tt class="docutils literal">table_frame</tt> and would be printed there and <em>not</em> in the <tt class="docutils literal">photo_frame</tt>! Also,
another interesting thing is that if I had
outputed 8-9 lines then the photo wouldn&#8217;t fit in that small space and would also be printed to the <tt class="docutils literal">photo_frame</tt>.</p>
</div>
<div class="section" id="extra-stuff">
<h3><a class="toc-backref" href="#toc-entry-16">Extra&nbsp;stuff</a></h3>
<p>Some extra things I want to mention concerning&nbsp;xhtml2pdf:</p>
<ul class="simple">
<li><tt class="docutils literal">&lt;pdf:pagenumber&gt;</tt> to output the current page number (please end the line after this&nbsp;tag)</li>
<li><tt class="docutils literal">&lt;pdf:pagecount&gt;</tt> to output the total page number (please end the line after this&nbsp;tag)</li>
</ul>
<p>So if you want to print a footer with the pages, I recommend something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;footerContent&#39;</span><span class="p">&gt;</span>
  Page <span class="p">&lt;</span><span class="nt">pdf:pagenumber</span><span class="p">&gt;</span>
  from <span class="p">&lt;</span><span class="nt">pdf:pagecount</span><span class="p">&gt;</span>
  total
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>Notice how the lines end after the&nbsp;tags.</p>
<ul class="simple">
<li><tt class="docutils literal">&lt;pdf:barcode&gt;</tt>: Output a barcode in your <span class="caps">PDF</span>. Here are the possible barcode types: I2of5, Standard39, Extended39, Standard93, Extended93, <span class="caps">MSI</span>, Codabar, Code11, <span class="caps">FIM</span>, <span class="caps">POSTNET</span>, USPS_4State, Code128, <span class="caps">EAN13</span>, <span class="caps">EAN8</span>, <span class="caps">QR</span>.</li>
<li>You may add a page background image using  the <tt class="docutils literal"><span class="pre">background-image</span></tt> property of <tt class="docutils literal">&#64;page</tt>.</li>
</ul>
<p>For example, if you want the templates you create from your development/<span class="caps">UAT</span> systems to be different
than the production ones you could do something like&nbsp;this:</p>
<pre class="code literal-block">
&#64;page {
    {% if DEBUG %}
        background-image: url({% static &quot;debug.png&quot; %});
    {% endif %}
    &lt;!-- Other page properties --&gt;
}
</pre>
</div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#toc-entry-17">Conclusion</a></h2>
<p>I hope that using the techniques described in this essential guide you&#8217;ll
be able to create great looking <span class="caps">PDF</span> documents from your Django application
and overcome any difficulties that may arise. If you feel that there&#8217;s something
I&#8217;ve not covered properly (and is not covered by the documentation) please comment
out and I&#8217;ll be happy to research it a bit and update the article with&nbsp;info.</p>
<p>I am using all the above in various production applications for a long time and everything
is smooth so don&#8217;t afraid to create PDFs from&nbsp;Django!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://www.spapas.net/2015/11/16/using-browserify-es6/">Improve your client-side-javascript workflow more by using ES6</a>
      </h1>
    <p class="meta">
<time datetime="2015-11-16T14:20:00+02:00" pubdate>Mon 16 November 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title"><a class="reference internal" href="#top">Contents</a></p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="toc-entry-1">Introduction</a></li>
<li><a class="reference internal" href="#npm-save-save-dev-and-avoiding-global-deps" id="toc-entry-2"><span class="caps">NPM</span>, &#8212;save, &#8212;save-dev and avoiding global&nbsp;deps</a></li>
<li><a class="reference internal" href="#using-babel" id="toc-entry-3">Using&nbsp;babel</a></li>
<li><a class="reference internal" href="#integrate-babel-with-browserify" id="toc-entry-4">Integrate babel with&nbsp;browserify</a></li>
<li><a class="reference internal" href="#the-object-spread-operator" id="toc-entry-5">The object-spread&nbsp;operator</a></li>
<li><a class="reference internal" href="#conclusion" id="toc-entry-6">Conclusion</a></li>
</ul>
</div>
<p><strong>Update 22/12/2015:</strong> Add section for the object-spread&nbsp;operator.</p>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#toc-entry-1">Introduction</a></h2>
<p>In a <a class="reference external" href="https://www.spapas.net/2015/05/27/using-browserify-watchify/">previous article</a>
we presented a simple workflow to improve your client-side (javascript) workflow
by including a bunch of tools from the node-js world i.e <a class="reference external" href="http://browserify.org/">browserify</a> and
its friends, <a class="reference external" href="https://github.com/substack/watchify">watchify</a> and <a class="reference external" href="https://www.npmjs.com/package/uglify-js">uglify-js</a>.</p>
<p>Using these tools we were able to properly manage our client side dependencies
(no more script tags in our html templates) and modularize our code
(so we could avoid monolithic javascript files that contained all our code).
Another great improvement to our workflow would be to include <span class="caps">ES6</span> to the&nbsp;mix!</p>
<p><span class="caps">ES6</span> (or EcmaScript 2015) is more or less &#8220;Javascript: <span class="caps">TNG</span>&#8221;. It has many features
that greatly improve the readability and writability of javascript code - for instance,
thick arrows, better classes, better modules, iterators/generators, template strings,
default function parameters and many others!
More info on these features and how they could be used can be found on the <a class="reference external" href="https://github.com/lukehoban/es6features">es6features</a>&nbsp;repository.</p>
<p>Unfortunately, these features are either not supported at all, or they are partially supported
on current (November 2015) browsers. However all is <em>not</em> lost yet: Since we already use browserify
to our client side workflow, we can easily enable it to read source files with <span class="caps">ES6</span> syntax
and transform them to normal javascript using a transformation through the <a class="reference external" href="https://babeljs.io/">babel</a>&nbsp;tool.</p>
<p>In the following, we&#8217;ll talk a bit more about the node-js package manager (npm) features,
talk a little about babel and finally
modify our workflow so that it will be able to use <span class="caps">ES6</span>! Please notice that to properly follow this article
you need to first read the <a class="reference external" href="https://www.spapas.net/2015/05/27/using-browserify-watchify/">previous one</a>.</p>
</div>
<div class="section" id="npm-save-save-dev-and-avoiding-global-deps">
<h2><a class="toc-backref" href="#toc-entry-2"><span class="caps">NPM</span>, &#8212;save, &#8212;save-dev and avoiding global&nbsp;deps</a></h2>
<p>In the previous article, I had recommended to install the needed tools
(needed to create the output bundle browserify, watchify, uglify) globally
using npm install -g package (of course the normal dependencies like moment.js
would be installed locally).
This has one advantage and two disadvantages: It
puts these tools to the path so they can be called immediately (i.e browserify)
but you will need root access to install a package globally and nothing is
saved on <tt class="docutils literal">package.json</tt> so you don&#8217;t know which packages must be installed
in order to start developing the&nbsp;project!</p>
<p>This could be ok for the introductionary article, however for this one I
will propose another alternative: Install all the tools <em>locally</em> using just
<tt class="docutils literal">npm install package <span class="pre">--save</span></tt>. These tools will be put to the <tt class="docutils literal">node_modules</tt> folder. They
<em>will not</em> be put to the path, but if you want to execute a binary by yourself
to debug the output, you can find it in <tt class="docutils literal">node_modules/bin</tt>, for example,
for browserify you can run <tt class="docutils literal">node_modules/bin/browserify</tt>. Another intersting
thing is that if you create executable scripts in your <tt class="docutils literal">package.json</tt> you
don&#8217;t actually need to include the full path but the binaries will be&nbsp;found.</p>
<p>Another thing I&#8217;d like to discuss here is the difference between <tt class="docutils literal"><span class="pre">--save</span></tt>
and <tt class="docutils literal"><span class="pre">--save-dev</span></tt> options that can be passed to npm install. If you take
a look at other guides you&#8217;ll see that people are using <tt class="docutils literal"><span class="pre">--save-dev</span></tt> for
development dependencies (i.e testing) and <tt class="docutils literal"><span class="pre">--save</span></tt> for normal dependencies.
The difference is that these dependencies are saved in different places in
<tt class="docutils literal">package.json</tt> and if you run <tt class="docutils literal">npm install <span class="pre">--production</span></tt> you&#8217;ll get only
the normal dependencies (while, if you run <tt class="docutils literal">npm install</tt> all dependencies
will be installed). In these articles, I chose to just use <tt class="docutils literal"><span class="pre">--save</span></tt> everywhere,
after all the only thing that would be needed for production would be the
<tt class="docutils literal">bundle.js</tt> output&nbsp;file.</p>
</div>
<div class="section" id="using-babel">
<h2><a class="toc-backref" href="#toc-entry-3">Using&nbsp;babel</a></h2>
<p>The <a class="reference external" href="https://babeljs.io/">babel</a> library &#8220;is a JavaScript compiler&#8221;. It gets input files in a variant
of javascript (for example, <span class="caps">ES6</span>) and produces normal javascript files &#8212; something
like what browserify transforms do. However, what babel does (and I think its
the only tool that does this) is that it allows you to use <span class="caps">ES6</span> features <em>now</em> by
transpiling them to normal (<span class="caps">ES5</span>) javascript. Also, babel has <a class="reference external" href="https://babeljs.io/docs/plugins/">various other transforms</a>,
including a react transform
(so you can use this instead of the reactify&nbsp;browserify-transform)!</p>
<p>In any case, to be able to use <span class="caps">ES6</span>, we&#8217;ll need to install babel and its es6 presets
(don&#8217;t forget that you need to have a <tt class="docutils literal">package.json</tt> for the dependencies to be
saved so either do an <tt class="docutils literal">npm init</tt> or create a <tt class="docutils literal">package.json</tt> file containing only
<tt class="docutils literal">{}</tt>):</p>
<pre class="code literal-block">
npm install  babel babel-preset-es2015 --save
</pre>
<p>If we wanted to also use babel for react we&#8217;d need to install&nbsp;babel-preset-react.</p>
<p>To configure babel we can either add a <tt class="docutils literal">babel</tt>
section in our <tt class="docutils literal">package.json</tt> or create a new file named .babelrc and put the configuration&nbsp;there.</p>
<p>I prefer the first one since we are already using the <tt class="docutils literal">package.json</tt>. So add the following attribute
to your <tt class="docutils literal">package.json</tt>:</p>
<pre class="code literal-block">
&quot;babel&quot;: {
  &quot;presets&quot;: [
    &quot;es2015&quot;
  ]
}
</pre>
<p>If you wanted to configure it through <tt class="docutils literal">.babelrc</tt> then you&#8217;d just copy to it the contents of <tt class="docutils literal">&quot;babel&quot;</tt>.</p>
<p>To do some tests with babel, you can install its cli (it&#8217;s not included in the babel package) through
<tt class="docutils literal">npm install <span class="pre">babel-cli</span></tt>. Now, you can run <tt class="docutils literal"><span class="pre">node_modules/.bin/babel</span></tt>. For example, create a
file named <tt class="docutils literal">testbabel.js</tt> with the following contents (thick&nbsp;arrow):</p>
<pre class="code literal-block">
[1,2,3].forEach(x =&gt; console.log(x) );
</pre>
<p>when you pass it to babel you&#8217;ll see the following&nbsp;output:</p>
<pre class="code literal-block">
&gt;node_modules\.bin\babel testbabel.js
&quot;use strict&quot;;

[1, 2, 3].forEach(function (x) {
  return console.log(x);
});
</pre>
</div>
<div class="section" id="integrate-babel-with-browserify">
<h2><a class="toc-backref" href="#toc-entry-4">Integrate babel with&nbsp;browserify</a></h2>
<p>To call babel from browserify we&#8217;re going to use the <a class="reference external" href="https://github.com/babel/babelify">babelify</a> browserify transform which
actually uses babel to transpile the browserify input. After installing it&nbsp;with</p>
<pre class="code literal-block">
npm install babelify --save
</pre>
<p>you need to tell browserify to use it. To do this, you&#8217;ll just pass a -t babelify parameter to
browserify. So if you run it with the <tt class="docutils literal">testbabel.js</tt> file as input you&#8217;ll see the following&nbsp;output:</p>
<pre class="code literal-block">
&gt;node_modules\.bin\browserify -t babelify testbabel.js
[...] browserify gibberish
&quot;use strict&quot;;

[1, 2, 3].forEach(function (x) {
  return console.log(x);
});

[...] more browserify gibberish
</pre>
<p>yey &#8212; the code is transpiled to <span class="caps">ES5</span>!</p>
<p>To create a complete project, let&#8217;s add a normal requirement&nbsp;(moment.js):</p>
<pre class="code literal-block">
npm install moment --save
</pre>
<p>and a file named <tt class="docutils literal">src\main.js</tt> that uses it with <span class="caps">ES6</span>&nbsp;syntax:</p>
<pre class="code literal-block">
import moment from 'moment';

const arr = [1,2,3,4,5];
arr.forEach(x =&gt; setTimeout(() =&gt; console.log(`Now: ${moment().format(&quot;HH:mm:ss&quot;)}, Later: ${moment().add(x, &quot;days&quot;).format(&quot;L&quot;)}...`), x*1000));
</pre>
<p>To create the output javascript file, we&#8217;ll use the browserify and watchify commands with the
addition of the -t babelify switch. Here&#8217;s the complete <tt class="docutils literal">package.json</tt> for this&nbsp;project:</p>
<pre class="code literal-block">
{
  &quot;dependencies&quot;: {
    &quot;babel&quot;: &quot;^6.1.18&quot;,
    &quot;babel-preset-es2015&quot;: &quot;^6.1.18&quot;,
    &quot;babelify&quot;: &quot;^7.2.0&quot;,
    &quot;browserify&quot;: &quot;^12.0.1&quot;,
    &quot;moment&quot;: &quot;^2.10.6&quot;,
    &quot;uglify-js&quot;: &quot;^2.6.0&quot;,
    &quot;watchify&quot;: &quot;^3.6.1&quot;
  },
  &quot;scripts&quot;: {
    &quot;watch&quot;: &quot;watchify src/main.js -o dist/bundle.js -v -t babelify&quot;,
    &quot;build&quot;: &quot;browserify src/main.js -t babelify | uglifyjs -mc warnings=false &gt; dist/bundle.js&quot;
  },
  &quot;babel&quot;: {
    &quot;presets&quot;: [
      &quot;es2015&quot;
    ]
  }
}
</pre>
<p>Running <tt class="docutils literal">npm run build</tt> should create a <tt class="docutils literal">dist/bundle.js</tt> file. If you include this in an html,
you should see something like this in the&nbsp;console:</p>
<pre class="code literal-block">
Now: 13:52:09, Later: 11/17/2015...
Now: 13:52:10, Later: 11/18/2015...
</pre>
</div>
<div class="section" id="the-object-spread-operator">
<h2><a class="toc-backref" href="#toc-entry-5">The object-spread&nbsp;operator</a></h2>
<p>Many examples in the internet use the <a class="reference external" href="https://facebook.github.io/react/docs/jsx-spread.html#spread-attributes">object spread operator</a> which is <a class="reference external" href="http://stackoverflow.com/questions/31115276/ecmascript-6-spread-operator-in-object-deconstruction-support-in-typescript-and">not part of es6</a> so our
proposed babel configuration does not support it!
To be able to use this syntax, we&#8217;ll need to install the corresponding babel plugin by using
<tt class="docutils literal">npm install <span class="pre">babel-plugin-transform-object-rest-spread</span> <span class="pre">--save</span></tt> and add it to our babel configuration
in the plugins section, something like&nbsp;this:</p>
<pre class="code literal-block">
&quot;presets&quot;: [
  &quot;es2015&quot;,
  &quot;react&quot;
],
&quot;plugins&quot;: [
  &quot;transform-object-rest-spread&quot;
]
</pre>
<p>If everything is ok this should be transpiled without errors using <tt class="docutils literal"><span class="pre">node_modules\.bin\browserify</span> testbabe.js <span class="pre">-t</span> babelify</tt></p>
<pre class="code literal-block">
let x = {a:1 , b:2 };
let y = {...x, c: 3};
</pre>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#toc-entry-6">Conclusion</a></h2>
<p>Using the combination of babel and javascript we can easily write <span class="caps">ES6</span> code in our modules! This,
along with the modularization of our code and the management of client-side dependencies should
make client side development a&nbsp;breeze!</p>
<p>Please notice that to keep the presented workflow simple and easy to
replicate and configure, we have not used any external
task runners (like gulp or grunt) &#8212; all configuration is kept in a single file (package.json) and
the whole environment can be replicated just by doing a <tt class="docutils literal">npm install</tt>. Of course, the capabilities of
browserify are not unlimited, so if you wanted to do something more complicated
(for instance, lint your code before passing it to browserify) you&#8217;d need to use the mentioned
task runners (or webpack which is the current trend in javascript bundlers and actually replaces
the task&nbsp;runners).</p>
</div>
</div>
  		</article>
<div class="pagination">
    <a class="prev" href="https://www.spapas.net/index11.html">&larr; Older</a>

    <a class="next" href="https://www.spapas.net/index9.html">Newer &rarr;</a>
  <br />
</div></div>
<aside class="sidebar">
  
  <section>
    <br />
    <a href='/feeds/all.atom.xml'>Atom</a>
    |
    <a href='/feeds/all.rss.xml'>RSS</a>
  </section>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- Sidebar unit -->
  <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7673322832689008" data-ad-slot="2720624730"
    data-ad-format="auto" data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>


  <script async src="https://cse.google.com/cse.js?cx=612920e5ca9da850c"></script>
  <div class="gcse-search"></div>

  
  <section>
    <h1>Support me</h1>

    You can show your appreciation for anything useful you've found here by 
    buying me a coffee 
    <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="spapas" data-color="#FFDD00" data-emoji=""  data-font="Lato" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script>

    or donating me some bitcoin to this address:
    <small><pre>bc1qx42vp8napheaewhnx0rk0mttdrdrtvw6czvxhl</pre></small>
    <svg shape-rendering="crispEdges" height="200" width="200" viewBox="0 0 29 29" class="qrcode">
      <path fill="#FFFFFF" d="M0,0 h29v29H0z"></path><path fill="#000000" d="M0 0h7v1H0zM9 0h2v1H9zM12 0h1v1H12zM14 0h2v1H14zM18 0h2v1H18zM22,0 h7v1H22zM0 1h1v1H0zM6 1h1v1H6zM8 1h1v1H8zM11 1h1v1H11zM14 1h5v1H14zM22 1h1v1H22zM28,1 h1v1H28zM0 2h1v1H0zM2 2h3v1H2zM6 2h1v1H6zM8 2h4v1H8zM17 2h1v1H17zM22 2h1v1H22zM24 2h3v1H24zM28,2 h1v1H28zM0 3h1v1H0zM2 3h3v1H2zM6 3h1v1H6zM9 3h2v1H9zM14 3h3v1H14zM18 3h1v1H18zM22 3h1v1H22zM24 3h3v1H24zM28,3 h1v1H28zM0 4h1v1H0zM2 4h3v1H2zM6 4h1v1H6zM8 4h1v1H8zM11 4h1v1H11zM13 4h1v1H13zM15 4h2v1H15zM18 4h1v1H18zM22 4h1v1H22zM24 4h3v1H24zM28,4 h1v1H28zM0 5h1v1H0zM6 5h1v1H6zM8 5h2v1H8zM14 5h2v1H14zM19 5h2v1H19zM22 5h1v1H22zM28,5 h1v1H28zM0 6h7v1H0zM8 6h1v1H8zM10 6h1v1H10zM12 6h1v1H12zM14 6h1v1H14zM16 6h1v1H16zM18 6h1v1H18zM20 6h1v1H20zM22,6 h7v1H22zM8 7h2v1H8zM11 7h1v1H11zM15 7h1v1H15zM17 7h2v1H17zM0 8h2v1H0zM3 8h1v1H3zM6 8h2v1H6zM10 8h1v1H10zM12 8h3v1H12zM20 8h1v1H20zM22 8h3v1H22zM26 8h2v1H26zM1 9h1v1H1zM3 9h3v1H3zM8 9h1v1H8zM10 9h1v1H10zM12 9h2v1H12zM16 9h2v1H16zM20 9h1v1H20zM22 9h1v1H22zM25 9h1v1H25zM27,9 h2v1H27zM0 10h1v1H0zM3 10h2v1H3zM6 10h1v1H6zM8 10h3v1H8zM12 10h2v1H12zM16 10h1v1H16zM19 10h1v1H19zM22 10h3v1H22zM27 10h1v1H27zM0 11h1v1H0zM2 11h1v1H2zM4 11h2v1H4zM7 11h1v1H7zM13 11h4v1H13zM18 11h4v1H18zM26 11h2v1H26zM0 12h1v1H0zM2 12h3v1H2zM6 12h1v1H6zM11 12h1v1H11zM13 12h1v1H13zM15 12h3v1H15zM20 12h1v1H20zM22 12h2v1H22zM27,12 h2v1H27zM4 13h1v1H4zM8 13h3v1H8zM12 13h1v1H12zM14 13h1v1H14zM17 13h4v1H17zM25 13h2v1H25zM0 14h1v1H0zM4 14h3v1H4zM8 14h2v1H8zM11 14h3v1H11zM16 14h1v1H16zM21 14h2v1H21zM24,14 h5v1H24zM3 15h3v1H3zM7 15h2v1H7zM10 15h1v1H10zM12 15h2v1H12zM15 15h1v1H15zM17 15h2v1H17zM20 15h2v1H20zM23 15h1v1H23zM1 16h1v1H1zM4 16h1v1H4zM6 16h4v1H6zM16 16h2v1H16zM20 16h1v1H20zM23 16h1v1H23zM25 16h1v1H25zM28,16 h1v1H28zM2 17h1v1H2zM5 17h1v1H5zM7 17h2v1H7zM11 17h3v1H11zM17 17h1v1H17zM22 17h1v1H22zM25 17h1v1H25zM27,17 h2v1H27zM0 18h1v1H0zM3 18h1v1H3zM5 18h4v1H5zM10 18h1v1H10zM12 18h1v1H12zM18 18h1v1H18zM20 18h1v1H20zM22 18h2v1H22zM25,18 h4v1H25zM2 19h3v1H2zM8 19h1v1H8zM16 19h2v1H16zM21 19h1v1H21zM23 19h1v1H23zM25 19h1v1H25zM27 19h1v1H27zM0 20h1v1H0zM2 20h5v1H2zM8 20h2v1H8zM13 20h4v1H13zM19 20h6v1H19zM26 20h1v1H26zM28,20 h1v1H28zM8 21h2v1H8zM12 21h3v1H12zM16 21h1v1H16zM20 21h1v1H20zM24 21h1v1H24zM26,21 h3v1H26zM0 22h7v1H0zM8 22h3v1H8zM17 22h1v1H17zM20 22h1v1H20zM22 22h1v1H22zM24 22h2v1H24zM27 22h1v1H27zM0 23h1v1H0zM6 23h1v1H6zM10 23h2v1H10zM13 23h2v1H13zM19 23h2v1H19zM24,23 h5v1H24zM0 24h1v1H0zM2 24h3v1H2zM6 24h1v1H6zM9 24h2v1H9zM12 24h2v1H12zM17 24h1v1H17zM20 24h6v1H20zM28,24 h1v1H28zM0 25h1v1H0zM2 25h3v1H2zM6 25h1v1H6zM8 25h3v1H8zM12 25h1v1H12zM14 25h1v1H14zM18 25h1v1H18zM22 25h3v1H22zM26 25h1v1H26zM0 26h1v1H0zM2 26h3v1H2zM6 26h1v1H6zM10 26h5v1H10zM16 26h3v1H16zM21 26h1v1H21zM24 26h1v1H24zM26 26h1v1H26zM28,26 h1v1H28zM0 27h1v1H0zM6 27h1v1H6zM8 27h3v1H8zM12 27h4v1H12zM17 27h1v1H17zM20 27h1v1H20zM23 27h2v1H23zM27 27h1v1H27zM0 28h7v1H0zM8 28h3v1H8zM14 28h1v1H14zM16 28h3v1H16zM20 28h1v1H20zM22 28h1v1H22zM24 28h2v1H24zM27 28h1v1H27z"></path>
    </svg>
  </section>
  

  <section>
    <h1>Subscribe</h1>
    Do you want to get notified via email when I post new content?
    <style>
      .subscribe-button {
        /* margin: 10px !important; */
        padding: 10px !important;
        background-color: black;
        display: inline-block;
        color: white !important;
        text-decoration: none;

        line-height: 36px !important;
        height: 37px !important;
        text-decoration: none !important;
        display: inline-block !important;
        color: #ffffff !important;
        background-color: #000000 !important;
        border-radius: 3px !important;
        border: 1px solid transparent !important;
        padding: 1px 9px !important;
        font-size: 23px !important;
        letter-spacing: 0.6px !important;
        box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
        -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
        margin: 0 auto !important;
        font-family: 'Cookie', cursive !important;
        -webkit-box-sizing: border-box !important;
        box-sizing: border-box !important;
        -o-transition: 0.3s all linear !important;
        -webkit-transition: 0.3s all linear !important;
        -moz-transition: 0.3s all linear !important;
        -ms-transition: 0.3s all linear !important;
        transition: 0.3s all linear !important;

      }
    </style>
    <a class='subscribe-button' target="_blank" href="http://eepurl.com/dxI3PP">Click here to subscribe!</a>
  </section>


  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
        <a href="https://www.spapas.net/2024/08/22/multiple-erl-elixir-windows/">Multiple Erlang/Elixir versions in Windows</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/11/29/openid-connect-tutorial/">A simple OpenID connect tutorial</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/05/23/simple-django-datatables-integration/">Simple Django - DataTables integration</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/05/22/ai-auto-subtitling/">AI auto-subtitling</a>
      </li>
      <li class="post">
        <a href="https://www.spapas.net/2023/05/12/disable-your-forms/">HTML form disable after submit</a>
      </li>
    </ul>
  </section>
  <section>

    <h1>Categories</h1>
    <ul id="recent_posts">
      <li><a href="https://www.spapas.net/category/ai.html">ai</a></li>
      <li><a href="https://www.spapas.net/category/android.html">android</a></li>
      <li><a href="https://www.spapas.net/category/clojure.html">clojure</a></li>
      <li><a href="https://www.spapas.net/category/css.html">css</a></li>
      <li><a href="https://www.spapas.net/category/django.html">django</a></li>
      <li><a href="https://www.spapas.net/category/elixir.html">elixir</a></li>
      <li><a href="https://www.spapas.net/category/flask.html">flask</a></li>
      <li><a href="https://www.spapas.net/category/gaming.html">gaming</a></li>
      <li><a href="https://www.spapas.net/category/git.html">git</a></li>
      <li><a href="https://www.spapas.net/category/html.html">html</a></li>
      <li><a href="https://www.spapas.net/category/javascript.html">javascript</a></li>
      <li><a href="https://www.spapas.net/category/networking.html">networking</a></li>
      <li><a href="https://www.spapas.net/category/pelican.html">pelican</a></li>
      <li><a href="https://www.spapas.net/category/postgresql.html">postgresql</a></li>
      <li><a href="https://www.spapas.net/category/python.html">python</a></li>
      <li><a href="https://www.spapas.net/category/spring.html">spring</a></li>
      <li><a href="https://www.spapas.net/category/unix.html">unix</a></li>
      <li><a href="https://www.spapas.net/category/wagtail.html">wagtail</a></li>
    </ul>
  </section>

  <section>
    <h1>Tags</h1>
    <a href="https://www.spapas.net/tag/erlang.html">erlang</a>,    <a href="https://www.spapas.net/tag/elixir.html">elixir</a>,    <a href="https://www.spapas.net/tag/windows.html">windows</a>,    <a href="https://www.spapas.net/tag/openid.html">openid</a>,    <a href="https://www.spapas.net/tag/openid-connect.html">openid-connect</a>,    <a href="https://www.spapas.net/tag/oidc.html">oidc</a>,    <a href="https://www.spapas.net/tag/http.html">http</a>,    <a href="https://www.spapas.net/tag/keycloak.html">keycloak</a>,    <a href="https://www.spapas.net/tag/python.html">python</a>,    <a href="https://www.spapas.net/tag/django.html">django</a>,    <a href="https://www.spapas.net/tag/jquery.html">jquery</a>,    <a href="https://www.spapas.net/tag/datatables.html">datatables</a>,    <a href="https://www.spapas.net/tag/ai.html">ai</a>,    <a href="https://www.spapas.net/tag/whisper.html">whisper</a>,    <a href="https://www.spapas.net/tag/whispercpp.html">whisper.cpp</a>,    <a href="https://www.spapas.net/tag/subtitles.html">subtitles</a>,    <a href="https://www.spapas.net/tag/video.html">video</a>,    <a href="https://www.spapas.net/tag/auto-subtitling.html">auto-subtitling</a>,    <a href="https://www.spapas.net/tag/subtitiling.html">subtitiling</a>,    <a href="https://www.spapas.net/tag/transcribe.html">transcribe</a>,    <a href="https://www.spapas.net/tag/html.html">html</a>,    <a href="https://www.spapas.net/tag/javascript.html">javascript</a>,    <a href="https://www.spapas.net/tag/media.html">media</a>,    <a href="https://www.spapas.net/tag/storage.html">storage</a>,    <a href="https://www.spapas.net/tag/unpoly.html">unpoly</a>,    <a href="https://www.spapas.net/tag/access.html">access</a>,    <a href="https://www.spapas.net/tag/database.html">database</a>,    <a href="https://www.spapas.net/tag/accdb.html">accdb</a>,    <a href="https://www.spapas.net/tag/mdb.html">mdb</a>,    <a href="https://www.spapas.net/tag/postgresql.html">postgresql</a>,    <a href="https://www.spapas.net/tag/development.html">development</a>,    <a href="https://www.spapas.net/tag/inlines.html">inlines</a>,    <a href="https://www.spapas.net/tag/clojure.html">clojure</a>,    <a href="https://www.spapas.net/tag/cmd.html">cmd</a>,    <a href="https://www.spapas.net/tag/pdf.html">pdf</a>,    <a href="https://www.spapas.net/tag/wkhtmltopdf.html">wkhtmltopdf</a>,    <a href="https://www.spapas.net/tag/forward-proxy.html">forward-proxy</a>,    <a href="https://www.spapas.net/tag/reverse-proxy.html">reverse-proxy</a>,    <a href="https://www.spapas.net/tag/proxy.html">proxy</a>,    <a href="https://www.spapas.net/tag/networking.html">networking</a>,    <a href="https://www.spapas.net/tag/dj-rest-auth.html">dj-rest-auth</a>,    <a href="https://www.spapas.net/tag/rest.html">rest</a>,    <a href="https://www.spapas.net/tag/django-rest-framework.html">django-rest-framework</a>,    <a href="https://www.spapas.net/tag/authentication.html">authentication</a>,    <a href="https://www.spapas.net/tag/tokens.html">tokens</a>,    <a href="https://www.spapas.net/tag/migrations.html">migrations</a>,    <a href="https://www.spapas.net/tag/foreignkey.html">foreignkey</a>,    <a href="https://www.spapas.net/tag/dark-souls.html">dark-souls</a>,    <a href="https://www.spapas.net/tag/dark-souls-2.html">dark-souls-2</a>,    <a href="https://www.spapas.net/tag/dark-souls-3.html">dark-souls-3</a>,    <a href="https://www.spapas.net/tag/autohotkey.html">autohotkey</a>,    <a href="https://www.spapas.net/tag/matplotlib.html">matplotlib</a>,    <a href="https://www.spapas.net/tag/hashids.html">hashids</a>,    <a href="https://www.spapas.net/tag/wagtail.html">wagtail</a>,    <a href="https://www.spapas.net/tag/osmon.html">osmon</a>,    <a href="https://www.spapas.net/tag/phoenix.html">phoenix</a>,    <a href="https://www.spapas.net/tag/os-monitoring.html">os-monitoring</a>,    <a href="https://www.spapas.net/tag/forms.html">forms</a>,    <a href="https://www.spapas.net/tag/django-crispy-forms.html">django-crispy-forms</a>,    <a href="https://www.spapas.net/tag/django-widget-tweaks.html">django-widget-tweaks</a>,    <a href="https://www.spapas.net/tag/ecto.html">ecto</a>,    <a href="https://www.spapas.net/tag/queries.html">queries</a>,    <a href="https://www.spapas.net/tag/declarative.html">declarative</a>,    <a href="https://www.spapas.net/tag/form.html">form</a>,    <a href="https://www.spapas.net/tag/php.html">php</a>,    <a href="https://www.spapas.net/tag/select2.html">select2</a>,    <a href="https://www.spapas.net/tag/autocompelte.html">autocompelte</a>,    <a href="https://www.spapas.net/tag/ajax.html">ajax</a>,    <a href="https://www.spapas.net/tag/android.html">android</a>,    <a href="https://www.spapas.net/tag/kotlin.html">kotlin</a>,    <a href="https://www.spapas.net/tag/adapter.html">adapter</a>,    <a href="https://www.spapas.net/tag/filter.html">filter</a>,    <a href="https://www.spapas.net/tag/async.html">async</a>,    <a href="https://www.spapas.net/tag/tasks.html">tasks</a>,    <a href="https://www.spapas.net/tag/django-rq.html">django-rq</a>,    <a href="https://www.spapas.net/tag/rq.html">rq</a>,    <a href="https://www.spapas.net/tag/du.html">du</a>,    <a href="https://www.spapas.net/tag/unix.html">unix</a>,    <a href="https://www.spapas.net/tag/linux.html">linux</a>,    <a href="https://www.spapas.net/tag/disk-usage.html">disk-usage</a>,    <a href="https://www.spapas.net/tag/cbv.html">cbv</a>,    <a href="https://www.spapas.net/tag/middleware.html">middleware</a>,    <a href="https://www.spapas.net/tag/class-based-views.html">class-based-views</a>,    <a href="https://www.spapas.net/tag/react.html">react</a>,    <a href="https://www.spapas.net/tag/redux.html">redux</a>,    <a href="https://www.spapas.net/tag/hyperapp.html">hyperapp</a>,    <a href="https://www.spapas.net/tag/immutable.html">immutable</a>,    <a href="https://www.spapas.net/tag/es6.html">es6</a>,    <a href="https://www.spapas.net/tag/youtube.html">youtube</a>,    <a href="https://www.spapas.net/tag/youtube-dl.html">youtube-dl</a>,    <a href="https://www.spapas.net/tag/ffmpeg.html">ffmpeg</a>,    <a href="https://www.spapas.net/tag/django-rest-auth.html">django-rest-auth</a>,    <a href="https://www.spapas.net/tag/python-2.html">python-2</a>,    <a href="https://www.spapas.net/tag/python-3.html">python-3</a>,    <a href="https://www.spapas.net/tag/plpgsql.html">plpgsql</a>,    <a href="https://www.spapas.net/tag/component.html">component</a>,    <a href="https://www.spapas.net/tag/ag-grid.html">ag-grid</a>,    <a href="https://www.spapas.net/tag/grid.html">grid</a>,    <a href="https://www.spapas.net/tag/bash.html">bash</a>,    <a href="https://www.spapas.net/tag/cron.html">cron</a>,    <a href="https://www.spapas.net/tag/pandas.html">pandas</a>,    <a href="https://www.spapas.net/tag/scipy.html">scipy</a>,    <a href="https://www.spapas.net/tag/numpy.html">numpy</a>,    <a href="https://www.spapas.net/tag/pivot.html">pivot</a>,    <a href="https://www.spapas.net/tag/pivot_table.html">pivot_table</a>,    <a href="https://www.spapas.net/tag/ipython.html">ipython</a>,    <a href="https://www.spapas.net/tag/jupyter.html">jupyter</a>,    <a href="https://www.spapas.net/tag/notebook.html">notebook</a>,    <a href="https://www.spapas.net/tag/query.html">query</a>,    <a href="https://www.spapas.net/tag/q.html">q</a>,    <a href="https://www.spapas.net/tag/imgur.html">imgur</a>,    <a href="https://www.spapas.net/tag/console.html">console</a>,    <a href="https://www.spapas.net/tag/research.html">research</a>,    <a href="https://www.spapas.net/tag/debug.html">debug</a>,    <a href="https://www.spapas.net/tag/werkzeug.html">werkzeug</a>,    <a href="https://www.spapas.net/tag/django-extensions.html">django-extensions</a>,    <a href="https://www.spapas.net/tag/404.html">404</a>,    <a href="https://www.spapas.net/tag/error.html">error</a>,    <a href="https://www.spapas.net/tag/spring.html">spring</a>,    <a href="https://www.spapas.net/tag/spring-boot.html">spring-boot</a>,    <a href="https://www.spapas.net/tag/java.html">java</a>,    <a href="https://www.spapas.net/tag/ldap.html">ldap</a>,    <a href="https://www.spapas.net/tag/profiles.html">profiles</a>,    <a href="https://www.spapas.net/tag/settings.html">settings</a>,    <a href="https://www.spapas.net/tag/properties.html">properties</a>,    <a href="https://www.spapas.net/tag/yaml.html">yaml</a>,    <a href="https://www.spapas.net/tag/configuration.html">configuration</a>,    <a href="https://www.spapas.net/tag/deploy.html">deploy</a>,    <a href="https://www.spapas.net/tag/initd.html">init.d</a>,    <a href="https://www.spapas.net/tag/react-redux.html">react-redux</a>,    <a href="https://www.spapas.net/tag/redux-thunk.html">redux-thunk</a>,    <a href="https://www.spapas.net/tag/redux-form.html">redux-form</a>,    <a href="https://www.spapas.net/tag/react-router.html">react-router</a>,    <a href="https://www.spapas.net/tag/react-router-redux.html">react-router-redux</a>,    <a href="https://www.spapas.net/tag/react-notification.html">react-notification</a>,    <a href="https://www.spapas.net/tag/history.html">history</a>,    <a href="https://www.spapas.net/tag/babel.html">babel</a>,    <a href="https://www.spapas.net/tag/babelify.html">babelify</a>,    <a href="https://www.spapas.net/tag/browserify.html">browserify</a>,    <a href="https://www.spapas.net/tag/watchify.html">watchify</a>,    <a href="https://www.spapas.net/tag/uglify.html">uglify</a>,    <a href="https://www.spapas.net/tag/boilerplate.html">boilerplate</a>,    <a href="https://www.spapas.net/tag/tutorial.html">tutorial</a>,    <a href="https://www.spapas.net/tag/introduction.html">introduction</a>,    <a href="https://www.spapas.net/tag/fixed-data-tables.html">fixed-data-tables</a>,    <a href="https://www.spapas.net/tag/fixeddatatable.html">FixedDataTable</a>,    <a href="https://www.spapas.net/tag/reportlab.html">reportlab</a>,    <a href="https://www.spapas.net/tag/xhtml2pdf.html">xhtml2pdf</a>,    <a href="https://www.spapas.net/tag/node.html">node</a>,    <a href="https://www.spapas.net/tag/npm.html">npm</a>,    <a href="https://www.spapas.net/tag/generic.html">generic</a>,    <a href="https://www.spapas.net/tag/tables.html">tables</a>,    <a href="https://www.spapas.net/tag/flux.html">flux</a>,    <a href="https://www.spapas.net/tag/jobs.html">jobs</a>,    <a href="https://www.spapas.net/tag/asynchronous.html">asynchronous</a>,    <a href="https://www.spapas.net/tag/scheduling.html">scheduling</a>,    <a href="https://www.spapas.net/tag/redis.html">redis</a>,    <a href="https://www.spapas.net/tag/pusher.html">pusher</a>,    <a href="https://www.spapas.net/tag/auditing.html">auditing</a>,    <a href="https://www.spapas.net/tag/css.html">css</a>,    <a href="https://www.spapas.net/tag/design.html">design</a>,    <a href="https://www.spapas.net/tag/boostrap-material-design.html">boostrap-material-design</a>,    <a href="https://www.spapas.net/tag/less.html">less</a>,    <a href="https://www.spapas.net/tag/nodejs.html">node.js</a>,    <a href="https://www.spapas.net/tag/gmail.html">gmail</a>,    <a href="https://www.spapas.net/tag/security.html">security</a>,    <a href="https://www.spapas.net/tag/google.html">google</a>,    <a href="https://www.spapas.net/tag/flask.html">flask</a>,    <a href="https://www.spapas.net/tag/mongodb.html">mongodb</a>,    <a href="https://www.spapas.net/tag/heroku.html">heroku</a>,    <a href="https://www.spapas.net/tag/spring-security.html">spring-security</a>,    <a href="https://www.spapas.net/tag/git.html">git</a>,    <a href="https://www.spapas.net/tag/github.html">github</a>,    <a href="https://www.spapas.net/tag/branching.html">branching</a>,    <a href="https://www.spapas.net/tag/static-html.html">static-html</a>,    <a href="https://www.spapas.net/tag/githubio.html">github.io</a>,    <a href="https://www.spapas.net/tag/pelican.html">pelican</a>,    <a href="https://www.spapas.net/tag/github-pages.html">github-pages</a>,    <a href="https://www.spapas.net/tag/rst.html">rst</a>  </section>

  <section>
    <h1>Yearly archives</h1>
    <a href="https://www.spapas.net/posts/2013/">2013</a>,    <a href="https://www.spapas.net/posts/2014/">2014</a>,    <a href="https://www.spapas.net/posts/2015/">2015</a>,    <a href="https://www.spapas.net/posts/2016/">2016</a>,    <a href="https://www.spapas.net/posts/2017/">2017</a>,    <a href="https://www.spapas.net/posts/2018/">2018</a>,    <a href="https://www.spapas.net/posts/2019/">2019</a>,    <a href="https://www.spapas.net/posts/2020/">2020</a>,    <a href="https://www.spapas.net/posts/2021/">2021</a>,    <a href="https://www.spapas.net/posts/2022/">2022</a>,    <a href="https://www.spapas.net/posts/2023/">2023</a>,    <a href="https://www.spapas.net/posts/2024/">2024</a>  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/spapas">@spapas</a> on GitHub
    <script  src="//code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script type="text/javascript">
      $(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = 'https://www.spapas.net/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'spapas',
              count: 5,
              skip_forks: true,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="https://www.spapas.net/theme/js/github.js" type="text/javascript"> </script>
  </section>


  <section>
    <a href="https://twitter.com/_serafeim_?ref_src=twsrc%5Etfw" class="twitter-follow-button"
      data-show-count="false">Follow @_serafeim_</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2013&ndash;2024  Serafeim Papastefanos &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="https://www.spapas.net/theme/js/modernizr-2.0.js"></script>
  <script src="https://www.spapas.net/theme/js/ender.js"></script>
  <script src="https://www.spapas.net/theme/js/octopress.js" type="text/javascript"></script>
  <script src="https://www.spapas.net/theme/js/ads.js"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44750952-1', 'auto');

    ga('send', 'pageview');
    </script>

<script defer data-domain="spapas.net" src="https://plausible.hcg.gr/js/script.js"></script>  <script type="text/javascript">
    var disqus_shortname = 'spapas-github-io';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>

</body>

</html>